<!DOCTYPE html>
<html><head><meta charset=utf-8><title>jail(8)</title><keywords content=man,jail></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>jail(8)</h1><table class=head><tr><td class=head-ltitle>JAIL(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>JAIL(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>jail</code> — <div class=Nd>manage system jails</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>jail</code></td><td>[<code class=Fl>-dhilqv</code>] [<code class=Fl>-J</code><var class=Ar>jid_file</var>] [<code class=Fl>-u</code><var class=Ar>username</var>] [<code class=Fl>-U</code><var class=Ar>username</var>] [<code class=Fl>-cmr</code>] <var class=Ar>param</var>=<var class=Ar>value ...</var> [<code class=Cm>command</code>=<var class=Ar>command ...</var>]</td></tr></table><br><table class=Nm><tr><td><code class=Nm>jail</code></td><td>[<code class=Fl>-dqv</code>] [<code class=Fl>-f</code><var class=Ar>conf_file</var>] [<code class=Fl>-p</code><var class=Ar>limit</var>] [<code class=Fl>-cmr</code>] [<var class=Ar>jail</var>]</td></tr></table><br><table class=Nm><tr><td><code class=Nm>jail</code></td><td>[<code class=Fl>-qv</code>] [<code class=Fl>-f</code><var class=Ar>conf_file</var>] [<code class=Fl>-rR</code>] [<code class=Cm>*</code> | <var class=Ar>jail ...</var>]</td></tr></table><br><table class=Nm><tr><td><code class=Nm>jail</code></td><td>[<code class=Fl>-dhilqv</code>] [<code class=Fl>-J</code><var class=Ar>jid_file</var>] [<code class=Fl>-u</code><var class=Ar>username</var>] [<code class=Fl>-U</code><var class=Ar>username</var>] [<code class=Fl>-n</code><var class=Ar>jailname</var>] [<code class=Fl>-s</code><var class=Ar>securelevel</var>] <var class=Ar>path hostname ip</var>[<code class=Cm>,</code><var class=Ar>...</var>] <var class=Ar>command ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>jail</code></td><td>[<code class=Fl>-f</code><var class=Ar>conf_file</var>] <code class=Fl>-e</code><var class=Ar>separator</var></td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>jail</code> utility creates new jails, or modifies or removes existing jails. It can also print a list of configured jails and their parameters. A jail (or “prison”) is specified via parameters on the command line, or in the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file. <p class=Pp>At least one of the options <code class=Fl>-c</code>, <code class=Fl>-e</code>, <code class=Fl>-m</code> or <code class=Fl>-r</code> must be specified. These options are used alone or in combination to describe the operation to perform:</p><dl class=Bl-tag><dt><a class=permalink href=#c><code class=Fl id=c>-c</code></a></dt><dd>Create a new jail. The jail <var class=Va>jid</var> and <var class=Va>name</var> parameters (if specified on the command line) must not refer to an existing jail.</dd><dt><a class=permalink href=#e><code class=Fl id=e>-e</code></a><var class=Ar>separator</var></dt><dd>Exhibit a list of all configured non-wildcard jails and their parameters. No jail creation, modification or removal performed if this option is used. The <var class=Ar>separator</var> string is used to separate parameters. Use <a class=Xr href=jls.8.html>jls(8)</a> utility to list running jails.</dd><dt><a class=permalink href=#m><code class=Fl id=m>-m</code></a></dt><dd>Modify an existing jail. One of the <var class=Va>jid</var> or <var class=Va>name</var> parameters must exist and refer to an existing jail. Some parameters may not be changed on a running jail.</dd><dt><a class=permalink href=#r><code class=Fl id=r>-r</code></a></dt><dd>Remove the <var class=Ar>jail</var> specified by jid or name. All jailed processes are killed, and all jails that are children of this jail are also removed.</dd><dt><a class=permalink href=#rc><code class=Fl id=rc>-rc</code></a></dt><dd>Restart an existing jail. The jail is first removed and then re-created, as if “<code class=Nm>jail</code><code class=Fl>-r</code>” and “<code class=Nm>jail</code><code class=Fl>-c</code>” were run in succession.</dd><dt><a class=permalink href=#cm><code class=Fl id=cm>-cm</code></a></dt><dd>Create a jail if it does not exist, or modify the jail if it does exist.</dd><dt><a class=permalink href=#mr><code class=Fl id=mr>-mr</code></a></dt><dd>Modify an existing jail. The jail may be restarted if necessary to modify parameters than could not otherwise be changed.</dd><dt><a class=permalink href=#cmr><code class=Fl id=cmr>-cmr</code></a></dt><dd>Create a jail if it doesn't exist, or modify (and possibly restart) the jail if it does exist.</dd></dl><p class=Pp>Other available options are:</p><dl class=Bl-tag><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a></dt><dd>Allow making changes to a dying jail, equivalent to the <var class=Va>allow.dying</var> parameter.</dd><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a><var class=Ar>conf_file</var></dt><dd>Use configuration file <var class=Ar>conf_file</var> instead of the default <span class=Pa>/etc/jail.conf</span>.</dd><dt><a class=permalink href=#h><code class=Fl id=h>-h</code></a></dt><dd>Resolve the <var class=Va>host.hostname</var> parameter (or <var class=Va>hostname</var>) and add all IP addresses returned by the resolver to the list of addresses for this jail. This is equivalent to the <var class=Va>ip_hostname</var> parameter.</dd><dt><a class=permalink href=#i><code class=Fl id=i>-i</code></a></dt><dd>Output (only) the jail identifier of the newly created jail(s). This implies the <code class=Fl>-q</code> option.</dd><dt><a class=permalink href=#J><code class=Fl id=J>-J</code></a><var class=Ar>jid_file</var></dt><dd>Write a <var class=Ar>jid_file</var> file, containing the parameters used to start the jail.</dd><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a></dt><dd>Run commands in a clean environment. This is deprecated and is equivalent to the exec.clean parameter.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a><var class=Ar>jailname</var></dt><dd>Set the jail's name. This is deprecated and is equivalent to the <var class=Va>name</var> parameter.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a><var class=Ar>limit</var></dt><dd>Limit the number of commands from <var class=Va>exec.*</var> that can run simultaneously.</dd><dt><a class=permalink href=#q><code class=Fl id=q>-q</code></a></dt><dd>Suppress the message printed whenever a jail is created, modified or removed. Only error messages will be printed.</dd><dt><a class=permalink href=#R><code class=Fl id=R>-R</code></a></dt><dd>A variation of the <code class=Fl>-r</code> option that removes an existing jail without using the configuration file. No removal-related parameters for this jail will be used — the jail will simply be removed.</dd><dt><a class=permalink href=#s><code class=Fl id=s>-s</code></a><var class=Ar>securelevel</var></dt><dd>Set the <var class=Va>kern.securelevel</var> MIB entry to the specified value inside the newly created jail. This is deprecated and is equivalent to the <var class=Va>securelevel</var> parameter.</dd><dt><a class=permalink href=#u><code class=Fl id=u>-u</code></a><var class=Ar>username</var></dt><dd>The user name from host environment as whom jailed commands should run. This is deprecated and is equivalent to the <var class=Va>exec.jail_user</var> and <var class=Va>exec.system_jail_user</var> parameters.</dd><dt><a class=permalink href=#U><code class=Fl id=U>-U</code></a><var class=Ar>username</var></dt><dd>The user name from the jailed environment as whom jailed commands should run. This is deprecated and is equivalent to the <var class=Va>exec.jail_user</var> parameter.</dd><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Print a message on every operation, such as running commands and mounting filesystems.</dd></dl><p class=Pp>If no arguments are given after the options, the operation (except remove) will be performed on all jails specified in the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file. A single argument of a jail name will operate only on the specified jail. The <code class=Fl>-r</code> and <code class=Fl>-R</code> options can also remove running jails that aren't in the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file, specified by name or jid.</p><p class=Pp>An argument of “*” is a wildcard that will operate on all jails, regardless of whether they appear in <a class=Xr href=jail.conf.5.html>jail.conf(5)</a>; this is the surest way for <code class=Fl>-r</code> to remove all jails. If hierarchical jails exist, a partial-matching wildcard definition may be specified. For example, an argument of “foo.*” would apply to jails with names like “foo.bar” and “foo.bar.baz”.</p><p class=Pp>A jail may be specified with parameters directly on the command line. In this case, the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file will not be used. For backward compatibility, the command line may also have four fixed parameters, without names: <var class=Ar>path</var>, <var class=Ar>hostname</var>, <var class=Ar>ip</var>, and <var class=Ar>command</var>. This mode will always create a new jail, and the <code class=Fl>-c</code> and <code class=Fl>-m</code> options do not apply (and must not be present).</p><section class=Ss><h2 class=Ss id=Jail_Parameters><a class=permalink href=#Jail_Parameters>Jail Parameters</a></h2> Parameters in the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file, or on the command line, are generally of the form “name=value”. Some parameters are boolean, and do not have a value but are set by the name alone with or without a “no” prefix, e.g. <var class=Va>persist</var> or <var class=Va>nopersist</var>. They can also be given the values “true” and “false”. Other parameters may have more than one value, specified as a comma-separated list or with “+=” in the configuration file (see <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> for details). <p class=Pp>The <code class=Nm>jail</code> utility recognizes two classes of parameters. There are the true jail parameters that are passed to the kernel when the jail is created, which can be seen with <a class=Xr href=jls.8.html>jls(8)</a>, and can (usually) be changed with “<code class=Nm>jail</code><code class=Fl>-m</code>”. Then there are pseudo-parameters that are only used by <code class=Nm>jail</code> itself.</p><p class=Pp>Jails have a set of core parameters, and kernel modules can add their own jail parameters. The current set of available parameters can be retrieved via “<code class=Nm>sysctl</code><code class=Fl>-d</code><var class=Va>security.jail.param</var>”. Any parameters not set will be given default values, often based on the current environment. The core parameters are:</p><dl class=Bl-tag><dt><var class=Va>jid</var></dt><dd>The jail identifier. This will be assigned automatically to a new jail (or can be explicitly set), and can be used to identify the jail for later modification, or for such commands as <a class=Xr href=jls.8.html>jls(8)</a> or <a class=Xr href=jexec.8.html>jexec(8)</a>.</dd><dt><var class=Va>name</var></dt><dd>The jail name. This is an arbitrary string that identifies a jail (except it may not contain a ‘.’). Like the <var class=Va>jid</var>, it can be passed to later <code class=Nm>jail</code> commands, or to <a class=Xr href=jls.8.html>jls(8)</a> or <a class=Xr href=jexec.8.html>jexec(8)</a>. If no <var class=Va>name</var> is supplied, a default is assumed that is the same as the <var class=Va>jid</var>. The <var class=Va>name</var> parameter is implied by the <a class=Xr href=jail.conf.5.html>jail.conf(5)</a> file format, and need not be explicitly set when using the configuration file.</dd><dt><var class=Va>path</var></dt><dd>The directory which is to be the root of the jail. Any commands run inside the jail, either by <code class=Nm>jail</code> or from <a class=Xr href=jexec.8.html>jexec(8)</a>, are run from this directory.</dd><dt><var class=Va>ip4.addr</var></dt><dd>A list of IPv4 addresses assigned to the jail. If this is set, the jail is restricted to using only these addresses. Any attempts to use other addresses fail, and attempts to use wildcard addresses silently use the jailed address instead. For IPv4 the first address given will be used as the source address when source address selection on unbound sockets cannot find a better match. It is only possible to start multiple jails with the same IP address if none of the jails has more than this single overlapping IP address assigned to itself.</dd><dt><var class=Va>ip4.saddrsel</var></dt><dd>A boolean option to change the formerly mentioned behaviour and disable IPv4 source address selection for the jail in favour of the primary IPv4 address of the jail. Source address selection is enabled by default for all jails and the <var class=Va>ip4.nosaddrsel</var> setting of a parent jail is not inherited for any child jails.</dd><dt><var class=Va>ip4</var></dt><dd>Control the availability of IPv4 addresses. Possible values are “inherit” to allow unrestricted access to all system addresses, “new” to restrict addresses via <var class=Va>ip4.addr</var>, and “disable” to stop the jail from using IPv4 entirely. Setting the <var class=Va>ip4.addr</var> parameter implies a value of “new”.</dd><dt><var class=Va>ip6.addr</var>, <var class=Va>ip6.saddrsel</var>, <var class=Va>ip6</var></dt><dd>A set of IPv6 options for the jail, the counterparts to <var class=Va>ip4.addr</var>, <var class=Va>ip4.saddrsel</var> and <var class=Va>ip4</var> above.</dd><dt><var class=Va>vnet</var></dt><dd>Create the jail with its own virtual network stack, with its own network interfaces, addresses, routing table, etc. The kernel must have been compiled with the <b class=Sy>VIMAGE option</b> for this to be available. Possible values are “inherit” to use the system network stack, possibly with restricted IP addresses, and “new” to create a new network stack.</dd><dt><var class=Va>host.hostname</var></dt><dd>The hostname of the jail. Other similar parameters are <var class=Va>host.domainname</var>, <var class=Va>host.hostuuid</var> and <var class=Va>host.hostid</var>.</dd><dt><var class=Va>host</var></dt><dd>Set the origin of hostname and related information. Possible values are “inherit” to use the system information and “new” for the jail to use the information from the above fields. Setting any of the above fields implies a value of “new”.</dd><dt><var class=Va>securelevel</var></dt><dd>The value of the jail's <var class=Va>kern.securelevel</var> sysctl. A jail never has a lower securelevel than its parent system, but by setting this parameter it may have a higher one. If the system securelevel is changed, any jail securelevels will be at least as secure.</dd><dt><var class=Va>devfs_ruleset</var></dt><dd>The number of the devfs ruleset that is enforced for mounting devfs in this jail. A value of zero (default) means no ruleset is enforced. Descendant jails inherit the parent jail's devfs ruleset enforcement. Mounting devfs inside a jail is possible only if the <var class=Va>allow.mount</var> and <var class=Va>allow.mount.devfs</var> permissions are effective and <var class=Va>enforce_statfs</var> is set to a value lower than 2. Devfs rules and rulesets cannot be viewed or modified from inside a jail. <p class=Pp>NOTE: It is important that only appropriate device nodes in devfs be exposed to a jail; access to disk devices in the jail may permit processes in the jail to bypass the jail sandboxing by modifying files outside of the jail. See <a class=Xr href=devfs.8.html>devfs(8)</a> for information on how to use devfs rules to limit access to entries in the per-jail devfs. A simple devfs ruleset for jails is available as ruleset #4 in <span class=Pa>/etc/defaults/devfs.rules</span>.</p></dd><dt><var class=Va>children.max</var></dt><dd>The number of child jails allowed to be created by this jail (or by other jails under this jail). This limit is zero by default, indicating the jail is not allowed to create child jails. See the <a class=Sx href=#Hierarchical_Jails>Hierarchical Jails</a> section for more information.</dd><dt><var class=Va>children.cur</var></dt><dd>The number of descendants of this jail, including its own child jails and any jails created under them.</dd><dt><var class=Va>enforce_statfs</var></dt><dd>This determines what information processes in a jail are able to get about mount points. It affects the behaviour of the following syscalls: <a class=Xr href=statfs.2.html>statfs(2)</a>, <a class=Xr href=fstatfs.2.html>fstatfs(2)</a>, <a class=Xr href=getfsstat.2.html>getfsstat(2)</a>, and <a class=Xr href=fhstatfs.2.html>fhstatfs(2)</a> (as well as similar compatibility syscalls). When set to 0, all mount points are available without any restrictions. When set to 1, only mount points below the jail's chroot directory are visible. In addition to that, the path to the jail's chroot directory is removed from the front of their pathnames. When set to 2 (default), above syscalls can operate only on a mount-point where the jail's chroot directory is located.</dd><dt><var class=Va>persist</var></dt><dd>Setting this boolean parameter allows a jail to exist without any processes. Normally, a command is run as part of jail creation, and then the jail is destroyed as its last process exits. A new jail must have either the <var class=Va>persist</var> parameter or <var class=Va>exec.start</var> or <var class=Va>command</var> pseudo-parameter set.</dd><dt><var class=Va>cpuset.id</var></dt><dd>The ID of the cpuset associated with this jail (read-only).</dd><dt><var class=Va>dying</var></dt><dd>This is true if the jail is in the process of shutting down (read-only).</dd><dt><var class=Va>parent</var></dt><dd>The <var class=Va>jid</var> of the parent of this jail, or zero if this is a top-level jail (read-only).</dd><dt><var class=Va>osrelease</var></dt><dd>The string for the jail's <var class=Va>kern.osrelease</var> sysctl and uname -r.</dd><dt><var class=Va>osreldate</var></dt><dd>The number for the jail's <var class=Va>kern.osreldate</var> and uname -K.</dd><dt><var class=Va>allow.*</var></dt><dd>Some restrictions of the jail environment may be set on a per-jail basis. With the exception of <var class=Va>allow.set_hostname</var> and <var class=Va>allow.reserved_ports</var>, these boolean parameters are off by default. <dl class=Bl-tag><dt><var class=Va>allow.set_hostname</var></dt><dd>The jail's hostname may be changed via <a class=Xr href=hostname.1.html>hostname(1)</a> or <a class=Xr href=sethostname.3.html>sethostname(3)</a>.</dd><dt><var class=Va>allow.sysvipc</var></dt><dd>A process within the jail has access to System V IPC primitives. This is deprecated in favor of the per-module parameters (see below). When this parameter is set, it is equivalent to setting <var class=Va>sysvmsg</var>, <var class=Va>sysvsem</var>, and <var class=Va>sysvshm</var> all to “inherit”.</dd><dt><var class=Va>allow.raw_sockets</var></dt><dd>The jail root is allowed to create raw sockets. Setting this parameter allows utilities like <a class=Xr href=ping.8.html>ping(8)</a> and <a class=Xr href=traceroute.8.html>traceroute(8)</a> to operate inside the jail. If this is set, the source IP addresses are enforced to comply with the IP address bound to the jail, regardless of whether or not the <code class=Dv>IP_HDRINCL</code> flag has been set on the socket. Since raw sockets can be used to configure and interact with various network subsystems, extra caution should be used where privileged access to jails is given out to untrusted parties.</dd><dt><var class=Va>allow.chflags</var></dt><dd>Normally, privileged users inside a jail are treated as unprivileged by <a class=Xr href=chflags.2.html>chflags(2)</a>. When this parameter is set, such users are treated as privileged, and may manipulate system file flags subject to the usual constraints on <var class=Va>kern.securelevel</var>.</dd><dt><var class=Va>allow.mount</var></dt><dd>privileged users inside the jail will be able to mount and unmount file system types marked as jail-friendly. The <a class=Xr href=lsvfs.1.html>lsvfs(1)</a> command can be used to find file system types available for mount from within a jail. This permission is effective only if <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.devfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the devfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2. The devfs ruleset should be restricted from the default by using the <var class=Va>devfs_ruleset</var> option.</dd><dt><var class=Va>allow.quotas</var></dt><dd>The jail root may administer quotas on the jail's filesystem(s). This includes filesystems that the jail may share with other jails or with non-jailed parts of the system.</dd><dt><var class=Va>allow.read_msgbuf</var></dt><dd>Jailed users may read the kernel message buffer. If the <var class=Va>security.bsd.unprivileged_read_msgbuf</var> MIB entry is zero, this will be restricted to the root user.</dd><dt><var class=Va>allow.socket_af</var></dt><dd>Sockets within a jail are normally restricted to IPv4, IPv6, local (UNIX), and route. This allows access to other protocol stacks that have not had jail functionality added to them.</dd><dt><var class=Va>allow.mlock</var></dt><dd>Locking or unlocking physical pages in memory are normally not available within a jail. When this parameter is set, users may <a class=Xr href=mlock.2.html>mlock(2)</a> or <a class=Xr href=munlock.2.html>munlock(2)</a> memory subject to <var class=Va>security.bsd.unprivileged_mlock</var> and resource limits.</dd><dt><var class=Va>allow.reserved_ports</var></dt><dd>The jail root may bind to ports lower than 1024.</dd><dt><var class=Va>allow.unprivileged_proc_debug</var></dt><dd>Unprivileged processes in the jail may use debugging facilities.</dd><dt><var class=Va>allow.suser</var></dt><dd>The value of the jail's <var class=Va>security.bsd.suser_enabled</var> sysctl. The super-user will be disabled automatically if its parent system has it disabled. The super-user is enabled by default.</dd></dl></dd></dl><p class=Pp>Kernel modules may add their own parameters, which only exist when the module is loaded. These are typically headed under a parameter named after the module, with values of “inherit” to give the jail full use of the module, “new” to encapsulate the jail in some module-specific way, and “disable” to make the module unavailable to the jail. There also may be other parameters to define jail behavior within the module. Module-specific parameters include:</p><dl class=Bl-tag><dt><var class=Va>allow.mount.fdescfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the fdescfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.fusefs</var></dt><dd>privileged users inside the jail will be able to mount and unmount fuse-based file systems. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.nullfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the nullfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.procfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the procfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.linprocfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the linprocfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.linsysfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the linsysfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.tmpfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the tmpfs file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2.</dd><dt><var class=Va>allow.mount.zfs</var></dt><dd>privileged users inside the jail will be able to mount and unmount the ZFS file system. This permission is effective only together with <var class=Va>allow.mount</var> and only when <var class=Va>enforce_statfs</var> is set to a value lower than 2. See <a class=Xr href=zfs.8.html>zfs(8)</a> for information on how to configure the ZFS filesystem to operate from within a jail.</dd><dt><var class=Va>allow.vmm</var></dt><dd>The jail may access <a class=Xr href=vmm.4.html>vmm(4)</a>. This flag is only available when the <a class=Xr href=vmm.4.html>vmm(4)</a> kernel module is loaded.</dd><dt><var class=Va>linux</var></dt><dd>Determine how a jail's Linux emulation environment appears. A value of “inherit” will keep the same environment, and “new” will give the jail its own environment (still originally inherited when the jail is created).</dd><dt><var class=Va>linux.osname</var>, <var class=Va>linux.osrelease</var>, <var class=Va>linux.oss_version</var></dt><dd>The Linux OS name, OS release, and OSS version associated with this jail.</dd><dt><var class=Va>sysvmsg</var></dt><dd>Allow access to SYSV IPC message primitives. If set to “inherit”, all IPC objects on the system are visible to this jail, whether they were created by the jail itself, the base system, or other jails. If set to “new”, the jail will have its own key namespace, and can only see the objects that it has created; the system (or parent jail) has access to the jail's objects, but not to its keys. If set to “disable”, the jail cannot perform any sysvmsg-related system calls.</dd><dt><var class=Va>sysvsem, sysvshm</var></dt><dd>Allow access to SYSV IPC semaphore and shared memory primitives, in the same manner as <var class=Va>sysvmsg.</var></dd></dl><p class=Pp>There are pseudo-parameters that are not passed to the kernel, but are used by <code class=Nm>jail</code> to set up the jail environment, often by running specified commands when jails are created or removed. The <var class=Va>exec.*</var> command parameters are <a class=Xr href=sh.1.html>sh(1)</a> command lines that are run in either the system or jail environment. They may be given multiple values, which would run the specified commands in sequence. All commands must succeed (return a zero exit status), or the jail will not be created or removed, as appropriate.</p><p class=Pp>The pseudo-parameters are:</p><dl class=Bl-tag><dt><var class=Va>exec.prepare</var></dt><dd>Command(s) to run in the system environment to prepare a jail for creation. These commands are executed before assigning IP addresses and mounting filesystems, so they may be used to create a new jail filesystem if it does not already exist.</dd><dt><var class=Va>exec.prestart</var></dt><dd>Command(s) to run in the system environment before a jail is created.</dd><dt><var class=Va>exec.created</var></dt><dd>Command(s) to run in the system environment right after a jail has been created, but before commands (or services) get executed in the jail.</dd><dt><var class=Va>exec.start</var></dt><dd>Command(s) to run in the jail environment when a jail is created. A typical command to run is “sh /etc/rc”.</dd><dt><var class=Va>command</var></dt><dd>A synonym for <var class=Va>exec.start</var> for use when specifying a jail directly on the command line. Unlike other parameters whose value is a single string, <var class=Va>command</var> uses the remainder of the <code class=Nm>jail</code> command line as its own arguments.</dd><dt><var class=Va>exec.poststart</var></dt><dd>Command(s) to run in the system environment after a jail is created, and after any <var class=Va>exec.start</var> commands have completed.</dd><dt><var class=Va>exec.prestop</var></dt><dd>Command(s) to run in the system environment before a jail is removed.</dd><dt><var class=Va>exec.stop</var></dt><dd>Command(s) to run in the jail environment before a jail is removed, and after any <var class=Va>exec.prestop</var> commands have completed. A typical command to run is “sh /etc/rc.shutdown jail”.</dd><dt><var class=Va>exec.poststop</var></dt><dd>Command(s) to run in the system environment after a jail is removed.</dd><dt><var class=Va>exec.release</var></dt><dd>Command(s) to run in the system environment after all other actions are done. These commands are executed after unmounting filesystems and removing IP addresses, so they may be used to remove a jail filesystem if it is no longer needed.</dd><dt><var class=Va>exec.clean</var></dt><dd>Run commands in a clean environment. The environment is discarded except for <code class=Ev>HOME</code>, <code class=Ev>SHELL</code>, <code class=Ev>TERM</code> and <code class=Ev>USER</code>. <code class=Ev>HOME</code> and <code class=Ev>SHELL</code> are set to the target login's default values. <code class=Ev>USER</code> is set to the target login. <code class=Ev>TERM</code> is imported from the current environment. The environment variables from the login class capability database for the target login are also set.</dd><dt><var class=Va>exec.jail_user</var></dt><dd>The user to run commands as, when running in the jail environment. The default is to run the commands as the current user.</dd><dt><var class=Va>exec.system_jail_user</var></dt><dd>This boolean option looks for the <var class=Va>exec.jail_user</var> in the system <a class=Xr href=passwd.5.html>passwd(5)</a> file, instead of in the jail's file.</dd><dt><var class=Va>exec.system_user</var></dt><dd>The user to run commands as, when running in the system environment. The default is to run the commands as the current user.</dd><dt><var class=Va>exec.timeout</var></dt><dd>The maximum amount of time to wait for a command to complete, in seconds. If a command is still running after this timeout has passed, the jail will not be created or removed, as appropriate.</dd><dt><var class=Va>exec.consolelog</var></dt><dd>A file to direct command output (stdout and stderr) to.</dd><dt><var class=Va>exec.fib</var></dt><dd>The FIB (routing table) to set when running commands inside the jail.</dd><dt><var class=Va>stop.timeout</var></dt><dd>The maximum amount of time to wait for a jail's processes to exit after sending them a <code class=Dv>SIGTERM</code> signal (which happens after the <var class=Va>exec.stop</var> commands have completed). After this many seconds have passed, the jail will be removed, which will kill any remaining processes. If this is set to zero, no <code class=Dv>SIGTERM</code> is sent and the jail is immediately removed. The default is 10 seconds.</dd><dt><var class=Va>interface</var></dt><dd>A network interface to add the jail's IP addresses (<var class=Va>ip4.addr</var> and <var class=Va>ip6.addr</var>) to. An alias for each address will be added to the interface before the jail is created, and will be removed from the interface after the jail is removed.</dd><dt><var class=Va>ip4.addr</var></dt><dd>In addition to the IP addresses that are passed to the kernel, an interface, netmask and additional parameters (as supported by <a class=Xr href=ifconfig.8.html>ifconfig(8)</a>) may also be specified, in the form “<var class=Ar>interface</var>|<var class=Ar>ip-address</var>/<var class=Ar>netmask param ...</var>”. If an interface is given before the IP address, an alias for the address will be added to that interface, as it is with the <var class=Va>interface</var> parameter. If a netmask in either dotted-quad or CIDR form is given after an IP address, it will be used when adding the IP alias. If additional parameters are specified then they will also be used when adding the IP alias.</dd><dt><var class=Va>ip6.addr</var></dt><dd>In addition to the IP addresses that are passed to the kernel, an interface, prefix and additional parameters (as supported by <a class=Xr href=ifconfig.8.html>ifconfig(8)</a>) may also be specified, in the form “<var class=Ar>interface</var>|<var class=Ar>ip-address</var>/<var class=Ar>prefix param ...</var>”.</dd><dt><var class=Va>vnet.interface</var></dt><dd>A network interface to give to a vnet-enabled jail after is it created. The interface will automatically be released when the jail is removed.</dd><dt><var class=Va>ip_hostname</var></dt><dd>Resolve the <var class=Va>host.hostname</var> parameter and add all IP addresses returned by the resolver to the list of addresses (<var class=Va>ip4.addr</var> or <var class=Va>ip6.addr</var>) for this jail. This may affect default address selection for outgoing IPv4 connections from jails. The address first returned by the resolver for each address family will be used as the primary address.</dd><dt><var class=Va>mount</var></dt><dd>A filesystem to mount before creating the jail (and to unmount after removing it), given as a single <a class=Xr href=fstab.5.html>fstab(5)</a> line.</dd><dt><var class=Va>mount.fstab</var></dt><dd>An <a class=Xr href=fstab.5.html>fstab(5)</a> format file containing filesystems to mount before creating a jail.</dd><dt><var class=Va>mount.devfs</var></dt><dd>Mount a <a class=Xr href=devfs.5.html>devfs(5)</a> filesystem on the chrooted <span class=Pa>/dev</span> directory, and apply the ruleset in the <var class=Va>devfs_ruleset</var> parameter (or a default of ruleset 4: devfsrules_jail) to restrict the devices visible inside the jail.</dd><dt><var class=Va>mount.fdescfs</var></dt><dd>Mount a <a class=Xr href=fdescfs.5.html>fdescfs(5)</a> filesystem on the chrooted <span class=Pa>/dev/fd</span> directory.</dd><dt><var class=Va>mount.procfs</var></dt><dd>Mount a <a class=Xr href=procfs.5.html>procfs(5)</a> filesystem on the chrooted <span class=Pa>/proc</span> directory.</dd><dt><var class=Va>allow.dying</var></dt><dd>Allow making changes to a <var class=Va>dying</var> jail.</dd><dt><var class=Va>depend</var></dt><dd>Specify a jail (or jails) that this jail depends on. When this jail is to be created, any jail(s) it depends on must already exist. If not, they will be created automatically, up to the completion of the last <var class=Va>exec.poststart</var> command, before any action will taken to create this jail. When jails are removed the opposite is true: this jail will be removed, up to the last <var class=Va>exec.poststop</var> command, before any jail(s) it depends on are stopped.</dd></dl></section></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> Jails are typically set up using one of two philosophies: either to constrain a specific application (possibly running with privilege), or to create a “virtual system image” running a variety of daemons and services. In both cases, a fairly complete file system install of <span class=Ux>FreeBSD</span> is required, so as to provide the necessary command line tools, daemons, libraries, application configuration files, etc. However, for a virtual server configuration, a fair amount of additional work is required so as to replace the “boot” process. This manual page documents the configuration steps necessary to support either of these steps, although the configuration steps may need to be refined based on local requirements. <section class=Ss><h2 class=Ss id=Setting_up_a_Jail_Directory_Tree><a class=permalink href=#Setting_up_a_Jail_Directory_Tree>Setting up a Jail Directory Tree</a></h2> To set up a jail directory tree containing an entire <span class=Ux>FreeBSD</span> distribution, the following <a class=Xr href=sh.1.html>sh(1)</a> command script can be used: <div class="Bd Pp Bd-indent"><pre>
D=/here/is/the/jail
cd /usr/src
mkdir -p $D
make world DESTDIR=$D
make distribution DESTDIR=$D
</pre></div><p class=Pp>In many cases this example would put far more in the jail than needed. In the other extreme case a jail might contain only one file: the executable to be run in the jail.</p><p class=Pp>We recommend experimentation, and caution that it is a lot easier to start with a “fat” jail and remove things until it stops working, than it is to start with a “thin” jail and add things until it works.</p></section><section class=Ss><h2 class=Ss id=Setting_Up_a_Jail><a class=permalink href=#Setting_Up_a_Jail>Setting Up a Jail</a></h2> Do what was described in <a class=Sx href=#Setting_Up_a_Jail_Directory_Tree>Setting Up a Jail Directory Tree</a> to build the jail directory tree. For the sake of this example, we will assume you built it in <span class=Pa>/data/jail/testjail</span>, for a jail named “testjail”. Substitute below as needed with your own directory, IP address, and hostname. </section><section class=Ss><h2 class=Ss id=Setting_up_the_Host_Environment><a class=permalink href=#Setting_up_the_Host_Environment>Setting up the Host Environment</a></h2> First, set up the real system's environment to be “jail-friendly”. For consistency, we will refer to the parent box as the “host environment”, and to the jailed virtual machine as the “jail environment”. Since jails are implemented using IP aliases, one of the first things to do is to disable IP services on the host system that listen on all local IP addresses for a service. If a network service is present in the host environment that binds all available IP addresses rather than specific IP addresses, it may service requests sent to jail IP addresses if the jail did not bind the port. This means changing <a class=Xr href=inetd.8.html>inetd(8)</a> to only listen on the appropriate IP address, and so forth. Add the following to <span class=Pa>/etc/rc.conf</span> in the host environment: <div class="Bd Pp Bd-indent"><pre>
sendmail_enable="NO"
inetd_flags="-wW -a 192.0.2.23"
rpcbind_enable="NO"
</pre></div><p class=Pp><code class=Li>192.0.2.23</code> is the native IP address for the host system, in this example. Daemons that run out of <a class=Xr href=inetd.8.html>inetd(8)</a> can be easily configured to use only the specified host IP address. Other daemons will need to be manually configured — for some this is possible through <a class=Xr href=rc.conf.5.html>rc.conf(5)</a> flags entries; for others it is necessary to modify per-application configuration files, or to recompile the application. The following frequently deployed services must have their individual configuration files modified to limit the application to listening to a specific IP address:</p><p class=Pp>To configure <a class=Xr href=sshd.8.html>sshd(8)</a>, it is necessary to modify <span class=Pa>/etc/ssh/sshd_config</span>.</p><p class=Pp>To configure <a class=Xr href=sendmail.8.html>sendmail(8)</a>, it is necessary to modify <span class=Pa>/etc/mail/sendmail.cf</span>.</p><p class=Pp>In addition, a number of services must be recompiled in order to run them in the host environment. This includes most applications providing services using <a class=Xr href=rpc.3.html>rpc(3)</a>, such as <a class=Xr href=rpcbind.8.html>rpcbind(8)</a>, <a class=Xr href=nfsd.8.html>nfsd(8)</a>, and <a class=Xr href=mountd.8.html>mountd(8)</a>. In general, applications for which it is not possible to specify which IP address to bind should not be run in the host environment unless they should also service requests sent to jail IP addresses. Attempting to serve NFS from the host environment may also cause confusion, and cannot be easily reconfigured to use only specific IPs, as some NFS services are hosted directly from the kernel. Any third-party network software running in the host environment should also be checked and configured so that it does not bind all IP addresses, which would result in those services also appearing to be offered by the jail environments.</p><p class=Pp>Once these daemons have been disabled or fixed in the host environment, it is best to reboot so that all daemons are in a known state, to reduce the potential for confusion later (such as finding that when you send mail to a jail, and its sendmail is down, the mail is delivered to the host, etc.).</p></section><section class=Ss><h2 class=Ss id=Configuring_the_Jail><a class=permalink href=#Configuring_the_Jail>Configuring the Jail</a></h2> Start any jail for the first time without configuring the network interface so that you can clean it up a little and set up accounts. As with any machine (virtual or not), you will need to set a root password, time zone, etc. Some of these steps apply only if you intend to run a full virtual server inside the jail; others apply both for constraining a particular application or for running a virtual server. <p class=Pp>Start a shell in the jail:</p><div class="Bd Pp Bd-indent"><pre>
jail -c path=/data/jail/testjail mount.devfs \
	host.hostname=testhostname ip4.addr=192.0.2.100 \
	command=/bin/sh
</pre></div><p class=Pp>Assuming no errors, you will end up with a shell prompt within the jail. You can now run <a class=Xr href=bsdconfig.8.html>bsdconfig(8)</a> and do the post-install configuration to set various configuration options, or perform these actions manually by editing <span class=Pa>/etc/rc.conf</span>, etc.</p><p class=Pp></p><ul class="Bl-bullet Bd-indent Bl-compact"><li>Configure <span class=Pa>/etc/resolv.conf</span> so that name resolution within the jail will work correctly.</li><li>Run <a class=Xr href=newaliases.1.html>newaliases(1)</a> to quell <a class=Xr href=sendmail.8.html>sendmail(8)</a> warnings.</li><li>Set a root password, probably different from the real host system.</li><li>Set the timezone.</li><li>Add accounts for users in the jail environment.</li><li>Install any packages the environment requires.</li></ul><p class=Pp>You may also want to perform any package-specific configuration (web servers, SSH servers, etc), patch up <span class=Pa>/etc/syslog.conf</span> so it logs as you would like, etc. If you are not using a virtual server, you may wish to modify <a class=Xr href=syslogd.8.html>syslogd(8)</a> in the host environment to listen on the syslog socket in the jail environment; in this example, the syslog socket would be stored in <span class=Pa>/data/jail/testjail/var/run/log</span>.</p><p class=Pp>Exit from the shell, and the jail will be shut down.</p></section><section class=Ss><h2 class=Ss id=Starting_the_Jail><a class=permalink href=#Starting_the_Jail>Starting the Jail</a></h2> You are now ready to restart the jail and bring up the environment with all of its daemons and other programs. Create an entry for the jail in <span class=Pa>/etc/jail.conf</span>: <div class="Bd Pp Bd-indent"><pre>
testjail {
	path = /tmp/jail/testjail;
	mount.devfs;
	host.hostname = testhostname;
	ip4.addr = 192.0.2.100;
	interface = em0;
	exec.start = "/bin/sh /etc/rc";
	exec.stop = "/bin/sh /etc/rc.shutdown jail";
}
</pre></div><p class=Pp>To start a virtual server environment, <span class=Pa>/etc/rc</span> is run to launch various daemons and services, and <span class=Pa>/etc/rc.shutdown</span> is run to shut them down when the jail is removed. If you are running a single application in the jail, substitute the command used to start the application for “/bin/sh /etc/rc”; there may be some script available to cleanly shut down the application, or it may be sufficient to go without a stop command, and have <code class=Nm>jail</code> send <code class=Dv>SIGTERM</code> to the application.</p><p class=Pp>Start the jail by running:</p><div class="Bd Pp Bd-indent"><pre>
jail -c testjail
</pre></div><p class=Pp>A few warnings may be produced; however, it should all work properly. You should be able to see <a class=Xr href=inetd.8.html>inetd(8)</a>, <a class=Xr href=syslogd.8.html>syslogd(8)</a>, and other processes running within the jail using <a class=Xr href=ps.1.html>ps(1)</a>, with the ‘<code class=Li>J</code>’ flag appearing beside jailed processes. To see an active list of jails, use <a class=Xr href=jls.8.html>jls(8)</a>. If <a class=Xr href=sshd.8.html>sshd(8)</a> is enabled in the jail environment, you should be able to <a class=Xr href=ssh.1.html>ssh(1)</a> to the hostname or IP address of the jailed environment, and log in using the accounts you created previously.</p><p class=Pp>It is possible to have jails started at boot time. Please refer to the “jail_*” variables in <a class=Xr href=rc.conf.5.html>rc.conf(5)</a> for more information.</p></section><section class=Ss><h2 class=Ss id=Managing_the_Jail><a class=permalink href=#Managing_the_Jail>Managing the Jail</a></h2> Normal machine shutdown commands, such as <a class=Xr href=halt.8.html>halt(8)</a>, <a class=Xr href=reboot.8.html>reboot(8)</a>, and <a class=Xr href=shutdown.8.html>shutdown(8)</a>, cannot be used successfully within the jail. To kill all processes from within a jail, you may use one of the following commands, depending on what you want to accomplish: <div class="Bd Pp Bd-indent"><pre>
kill -TERM -1
kill -KILL -1
</pre></div><p class=Pp>This will send the <code class=Dv>SIGTERM</code> or <code class=Dv>SIGKILL</code> signals to all processes in the jail — be careful not to run this from the host environment! Once all of the jail's processes have died, unless the jail was created with the <var class=Va>persist</var> parameter, the jail will be removed. Depending on the intended use of the jail, you may also want to run <span class=Pa>/etc/rc.shutdown</span> from within the jail.</p><p class=Pp>To shut down the jail from the outside, simply remove it with:</p><div class="Bd Pp Bd-indent"><pre>
jail -r
</pre></div><p class=Pp>which will run any commands specified by <var class=Va>exec.stop</var>, and then send <code class=Dv>SIGTERM</code> and eventually <code class=Dv>SIGKILL</code> to any remaining jailed processes.</p><p class=Pp>The <span class=Pa>/proc/</span><var class=Ar>pid</var><span class=Pa>/status</span> file contains, as its last field, the name of the jail in which the process runs, or “<code class=Li>-</code>” to indicate that the process is not running within a jail. The <a class=Xr href=ps.1.html>ps(1)</a> command also shows a ‘<code class=Li>J</code>’ flag for processes in a jail.</p><p class=Pp>You can also list/kill processes based on their jail ID. To show processes and their jail ID, use the following command:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>ps ax -o pid,jid,args</code></div><p class=Pp>To show and then kill processes in jail number 3 use the following commands:</p><div class="Bd Pp Bd-indent"><pre>
pgrep -lfj 3
pkill -j 3
</pre></div> or: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>killall -j 3</code></div></section><section class=Ss><h2 class=Ss id=Jails_and_File_Systems><a class=permalink href=#Jails_and_File_Systems>Jails and File Systems</a></h2> It is not possible to <a class=Xr href=mount.8.html>mount(8)</a> or <a class=Xr href=umount.8.html>umount(8)</a> any file system inside a jail unless the file system is marked jail-friendly, the jail's <var class=Va>allow.mount</var> parameter is set, and the jail's <var class=Va>enforce_statfs</var> parameter is lower than 2. <p class=Pp>Multiple jails sharing the same file system can influence each other. For example, a user in one jail can fill the file system, leaving no space for processes in the other jail. Trying to use <a class=Xr href=quota.1.html>quota(1)</a> to prevent this will not work either, as the file system quotas are not aware of jails but only look at the user and group IDs. This means the same user ID in two jails share a single file system quota. One would need to use one file system per jail to make this work.</p></section><section class=Ss><h2 class=Ss id=Sysctl_MIB_Entries><a class=permalink href=#Sysctl_MIB_Entries>Sysctl MIB Entries</a></h2> The read-only entry <var class=Va>security.jail.jailed</var> can be used to determine if a process is running inside a jail (value is one) or not (value is zero). <p class=Pp>The variable <var class=Va>security.jail.max_af_ips</var> determines how may address per address family a jail may have. The default is 255.</p><p class=Pp>Some MIB variables have per-jail settings. Changes to these variables by a jailed process do not affect the host environment, only the jail environment. These variables are <var class=Va>kern.securelevel</var>, <var class=Va>security.bsd.suser_enabled</var>, <var class=Va>kern.hostname</var>, <var class=Va>kern.domainname</var>, <var class=Va>kern.hostid</var>, and <var class=Va>kern.hostuuid</var>.</p></section><section class=Ss><h2 class=Ss id=Hierarchical_Jails><a class=permalink href=#Hierarchical_Jails>Hierarchical Jails</a></h2> By setting a jail's <var class=Va>children.max</var> parameter, processes within a jail may be able to create jails of their own. These child jails are kept in a hierarchy, with jails only able to see and/or modify the jails they created (or those jails' children). Each jail has a read-only <var class=Va>parent</var> parameter, containing the <var class=Va>jid</var> of the jail that created it; a <var class=Va>jid</var> of 0 indicates the jail is a child of the current jail (or is a top-level jail if the current process isn't jailed). <p class=Pp>Jailed processes are not allowed to confer greater permissions than they themselves are given, e.g., if a jail is created with <var class=Va>allow.nomount</var>, it is not able to create a jail with <var class=Va>allow.mount</var> set. Similarly, such restrictions as <var class=Va>ip4.addr</var> and <var class=Va>securelevel</var> may not be bypassed in child jails.</p><p class=Pp>A child jail may in turn create its own child jails if its own <var class=Va>children.max</var> parameter is set (remember it is zero by default). These jails are visible to and can be modified by their parent and all ancestors.</p><p class=Pp>Jail names reflect this hierarchy, with a full name being an MIB-type string separated by dots. For example, if a base system process creates a jail “foo”, and a process under that jail creates another jail “bar”, then the second jail will be seen as “foo.bar” in the base system (though it is only seen as “bar” to any processes inside jail “foo”). Jids on the other hand exist in a single space, and each jail must have a unique jid.</p><p class=Pp>Like the names, a child jail's <var class=Va>path</var> appears relative to its creator's own <var class=Va>path</var>. This is by virtue of the child jail being created in the chrooted environment of the first jail.</p></section></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=killall.1.html>killall(1)</a>, <a class=Xr href=lsvfs.1.html>lsvfs(1)</a>, <a class=Xr href=newaliases.1.html>newaliases(1)</a>, <a class=Xr href=pgrep.1.html>pgrep(1)</a>, <a class=Xr href=pkill.1.html>pkill(1)</a>, <a class=Xr href=ps.1.html>ps(1)</a>, <a class=Xr href=quota.1.html>quota(1)</a>, <a class=Xr href=jail_set.2.html>jail_set(2)</a>, <a class=Xr href=vmm.4.html>vmm(4)</a>, <a class=Xr href=devfs.5.html>devfs(5)</a>, <a class=Xr href=fdescfs.5.html>fdescfs(5)</a>, <a class=Xr href=jail.conf.5.html>jail.conf(5)</a>, <a class=Xr href=linprocfs.5.html>linprocfs(5)</a>, <a class=Xr href=linsysfs.5.html>linsysfs(5)</a>, <a class=Xr href=procfs.5.html>procfs(5)</a>, <a class=Xr href=rc.conf.5.html>rc.conf(5)</a>, <a class=Xr href=sysctl.conf.5.html>sysctl.conf(5)</a>, <a class=Xr href=bsdconfig.8.html>bsdconfig(8)</a>, <a class=Xr href=chroot.8.html>chroot(8)</a>, <a class=Xr href=devfs.8.html>devfs(8)</a>, <a class=Xr href=halt.8.html>halt(8)</a>, <a class=Xr href=ifconfig.8.html>ifconfig(8)</a>, <a class=Xr href=inetd.8.html>inetd(8)</a>, <a class=Xr href=jexec.8.html>jexec(8)</a>, <a class=Xr href=jls.8.html>jls(8)</a>, <a class=Xr href=mount.8.html>mount(8)</a>, <a class=Xr href=reboot.8.html>reboot(8)</a>, <a class=Xr href=rpcbind.8.html>rpcbind(8)</a>, <a class=Xr href=sendmail.8.html>sendmail(8)</a>, <a class=Xr href=shutdown.8.html>shutdown(8)</a>, <a class=Xr href=sysctl.8.html>sysctl(8)</a>, <a class=Xr href=syslogd.8.html>syslogd(8)</a>, <a class=Xr href=umount.8.html>umount(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>jail</code> utility appeared in <span class=Ux>FreeBSD 4.0</span>. Hierarchical/extensible jails were introduced in <span class=Ux>FreeBSD 8.0</span>. The configuration file was introduced in <span class=Ux>FreeBSD 9.1</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The jail feature was written by <span class=An>Poul-Henning Kamp</span> for R&amp;D Associates who contributed it to <span class=Ux>FreeBSD</span>. <p class=Pp><span class=An>Robert Watson</span> wrote the extended documentation, found a few bugs, added a few new features, and cleaned up the userland jail environment.</p><p class=Pp><span class=An>Bjoern A. Zeeb</span> added multi-IP jail support for IPv4 and IPv6 based on a patch originally done by <span class=An>Pawel Jakub Dawidek</span> for IPv4.</p><p class=Pp><span class=An>James Gritton</span> added the extensible jail parameters, hierarchical jails, and the configuration file.</p></section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> It might be a good idea to add an address alias flag such that daemons listening on all IPs (<code class=Dv>INADDR_ANY</code>) will not bind on that address, which would facilitate building a safe host environment such that host daemons do not impose on services offered from within jails. Currently, the simplest answer is to minimize services offered on the host, possibly limiting it to services offered from <a class=Xr href=inetd.8.html>inetd(8)</a> which is easily configurable. </section><section class=Sh><h2 class=Sh id=NOTES><a class=permalink href=#NOTES>NOTES</a></h2> Great care should be taken when managing directories visible within the jail. For example, if a jailed process has its current working directory set to a directory that is moved out of the jail's chroot, then the process may gain access to the file space outside of the jail. It is recommended that directories always be copied, rather than moved, out of a jail. <p class=Pp>In addition, there are several ways in which an unprivileged user outside the jail can cooperate with a privileged user inside the jail and thereby obtain elevated privileges in the host environment. Most of these attacks can be mitigated by ensuring that the jail root is not accessible to unprivileged users in the host environment. Regardless, as a general rule, untrusted users with privileged access to a jail should not be given access to the host environment.</p></section></div><table class=foot><tr><td class=foot-date>July 18, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>