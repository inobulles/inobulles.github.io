<!DOCTYPE html>
<html><head><meta charset=utf-8><title>pmc(3)</title><keywords content=man,pmc></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>pmc(3)</h1><table class=head><tr><td class=head-ltitle>PMC(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>PMC(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>pmc</code> — <div class=Nd>library for accessing hardware performance monitoring counters</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>Performance Counters Library (libpmc, -lpmc)</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/pmc.h.html>pmc.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <span class=Lb>Performance Counters Library (libpmc, -lpmc)</span> provides a programming interface that allows applications to use hardware performance counters to gather performance data about specific processes or for the system as a whole. The library is implemented using the lower-level facilities offered by the <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> driver. <section class=Ss><h2 class=Ss id=Key_Concepts><a class=permalink href=#Key_Concepts>Key Concepts</a></h2> Performance monitoring counters (PMCs) are represented by the library using a software abstraction. These “abstract” PMCs can have two scopes: <ul class=Bl-bullet><li>System scope. These PMCs measure events in a whole-system manner, i.e., independent of the currently executing thread. System scope PMCs are allocated on specific CPUs and do not migrate between CPUs. Non-privileged process are allowed to allocate system scope PMCs if the <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> sysctl tunable: <var class=Va>security.bsd.unprivileged_syspmcs</var> is non-zero.</li><li>Process scope. These PMCs only measure hardware events when the processes they are attached to are executing on a CPU. In an SMP system, process scope PMCs migrate between CPUs along with their target processes.</li></ul><p class=Pp>Orthogonal to PMC scope, PMCs may be allocated in one of two operational modes:</p><ul class=Bl-bullet><li>Counting PMCs measure events according to their scope (system or process). The application needs to explicitly read these counters to retrieve their value.</li><li>Sampling PMCs cause the CPU to be periodically interrupted and information about its state of execution to be collected. Sampling PMCs are used to profile specific processes and kernel threads or to profile the system as a whole.</li></ul><p class=Pp>The scope and operational mode for a software PMC are specified at PMC allocation time. An application is allowed to allocate multiple PMCs subject to availability of hardware resources.</p><p class=Pp>The library uses human-readable strings to name the event being measured by hardware. The syntax used for specifying a hardware event along with additional event specific qualifiers (if any) is described in detail in section <a class=Sx href=#EVENT_SPECIFIERS>EVENT SPECIFIERS</a> below.</p><p class=Pp>PMCs are associated with the process that allocated them and will be automatically reclaimed by the system when the process exits. Additionally, process-scope PMCs have to be attached to one or more target processes before they can perform measurements. A process-scope PMC may be attached to those target processes that its owner process would otherwise be permitted to debug. An owner process may attach PMCs to itself allowing it to measure its own behavior. Additionally, on some machine architectures, such self-attached PMCs may be read cheaply using specialized instructions supported by the processor.</p><p class=Pp>Certain kinds of PMCs require that a log file be configured before they may be started. These include:</p><ul class=Bl-bullet><li>System scope sampling PMCs.</li><li>Process scope sampling PMCs.</li><li>Process scope counting PMCs that have been configured to report PMC readings on process context switches or process exits.</li></ul><p class=Pp>Up to one log file may be configured per owner process. Events logged to a log file may be subsequently analyzed using the <a class=Xr href=pmclog.3.html>pmclog(3)</a> family of functions.</p></section><section class=Ss><h2 class=Ss id=Supported_CPUs><a class=permalink href=#Supported_CPUs>Supported CPUs</a></h2> The CPUs known to the PMC library are named by the <var class=Vt>enum pmc_cputype</var> enumeration. Supported CPUs include: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#PMC_CPU_AMD_K7><code class=Li id=PMC_CPU_AMD_K7>PMC_CPU_AMD_K7</code></a></dt><dd>AMD Athlon CPUs.</dd><dt><a class=permalink href=#PMC_CPU_AMD_K8><code class=Li id=PMC_CPU_AMD_K8>PMC_CPU_AMD_K8</code></a></dt><dd>AMD Athlon64 CPUs.</dd><dt><a class=permalink href=#PMC_CPU_INTEL_ATOM><code class=Li id=PMC_CPU_INTEL_ATOM>PMC_CPU_INTEL_ATOM</code></a></dt><dd>Intel Atom CPUs and other CPUs conforming to version 3 of the Intel performance measurement architecture.</dd><dt><a class=permalink href=#PMC_CPU_INTEL_CORE><code class=Li id=PMC_CPU_INTEL_CORE>PMC_CPU_INTEL_CORE</code></a></dt><dd>Intel Core Solo and Core Duo CPUs, and other CPUs conforming to version 1 of the Intel performance measurement architecture.</dd><dt><a class=permalink href=#PMC_CPU_INTEL_CORE2><code class=Li id=PMC_CPU_INTEL_CORE2>PMC_CPU_INTEL_CORE2</code></a></dt><dd>Intel Core2 Solo, Core2 Duo and Core2 Extreme CPUs, and other CPUs conforming to version 2 of the Intel performance measurement architecture.</dd></dl></section><section class=Ss><h2 class=Ss id=Supported_PMCs><a class=permalink href=#Supported_PMCs>Supported PMCs</a></h2> PMC supported by this library are named by the <var class=Vt>enum pmc_class</var> enumeration. Supported PMC kinds include: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#PMC_CLASS_IAF><code class=Li id=PMC_CLASS_IAF>PMC_CLASS_IAF</code></a></dt><dd>Fixed function hardware counters presents in CPUs conforming to the Intel performance measurement architecture version 2 and later.</dd><dt><a class=permalink href=#PMC_CLASS_IAP><code class=Li id=PMC_CLASS_IAP>PMC_CLASS_IAP</code></a></dt><dd>Programmable hardware counters present in CPUs conforming to the Intel performance measurement architecture version 1 and later.</dd><dt><a class=permalink href=#PMC_CLASS_K7><code class=Li id=PMC_CLASS_K7>PMC_CLASS_K7</code></a></dt><dd>Programmable hardware counters present in AMD Athlon CPUs.</dd><dt><a class=permalink href=#PMC_CLASS_K8><code class=Li id=PMC_CLASS_K8>PMC_CLASS_K8</code></a></dt><dd>Programmable hardware counters present in AMD Athlon64 CPUs.</dd><dt><a class=permalink href=#PMC_CLASS_TSC><code class=Li id=PMC_CLASS_TSC>PMC_CLASS_TSC</code></a></dt><dd>The timestamp counter on i386 and amd64 architecture CPUs.</dd><dt><a class=permalink href=#PMC_CLASS_SOFT><code class=Li id=PMC_CLASS_SOFT>PMC_CLASS_SOFT</code></a></dt><dd>Software events.</dd></dl></section><section class=Ss><h2 class=Ss id=PMC_Capabilities><a class=permalink href=#PMC_Capabilities>PMC Capabilities</a></h2> Capabilities of performance monitoring hardware are denoted using the <var class=Vt>enum pmc_caps</var> enumeration. Supported capabilities include: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#PMC_CAP_CASCADE><code class=Li id=PMC_CAP_CASCADE>PMC_CAP_CASCADE</code></a></dt><dd>The ability to cascade counters.</dd><dt><a class=permalink href=#PMC_CAP_DOMWIDE><code class=Li id=PMC_CAP_DOMWIDE>PMC_CAP_DOMWIDE</code></a></dt><dd>Separate counters tied to each NUMA domain.</dd><dt><a class=permalink href=#PMC_CAP_EDGE><code class=Li id=PMC_CAP_EDGE>PMC_CAP_EDGE</code></a></dt><dd>The ability to count negated to asserted transitions of the hardware conditions being probed for.</dd><dt><a class=permalink href=#PMC_CAP_INTERRUPT><code class=Li id=PMC_CAP_INTERRUPT>PMC_CAP_INTERRUPT</code></a></dt><dd>The ability to interrupt the CPU.</dd><dt><a class=permalink href=#PMC_CAP_INVERT><code class=Li id=PMC_CAP_INVERT>PMC_CAP_INVERT</code></a></dt><dd>The ability to invert the sense of the hardware conditions being measured.</dd><dt><a class=permalink href=#PMC_CAP_PRECISE><code class=Li id=PMC_CAP_PRECISE>PMC_CAP_PRECISE</code></a></dt><dd>The ability to perform precise sampling.</dd><dt><a class=permalink href=#PMC_CAP_QUALIFIER><code class=Li id=PMC_CAP_QUALIFIER>PMC_CAP_QUALIFIER</code></a></dt><dd>The hardware allows monitored to be further qualified in some system dependent way.</dd><dt><a class=permalink href=#PMC_CAP_READ><code class=Li id=PMC_CAP_READ>PMC_CAP_READ</code></a></dt><dd>The ability to read from performance counters.</dd><dt><a class=permalink href=#PMC_CAP_SYSTEM><code class=Li id=PMC_CAP_SYSTEM>PMC_CAP_SYSTEM</code></a></dt><dd>The ability to restrict counting of hardware events to when the CPU is running privileged code.</dd><dt><a class=permalink href=#PMC_CAP_SYSWIDE><code class=Li id=PMC_CAP_SYSWIDE>PMC_CAP_SYSWIDE</code></a></dt><dd>A single counter aggregating events for the whole system.</dd><dt><a class=permalink href=#PMC_CAP_THRESHOLD><code class=Li id=PMC_CAP_THRESHOLD>PMC_CAP_THRESHOLD</code></a></dt><dd>The ability to ignore simultaneous hardware events below a programmable threshold.</dd><dt><a class=permalink href=#PMC_CAP_USER><code class=Li id=PMC_CAP_USER>PMC_CAP_USER</code></a></dt><dd>The ability to restrict counting of hardware events to those when the CPU is running unprivileged code.</dd><dt><a class=permalink href=#PMC_CAP_WRITE><code class=Li id=PMC_CAP_WRITE>PMC_CAP_WRITE</code></a></dt><dd>The ability to write to performance counters.</dd></dl></section><section class=Ss><h2 class=Ss id=CPU_Naming_Conventions><a class=permalink href=#CPU_Naming_Conventions>CPU Naming Conventions</a></h2> CPUs are named using small integers from zero up to, but excluding, the value returned by function <code class=Fn>pmc_ncpu</code>(). On platforms supporting sparsely numbered CPUs not all the numbers in this range will denote valid CPUs. Operations on non-existent CPUs will return an error. </section><section class=Ss><h2 class=Ss id=Functional_Grouping_of_the_API><a class=permalink href=#Functional_Grouping_of_the_API>Functional Grouping of the API</a></h2> This section contains a brief overview of the available functionality in the PMC library. Each function listed here is described further in its own manual page. <dl class=Bl-tag><dt>Administration</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_disable</code>(), <code class=Fn>pmc_enable</code>()</dt><dd>Administratively disable (enable) specific performance monitoring counter hardware. Counters that are disabled will not be available to applications to use.</dd></dl></dd><dt>Convenience Functions</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_event_names_of_class</code>()</dt><dd>Returns a list of event names supported by a given PMC type.</dd><dt><code class=Fn>pmc_name_of_capability</code>()</dt><dd>Convert a <code class=Dv>PMC_CAP_*</code> flag to a human-readable string.</dd><dt><code class=Fn>pmc_name_of_class</code>()</dt><dd>Convert a <code class=Dv>PMC_CLASS_*</code> constant to a human-readable string.</dd><dt><code class=Fn>pmc_name_of_cputype</code>()</dt><dd>Return a human-readable name for a CPU type.</dd><dt><code class=Fn>pmc_name_of_disposition</code>()</dt><dd>Return a human-readable string describing a PMC's disposition.</dd><dt><code class=Fn>pmc_name_of_event</code>()</dt><dd>Convert a numeric event code to a human-readable string.</dd><dt><code class=Fn>pmc_name_of_mode</code>()</dt><dd>Convert a <code class=Dv>PMC_MODE_*</code> constant to a human-readable name.</dd><dt><code class=Fn>pmc_name_of_state</code>()</dt><dd>Return a human-readable string describing a PMC's current state.</dd></dl></dd><dt>Library Initialization</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_init</code>()</dt><dd>Initialize the library. This function must be called before any other library function.</dd></dl></dd><dt>Log File Handling</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_configure_logfile</code>()</dt><dd>Configure a log file for <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> to write logged events to.</dd><dt><code class=Fn>pmc_flush_logfile</code>()</dt><dd>Flush all pending log data in <a class=Xr href=hwpmc.4.html>hwpmc(4)</a>'s buffers.</dd><dt><code class=Fn>pmc_close_logfile</code>()</dt><dd>Flush all pending log data and close <a class=Xr href=hwpmc.4.html>hwpmc(4)</a>'s side of the stream.</dd><dt><code class=Fn>pmc_writelog</code>()</dt><dd>Append arbitrary user data to the current log file.</dd></dl></dd><dt>PMC Management</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_allocate</code>(), <code class=Fn>pmc_release</code>()</dt><dd>Allocate (free) a PMC.</dd><dt><code class=Fn>pmc_attach</code>(), <code class=Fn>pmc_detach</code>()</dt><dd>Attach (detach) a process scope PMC to a target.</dd><dt><code class=Fn>pmc_read</code>(), <code class=Fn>pmc_write</code>(), <code class=Fn>pmc_rw</code>()</dt><dd>Read (write) a value from (to) a PMC.</dd><dt><code class=Fn>pmc_start</code>(), <code class=Fn>pmc_stop</code>()</dt><dd>Start (stop) a software PMC.</dd><dt><code class=Fn>pmc_set</code>()</dt><dd>Set the reload value for a sampling PMC.</dd></dl></dd><dt>Queries</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_capabilities</code>()</dt><dd>Retrieve the capabilities for a given PMC.</dd><dt><code class=Fn>pmc_cpuinfo</code>()</dt><dd>Retrieve information about the CPUs and PMC hardware present in the system.</dd><dt><code class=Fn>pmc_get_driver_stats</code>()</dt><dd>Retrieve statistics maintained by <a class=Xr href=hwpmc.4.html>hwpmc(4)</a>.</dd><dt><code class=Fn>pmc_ncpu</code>()</dt><dd>Determine the greatest possible CPU number on the system.</dd><dt><code class=Fn>pmc_npmc</code>()</dt><dd>Return the number of hardware PMCs present in a given CPU.</dd><dt><code class=Fn>pmc_pmcinfo</code>()</dt><dd>Return information about the state of a given CPU's PMCs.</dd><dt><code class=Fn>pmc_width</code>()</dt><dd>Determine the width of a hardware counter in bits.</dd></dl></dd><dt>x86 Architecture Specific API</dt><dd><dl class="Bl-tag Bl-compact"><dt><code class=Fn>pmc_get_msr</code>()</dt><dd>Returns the processor model specific register number associated with <var class=Fa>pmc</var>. Applications may then use the x86 <code class=Ic>RDPMC</code> instruction to directly read the contents of the PMC.</dd></dl></dd></dl></section><section class=Ss><h2 class=Ss id=Signal_Handling_Requirements><a class=permalink href=#Signal_Handling_Requirements>Signal Handling Requirements</a></h2> Applications using PMCs are required to handle the following signals: <dl class=Bl-tag><dt><a class=permalink href=#SIGBUS><code class=Dv id=SIGBUS>SIGBUS</code></a></dt><dd>When the <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> module is unloaded using <a class=Xr href=kldunload.8.html>kldunload(8)</a>, processes that have PMCs allocated to them will be sent a <code class=Dv>SIGBUS</code> signal.</dd><dt><a class=permalink href=#SIGIO><code class=Dv id=SIGIO>SIGIO</code></a></dt><dd>The <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> driver will send a PMC owning process a <code class=Dv>SIGIO</code> signal if: <ul class=Bl-bullet><li>If any process-mode PMC allocated by it loses all its target processes.</li><li>If the driver encounters an error when writing log data to a configured log file. This error may be retrieved by a subsequent call to <code class=Fn>pmc_flush_logfile</code>().</li></ul></dd></dl></section><section class=Ss><h2 class=Ss id=Typical_Program_Flow><a class=permalink href=#Typical_Program_Flow>Typical Program Flow</a></h2><ol class=Bl-enum><li>An application would first invoke function <code class=Fn>pmc_init</code>() to allow the library to initialize itself.</li><li>Signal handling would then be set up.</li><li>Next the application would allocate the PMCs it desires using function <code class=Fn>pmc_allocate</code>().</li><li>Initial values for PMCs may be set using function <code class=Fn>pmc_set</code>().</li><li>If a log file is necessary for the PMCs to work, it would be configured using function <code class=Fn>pmc_configure_logfile</code>().</li><li>Process scope PMCs would then be attached to their target processes using function <code class=Fn>pmc_attach</code>().</li><li>The PMCs would then be started using function <code class=Fn>pmc_start</code>().</li><li>Once started, the values of counting PMCs may be read using function <code class=Fn>pmc_read</code>(). For PMCs that write events to the log file, this logged data would be read and parsed using the <a class=Xr href=pmclog.3.html>pmclog(3)</a> family of functions.</li><li>PMCs are stopped using function <code class=Fn>pmc_stop</code>(), and process scope PMCs are detached from their targets using function <code class=Fn>pmc_detach</code>().</li><li>Before the process exits, its may release its PMCs using function <code class=Fn>pmc_release</code>(). Any configured log file may be closed using function <code class=Fn>pmc_configure_logfile</code>().</li></ol></section></section><section class=Sh><h2 class=Sh id=EVENT_SPECIFIERS><a class=permalink href=#EVENT_SPECIFIERS>EVENT SPECIFIERS</a></h2> Event specifiers are strings comprising of an event name, followed by optional parameters modifying the semantics of the hardware event being probed. Event names are PMC architecture dependent, but the PMC library defines machine independent aliases for commonly used events. <p class=Pp>Event specifiers spellings are case-insensitive and space characters, periods, underscores and hyphens are considered equivalent to each other. Thus the event specifiers “Example Event”, “example-event”, and “EXAMPLE_EVENT” are equivalent.</p><section class=Ss><h2 class=Ss id=PMC_Architecture_Dependent_Events><a class=permalink href=#PMC_Architecture_Dependent_Events>PMC Architecture Dependent Events</a></h2> PMC architecture dependent event specifiers are described in the following manual pages: <table class=Bl-column><tr><td><i class=Em>PMC Class</i></td><td><i class=Em>Manual Page</i></td></tr><tr><td><a class=permalink href=#PMC_CLASS_IAF_2><code class=Li id=PMC_CLASS_IAF_2>PMC_CLASS_IAF</code></a></td><td><a class=Xr href=pmc.iaf.3.html>pmc.iaf(3)</a></td></tr><tr><td><a class=permalink href=#PMC_CLASS_IAP_2><code class=Li id=PMC_CLASS_IAP_2>PMC_CLASS_IAP</code></a></td><td><a class=Xr href=pmc.atom.3.html>pmc.atom(3)</a>, <a class=Xr href=pmc.core.3.html>pmc.core(3)</a>, <a class=Xr href=pmc.core2.3.html>pmc.core2(3)</a></td></tr><tr><td><a class=permalink href=#PMC_CLASS_K7_2><code class=Li id=PMC_CLASS_K7_2>PMC_CLASS_K7</code></a></td><td><a class=Xr href=pmc.k7.3.html>pmc.k7(3)</a></td></tr><tr><td><a class=permalink href=#PMC_CLASS_K8_2><code class=Li id=PMC_CLASS_K8_2>PMC_CLASS_K8</code></a></td><td><a class=Xr href=pmc.k8.3.html>pmc.k8(3)</a></td></tr><tr><td><a class=permalink href=#PMC_CLASS_TSC_2><code class=Li id=PMC_CLASS_TSC_2>PMC_CLASS_TSC</code></a></td><td><a class=Xr href=pmc.tsc.3.html>pmc.tsc(3)</a></td></tr></table></section><section class=Ss><h2 class=Ss id=Event_Name_Aliases><a class=permalink href=#Event_Name_Aliases>Event Name Aliases</a></h2> Event name aliases are PMC-independent names for commonly used events. The following aliases are known to this version of the <code class=Nm>pmc</code> library: <dl class=Bl-tag><dt><a class=permalink href=#branches><code class=Li id=branches>branches</code></a></dt><dd>Measure the number of branches retired.</dd><dt><a class=permalink href=#branch-mispredicts><code class=Li id=branch-mispredicts>branch-mispredicts</code></a></dt><dd>Measure the number of retired branches that were mispredicted.</dd><dt><a class=permalink href=#cycles><code class=Li id=cycles>cycles</code></a></dt><dd>Measure processor cycles. This event is implemented using the processor's Time Stamp Counter register.</dd><dt><a class=permalink href=#dc-misses><code class=Li id=dc-misses>dc-misses</code></a></dt><dd>Measure the number of data cache misses.</dd><dt><a class=permalink href=#ic-misses><code class=Li id=ic-misses>ic-misses</code></a></dt><dd>Measure the number of instruction cache misses.</dd><dt><a class=permalink href=#instructions><code class=Li id=instructions>instructions</code></a></dt><dd>Measure the number of instructions retired.</dd><dt><a class=permalink href=#interrupts><code class=Li id=interrupts>interrupts</code></a></dt><dd>Measure the number of interrupts seen.</dd><dt><a class=permalink href=#unhalted-cycles><code class=Li id=unhalted-cycles>unhalted-cycles</code></a></dt><dd>Measure the number of cycles the processor is not in a halted or sleep state.</dd></dl></section></section><section class=Sh><h2 class=Sh id=COMPATIBILITY><a class=permalink href=#COMPATIBILITY>COMPATIBILITY</a></h2> The interface between the <code class=Nm>pmc</code> library and the <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> driver is intended to be private to the implementation and may change. In order to ease forward compatibility with future versions of the <a class=Xr href=hwpmc.4.html>hwpmc(4)</a> driver, applications are urged to dynamically link with the <code class=Nm>pmc</code> library. <p class=Pp>The <code class=Nm>pmc</code> API is currently under development.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=pmc.atom.3.html>pmc.atom(3)</a>, <a class=Xr href=pmc.core.3.html>pmc.core(3)</a>, <a class=Xr href=pmc.core2.3.html>pmc.core2(3)</a>, <a class=Xr href=pmc.haswell.3.html>pmc.haswell(3)</a>, <a class=Xr href=pmc.haswelluc.3.html>pmc.haswelluc(3)</a>, <a class=Xr href=pmc.haswellxeon.3.html>pmc.haswellxeon(3)</a>, <a class=Xr href=pmc.iaf.3.html>pmc.iaf(3)</a>, <a class=Xr href=pmc.ivybridge.3.html>pmc.ivybridge(3)</a>, <a class=Xr href=pmc.ivybridgexeon.3.html>pmc.ivybridgexeon(3)</a>, <a class=Xr href=pmc.k7.3.html>pmc.k7(3)</a>, <a class=Xr href=pmc.k8.3.html>pmc.k8(3)</a>, <a class=Xr href=pmc.sandybridge.3.html>pmc.sandybridge(3)</a>, <a class=Xr href=pmc.sandybridgeuc.3.html>pmc.sandybridgeuc(3)</a>, <a class=Xr href=pmc.sandybridgexeon.3.html>pmc.sandybridgexeon(3)</a>, <a class=Xr href=pmc.soft.3.html>pmc.soft(3)</a>, <a class=Xr href=pmc.tsc.3.html>pmc.tsc(3)</a>, <a class=Xr href=pmc.westmere.3.html>pmc.westmere(3)</a>, <a class=Xr href=pmc.westmereuc.3.html>pmc.westmereuc(3)</a>, <a class=Xr href=pmc_allocate.3.html>pmc_allocate(3)</a>, <a class=Xr href=pmc_attach.3.html>pmc_attach(3)</a>, <a class=Xr href=pmc_capabilities.3.html>pmc_capabilities(3)</a>, <a class=Xr href=pmc_configure_logfile.3.html>pmc_configure_logfile(3)</a>, <a class=Xr href=pmc_disable.3.html>pmc_disable(3)</a>, <a class=Xr href=pmc_event_names_of_class.3.html>pmc_event_names_of_class(3)</a>, <a class=Xr href=pmc_get_driver_stats.3.html>pmc_get_driver_stats(3)</a>, <a class=Xr href=pmc_get_msr.3.html>pmc_get_msr(3)</a>, <a class=Xr href=pmc_init.3.html>pmc_init(3)</a>, <a class=Xr href=pmc_name_of_capability.3.html>pmc_name_of_capability(3)</a>, <a class=Xr href=pmc_read.3.html>pmc_read(3)</a>, <a class=Xr href=pmc_set.3.html>pmc_set(3)</a>, <a class=Xr href=pmc_start.3.html>pmc_start(3)</a>, <a class=Xr href=pmclog.3.html>pmclog(3)</a>, <a class=Xr href=hwpmc.4.html>hwpmc(4)</a>, <a class=Xr href=pmccontrol.8.html>pmccontrol(8)</a>, <a class=Xr href=pmcstat.8.html>pmcstat(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>pmc</code> library first appeared in <span class=Ux>FreeBSD 6.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <span class=Lb>Performance Counters Library (libpmc, -lpmc)</span> library was written by <span class=An>Joseph Koshy</span> &lt;<a class=Mt href=mailto:jkoshy@FreeBSD.org>jkoshy@FreeBSD.org</a>&gt;. </section></div><table class=foot><tr><td class=foot-date>May 28, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>