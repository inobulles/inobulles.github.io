<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ng_nat(4)</title><keywords content=man,ng_nat></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ng_nat(4)</h1><table class=head><tr><td class=head-ltitle>NG_NAT(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>NG_NAT(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ng_nat</code> — <div class=Nd>NAT netgraph node type</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/netgraph/ng_nat.h.html>netgraph/ng_nat.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> An <code class=Nm>ng_nat</code> node performs network address translation (NAT) of IPv4 packets passing through it. A <code class=Nm>nat</code> node uses <a class=Xr href=libalias.3.html>libalias(3)</a> engine for packet aliasing. </section><section class=Sh><h2 class=Sh id=HOOKS><a class=permalink href=#HOOKS>HOOKS</a></h2> This node type has two hooks: <dl class=Bl-tag><dt><var class=Va>out</var></dt><dd>Packets received on this hook are considered outgoing and will be masqueraded to a configured address.</dd><dt><var class=Va>in</var></dt><dd>Packets coming on this hook are considered incoming and will be dealiased.</dd></dl></section><section class=Sh><h2 class=Sh id=CONTROL_MESSAGES><a class=permalink href=#CONTROL_MESSAGES>CONTROL MESSAGES</a></h2> This node type supports the generic control messages, plus the following: <dl class=Bl-tag><dt><a class=permalink href=#NGM_NAT_SET_IPADDR><code class=Dv id=NGM_NAT_SET_IPADDR>NGM_NAT_SET_IPADDR</code></a> (<code class=Ic>setaliasaddr</code>)</dt><dd>Configure aliasing address for a node. After both hooks have been connected and aliasing address was configured, a node is ready for aliasing operation.</dd><dt><a class=permalink href=#NGM_NAT_SET_MODE><code class=Dv id=NGM_NAT_SET_MODE>NGM_NAT_SET_MODE</code></a> (<code class=Ic>setmode</code>)</dt><dd>Set node's operation mode using supplied <var class=Vt>struct ng_nat_mode</var>. <div class="Bd Pp"><pre>
struct ng_nat_mode {
	uint32_t	flags;
	uint32_t	mask;
};
/* Supported flags: */
#define NG_NAT_LOG			0x01
#define NG_NAT_DENY_INCOMING		0x02
#define NG_NAT_SAME_PORTS		0x04
#define NG_NAT_UNREGISTERED_ONLY	0x10
#define NG_NAT_RESET_ON_ADDR_CHANGE	0x20
#define NG_NAT_PROXY_ONLY		0x40
#define NG_NAT_REVERSE			0x80
#define NG_NAT_UNREGISTERED_CGN		0x100
    </pre></div><p class=Pp>The corresponding libalias flags can be found by replacing the <var class=Vt>NG_NAT</var> prefix with <var class=Vt>PKT_ALIAS</var>.</p></dd><dt><a class=permalink href=#NGM_NAT_SET_TARGET><code class=Dv id=NGM_NAT_SET_TARGET>NGM_NAT_SET_TARGET</code></a> (<code class=Ic>settarget</code>)</dt><dd>Configure target address for a node. When an incoming packet not associated with any pre-existing aliasing link arrives at the host machine, it will be sent to the specified address.</dd><dt><a class=permalink href=#NGM_NAT_REDIRECT_PORT><code class=Dv id=NGM_NAT_REDIRECT_PORT>NGM_NAT_REDIRECT_PORT</code></a> (<code class=Ic>redirectport</code>)</dt><dd>Redirect incoming connections arriving to given port(s) to another host and port(s). The following <var class=Vt>struct ng_nat_redirect_port</var> must be supplied as argument. <div class="Bd Pp"><pre>
#define NG_NAT_DESC_LENGTH	64
struct ng_nat_redirect_port {
	struct in_addr	local_addr;
	struct in_addr	alias_addr;
	struct in_addr	remote_addr;
	uint16_t	local_port;
	uint16_t	alias_port;
	uint16_t	remote_port;
	uint8_t		proto;
	char		description[NG_NAT_DESC_LENGTH];
};
    </pre></div><p class=Pp>Redirection is assigned an unique ID which is returned as response to this message, and information about redirection added to list of static redirects which later can be retrieved by <code class=Dv>NGM_NAT_LIST_REDIRECTS</code> message.</p></dd><dt><a class=permalink href=#NGM_NAT_REDIRECT_ADDR><code class=Dv id=NGM_NAT_REDIRECT_ADDR>NGM_NAT_REDIRECT_ADDR</code></a> (<code class=Ic>redirectaddr</code>)</dt><dd>Redirect traffic for public IP address to a machine on the local network. This function is known as <i class=Em>static NAT</i>. The following <var class=Vt>struct ng_nat_redirect_addr</var> must be supplied as argument. <div class="Bd Pp"><pre>
struct ng_nat_redirect_addr {
	struct in_addr	local_addr;
	struct in_addr	alias_addr;
	char		description[NG_NAT_DESC_LENGTH];
};
    </pre></div><p class=Pp>Unique ID for this redirection is returned as response to this message.</p></dd><dt><a class=permalink href=#NGM_NAT_REDIRECT_PROTO><code class=Dv id=NGM_NAT_REDIRECT_PROTO>NGM_NAT_REDIRECT_PROTO</code></a> (<code class=Ic>redirectproto</code>)</dt><dd>Redirect incoming IP packets of protocol <var class=Va>proto</var> (see <a class=Xr href=protocols.5.html>protocols(5)</a>) to a machine on the local network. The following <var class=Vt>struct ng_nat_redirect_proto</var> must be supplied as argument. <div class="Bd Pp"><pre>
struct ng_nat_redirect_proto {
	struct in_addr	local_addr;
	struct in_addr	alias_addr;
	struct in_addr	remote_addr;
	uint8_t		proto;
	char		description[NG_NAT_DESC_LENGTH];
};
    </pre></div><p class=Pp>Unique ID for this redirection is returned as response to this message.</p></dd><dt><a class=permalink href=#NGM_NAT_REDIRECT_DYNAMIC><code class=Dv id=NGM_NAT_REDIRECT_DYNAMIC>NGM_NAT_REDIRECT_DYNAMIC</code></a> (<code class=Ic>redirectdynamic</code>)</dt><dd>Mark redirection with specified ID as dynamic, i.e., it will serve for exactly one next connection and then will be automatically deleted from internal links table. Only fully specified links can be made dynamic. The redirection with this ID is also immediately deleted from user-visible list of static redirects (available through <code class=Dv>NGM_NAT_LIST_REDIRECTS</code> message).</dd><dt><a class=permalink href=#NGM_NAT_REDIRECT_DELETE><code class=Dv id=NGM_NAT_REDIRECT_DELETE>NGM_NAT_REDIRECT_DELETE</code></a> (<code class=Ic>redirectdelete</code>)</dt><dd>Delete redirection with specified ID (currently active connections are not affected).</dd><dt><a class=permalink href=#NGM_NAT_ADD_SERVER><code class=Dv id=NGM_NAT_ADD_SERVER>NGM_NAT_ADD_SERVER</code></a> (<code class=Ic>addserver</code>)</dt><dd>Add another server to a pool. This is used to transparently offload network load on a single server and distribute the load across a pool of servers, also known as <i class=Em>LSNAT</i> (RFC 2391). The following <var class=Vt>struct ng_nat_add_server</var> must be supplied as argument. <div class="Bd Pp"><pre>
struct ng_nat_add_server {
	uint32_t	id;
	struct in_addr	addr;
	uint16_t	port;
};
    </pre></div><p class=Pp>First, the redirection is set up by <code class=Dv>NGM_NAT_REDIRECT_PORT</code> or <code class=Dv>NGM_NAT_REDIRECT_ADDR</code>. Then, ID of that redirection is used in multiple <code class=Dv>NGM_NAT_ADD_SERVER</code> messages to add necessary number of servers. For redirections created by <code class=Dv>NGM_NAT_REDIRECT_ADDR</code>, the <var class=Va>port</var> is ignored and could have any value. Original redirection's parameters <var class=Va>local_addr</var> and <var class=Va>local_port</var> are also ignored after <code class=Dv>NGM_NAT_ADD_SERVER</code> was used (they are effectively replaced by server pool).</p></dd><dt><a class=permalink href=#NGM_NAT_LIST_REDIRECTS><code class=Dv id=NGM_NAT_LIST_REDIRECTS>NGM_NAT_LIST_REDIRECTS</code></a> (<code class=Ic>listredirects</code>)</dt><dd>Return list of configured static redirects as <var class=Vt>struct ng_nat_list_redirects</var>. <div class="Bd Pp"><pre>
struct ng_nat_listrdrs_entry {
	uint32_t	id;		/* Anything except zero */
	struct in_addr	local_addr;
	struct in_addr	alias_addr;
	struct in_addr	remote_addr;
	uint16_t	local_port;
	uint16_t	alias_port;
	uint16_t	remote_port;
	uint16_t	proto;		/* Valid proto or NG_NAT_REDIRPROTO_ADDR */
	uint16_t	lsnat;		/* LSNAT servers count */
	char		description[NG_NAT_DESC_LENGTH];
};
struct ng_nat_list_redirects {
	uint32_t		total_count;
	struct ng_nat_listrdrs_entry redirects[];
};
#define NG_NAT_REDIRPROTO_ADDR	(IPPROTO_MAX + 3)
    </pre></div><p class=Pp>Entries of the <var class=Va>redirects</var> array returned in the unified format for all redirect types. Ports are meaningful only if protocol is either TCP or UDP and <i class=Em>static NAT</i> redirection (created by <code class=Dv>NGM_NAT_REDIRECT_ADDR</code>) is indicated by <var class=Va>proto</var> set to <code class=Dv>NG_NAT_REDIRPROTO_ADDR</code>. If <var class=Va>lsnat</var> servers counter is greater than zero, then <var class=Va>local_addr</var> and <var class=Va>local_port</var> are also meaningless.</p></dd><dt><a class=permalink href=#NGM_NAT_PROXY_RULE><code class=Dv id=NGM_NAT_PROXY_RULE>NGM_NAT_PROXY_RULE</code></a> (<code class=Ic>proxyrule</code>)</dt><dd>Specify a transparent proxying rule (string must be supplied as argument). See <a class=Xr href=libalias.3.html>libalias(3)</a> for details.</dd><dt><a class=permalink href=#NGM_NAT_LIBALIAS_INFO><code class=Dv id=NGM_NAT_LIBALIAS_INFO>NGM_NAT_LIBALIAS_INFO</code></a> (<code class=Ic>libaliasinfo</code>)</dt><dd>Return internal statistics of <a class=Xr href=libalias.3.html>libalias(3)</a> instance as <var class=Vt>struct ng_nat_libalias_info</var>. <div class="Bd Pp"><pre>
struct ng_nat_libalias_info {
	uint32_t	icmpLinkCount;
	uint32_t	udpLinkCount;
	uint32_t	tcpLinkCount;
	uint32_t	sctpLinkCount;
	uint32_t	pptpLinkCount;
	uint32_t	protoLinkCount;
	uint32_t	fragmentIdLinkCount;
	uint32_t	fragmentPtrLinkCount;
	uint32_t	sockCount;
};
    </pre></div> In case of <code class=Nm>ng_nat</code> failed to retrieve a certain counter from its <a class=Xr href=libalias.1.html>libalias</a> instance, the corresponding field is returned as <var class=Va>UINT32_MAX</var>.</dd><dt><a class=permalink href=#NGM_NAT_SET_DLT><code class=Dv id=NGM_NAT_SET_DLT>NGM_NAT_SET_DLT</code></a> (<code class=Ic>setdlt</code>)</dt><dd>Sets the data link type on the <var class=Va>in</var> and <var class=Va>out</var> hooks. Currently, supported types are <code class=Cm>DLT_RAW</code> (raw IP datagrams , no offset applied, the default) and <code class=Cm>DLT_EN10MB</code> (Ethernet). DLT_ definitions can be found in <code class=In>&lt;<a class=In href=../src/net/bpf.h.html>net/bpf.h</a>&gt;</code>. If you want to work on the <a class=Xr href=ipfw.8.html>ipfw(8)</a> level you must use no additional offset by specifying <code class=Cm>DLT_RAW</code>. If, however, you attach <code class=Nm>ng_nat</code> to a network interface directly and <code class=Cm>EN10MB</code> is specified, then the extra offset will be applied to take into account link-level header. In this mode the <code class=Nm>ng_nat</code> would also inspect appropriate type field in the Ethernet header and pass-through any datagrams that are not IP packets.</dd><dt><a class=permalink href=#NGM_NAT_GET_DLT><code class=Dv id=NGM_NAT_GET_DLT>NGM_NAT_GET_DLT</code></a> (<code class=Ic>getdlt</code>)</dt><dd>This control message returns the current data link type of the <var class=Va>in</var> and <var class=Va>out</var> hooks.</dd></dl><p class=Pp>In all redirection messages <var class=Va>local_addr</var> and <var class=Va>local_port</var> mean address and port of target machine in the internal network, respectively. If <var class=Va>alias_addr</var> is zero, then default aliasing address (set by <code class=Dv>NGM_NAT_SET_IPADDR</code>) is used. Connections can also be restricted to be accepted only from specific external machines by using non-zero <var class=Va>remote_addr</var> and/or <var class=Va>remote_port</var>. Each redirection assigned an ID which can be later used for redirection manipulation on individual basis (e.g., removal). This ID guaranteed to be unique until the node shuts down (it will not be reused after deletion), and is returned to user after making each new redirection or can be found in the stored list of all redirections. The <var class=Va>description</var> passed to and from node unchanged, together with ID providing a way for several entities to concurrently manipulate redirections in automated way.</p></section><section class=Sh><h2 class=Sh id=SHUTDOWN><a class=permalink href=#SHUTDOWN>SHUTDOWN</a></h2> This node shuts down upon receipt of a <code class=Dv>NGM_SHUTDOWN</code> control message, or when both hooks are disconnected. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> In the following example, the packets are injected into a <code class=Nm>nat</code> node using the <a class=Xr href=ng_ipfw.4.html>ng_ipfw(4)</a> node. <div class="Bd Pp Bd-indent"><pre>
# Create NAT node
ngctl mkpeer ipfw: nat 60 out
ngctl name ipfw:60 nat
ngctl connect ipfw: nat: 61 in
ngctl msg nat: setaliasaddr x.y.35.8

# Divert traffic into NAT node
ipfw add 300 netgraph 61 all from any to any in via fxp0
ipfw add 400 netgraph 60 all from any to any out via fxp0

# Let packets continue with after being (de)aliased
sysctl net.inet.ip.fw.one_pass=0
</pre></div><p class=Pp>The <code class=Nm>ng_nat</code> node can be inserted right after the <a class=Xr href=ng_iface.4.html>ng_iface(4)</a> node in the graph. In the following example, we perform masquerading on a serial line with HDLC encapsulation.</p><div class="Bd Pp Bd-indent"><pre>
/usr/sbin/ngctl -f- &lt;&lt;-SEQ
	mkpeer cp0: cisco rawdata downstream
	name cp0:rawdata hdlc
	mkpeer hdlc: nat inet in
	name hdlc:inet nat
	mkpeer nat: iface out inet
	msg nat: setaliasaddr x.y.8.35
SEQ
ifconfig ng0 x.y.8.35 x.y.8.1
</pre></div><p class=Pp>The <code class=Nm>ng_nat</code> node can also be attached directly to the physical interface via <a class=Xr href=ng_ether.4.html>ng_ether(4)</a> node in the graph. In the following example, we perform masquerading on a Ethernet interface connected to a public network.</p><div class="Bd Pp Bd-indent"><pre>
ifconfig igb0 inet x.y.8.35 netmask 0xfffff000
route add default x.y.0.1
/usr/sbin/ngctl -f- &lt;&lt;-SEQ
        mkpeer igb0: nat lower in
        name igb0:lower igb0_NAT
        connect igb0: igb0_NAT: upper out
        msg igb0_NAT: setdlt 1
        msg igb0_NAT: setaliasaddr x.y.8.35
SEQ
</pre></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=libalias.3.html>libalias(3)</a>, <a class=Xr href=ng_ipfw.4.html>ng_ipfw(4)</a>, <a class=Xr href=natd.8.html>natd(8)</a>, <a class=Xr href=ngctl.8.html>ngctl(8)</a>, <a class=Xr href=ng_ether.8.html>ng_ether(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>ng_nat</code> node type was implemented in <span class=Ux>FreeBSD 6.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Gleb Smirnoff</span> &lt;<a class=Mt href=mailto:glebius@FreeBSD.org>glebius@FreeBSD.org</a>&gt; </section></div><table class=foot><tr><td class=foot-date>January 24, 2021</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>