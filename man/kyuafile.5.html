<!DOCTYPE html>
<html><head><meta charset=utf-8><title>kyuafile(5)</title><keywords content=man,kyuafile></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>kyuafile(5)</h1><table class=head><tr><td class=head-ltitle>KYUAFILE(5)</td><td class=head-vol>FreeBSD File Formats Manual</td><td class=head-rtitle>KYUAFILE(5)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>Kyuafile</code> — <div class=Nd>Test suite description files</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=Fn>atf_test_program</code>(<var class=Fa style="white-space: nowrap;">string name</var>, <var class=Fa style="white-space: nowrap;">[string metadata]</var>); <p class=Pp><code class=Fn>current_kyuafile</code>();</p><p class=Pp><code class=Fn>fs.basename</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>fs.dirname</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>fs.exists</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>fs.files</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>fs.is_absolute</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>fs.join</code>(<var class=Fa style="white-space: nowrap;">string path</var>, <var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>include</code>(<var class=Fa style="white-space: nowrap;">string path</var>);</p><p class=Pp><code class=Fn>plain_test_program</code>(<var class=Fa style="white-space: nowrap;">string name</var>, <var class=Fa style="white-space: nowrap;">[string metadata]</var>);</p><p class=Pp><code class=Fn>syntax</code>(<var class=Fa style="white-space: nowrap;">int version</var>);</p><p class=Pp><code class=Fn>tap_test_program</code>(<var class=Fa style="white-space: nowrap;">string name</var>, <var class=Fa style="white-space: nowrap;">[string metadata]</var>);</p><p class=Pp><code class=Fn>test_suite</code>(<var class=Fa style="white-space: nowrap;">string name</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> A test suite is a collection of test programs and is represented by a hierarchical layout of test binaries on the file system. Any subtree of the file system can represent a test suite, provided that it includes one or more <code class=Nm>Kyuafile</code>s, which are the test suite definition files. <p class=Pp>A <code class=Nm>Kyuafile</code> is a Lua script whose purpose is to describe the structure of the test suite it belongs to. To do so, the script has access to a collection of special functions provided by <a class=Xr href=kyua.1.html>kyua(1)</a> as described in <a class=Sx href=#Helper_functions>Helper functions</a>.</p><section class=Ss><h2 class=Ss id=File_versioning><a class=permalink href=#File_versioning>File versioning</a></h2> Every <code class=Nm>Kyuafile</code> file starts with a call to <code class=Fn>syntax</code>(<var class=Fa>int version</var>). This call determines the specific schema used by the file so that future backwards-incompatible modifications to the file can be introduced. <p class=Pp>Any new <code class=Nm>Kyuafile</code> file should set <var class=Fa>version</var> to ‘2’.</p></section><section class=Ss><h2 class=Ss id=Test_suite_definition><a class=permalink href=#Test_suite_definition>Test suite definition</a></h2> If the <code class=Nm>Kyuafile</code> registers any test programs, the <code class=Nm>Kyuafile</code> must define the name of the test suite the test programs belong to by using the <code class=Fn>test_suite</code>() function at the very beginning of the file. <p class=Pp>The test suite name provided in the <code class=Fn>test_suite</code>() call tells <a class=Xr href=kyua.1.html>kyua(1)</a> which set of configuration variables from <a class=Xr href=kyua.conf.5.html>kyua.conf(5)</a> to pass to the test programs at run time.</p></section><section class=Ss><h2 class=Ss id=Test_program_registration><a class=permalink href=#Test_program_registration>Test program registration</a></h2> A <code class=Nm>Kyuafile</code> can register test programs by means of a variety of <code class=Fn>*_test_program</code>() functions, all of which take the name of a test program and a set of optional metadata properties that describe such test program. <p class=Pp>The test programs to be registered must live in the current directory; in other words, the various <code class=Fn>*_test_program</code>() calls cannot reference test programs in other directories. The rationale for this is to force all <code class=Nm>Kyuafile</code> files to be self-contained, and to simplify their internal representation.</p><p class=Pp><i class=Em>ATF test programs</i> are those that use the <a class=Xr href=atf.7.html>atf(7)</a> libraries. They can be registered with the <code class=Fn>atf_test_program</code>() table constructor. This function takes the <var class=Fa>name</var> of the test program and a collection of optional metadata settings for all the test cases in the test program. Any metadata properties defined by the test cases themselves override the metadata values defined here.</p><p class=Pp><i class=Em>Plain test programs</i> are those that return 0 on success and non-0 on failure; in general, most test programs (even those that use fancy unit-testing libraries) behave this way and thus also qualify as plain test programs. They can be registered with the <code class=Fn>plain_test_program</code>() table constructor. This function takes the <var class=Fa>name</var> of the test program, an optional <var class=Fa>test_suite</var> name that overrides the global test suite name, and a collection of optional metadata settings for the test program.</p><p class=Pp><i class=Em>TAP test programs</i> are those that implement the Test Anything Protocol. They can be registered with the <code class=Fn>tap_test_program</code>() table constructor. This function takes the <var class=Fa>name</var> of the test program and a collection of optional metadata settings for the test program.</p><p class=Pp>The following metadata properties can be passed to any test program definition:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>allowed_architectures</var></dt><dd>Whitespace-separated list of machine architecture names allowed by the test. If empty or not defined, the test is allowed to run on any machine architecture.</dd><dt><var class=Va>allowed_platforms</var></dt><dd>Whitespace-separated list of machine platform names allowed by the test. If empty or not defined, the test is allowed to run on any machine platform.</dd><dt><var class=Va>custom.NAME</var></dt><dd>Custom variable defined by the test where ‘NAME’ denotes the name of the variable. These variables are useful to tag your tests with information specific to your project. The values of such variables are propagated all the way from the tests to the results files and later to any generated reports. <p class=Pp>Note that if the name happens to have dashes or any other special characters in it, you will have to use a special Lua syntax to define the property. Refer to the <a class=Sx href=#EXAMPLES>EXAMPLES</a> section below for clarification.</p></dd><dt><var class=Va>description</var></dt><dd>Textual description of the test.</dd><dt><var class=Va>is_exclusive</var></dt><dd>If true, indicates that this test program cannot be executed along any other programs at the same time. Test programs that affect global system state, such as those that modify the value of a <a class=Xr href=sysctl.8.html>sysctl(8)</a> setting, must set themselves as exclusive to prevent failures due to race conditions. Defaults to false.</dd><dt><var class=Va>required_configs</var></dt><dd>Whitespace-separated list of configuration variables that the test requires to be defined before it can run.</dd><dt><var class=Va>required_disk_space</var></dt><dd>Amount of available disk space that the test needs to run successfully.</dd><dt><var class=Va>required_files</var></dt><dd>Whitespace-separated list of paths that the test requires to exist before it can run.</dd><dt><var class=Va>required_memory</var></dt><dd>Amount of physical memory that the test needs to run successfully.</dd><dt><var class=Va>required_programs</var></dt><dd>Whitespace-separated list of basenames or absolute paths pointing to executable binaries that the test requires to exist before it can run.</dd><dt><var class=Va>required_user</var></dt><dd>If empty, the test has no restrictions on the calling user for it to run. If set to ‘unprivileged’, the test needs to not run as root. If set to ‘root’, the test must run as root.</dd><dt><var class=Va>timeout</var></dt><dd>Amount of seconds that the test is allowed to execute before being killed.</dd></dl></div></section><section class=Ss><h2 class=Ss id=Recursion><a class=permalink href=#Recursion>Recursion</a></h2> To reference test programs in another subdirectory, a different <code class=Nm>Kyuafile</code> must be created in that directory and it must be included into the original <code class=Nm>Kyuafile</code> by means of the <code class=Fn>include</code>() function. <p class=Pp><code class=Fn>include</code>() may only be called with a relative path and with at most one directory component. This is by design: Kyua uses the file system structure as the layout of the test suite definition. Therefore, each subdirectory in a test suite must include its own <code class=Nm>Kyuafile</code> and each <code class=Nm>Kyuafile</code> can only descend into the <code class=Nm>Kyuafile</code>s of immediate subdirectories.</p><p class=Pp>If you need to source a <code class=Nm>Kyuafile</code> located in disjoint parts of your file system namespace, you will have to create a ‘shadow tree’ using symbolic links and possibly helper <code class=Nm>Kyuafile</code>s to plug the various subdirectories together. See the <a class=Sx href=#EXAMPLES>EXAMPLES</a> section below for details.</p><p class=Pp>Note that each file is processed in its own Lua environment: there is no mechanism to pass state from one file to the other. The reason for this is that there is no such thing as a “top-level” <code class=Nm>Kyuafile</code> in a test suite: the user has to be able to run the test suite from any directory in a given hierarchy, and this execution must not depend on files that live in parent directories.</p></section><section class=Ss><h2 class=Ss id=Top_level_Kyuafile><a class=permalink href=#Top_level_Kyuafile>Top-level Kyuafile</a></h2> Every system has a top directory into which test suites get installed. The default is <span class=Pa>/usr/tests</span>. Within this directory live test suites, each of which is in an independent subdirectory. Each subdirectory can be provided separately by independent third-party packages. <p class=Pp>Kyua allows running all the installed test suites at once in order to provide comprehensive cross-component reports. In order to do this, there is a special file in the top directory that knows how to inspect the subdirectories in search for other Kyuafiles and include them.</p><p class=Pp>The <a class=Sx href=#FILES>FILES</a> section includes more details on where this file lives.</p></section><section class=Ss><h2 class=Ss id=Helper_functions><a class=permalink href=#Helper_functions>Helper functions</a></h2> The ‘base’, ‘string’, and ‘table’ Lua modules are fully available in the context of a <code class=Nm>Kyuafile</code>. <p class=Pp>The following extra functions are provided by Kyua:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Ft>string</var><code class=Fn>current_kyuafile</code>()</dt><dd>Returns the absolute path to the current <code class=Nm>Kyuafile</code>.</dd><dt><var class=Ft>string</var><code class=Fn>fs.basename</code>(<var class=Fa>string path</var>)</dt><dd>Returns the last component of the given path.</dd><dt><var class=Ft>string</var><code class=Fn>fs.dirname</code>(<var class=Fa>string path</var>)</dt><dd>Returns the given path without its last component or a dot if the path has a single component.</dd><dt><var class=Ft>bool</var><code class=Fn>fs.exists</code>(<var class=Fa>string path</var>)</dt><dd>Checks if the given path exists. If the path is not absolute, it is relative to the directory containing the <code class=Nm>Kyuafile</code> in which the call to this function occurs.</dd><dt><var class=Ft>iterator</var><code class=Fn>fs.files</code>(<var class=Fa>string path</var>)</dt><dd>Opens a directory for scanning of its entries. The returned iterator yields an entry on each call, and the entry is simply the filename. If the path is not absolute, it is relative to the directory containing the <code class=Nm>Kyuafile</code> in which the call to this function occurs.</dd><dt><var class=Ft>is_absolute</var><code class=Fn>fs.is_absolute</code>(<var class=Fa>string path</var>)</dt><dd>Returns true if the given path is absolute; false otherwise.</dd><dt><var class=Ft>join</var><code class=Fn>fs.join</code>(<var class=Fa>string path</var>, <var class=Fa>string path</var>)</dt><dd>Concatenates the two paths. The second path cannot be absolute.</dd></dl></div></section></section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class=Bl-tag><dt><span class=Pa>/usr/tests/Kyuafile</span>.</dt><dd>Top-level <code class=Nm>Kyuafile</code> for the current system.</dd><dt><span class=Pa>/usr/share/examples/kyua/Kyuafile.top</span>.</dt><dd>Sample file to serve as a top-level <code class=Nm>Kyuafile</code>.</dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> The following <code class=Nm>Kyuafile</code> is the simplest you can define. It provides a test suite definition and registers a couple of different test programs using different interfaces: <div class="Bd Pp Bd-indent"><pre>
syntax(2)

test_suite('first')

atf_test_program{name='integration_test'}
plain_test_program{name='legacy_test'}
</pre></div><p class=Pp>The following example is a bit more elaborate. It introduces some metadata properties to the test program definitions and recurses into a couple of subdirectories:</p><div class="Bd Pp Bd-indent"><pre>
syntax(2)

test_suite('second')

plain_test_program{name='legacy_test',
                   allowed_architectures='amd64 i386',
                   required_files='/bin/ls',
                   timeout=30}

tap_test_program{name='privileged_test',
                 required_user='root'}

include('module-1/Kyuafile')
include('module-2/Kyuafile')
</pre></div><p class=Pp>The syntax to define custom properties may be not obvious if their names have any characters that make the property name not be a valid Lua identifier. Dashes are just one example. To set such properties, do something like this:</p><div class="Bd Pp Bd-indent"><pre>
syntax(2)

test_suite('FreeBSD')

plain_test_program{name='the_test',
                   ['custom.FreeBSD-Bug-Id']='category/12345'}
</pre></div><section class=Ss><h2 class=Ss id=Connecting_disjoint_test_suites><a class=permalink href=#Connecting_disjoint_test_suites>Connecting disjoint test suites</a></h2> Now suppose you had various test suites on your file system and you would like to connect them together so that they could be executed and treated as a single unit. The test suites we would like to connect live under <span class=Pa>/usr/tests</span>, <span class=Pa>/usr/local/tests</span> and <span class=Pa>~/local/tests</span>. <p class=Pp>We cannot create a <code class=Nm>Kyuafile</code> that references these because the <code class=Fn>include</code>() directive does not support absolute paths. Instead, what we can do is create a shadow tree using symbolic links:</p><div class="Bd Pp Bd-indent"><pre>
$ mkdir ~/everything
$ ln -s /usr/tests ~/everything/system-tests
$ ln -s /usr/local/tests ~/everything/local-tests
$ ln -s ~/local/tests ~/everything/home-tests
</pre></div><p class=Pp>And then we create an <span class=Pa>~/everything/Kyuafile</span> file to drive the execution of the integrated test suite:</p><div class="Bd Pp Bd-indent"><pre>
syntax(2)

test_suite('test-all-the-things')

include('system-tests/Kyuafile')
include('local-tests/Kyuafile')
include('home-tests/Kyuafile')
</pre></div><p class=Pp>Or, simply, you could reuse the sample top-level <code class=Nm>Kyuafile</code> to avoid having to manually craft the list of directories into which to recurse:</p><div class="Bd Pp Bd-indent"><pre>
$ cp /usr/share/examples/kyua/Kyuafile.top ~/everything/Kyuafile
</pre></div></section></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=kyua.1.html>kyua(1)</a></section></div><table class=foot><tr><td class=foot-date>July 3, 2015</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>