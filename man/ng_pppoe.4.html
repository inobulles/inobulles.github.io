<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ng_pppoe(4)</title><keywords content=man,ng_pppoe></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ng_pppoe(4)</h1><table class=head><tr><td class=head-ltitle>NG_PPPOE(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>NG_PPPOE(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ng_pppoe</code> — <div class=Nd>RFC 2516 PPPoE protocol netgraph node type</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/net/ethernet.h.html>net/ethernet.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netgraph.h.html>netgraph.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netgraph/ng_pppoe.h.html>netgraph/ng_pppoe.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>pppoe</code> node type performs the PPPoE protocol. It is used in conjunction with the <a class=Xr href=netgraph.4.html>netgraph(4)</a> extensions to the Ethernet framework to divert and inject Ethernet packets to and from a PPP agent (which is not specified). <p class=Pp>The <code class=Dv>NGM_PPPOE_GET_STATUS</code> control message can be used at any time to query the current status of the PPPoE module. The only statistics presently available are the total packet counts for input and output. This node does not yet support the <code class=Dv>NGM_TEXT_STATUS</code> control message.</p></section><section class=Sh><h2 class=Sh id=HOOKS><a class=permalink href=#HOOKS>HOOKS</a></h2> This node type supports the following hooks: <dl class=Bl-tag><dt><var class=Va>ethernet</var></dt><dd>The hook that should normally be connected to an <a class=Xr href=ng_ether.4.html>ng_ether(4)</a> node. Once connected, <code class=Nm>ng_pppoe</code> will send a message down this hook to determine Ethernet address of the underlying node. Obtained address will be stored and then used for outgoing datagrams.</dd><dt><var class=Va>debug</var></dt><dd>Presently no use.</dd><dt><var class=Va>[unspecified]</var></dt><dd>Any other name is assumed to be a session hook that will be connected to a PPP client agent, or a PPP server agent.</dd></dl></section><section class=Sh><h2 class=Sh id=CONTROL_MESSAGES><a class=permalink href=#CONTROL_MESSAGES>CONTROL MESSAGES</a></h2> This node type supports the generic control messages, plus the following: <dl class=Bl-tag><dt><a class=permalink href=#NGM_PPPOE_GET_STATUS><code class=Dv id=NGM_PPPOE_GET_STATUS>NGM_PPPOE_GET_STATUS</code></a></dt><dd>This command returns status information in a <code class=Dv>struct ngpppoestat</code>: <div class="Bd Pp Bd-indent"><pre>
struct ngpppoestat {
    u_int   packets_in;     /* packets in from Ethernet */
    u_int   packets_out;    /* packets out towards Ethernet */
};
    </pre></div></dd><dt><a class=permalink href=#NGM_TEXT_STATUS><code class=Dv id=NGM_TEXT_STATUS>NGM_TEXT_STATUS</code></a></dt><dd>This generic message returns a human-readable version of the node status. (not yet)</dd><dt><a class=permalink href=#NGM_PPPOE_CONNECT><code class=Dv id=NGM_PPPOE_CONNECT>NGM_PPPOE_CONNECT</code></a> (<code class=Ic>pppoe_connect</code>)</dt><dd>Tell a nominated newly created hook that its session should enter the state machine as a client. It must be newly created and a service name can be given as an argument. It is legal to specify a zero-length service name, this is common on some DSL setups. It is possible to request a connection to a specific access concentrator, and/or set a specific Host-Uniq tag, required by some Internet providers, using the “<code class=Li>[AC-Name][Host-Uniq|]Service-Name</code>” syntax. To set a binary Host-Uniq, it must be encoded as a hexadecimal lowercase string and prefixed with “<code class=Li>0x</code>”, for example “<code class=Li>0x6d792d746167</code>” is equivalent to “<code class=Li>my-tag</code>”. A session request packet will be broadcast on the Ethernet. This command uses the <code class=Dv>ngpppoe_init_data</code> structure shown below. For example, this init data argument can be used to connect to “<code class=Li>my-isp</code>” service with “<code class=Li>my-host</code>” uniq tag, accepting only “<code class=Li>remote-ac</code>” as access concentrator: <div class="Bd Pp Bd-indent"><pre>
"remote-ac\my-host|my-isp"
    </pre></div></dd><dt><a class=permalink href=#NGM_PPPOE_LISTEN><code class=Dv id=NGM_PPPOE_LISTEN>NGM_PPPOE_LISTEN</code></a> (<code class=Ic>pppoe_listen</code>)</dt><dd>Tell a nominated newly created hook that its session should enter the state machine as a server listener. The argument given is the name of the service to listen for. A zero-length service name will match all requests for service. A matching service request packet will be passed unmodified back to the process responsible for starting the service. It can then examine it and pass it on to the session that is started to answer the request. This command uses the <code class=Dv>ngpppoe_init_data</code> structure shown below.</dd><dt><a class=permalink href=#NGM_PPPOE_OFFER><code class=Dv id=NGM_PPPOE_OFFER>NGM_PPPOE_OFFER</code></a> (<code class=Ic>pppoe_offer</code>)</dt><dd>Tell a nominated newly created hook that its session should enter the state machine as a server. The argument given is the name of the service to offer. A zero-length service is legal. The State machine will progress to a state where it will await a request packet to be forwarded to it from the startup server, which in turn probably received it from a LISTEN mode hook (see above). This is so that information that is required for the session that is embedded in the original session request packet, is made available to the state machine that eventually answers the request. When the Session request packet is received, the session negotiation will proceed. This command uses the <code class=Dv>ngpppoe_init_data</code> structure shown below.</dd></dl><p class=Pp>The three commands above use a common data structure:</p><div class="Bd Pp Bd-indent"><pre>
struct ngpppoe_init_data {
    char       hook[NG_HOOKSIZ];       /* hook to monitor on */
    uint16_t   data_len;               /* length of the service name */
    char       data[0];                /* init data goes here */
};
</pre></div><dl class=Bl-tag><dt><a class=permalink href=#NGM_PPPOE_SUCCESS><code class=Dv id=NGM_PPPOE_SUCCESS>NGM_PPPOE_SUCCESS</code></a> (<code class=Ic>pppoe_success</code>)</dt><dd>This command is sent to the node that started this session with one of the above messages, and reports a state change. This message reports successful Session negotiation. It uses the structure shown below, and reports back the hook name corresponding to the successful session.</dd><dt><a class=permalink href=#NGM_PPPOE_FAIL><code class=Dv id=NGM_PPPOE_FAIL>NGM_PPPOE_FAIL</code></a> (<code class=Ic>pppoe_fail</code>)</dt><dd>This command is sent to the node that started this session with one of the above messages, and reports a state change. This message reports failed Session negotiation. It uses the structure shown below, and reports back the hook name corresponding to the failed session. The hook will probably have been removed immediately after sending this message.</dd><dt><a class=permalink href=#NGM_PPPOE_CLOSE><code class=Dv id=NGM_PPPOE_CLOSE>NGM_PPPOE_CLOSE</code></a> (<code class=Ic>pppoe_close</code>)</dt><dd>This command is sent to the node that started this session with one of the above messages, and reports a state change. This message reports a request to close a session. It uses the structure shown below, and reports back the hook name corresponding to the closed session. The hook will probably have been removed immediately after sending this message. At present this message is not yet used and a <code class=Dv>NGM_PPPOE_FAIL</code> message will be received at closure instead.</dd><dt><a class=permalink href=#NGM_PPPOE_ACNAME><code class=Dv id=NGM_PPPOE_ACNAME>NGM_PPPOE_ACNAME</code></a></dt><dd>This command is sent to the node that started this session with one of the above messages, and reports the Access Concentrator Name.</dd></dl><p class=Pp>The four commands above use a common data structure:</p><div class="Bd Pp Bd-indent"><pre>
struct ngpppoe_sts {
    char    hook[NG_HOOKSIZ];
};
</pre></div><dl class=Bl-tag><dt><a class=permalink href=#NGM_PPPOE_GETMODE><code class=Dv id=NGM_PPPOE_GETMODE>NGM_PPPOE_GETMODE</code></a> (<code class=Ic>pppoe_getmode</code>)</dt><dd>This command returns the current compatibility mode of the node as a string. ASCII form of this message is “<code class=Li>pppoe_getmode</code>”. The following keywords can be returned: <dl class=Bl-tag><dt>“standard”</dt><dd>The node operates according to RFC 2516.</dd><dt>“3Com”</dt><dd>When <code class=Nm>ng_pppoe</code> is a PPPoE client, it initiates a session encapsulating packets into incorrect 3Com ethertypes. This compatibility option does not affect server mode. In server mode <code class=Nm>ng_pppoe</code> supports both modes simultaneously, depending on the ethertype, the client used when connecting.</dd><dt>“D-Link”</dt><dd>When <code class=Nm>ng_pppoe</code> is a PPPoE server serving only specific Service-Name(s), it will respond to a PADI requests with empty Service-Name tag, returning all available Service-Name(s) on node. This option is necessary for compatibility with D-Link DI-614+ and DI-624+ SOHO routers as clients, when serving only specific Service-Name. This compatibility option does not affect client mode.</dd></dl></dd><dt><a class=permalink href=#NGM_PPPOE_SETMODE><code class=Dv id=NGM_PPPOE_SETMODE>NGM_PPPOE_SETMODE</code></a> (<code class=Ic>pppoe_setmode</code>)</dt><dd>Configure node to the specified mode. The string argument is required. This command understands the same keywords that are returned by the <code class=Dv>NGM_PPPOE_GETMODE</code> command. ASCII form of this message is “<code class=Li>pppoe_setmode</code>”. For example, the following command will configure the node to initiate the next session in the proprietary 3Com mode: <div class="Bd Pp Bd-indent"><pre>
ngctl msg fxp0:orphans pppoe_setmode '"3Com"'
    </pre></div></dd><dt><a class=permalink href=#NGM_PPPOE_SETENADDR><code class=Dv id=NGM_PPPOE_SETENADDR>NGM_PPPOE_SETENADDR</code></a> (<code class=Ic>setenaddr</code>)</dt><dd>Set the node Ethernet address for outgoing datagrams. This message is important when a node has failed to obtain an Ethernet address from its peer on the <code class=Dv>ethernet</code> hook, or when user wants to override this address with another one. ASCII form of this message is “<code class=Li>setenaddr</code>”.</dd><dt><a class=permalink href=#NGM_PPPOE_SETMAXP><code class=Dv id=NGM_PPPOE_SETMAXP>NGM_PPPOE_SETMAXP</code></a> (<code class=Ic>setmaxp</code>)</dt><dd>Set the node PPP-Max-Payload value as described in RFC 4638. This message applies only to a client configuration. ASCII form of this message is “<code class=Li>setmaxp</code>”. <p class=Pp>Data structure returned to client is:</p><div class="Bd Pp Bd-indent"><pre>
struct ngpppoe_maxp {
    char     hook[NG_HOOKSIZ];
    uint16_t data;
};
    </pre></div></dd><dt><a class=permalink href=#NGM_PPPOE_SEND_HURL><code class=Dv id=NGM_PPPOE_SEND_HURL>NGM_PPPOE_SEND_HURL</code></a> (<code class=Ic>send_hurl</code>)</dt><dd>Tell a nominated hook with an active session to send a PADM message with a HURL tag. The argument is the URL to be delivered to the client: <div class="Bd Pp Bd-indent"><pre>
ngctl msg fxp0:orphans send_hurl '{ hook="myHook" data="http://example.net/cpe" }'
    </pre></div></dd><dt><a class=permalink href=#NGM_PPPOE_SEND_MOTM><code class=Dv id=NGM_PPPOE_SEND_MOTM>NGM_PPPOE_SEND_MOTM</code></a> (<code class=Ic>send_motm</code>)</dt><dd>Tell a nominated hook with an active session to send a PADM message with a MOTM tag. The argument is the message to be delivered to the client: <div class="Bd Pp Bd-indent"><pre>
ngctl msg fxp0:orphans send_motm '{ hook="myHook" data="Welcome aboard" }'
    </pre></div></dd></dl><p class=Pp>The two commands above use the same ngpppoe_init_data structure described above.</p><dl class=Bl-tag><dt><a class=permalink href=#NGM_PPPOE_HURL><code class=Dv id=NGM_PPPOE_HURL>NGM_PPPOE_HURL</code></a></dt><dd>This command is sent to the node that started this session when a PADM message with a HURL tag is received, and contains a URL that the host can pass to a web browser for presentation to the user.</dd><dt><a class=permalink href=#NGM_PPPOE_MOTM><code class=Dv id=NGM_PPPOE_MOTM>NGM_PPPOE_MOTM</code></a></dt><dd>This command is sent to the node that started this session when a PADM message with a MOTM tag is received, and contains a Message Of The Minute that the host can display to the user.</dd></dl><p class=Pp>The two commands above use a common data structure:</p><div class="Bd Pp Bd-indent"><pre>
struct ngpppoe_padm {
    char    msg[PPPOE_PADM_VALUE_SIZE];
};
</pre></div></section><section class=Sh><h2 class=Sh id=SHUTDOWN><a class=permalink href=#SHUTDOWN>SHUTDOWN</a></h2> This node shuts down upon receipt of a <code class=Dv>NGM_SHUTDOWN</code> control message, when all session have been disconnected or when the <code class=Dv>ethernet</code> hook is disconnected. </section><section class=Sh><h2 class=Sh id=SYSCTL_VARIABLES><a class=permalink href=#SYSCTL_VARIABLES>SYSCTL VARIABLES</a></h2> The node can mark transmitted LCP Ethernet packets (protocol 0xc021) with 3-bit Priority Code Point (PCP) referring to IEEE 802.1p class of service with following <a class=Xr href=sysctl.8.html>sysctl(8)</a> variable. <dl class=Bl-tag><dt><var class=Va>net.graph.pppoe.lcp_pcp: 0..7 (default: 0)</var></dt><dd>Set it to non-zero value to be used by parent network interface driver like <a class=Xr href=vlan.4.html>vlan(4)</a></dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> The following code uses <code class=Dv>libnetgraph</code> to set up a <code class=Nm>ng_pppoe</code> node and connect it to both a socket node and an Ethernet node. It can handle the case of when a <code class=Nm>ng_pppoe</code> node is already attached to the Ethernet. It then starts a client session. <div class="Bd Pp"><pre>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;ctype.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sysexits.h&gt;
#include &lt;errno.h&gt;
#include &lt;err.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/select.h&gt;
#include &lt;net/ethernet.h&gt;

#include &lt;netgraph.h&gt;
#include &lt;netgraph/ng_ether.h&gt;
#include &lt;netgraph/ng_pppoe.h&gt;
#include &lt;netgraph/ng_socket.h&gt;
static int setup(char *ethername, char *service, char *sessname,
				int *dfd, int *cfd);

int
main()
{
	int  fd1, fd2;
	setup("xl0", NULL, "fred", &amp;fd1, &amp;fd2);
	sleep (30);
}

static int
setup(char *ethername, char *service, char *sessname,
			int *dfd, int *cfd)
{
	struct ngm_connect ngc;	/* connect */
	struct ngm_mkpeer mkp;	/* mkpeer */
	/******** nodeinfo stuff **********/
	u_char          rbuf[2 * 1024];
	struct ng_mesg *const resp = (struct ng_mesg *) rbuf;
	struct hooklist *const hlist
			= (struct hooklist *) resp-&gt;data;
	struct nodeinfo *const ninfo = &amp;hlist-&gt;nodeinfo;
	int             ch, no_hooks = 0;
	struct linkinfo *link;
	struct nodeinfo *peer;
	/****message to connect PPPoE session*****/
	struct {
		struct ngpppoe_init_data idata;
		char            service[100];
	}               message;
	/********tracking our little graph ********/
	char            path[100];
	char            source_ID[NG_NODESIZ];
	char            pppoe_node_name[100];
	int             k;

	/*
	 * Create the data and control sockets
	 */
	if (NgMkSockNode(NULL, cfd, dfd) &lt; 0) {
		return (errno);
	}
	/*
	 * find the ether node of the name requested by asking it for
	 * it's inquiry information.
	 */
	if (strlen(ethername) &gt; 16)
		return (EINVAL);
	sprintf(path, "%s:", ethername);
	if (NgSendMsg(*cfd, path, NGM_GENERIC_COOKIE,
		      NGM_LISTHOOKS, NULL, 0) &lt; 0) {
		return (errno);
	}
	/*
	 * the command was accepted so it exists. Await the reply (It's
	 * almost certainly already waiting).
	 */
	if (NgRecvMsg(*cfd, resp, sizeof(rbuf), NULL) &lt; 0) {
		return (errno);
	}
	/**
	 * The following is available about the node:
	 * ninfo-&gt;name		(string)
	 * ninfo-&gt;type		(string)
	 * ninfo-&gt;id		(uint32_t)
	 * ninfo-&gt;hooks		(uint32_t) (count of hooks)
	 * check it is the correct type. and get it's ID for use
	 * with mkpeer later.
	 */
	if (strncmp(ninfo-&gt;type, NG_ETHER_NODE_TYPE,
		    strlen(NG_ETHER_NODE_TYPE)) != 0) {
		return (EPROTOTYPE);
	}
	sprintf(source_ID, "[%08x]:", ninfo-&gt;id);

	/*
	 * look for a hook already attached.
	 */
	for (k = 0; k &lt; ninfo-&gt;hooks; k++) {
		/**
		 * The following are available about each hook.
		 * link-&gt;ourhook	(string)
		 * link-&gt;peerhook	(string)
		 * peer-&gt;name		(string)
		 * peer-&gt;type		(string)
		 * peer-&gt;id		(uint32_t)
		 * peer-&gt;hooks		(uint32_t)
		 */
		link = &amp;hlist-&gt;link[k];
		peer = &amp;hlist-&gt;link[k].nodeinfo;

		/* Ignore debug hooks */
		if (strcmp("debug", link-&gt;ourhook) == 0)
			continue;

		/* If the orphans hook is attached, use that */
		if (strcmp(NG_ETHER_HOOK_ORPHAN,
		    link-&gt;ourhook) == 0) {
			break;
		}
		/* the other option is the 'divert' hook */
		if (strcmp("NG_ETHER_HOOK_DIVERT",
		    link-&gt;ourhook) == 0) {
			break;
		}
	}

	/*
	 * See if we found a hook there.
	 */
	if (k &lt; ninfo-&gt;hooks) {
		if (strcmp(peer-&gt;type, NG_PPPOE_NODE_TYPE) == 0) {
			/*
			 * If it's a type PPPoE, we skip making one
			 * ourself, but we continue, using
			 * the existing one.
			 */
			sprintf(pppoe_node_name, "[%08x]:", peer-&gt;id);
		} else {
			/*
			 * There is already someone hogging the data,
			 * return an error. Some day we'll try
			 * daisy-chaining..
			 */
			return (EBUSY);
		}
	} else {

		/*
		 * Try make a node of type PPPoE against node "ID"
		 * On hook NG_ETHER_HOOK_ORPHAN.
		 */
		snprintf(mkp.type, sizeof(mkp.type),
			 "%s", NG_PPPOE_NODE_TYPE);
		snprintf(mkp.ourhook, sizeof(mkp.ourhook),
			 "%s", NG_ETHER_HOOK_ORPHAN);
		snprintf(mkp.peerhook, sizeof(mkp.peerhook),
			 "%s", NG_PPPOE_HOOK_ETHERNET);
		/* Send message */
		if (NgSendMsg(*cfd, source_ID, NGM_GENERIC_COOKIE,
			      NGM_MKPEER, &amp;mkp, sizeof(mkp)) &lt; 0) {
			return (errno);
		}
		/*
		 * Work out a name for the new node.
		 */
		sprintf(pppoe_node_name, "%s:%s",
			source_ID, NG_ETHER_HOOK_ORPHAN);
	}
	/*
	 * We now have a PPPoE node attached to the Ethernet
	 * card. The Ethernet is addressed as ethername: The PPPoE
	 * node is addressed as pppoe_node_name: attach to it.
	 * Connect socket node to specified node Use the same hook
	 * name on both ends of the link.
	 */
	snprintf(ngc.path, sizeof(ngc.path), "%s", pppoe_node_name);
	snprintf(ngc.ourhook, sizeof(ngc.ourhook), "%s", sessname);
	snprintf(ngc.peerhook, sizeof(ngc.peerhook), "%s", sessname);

	if (NgSendMsg(*cfd, ".:", NGM_GENERIC_COOKIE,
		      NGM_CONNECT, &amp;ngc, sizeof(ngc)) &lt; 0) {
		return (errno);
	}

#ifdef	NONSTANDARD
	/*
	 * In some cases we are speaking to 3Com hardware, so
	 * configure node to non-standard mode.
	 */
	if (NgSendMsg(*cfd, ngc.path, NGM_PPPOE_COOKIE,
			NGM_PPPOE_SETMODE, NG_PPPOE_NONSTANDARD,
			strlen(NG_PPPOE_NONSTANDARD) + 1) == -1) {
		return (errno);
	}
#endif

	/*
	 * Send it a message telling it to start up.
	 */
	bzero(&amp;message, sizeof(message));
	snprintf(message.idata.hook, sizeof(message.idata.hook),
				"%s", sessname);
	if (service == NULL) {
		message.idata.data_len = 0;
	} else {
		snprintf(message.idata.data,
			 sizeof(message.idata.data), "%s", service);
		message.idata.data_len = strlen(service);
	}
	/* Tell session/hook to start up as a client */
	if (NgSendMsg(*cfd, ngc.path,
		      NGM_PPPOE_COOKIE, NGM_PPPOE_CONNECT, &amp;message.idata,
		      sizeof(message.idata) + message.idata.data_len) &lt; 0) {
		return (errno);
	}
	return (0);
}
</pre></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=netgraph.3.html>netgraph(3)</a>, <a class=Xr href=netgraph.4.html>netgraph(4)</a>, <a class=Xr href=ng_ether.4.html>ng_ether(4)</a>, <a class=Xr href=ng_ppp.4.html>ng_ppp(4)</a>, <a class=Xr href=ng_socket.4.html>ng_socket(4)</a>, <a class=Xr href=ngctl.8.html>ngctl(8)</a>, <a class=Xr href=ppp.8.html>ppp(8)</a>, <a class=Xr href=vlan.4.html>vlan(4)</a><p class=Pp><cite class=Rs><span class=RsA>L. Mamakos</span>, <span class=RsA>K. Lidl</span>, <span class=RsA>J. Evarts</span>, <span class=RsA>D. Carrel</span>, <span class=RsA>D. Simone</span>, and <span class=RsA>R. Wheeler</span>, <span class=RsT>A Method for transmitting PPP over Ethernet (PPPoE)</span>, <span class=RsO>RFC 2516</span>.</cite></p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>ng_pppoe</code> node type was implemented in <span class=Ux>FreeBSD 4.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Julian Elischer</span> &lt;<a class=Mt href=mailto:julian@FreeBSD.org>julian@FreeBSD.org</a>&gt; </section></div><table class=foot><tr><td class=foot-date>May 1, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>