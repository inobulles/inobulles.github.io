<!DOCTYPE html>
<html><head><meta charset=utf-8><title>gmirror(8)</title><keywords content=man,gmirror></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>gmirror(8)</h1><table class=head><tr><td class=head-ltitle>GMIRROR(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>GMIRROR(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>gmirror</code> — <div class=Nd>control utility for mirrored devices</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>label</code> [<code class=Fl>-Fhnv</code>] [<code class=Fl>-b</code><var class=Ar>balance</var>] [<code class=Fl>-s</code><var class=Ar>slice</var>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>clear</code> [<code class=Fl>-v</code>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>create</code> [<code class=Fl>-Fnv</code>] [<code class=Fl>-b</code><var class=Ar>balance</var>] [<code class=Fl>-s</code><var class=Ar>slice</var>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>configure</code> [<code class=Fl>-adfFhnv</code>] [<code class=Fl>-b</code><var class=Ar>balance</var>] [<code class=Fl>-s</code><var class=Ar>slice</var>] <var class=Ar>name</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>configure</code> [<code class=Fl>-v</code>] <code class=Fl>-p</code><var class=Ar>priority</var><var class=Ar>name</var><var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>rebuild</code> [<code class=Fl>-v</code>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>resize</code> [<code class=Fl>-v</code>] [<code class=Fl>-s</code><var class=Ar>size</var>] <var class=Ar>name</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>insert</code> [<code class=Fl>-hiv</code>] [<code class=Fl>-p</code><var class=Ar>priority</var>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>remove</code> [<code class=Fl>-v</code>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>activate</code> [<code class=Fl>-v</code>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>deactivate</code> [<code class=Fl>-v</code>] <var class=Ar>name</var><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>destroy</code> [<code class=Fl>-fv</code>] <var class=Ar>name ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>forget</code> [<code class=Fl>-v</code>] <var class=Ar>name ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>stop</code> [<code class=Fl>-fv</code>] <var class=Ar>name ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>dump</code><var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>list</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>status</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>load</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>gmirror</code></td><td><code class=Cm>unload</code></td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>gmirror</code> utility is used for mirror (RAID1) configurations. After a mirror's creation, all components are detected and configured automatically. All operations like failure detection, stale component detection, rebuild of stale components, etc. are also done automatically. The <code class=Nm>gmirror</code> utility uses on-disk metadata (stored in the provider's last sector) to store all needed information. Since the last sector is used for this purpose, it is possible to place a root file system on a mirror. <p class=Pp>The first argument to <code class=Nm>gmirror</code> indicates an action to be performed:</p><dl class=Bl-tag><dt><a class=permalink href=#label><code class=Cm id=label>label</code></a></dt><dd>Create a mirror. The order of components is important, because a component's priority is based on its position (starting from 0 to 255). The component with the biggest priority is used by the <code class=Cm>prefer</code> balance algorithm and is also used as a master component when resynchronization is needed, e.g. after a power failure when the device was open for writing. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#b><code class=Fl id=b>-b</code></a><var class=Ar>balance</var></dt><dd>Specifies balance algorithm to use, one of: <dl class=Bl-tag><dt><a class=permalink href=#load><code class=Cm id=load>load</code></a></dt><dd>Read from the component with the lowest load. This is the default balance algorithm.</dd><dt><a class=permalink href=#prefer><code class=Cm id=prefer>prefer</code></a></dt><dd>Read from the component with the biggest priority.</dd><dt><a class=permalink href=#round-robin><code class=Cm id=round-robin>round-robin</code></a></dt><dd>Use round-robin algorithm when choosing component to read.</dd><dt><a class=permalink href=#split><code class=Cm id=split>split</code></a></dt><dd>Split read requests, which are bigger than or equal to slice size on N pieces, where N is the number of active components.</dd></dl></dd><dt><a class=permalink href=#F><code class=Fl id=F>-F</code></a></dt><dd>Do not synchronize after a power failure or system crash. Assumes device is in consistent state.</dd><dt><a class=permalink href=#h><code class=Fl id=h>-h</code></a></dt><dd>Hardcode providers' names in metadata.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a></dt><dd>Turn off autosynchronization of stale components.</dd><dt><a class=permalink href=#s><code class=Fl id=s>-s</code></a><var class=Ar>slice</var></dt><dd>When using the <code class=Cm>split</code> balance algorithm and an I/O READ request is bigger than or equal to this value, the I/O request will be split into N pieces, where N is the number of active components. Defaults to 4096 bytes.</dd></dl></dd><dt><a class=permalink href=#clear><code class=Cm id=clear>clear</code></a></dt><dd>Clear metadata on the given providers.</dd><dt><a class=permalink href=#create><code class=Cm id=create>create</code></a></dt><dd>Similar to <code class=Cm>label</code>, but creates mirror without storing on-disk metadata in last sector. This special "manual" operation mode assumes some external control to manage mirror detection after reboot, device hot-plug and other external events.</dd><dt><a class=permalink href=#configure><code class=Cm id=configure>configure</code></a></dt><dd>Configure the given device. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a><code class=Fl id=a>-a</code></a></dt><dd>Turn on autosynchronization of stale components.</dd><dt><a class=permalink href=#b_2><code class=Fl id=b_2>-b</code></a><var class=Ar>balance</var></dt><dd>Specifies balance algorithm to use.</dd><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a></dt><dd>Do not hardcode providers' names in metadata.</dd><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a></dt><dd>Synchronize device after a power failure or system crash.</dd><dt><a class=permalink href=#F_2><code class=Fl id=F_2>-F</code></a></dt><dd>Do not synchronize after a power failure or system crash. Assumes device is in consistent state.</dd><dt><a class=permalink href=#h_2><code class=Fl id=h_2>-h</code></a></dt><dd>Hardcode providers' names in metadata.</dd><dt><a class=permalink href=#n_2><code class=Fl id=n_2>-n</code></a></dt><dd>Turn off autosynchronization of stale components.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a><var class=Ar>priority</var></dt><dd>Specifies priority for the given component <var class=Ar>prov</var>.</dd><dt><a class=permalink href=#s_2><code class=Fl id=s_2>-s</code></a><var class=Ar>slice</var></dt><dd>Specifies slice size for <code class=Cm>split</code> balance algorithm.</dd></dl></dd><dt><a class=permalink href=#rebuild><code class=Cm id=rebuild>rebuild</code></a></dt><dd>Rebuild the given mirror components forcibly. If autosynchronization was not turned off for the given device, this command should be unnecessary.</dd><dt><a class=permalink href=#resize><code class=Cm id=resize>resize</code></a></dt><dd>Change the size of the given mirror. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#s_3><code class=Fl id=s_3>-s</code></a><var class=Ar>size</var></dt><dd>New size of the mirror is expressed in logical block numbers. This option can be omitted, then it will be automatically calculated to maximum available size.</dd></dl></dd><dt><a class=permalink href=#insert><code class=Cm id=insert>insert</code></a></dt><dd>Add the given component(s) to the existing mirror. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#h_3><code class=Fl id=h_3>-h</code></a></dt><dd>Hardcode providers' names in metadata.</dd><dt><a class=permalink href=#i><code class=Fl id=i>-i</code></a></dt><dd>Mark component(s) as inactive immediately after insertion.</dd><dt><a class=permalink href=#p_2><code class=Fl id=p_2>-p</code></a><var class=Ar>priority</var></dt><dd>Specifies priority of the given component(s).</dd></dl></dd><dt><a class=permalink href=#remove><code class=Cm id=remove>remove</code></a></dt><dd>Remove the given component(s) from the mirror and clear metadata on it.</dd><dt><a class=permalink href=#activate><code class=Cm id=activate>activate</code></a></dt><dd>Activate the given component(s), which were marked as inactive before.</dd><dt><a class=permalink href=#deactivate><code class=Cm id=deactivate>deactivate</code></a></dt><dd>Mark the given component(s) as inactive, so it will not be automatically connected to the mirror.</dd><dt><a class=permalink href=#destroy><code class=Cm id=destroy>destroy</code></a></dt><dd>Stop the given mirror and clear metadata on all its components. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#f_2><code class=Fl id=f_2>-f</code></a></dt><dd>Stop the given mirror even if it is opened.</dd></dl></dd><dt><a class=permalink href=#forget><code class=Cm id=forget>forget</code></a></dt><dd>Forget about components which are not connected. This command is useful when a disk has failed and cannot be reconnected, preventing the <code class=Cm>remove</code> command from being used to remove it.</dd><dt><a class=permalink href=#stop><code class=Cm id=stop>stop</code></a></dt><dd>Stop the given mirror. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#f_3><code class=Fl id=f_3>-f</code></a></dt><dd>Stop the given mirror even if it is opened.</dd></dl></dd><dt><a class=permalink href=#dump><code class=Cm id=dump>dump</code></a></dt><dd>Dump metadata stored on the given providers.</dd><dt><a class=permalink href=#list><code class=Cm id=list>list</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#status><code class=Cm id=status>status</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#load_2><code class=Cm id=load_2>load</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#unload><code class=Cm id=unload>unload</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd></dl><p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Be more verbose.</dd></dl></section><section class=Sh><h2 class=Sh id=EXIT_STATUS><a class=permalink href=#EXIT_STATUS>EXIT STATUS</a></h2> Exit status is 0 on success, and 1 if the command fails. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> Use 3 disks to setup a mirror. Choose split balance algorithm, split only requests which are bigger than or equal to 2kB. Create file system, mount it, then unmount it and stop device: <div class="Bd Pp Bd-indent"><pre>
gmirror label -v -b split -s 2048 data da0 da1 da2
newfs /dev/mirror/data
mount /dev/mirror/data /mnt
...
umount /mnt
gmirror stop data
gmirror unload
</pre></div><p class=Pp>Create a mirror on disk with valid data (note that the last sector of the disk will be overwritten). Add another disk to this mirror, so it will be synchronized with existing disk:</p><div class="Bd Pp Bd-indent"><pre>
gmirror label -v -b round-robin data da0
gmirror insert data da1
</pre></div><p class=Pp>Create a mirror, but do not use automatic synchronization feature. Add another disk and rebuild it:</p><div class="Bd Pp Bd-indent"><pre>
gmirror label -v -n -b load data da0 da1
gmirror insert data da2
gmirror rebuild data da2
</pre></div><p class=Pp>One disk failed. Replace it with a brand new one:</p><div class="Bd Pp Bd-indent"><pre>
gmirror forget data
gmirror insert data da1
</pre></div><p class=Pp>Create a mirror, deactivate one component, do the backup and connect it again. It will not be resynchronized, if there is no need to do so (there were no writes in the meantime):</p><div class="Bd Pp Bd-indent"><pre>
gmirror label data da0 da1
gmirror deactivate data da1
dd if=/dev/da1 of=/backup/data.img bs=1m
gmirror activate data da1
</pre></div></section><section class=Sh><h2 class=Sh id=SYSCTL_VARIABLES><a class=permalink href=#SYSCTL_VARIABLES>SYSCTL VARIABLES</a></h2> The following <a class=Xr href=sysctl.8.html>sysctl(8)</a> variables can be used to configure behavior for all mirrors. <dl class=Bl-tag><dt><var class=Va>kern.geom.mirror.debug</var></dt><dd>Control the verbosity of kernel logging related to mirrors. A value larger than 0 will enable debug logging.</dd><dt><var class=Va>kern.geom.mirror.timeout</var></dt><dd>The amount of time, in seconds, to wait for all copies of a mirror to appear before starting the mirror. Disks that appear after the mirror has been started are not automatically added to the mirror.</dd><dt><var class=Va>kern.geom.mirror.idletime</var></dt><dd>The amount of time, in seconds, which must elapse after the last write to a mirror before that mirror is marked clean. Clean mirrors do not need to be synchronized after a power failure or system crash. A small value may result in frequent overwrites of the disks' metadata sectors, and thus may reduce the longevity of the disks.</dd><dt><var class=Va>kern.geom.mirror.disconnect_on_failure</var></dt><dd>Determine whether a disk is automatically removed from its mirror when an I/O request to that disk fails.</dd><dt><var class=Va>kern.geom.mirror.sync_requests</var></dt><dd>The number of parallel I/O requests used while synchronizing a mirror. This parameter may only be configured as a <a class=Xr href=loader.conf.5.html>loader.conf(5)</a> tunable.</dd><dt><var class=Va>kern.geom.mirror.sync_update_period</var></dt><dd>The period, in seconds, at which a synchronizing mirror's metadata is updated. Periodic updates are used to record a synchronization's progress so that an interrupted synchronization may be resumed starting at the recorded offset, rather than at the beginning. A smaller value results in more accurate progress tracking, but also increases the number of non-sequential writes to the disk being synchronized. If the sysctl value is 0, no updates are performed until the synchronization is complete.</dd></dl></section><section class=Sh><h2 class=Sh id=NOTES><a class=permalink href=#NOTES>NOTES</a></h2> Doing kernel dumps to <code class=Nm>gmirror</code> providers is possible, but some conditions have to be met. First of all, a kernel dump will go only to one component and <code class=Nm>gmirror</code> always chooses the component with the highest priority. Reading a dump from the mirror on boot will only work if the <code class=Cm>prefer</code> balance algorithm is used (that way <code class=Nm>gmirror</code> will read only from the component with the highest priority). If you use a different balance algorithm, you should create an <a class=Xr href=rc.8.html>rc(8)</a> script that sets the balance algorithm to <code class=Cm>prefer</code>, for example with the following command: <div class="Bd Pp Bd-indent"><pre>
gmirror configure -b prefer data
</pre></div><p class=Pp>Make sure that <a class=Xr href=rcorder.8.html>rcorder(8)</a> schedules the new script before <a class=Xr href=savecore.8.html>savecore(8)</a>. The desired balance algorithm can be restored later on by placing the following command in <a class=Xr href=rc.local.8.html>rc.local(8)</a>:</p><div class="Bd Pp Bd-indent"><pre>
gmirror configure -b round-robin data
</pre></div><p class=Pp>The decision which component to choose for dumping is made when <a class=Xr href=dumpon.8.html>dumpon(8)</a> is called. If on the next boot a component with a higher priority will be available, the prefer algorithm will choose to read from it and <a class=Xr href=savecore.8.html>savecore(8)</a> will find nothing. If on the next boot a component with the highest priority will be synchronized, the prefer balance algorithm will read from the next one, thus will find nothing there.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=geom.4.html>geom(4)</a>, <a class=Xr href=dumpon.8.html>dumpon(8)</a>, <a class=Xr href=geom.8.html>geom(8)</a>, <a class=Xr href=gvinum.8.html>gvinum(8)</a>, <a class=Xr href=mount.8.html>mount(8)</a>, <a class=Xr href=newfs.8.html>newfs(8)</a>, <a class=Xr href=savecore.8.html>savecore(8)</a>, <a class=Xr href=sysctl.8.html>sysctl(8)</a>, <a class=Xr href=umount.8.html>umount(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>gmirror</code> utility appeared in <span class=Ux>FreeBSD 5.3</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Pawel Jakub Dawidek</span> &lt;<a class=Mt href=mailto:pjd@FreeBSD.org>pjd@FreeBSD.org</a>&gt; </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> There should be a way to change a component's priority inside a running mirror. <p class=Pp>There should be a section with an implementation description.</p></section></div><table class=foot><tr><td class=foot-date>July 21, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>