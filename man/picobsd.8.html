<!DOCTYPE html>
<html><head><meta charset=utf-8><title>picobsd(8)</title><keywords content=man,picobsd></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>picobsd(8)</h1><table class=head><tr><td class=head-ltitle>PICOBSD(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>PICOBSD(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>picobsd</code> — <div class=Nd>building small FreeBSD disk images</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>picobsd</code></td><td>[<var class=Ar>options</var>] [<var class=Ar>config-name</var> [<var class=Ar>site-name</var>]]</td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2><code class=Nm>picobsd</code> is deprecated and will be removed in <span class=Ux>FreeBSD 13.0</span>. <p class=Pp>The <code class=Nm>picobsd</code> utility is a script which produces a minimal implementation of <span class=Ux>FreeBSD</span> (historically called <code class=Nm>PicoBSD</code>) which typically fits on a small media such as a floppy disk, or can be downloaded as a single image file from some media such as CDROM, flash memory, or through etherboot.</p><p class=Pp>The <code class=Nm>picobsd</code> utility was originally created to build simple standalone systems such as firewalls or bridges, but because of the ability to cross-build images with different source trees than the one in the server, it can be extremely useful to developers to test their code without having to reinstall the system.</p><p class=Pp>The boot media (historically a floppy disk, but also small CDROM or USB keys) contains a boot loader and a compressed kernel which includes a memory file system. Depending on the media, it might also contain a number of additional files, which can be updated at run time, and are used to override/update those in the memory file system.</p><p class=Pp>The system loads the kernel in the normal way, uncompresses the memory file system and mounts it as root. It then updates the memory file system with files from the boot media (if present), and executes a specialized version of <span class=Pa>/etc/rc</span>. The boot media (floppy, etc.) is required for loading only, and typically used read-only. After the boot phase, the system runs entirely from RAM.</p><p class=Pp>The following options are available (but also check the <code class=Nm>picobsd</code> script for more details). The most important options for common operations are <code class=Fl>-src</code>, <code class=Fl>-init</code>, <code class=Fl>-n</code><code class=Fl>-and</code><code class=Fl>-v</code>.</p><dl class=Bl-tag><dt><a class=permalink href=#-all_in_mfs><code class=Fl id=-all_in_mfs>--all_in_mfs</code></a></dt><dd>Put the entire contents of the file system in the memory file system image which is contained in the kernel. This is the default behaviour, and is extremely useful as the kernel itself can be loaded, using etherboot or <a class=Xr href=pxeboot.8.html>pxeboot(8)</a>,</dd><dt><a class=permalink href=#c><code class=Fl id=c>-c</code></a>, <code class=Fl>-clean</code></dt><dd>Clean the product of previous builds.</dd><dt><a class=permalink href=#-cfg><code class=Fl id=-cfg>--cfg</code></a><var class=Ar>file</var></dt><dd>Specify a file that contains additional config commands.</dd><dt><a class=permalink href=#-floppy_size><code class=Fl id=-floppy_size>--floppy_size</code></a><var class=Ar>size</var></dt><dd>Set the size of the disk image. Typical values for a floppy disk are 1440 or 2880, but other values can be used for other media (flash memories, CDROM, network booted kernels). Note that this option is overridden by the content of the config files (config in the image tree, or the one specified with <code class=Fl>-</code><code class=Fl>-cfg</code>)</dd><dt><a class=permalink href=#-init><code class=Fl id=-init>--init</code></a></dt><dd>When used together with the <code class=Fl>--src</code> option, this initializes the ⟨<var class=Ar>SRC_PATH</var>⟩<span class=Pa>/../usr</span> subtree as necessary to subsequently build <code class=Nm>picobsd</code> images.</dd><dt><a class=permalink href=#-iso><code class=Fl id=-iso>--iso</code></a></dt><dd>Generate an ISO image, <span class=Pa>picobsd.iso</span>, in addition to the disk image <span class=Pa>picobsd.bin</span>.</dd><dt><a class=permalink href=#-modules><code class=Fl id=-modules>--modules</code></a></dt><dd>Also build kernel modules. These are not stored on the <code class=Nm>picobsd</code> image but are left available in the build directory.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a></dt><dd>Make the script non-interactive, skipping the initial menu and proceeding with the build process without requiring user input.</dd><dt><a class=permalink href=#-no_all_in_mfs><code class=Fl id=-no_all_in_mfs>--no_all_in_mfs</code></a></dt><dd>Leaves files contained in the <span class=Pa>floppy.tree</span> on the <code class=Nm>picobsd</code> image, so they can be loaded separately from the kernel (and updated individually to customize the image).</dd><dt><a class=permalink href=#-no_loader><code class=Fl id=-no_loader>--no_loader</code></a></dt><dd>Omit /boot/loader, just rely on boot2 to load the kernel. This saves some space but may have problems with kernels &gt; 4MB.</dd><dt><a class=permalink href=#-objdir><code class=Fl id=-objdir>--objdir</code></a><var class=Ar>directory</var></dt><dd>Specify a directory with the result of a previous buildworld. This saves the need for an <code class=Fl>-</code><code class=Fl>-init</code> call before creating an image.</dd><dt><a class=permalink href=#-src><code class=Fl id=-src>--src</code></a><var class=Ar>SRC_PATH</var></dt><dd>Use the source tree at <var class=Ar>SRC_PATH</var> instead the one at <span class=Pa>/usr/src</span>. This can be useful for cross-building <code class=Nm>picobsd</code> images. When using this option, you must also create and initialize the subtree at ⟨<var class=Ar>SRC_PATH</var>⟩<span class=Pa>/../usr</span> with the correct header files, libraries, and tools (such as the <a class=Xr href=config.8.html>config(8)</a> program) that are necessary for the cross-build (see the <code class=Fl>--init</code> option). The source files are unmodified by the <code class=Nm>picobsd</code> script. However the source tree is not completely read-only, because <a class=Xr href=config.8.html>config(8)</a> expects the kernel configuration file to be in one of its subdirectories, and also the process of initializing the <span class=Pa>usr</span> subtree touches some parts of the source tree (this is a bug in the release build scripts which might go away with time).</dd><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Make the script verbose, showing commands to be executed and waiting for user input before executing each of them. Useful for debugging. as a fully functional system.</dd></dl></section><section class=Sh><h2 class=Sh id=ENVIRONMENT><a class=permalink href=#ENVIRONMENT>ENVIRONMENT</a></h2> As a result of extreme size limitations, the <code class=Nm>picobsd</code> environment differs from the normal <span class=Ux>FreeBSD</span> in a number of ways: <ul class=Bl-bullet><li>There are no dynamic libraries, and there is no directory <span class=Pa>/usr/lib</span>. As a result, only static executables may be executed.</li><li>In order to reduce the size of the executables, all executables on a specific floppy are joined together as a single executable built with <a class=Xr href=crunchgen.1.html>crunchgen(1)</a>.</li><li>Some programs are supplied in minimalistic versions, specifically <code class=Nm>ns</code>, a cut-down version of <a class=Xr href=netstat.1.html>netstat(1)</a>, and <code class=Nm>vm</code>, a cut-down version of <a class=Xr href=vmstat.8.html>vmstat(8)</a>.</li></ul></section><section class=Sh><h2 class=Sh id=BUILDING_PicoBSD><a class=permalink href=#BUILDING_PicoBSD>BUILDING PicoBSD</a></h2> The <code class=Nm>picobsd</code> sources reside in the hierarchy <span class=Pa>/usr/src/release/picobsd</span>. In the following discussion, all relative path names are relative to this directory. <p class=Pp>The supported build script is <span class=Pa>/usr/src/release/picobsd/build/picobsd</span> which can be run from anywhere, and relies on the <a class=Xr href=sysutils/makefs.1.html>sysutils/makefs</a> port to build a filesystem without requiring <a class=Xr href=mdconfig.1.html>mdconfig</a> or root privileges to mount a filesystem. When run in interactive mode (the default without the <code class=Fl>-n</code> option), the script will let you configure the various parameters used to build the PicoBSD image. An image is configured using the files and directories described below. The base system contains a template, called <span class=Pa>bridge</span> for historical reasons, that can be used as a base for building various kinds of network appliances.</p><p class=Pp>You can define your own PicoBSD configuration, by creating a directory with a name of your choice (e.g. <span class=Pa>FOO</span>) which contains some of the following files and directories. For more information on how to construct these files, look at one of the standard <code class=Nm>picobsd</code> configurations as a reference.</p><dl class=Bl-tag><dt><span class=Pa>PICOBSD</span></dt><dd>The kernel configuration file (required). This is a mostly standard kernel configuration file, possibly stripped down by removing unnecessary drivers and options to reduce the kernel's size. <p class=Pp>To be recognised as a <code class=Nm>picobsd</code> kernel config file, the file must also contain the line beginning with “<code class=Li>#PicoBSD</code>” below, and a matching <code class=Dv>MD_ROOT_SIZE</code> option:</p><div class="Bd Pp Bd-indent"><pre>
#marker    def_sz  init   MFS_inodes    floppy_inodes
#PicoBSD   4200    init   8192          32768
options MD_ROOT_SIZE=4200      # same as def_sz
    </pre></div><p class=Pp>This informs the script of the size of the memory file system and provides a few other details on how to build the image.</p></dd><dt><span class=Pa>crunch.conf</span></dt><dd><a class=Xr href=crunchgen.1.html>crunchgen(1)</a> configuration (required). It contains the list of directories containing program sources, the list of binaries to be built, and the list of libraries that these programs use. See the <a class=Xr href=crunchgen.1.html>crunchgen(1)</a> manpage for the exact details on the syntax of this file. <p class=Pp>The following issues are particularly important when dealing with <code class=Nm>picobsd</code> configurations:</p><ul class=Bl-bullet><li>We can pass build options to those makefiles which understand that, in order to reduce the size of the programs. This is achieved with a line of the form <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>buildopts -DNO_PAM -DRELEASE_CRUNCH ...</code></div></li><li>When providing the list of directories where source files are, it is convenient to list the following entry first: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>srcdirs /usr/src/release/picobsd/tinyware</code></div><p class=Pp>so that <code class=Nm>picobsd</code>-specific versions of the programs will be found there.</p></li><li>The string “<code class=Li>@__CWD__@</code>” is replaced with the full pathname of the directory where the <code class=Nm>picobsd</code> configuration resides (i.e., the one where we find <span class=Pa>PICOBSD</span>, <span class=Pa>crunch.conf</span>, and so on). This can be useful to refer source code that resides within a configuration, e.g. <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>srcdirs @__CWD__@/src</code></div></li></ul></dd><dt><span class=Pa>config</span></dt><dd>Shell variables, sourced by the <code class=Nm>picobsd</code> script (optional). The most important variables here are: <dl class=Bl-tag><dt><var class=Va>MY_DEVS</var></dt><dd>(Not used in <span class=Ux>FreeBSD 5.0</span> where we have <a class=Xr href=devfs.5.html>devfs(5)</a>). Should be set to the list of devices to be created in the <span class=Pa>/dev</span> directory of the image (it is really the argument passed to <a class=Xr href=MAKEDEV.8.html>MAKEDEV(8)</a>, so refer to that manpage for the names).</dd><dt><var class=Va>fd_size</var></dt><dd>Size (in kilobytes) of the <code class=Nm>picobsd</code> image. By default, <var class=Va>fd_size</var> is set to 1440 which produces an image suitable for a standard floppy. <p class=Pp>If you plan to store the image on a CDROM (e.g. using the “El Torito” floppy emulation), you can set <var class=Va>fd_size</var> equal to 2880. If you are planning to dump the image onto a hard disk (either in a partition or on the whole disk), you are not restricted to one of the standard floppy sizes. Using a large image size per se does not waste RAM at runtime, because only the files that are actually loaded from the image contribute to the memory usage.</p></dd><dt><var class=Va>import_files</var></dt><dd>Contains a list of files to be imported in the floppy tree. Absolute names refer to the standard file system, relative names refer to the root of the source tree being used (i.e. <var class=Va>SRC_PATH/..</var>). You can normally use this option if you want to import files such as shared libraries, or databases, without having to replicate them first in your configuration under the <span class=Pa>floppy.tree/</span> directory.</dd></dl></dd><dt><span class=Pa>floppy.tree.exclude</span></dt><dd>List of files from the standard floppy tree which we do not want to be copied (optional).</dd><dt><span class=Pa>floppy.tree/</span></dt><dd>Local additions to the standard floppy tree (optional). The content of this subtree will be copied as-is into the floppy image.</dd><dt><span class=Pa>floppy.tree.</span>⟨<var class=Ar>site-name</var>⟩</dt><dd>Same as above, but site-specific (optional).</dd></dl><p class=Pp>More information on the build process can be found in the comments in the <code class=Nm>picobsd</code> script.</p></section><section class=Sh><h2 class=Sh id=USING_ALTERNATE_SOURCE_TREES><a class=permalink href=#USING_ALTERNATE_SOURCE_TREES>USING ALTERNATE SOURCE TREES</a></h2> The build script can be instructed to use an alternate source tree using the <code class=Fl>--src</code><var class=Ar>SRC_PATH</var> option. The tree that you specify must contain full sources for the kernel and for all programs that you want to include in your image. As an example, to cross-build the <span class=Pa>bridge</span> floppy using RELENG_4 sources, you can do the following: <div class="Bd Pp Bd-indent"><pre>
cd &lt;some_empty_directory&gt;
mkdir FOO
(cd FOO; cvs -d&lt;my_repository&gt; co -rRELENG_4 src)
picobsd --src FOO/src --init	# this is needed only once
picobsd --src FOO/src -n -v bridge
</pre></div><p class=Pp>If the build is successful, the directory <span class=Pa>build_dir-bridge/</span> will contain a <span class=Pa>kernel</span> that can be downloaded with etherboot, a floppy image called <span class=Pa>picobsd.bin</span>, plus the products of the compilation in other directories. If you want to modify the source tree in <span class=Pa>FOO/src</span>, a new image can be produced by simply running</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>picobsd --src FOO/src -n -v bridge</code></div><p class=Pp>whereas if the change affects include files or libraries you first need to update them, e.g. by re-running</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>picobsd --src FOO/src --init # this is needed only once</code></div><p class=Pp>as you would normally do for any change of this kind.</p></section><section class=Sh><h2 class=Sh id=INSTALLING_PicoBSD><a class=permalink href=#INSTALLING_PicoBSD>INSTALLING PicoBSD</a></h2><section class=Ss><h2 class=Ss id=Floppy_Install><a class=permalink href=#Floppy_Install>Floppy Install</a></h2> Historically, <code class=Nm>picobsd</code> is run from a floppy disk, where it can be installed with a simple <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>dd if=picobsd.bin of=/dev/rfd0</code></div><p class=Pp>and the floppy is ready to boot.</p></section><section class=Ss><h2 class=Ss id=Hard_Disk_Install><a class=permalink href=#Hard_Disk_Install>Hard Disk Install</a></h2> The same process can be used to store the image on a hard disk (entire volume or one of the slices): <div class="Bd Pp Bd-indent"><pre>
dd if=picobsd.bin of=/dev/ada2
dd if=picobsd.bin of=/dev/ada2s3
dd if=picobsd.bin of=/dev/ada2 oseek=NN
</pre></div><p class=Pp>The first form will install the image on the entire disk, and it should work in the same way as for a floppy.</p><p class=Pp>The second form will install the image on slice number 3 (which should be large enough to store the contents of the image). However, the process will only have success if the partition does not contain a valid disklabel, otherwise the kernel will likely prevent overwriting the label. In this case you can use the third form, replacing <var class=Ar>NN</var> with the actual start of the partition (which you can determine using <a class=Xr href=gpart.8.html>gpart(8)</a>). Note that after saving the image to the slice, it will not yet be recognised. You have to use the <a class=Xr href=disklabel.8.html>disklabel(8)</a> command to properly initialize the label (do not ask why!). One way to do this is</p><div class="Bd Pp Bd-indent"><pre>
disklabel -w ada0s2 auto
disklabel -e ada0s2
</pre></div><p class=Pp>and from the editor enter a line corresponding to the actual partition, e.g. if the image has 2.88MB (5760 sectors) you need to enter the following line for the partition:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>a: 5760 0 4.2BSD 512 4096</code></div><p class=Pp>At this point the partition is bootable. Note that the image size can be smaller than the slice size (indicated as partition “<code class=Li>c:</code>”).</p></section><section class=Ss><h2 class=Ss id=CDROM_Install><a class=permalink href=#CDROM_Install>CDROM Install</a></h2><code class=Nm>picobsd</code> can produce an ISO image named picobsd.iso, which does not use “El Torito” emulation, so it has no size restrictions. Installing means just burning a media with the file. </section><section class=Ss><h2 class=Ss id=Booting_From_The_Network><a class=permalink href=#Booting_From_The_Network>Booting From The Network</a></h2> Yet another way to use <code class=Nm>picobsd</code> is to boot the image off the network. For this purpose you should use the uncompressed kernel which is available as a byproduct of the compilation. Refer to the documentation for network booting for more details, the <code class=Nm>picobsd</code> kernel is bootable as a standard <span class=Ux>FreeBSD</span> kernel. </section></section><section class=Sh><h2 class=Sh id=BOOTING_PicoBSD><a class=permalink href=#BOOTING_PicoBSD>BOOTING PicoBSD</a></h2> To boot <code class=Nm>picobsd</code>, insert the floppy and reset the machine. The boot procedure is similar to the standard <span class=Ux>FreeBSD</span> boot. Booting from a floppy is normally rather slow (in the order of 1-2 minutes), things are much faster if you store your image on a hard disk, Compact Flash, or CDROM. <p class=Pp>You can also use etherboot to load the preloaded, uncompressed kernel image which is a byproduct of the <code class=Nm>picobsd</code> build. In this case the load time is a matter of a few seconds, even on a 10Mbit/s ethernet.</p><p class=Pp>After booting, <code class=Nm>picobsd</code> loads the root file system from the memory file system, starts <span class=Pa>/sbin/init</span>, and passes control to a first startup script, <span class=Pa>/etc/rc</span>. The latter populates the <span class=Pa>/etc</span> and <span class=Pa>/root</span> directories with the default files, then tries to identify the boot device (floppy, hard disk partition) and possibly override the contents of the root file system with files read from the boot device. This allows you to store local configuration on the same media. After this phase the boot device is no longer used, unless the user specifically does it.</p><p class=Pp>After this, control is transferred to a second script, <span class=Pa>/etc/rc1</span> (which can be overridden from the boot device). This script tries to associate a hostname to the system by using the MAC address of the first ethernet interface as a key, and <span class=Pa>/etc/hosts</span> as a lookup table. Then control is passed to the main user configuration script, <span class=Pa>/etc/rc.conf</span>, which is supposed to override the value of a number of configuration variables which have been pre-set in <span class=Pa>/etc/rc.conf.defaults</span>. You can use the <var class=Va>hostname</var> variable to create different configurations from the same file. After taking control back, <span class=Pa>/etc/rc1</span> completes the initializations, and as part of this it configures network interfaces and optionally calls the firewall configuration script, <span class=Pa>/etc/rc.firewall</span>, where the user can store his own firewall configuration.</p><p class=Pp>Note that by default <code class=Nm>picobsd</code> runs entirely from main memory, and has no swap space, unless you explicitly request it. The boot device is also not used anymore after <span class=Pa>/etc/rc1</span> takes control, again, unless you explicitly request it.</p></section><section class=Sh><h2 class=Sh id=CONFIGURING_a_PicoBSD_system><a class=permalink href=#CONFIGURING_a_PicoBSD_system>CONFIGURING a PicoBSD system</a></h2> The operation of a <code class=Nm>picobsd</code> system can be configured through a few files which are read at boot time, very much like a standard <span class=Ux>FreeBSD</span> system. There are, however, some minor differences to reduce the number of files to store and/or customize, thus saving space. Among the files to configure we have the following: <dl class=Bl-tag><dt><span class=Pa>/etc/hosts</span></dt><dd>Traditionally, this file contains the IP-to-hostname mappings. In addition to this, the <code class=Nm>picobsd</code> version of this file also contains a mapping between Ethernet (MAC) addresses and hostnames, as follows: <div class="Bd Pp Bd-indent"><pre>
#ethertable     start of the ethernet-&gt;hostname mapping
# mac_address           hostname
# 00:12:34:56:78:9a     pinco
# 12:34:56:*            pallino
# *                     this-matches-all
    </pre></div><p class=Pp>where the line containing “<code class=Li>#ethertable</code>” marks the start of the table.</p><p class=Pp>If the MAC address is not found, the script will prompt you to enter a hostname and IP address for the system, and this information will be stored in the <span class=Pa>/etc/hosts</span> file (in memory) so you can simply store them on disk later.</p><p class=Pp>Note that you can use wildcards in the address part, so a line like the last one in the example will match any MAC address and avoid the request.</p></dd><dt><span class=Pa>/etc/rc.conf</span></dt><dd>This file contains a number of variables which control the operation of the system, such as interface configuration, router setup, network service startup, etc. For the exact list and meaning of these variables see <span class=Pa>/etc/rc.conf.defaults</span>. <p class=Pp>It is worth mentioning that some of the variables let you overwrite the contents of some files in <span class=Pa>/etc</span>. This option is available at the moment for <span class=Pa>/etc/host.conf</span> and <span class=Pa>/etc/resolv.conf</span>, whose contents are generally very short and suitable for this type of updating. In case you use these variables, remember to use newlines as appropriate, e.g.</p><div class="Bd Pp Bd-indent"><pre>
host_conf="# this goes into /etc/host.conf
hosts
bind"
    </pre></div><p class=Pp>Although not mandatory, in this file you should only set the variables indicated in <span class=Pa>/etc/rc.conf.defaults</span>, and avoid starting services which depend on having the network running. This can be done at a later time: if you set <var class=Va>firewall_enable</var>=“<code class=Li>YES</code>”, the <span class=Pa>/etc/rc.firewall</span> script will be run after configuring the network interfaces, so you can set up your firewall and safely start network services or enable things such as routing and bridging.</p></dd><dt><span class=Pa>/etc/rc.firewall</span></dt><dd>This script can be used to configure the <a class=Xr href=ipfw.4.html>ipfw(4)</a> firewall. On entry, the <var class=Va>fwcmd</var> variable is set to the pathname of the firewall command, <var class=Va>firewall_type</var> contains the value set in <span class=Pa>/etc/rc.conf</span>, and <var class=Va>hostname</var> contains the name assigned to the host.</dd></dl><p class=Pp>There is a small script called <code class=Nm>update</code> which can be used to edit and/or save to disk a copy of the files you have modified after booting. The script takes one or more absolute pathnames, runs the editor on the files passed as arguments, and then saves a compressed copy of the files on the disk (mounting and unmounting the latter around the operation).</p><p class=Pp>If invoked without arguments, <code class=Nm>update</code> edits and saves <span class=Pa>rc.conf</span>, <span class=Pa>rc.firewall</span>, and <span class=Pa>master.passwd</span>.</p><p class=Pp>If one of the arguments is <span class=Pa>/etc</span> (the directory name alone), then the command saves to disk (without editing) all the files in the directory for which a copy already exists on disk (e.g. as a result of a previous update).</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=crunchgen.1.html>crunchgen(1)</a>, <a class=Xr href=mdconfig.8.html>mdconfig(8)</a>, <a class=Xr href=nanobsd.8.html>nanobsd(8)</a>, <a class=Xr href=swapon.8.html>swapon(8)</a></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Andrzej Bialecki</span> &lt;<a class=Mt href=mailto:abial@FreeBSD.org>abial@FreeBSD.org</a>&gt;, with subsequent work on the scripts by <span class=An>Luigi Rizzo</span> &lt;<a class=Mt href=mailto:luigi@iet.unipi.it>luigi@iet.unipi.it</a>&gt; and others. Man page and <span class=Pa>Makefiles</span> created by <span class=An>Greg Lehey</span> &lt;<a class=Mt href=mailto:grog@lemis.com>grog@lemis.com</a>&gt;. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Documentation is still incomplete. </section></div><table class=foot><tr><td class=foot-date>October 20, 2019</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>