<!DOCTYPE html>
<html><head><meta charset=utf-8><title>devstat(9)</title><keywords content=man,devstat></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>devstat(9)</h1><table class=head><tr><td class=head-ltitle>DEVSTAT(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>DEVSTAT(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>devstat</code>, <code class=Nm>devstat_end_transaction</code>, <code class=Nm>devstat_end_transaction_bio</code>, <code class=Nm>devstat_end_transaction_bio_bt</code>, <code class=Nm>devstat_new_entry</code>, <code class=Nm>devstat_remove_entry</code>, <code class=Nm>devstat_start_transaction</code>, <code class=Nm>devstat_start_transaction_bio</code> — <div class=Nd>kernel interface for keeping device statistics</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/devicestat.h.html>sys/devicestat.h</a>&gt;</code><p class=Pp><var class=Ft>struct devstat *</var><br><code class=Fn>devstat_new_entry</code>(<var class=Fa>const void *dev_name</var>, <var class=Fa>int unit_number</var>, <var class=Fa>uint32_t block_size</var>, <var class=Fa>devstat_support_flags flags</var>, <var class=Fa>devstat_type_flags device_type</var>, <var class=Fa>devstat_priority priority</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_remove_entry</code>(<var class=Fa style="white-space: nowrap;">struct devstat *ds</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_start_transaction</code>(<var class=Fa>struct devstat *ds</var>, <var class=Fa>const struct bintime *now</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_start_transaction_bio</code>(<var class=Fa>struct devstat *ds</var>, <var class=Fa>struct bio *bp</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_end_transaction</code>(<var class=Fa>struct devstat *ds</var>, <var class=Fa>uint32_t bytes</var>, <var class=Fa>devstat_tag_type tag_type</var>, <var class=Fa>devstat_trans_flags flags</var>, <var class=Fa>const struct bintime *now</var>, <var class=Fa>const struct bintime *then</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_end_transaction_bio</code>(<var class=Fa>struct devstat *ds</var>, <var class=Fa>const struct bio *bp</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>devstat_end_transaction_bio_bt</code>(<var class=Fa>struct devstat *ds</var>, <var class=Fa>const struct bio *bp</var>, <var class=Fa>const struct bintime *now</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The devstat subsystem is an interface for recording device statistics, as its name implies. The idea is to keep reasonably detailed statistics while utilizing a minimum amount of CPU time to record them. Thus, no statistical calculations are actually performed in the kernel portion of the <code class=Nm>devstat</code> code. Instead, that is left for user programs to handle. <p class=Pp>The historical and antiquated <code class=Nm>devstat</code> model assumed a single active IO operation per device, which is not accurate for most disk-like drivers in the 2000s and beyond. New consumers of the interface should almost certainly use only the "bio" variants of the start and end transacation routines.</p><p class=Pp><code class=Fn>devstat_new_entry</code>() allocates and initializes <var class=Va>devstat</var> structure and returns a pointer to it. <code class=Fn>devstat_new_entry</code>() takes several arguments:</p><dl class=Bl-tag><dt>dev_name</dt><dd>The device name, e.g., da, cd, sa.</dd><dt>unit_number</dt><dd>Device unit number.</dd><dt>block_size</dt><dd>Block size of the device, if supported. If the device does not support a block size, or if the blocksize is unknown at the time the device is added to the <code class=Nm>devstat</code> list, it should be set to 0.</dd><dt>flags</dt><dd>Flags indicating operations supported or not supported by the device. See below for details.</dd><dt>device_type</dt><dd>The device type. This is broken into three sections: base device type (e.g., direct access, CDROM, sequential access), interface type (IDE, SCSI or other) and a pass-through flag to indicate pas-through devices. See below for a complete list of types.</dd><dt>priority</dt><dd>The device priority. The priority is used to determine how devices are sorted within <code class=Nm>devstat</code>'s list of devices. Devices are sorted first by priority (highest to lowest), and then by attach order. See below for a complete list of available priorities.</dd></dl><p class=Pp><code class=Fn>devstat_remove_entry</code>() removes a device from the <code class=Nm>devstat</code> subsystem. It takes the devstat structure for the device in question as an argument. The <code class=Nm>devstat</code> generation number is incremented and the number of devices is decremented.</p><p class=Pp><code class=Fn>devstat_start_transaction</code>() registers the start of a transaction with the <code class=Nm>devstat</code> subsystem. Optionally, if the caller already has a <code class=Fn>binuptime</code>() value available, it may be passed in <var class=Fa>*now</var>. Usually the caller can just pass <code class=Dv>NULL</code> for <var class=Fa>now</var>, and the routine will gather the current <code class=Fn>binuptime</code>() itself. The busy count is incremented with each transaction start. When a device goes from idle to busy, the system uptime is recorded in the <var class=Va>busy_from</var> field of the <var class=Va>devstat</var> structure.</p><p class=Pp><code class=Fn>devstat_start_transaction_bio</code>() records the <code class=Fn>binuptime</code>() in the provided bio's <var class=Fa>bio_t0</var> and then invokes <code class=Fn>devstat_start_transaction</code>().</p><p class=Pp><code class=Fn>devstat_end_transaction</code>() registers the end of a transaction with the <code class=Nm>devstat</code> subsystem. It takes six arguments:</p><dl class=Bl-tag><dt>ds</dt><dd>The <var class=Va>devstat</var> structure for the device in question.</dd><dt>bytes</dt><dd>The number of bytes transferred in this transaction.</dd><dt>tag_type</dt><dd>Transaction tag type. See below for tag types.</dd><dt>flags</dt><dd>Transaction flags indicating whether the transaction was a read, write, or whether no data was transferred.</dd><dt>now</dt><dd>The <code class=Fn>binuptime</code>() at the end of the transaction, or <code class=Dv>NULL</code>.</dd><dt>then</dt><dd>The <code class=Fn>binuptime</code>() at the beginning of the transaction, or <code class=Dv>NULL</code>.</dd></dl><p class=Pp>If <var class=Fa>now</var> is <code class=Dv>NULL</code>, it collects the current time from <code class=Fn>binuptime</code>(). If <var class=Fa>then</var> is <code class=Dv>NULL</code>, the operation is not tracked in the <var class=Va>devstat</var><var class=Fa>duration</var> table.</p><p class=Pp><code class=Fn>devstat_end_transaction_bio</code>() is a thin wrapper for <code class=Fn>devstat_end_transaction_bio_bt</code>() with a <code class=Dv>NULL</code><var class=Fa>now</var> parameter.</p><p class=Pp><code class=Fn>devstat_end_transaction_bio_bt</code>() is a wrapper for <code class=Fn>devstat_end_transaction</code>() which pulls all needed information from a <var class=Va>struct bio</var> prepared by <code class=Fn>devstat_start_transaction_bio</code>(). The bio must be ready for <code class=Fn>biodone</code>() (i.e., <var class=Fa>bio_bcount</var> and <var class=Fa>bio_resid</var> must be correctly initialized).</p><p class=Pp>The <var class=Va>devstat</var> structure is composed of the following fields:</p><dl class=Bl-tag><dt>sequence0,</dt><dd style="width: auto;"> </dd><dt>sequence1</dt><dd>An implementation detail used to gather consistent snapshots of device statistics.</dd><dt>start_count</dt><dd>Number of operations started.</dd><dt>end_count</dt><dd>Number of operations completed. The “busy_count” can be calculated by subtracting <var class=Fa>end_count</var> from <var class=Fa>start_count</var>. (<var class=Fa>sequence0</var> and <var class=Fa>sequence1</var> are used to get a consistent snapshot.) This is the current number of outstanding transactions for the device. This should never go below zero, and on an idle device it should be zero. If either one of these conditions is not true, it indicates a problem. <p class=Pp>There should be one and only one transaction start event and one transaction end event for each transaction.</p></dd><dt>dev_links</dt><dd>Each <var class=Va>devstat</var> structure is placed in a linked list when it is registered. The <var class=Va>dev_links</var> field contains a pointer to the next entry in the list of <var class=Va>devstat</var> structures.</dd><dt>device_number</dt><dd>The device number is a unique identifier for each device. The device number is incremented for each new device that is registered. The device number is currently only a 32-bit integer, but it could be enlarged if someone has a system with more than four billion device arrival events.</dd><dt>device_name</dt><dd>The device name is a text string given by the registering driver to identify itself. (e.g., “da”, “cd”, “sa”, etc.)</dd><dt>unit_number</dt><dd>The unit number identifies the particular instance of the peripheral driver in question.</dd><dt>bytes[4]</dt><dd>This array contains the number of bytes that have been read (index <code class=Dv>DEVSTAT_READ</code>), written (index <code class=Dv>DEVSTAT_WRITE</code>), freed or erased (index <code class=Dv>DEVSTAT_FREE</code>), or other (index <code class=Dv>DEVSTAT_NO_DATA</code>). All values are unsigned 64-bit integers.</dd><dt>operations[4]</dt><dd>This array contains the number of operations of a given type that have been performed. The indices are identical to those for <var class=Fa>bytes</var> above. <code class=Dv>DEVSTAT_NO_DATA</code> or "other" represents the number of transactions to the device which are neither reads, writes, nor frees. For instance, SCSI drivers often send a test unit ready command to SCSI devices. The test unit ready command does not read or write any data. It merely causes the device to return its status.</dd><dt>duration[4]</dt><dd>This array contains the total bintime corresponding to completed operations of a given type. The indices are identical to those for <var class=Fa>bytes</var> above. (Operations that complete using the historical <code class=Fn>devstat_end_transaction</code>() API and do not provide a non-NULL <var class=Fa>then</var> are not accounted for.)</dd><dt>busy_time</dt><dd>This is the amount of time that the device busy count has been greater than zero. This is only updated when the busy count returns to zero.</dd><dt>creation_time</dt><dd>This is the time, as reported by <code class=Fn>getmicrotime</code>() that the device was registered.</dd><dt>block_size</dt><dd>This is the block size of the device, if the device has a block size.</dd><dt>tag_types</dt><dd>This is an array of counters to record the number of various tag types that are sent to a device. See below for a list of tag types.</dd><dt>busy_from</dt><dd>If the device is not busy, this was the time that a transaction last completed. If the device is busy, this the most recent of either the time that the device became busy, or the time that the last transaction completed.</dd><dt>flags</dt><dd>These flags indicate which statistics measurements are supported by a particular device. These flags are primarily intended to serve as an aid to userland programs that decipher the statistics.</dd><dt>device_type</dt><dd>This is the device type. It consists of three parts: the device type (e.g., direct access, CDROM, sequential access, etc.), the interface (IDE, SCSI or other) and whether or not the device in question is a pass-through driver. See below for a complete list of device types.</dd><dt>priority</dt><dd>This is the priority. This is the first parameter used to determine where to insert a device in the <code class=Nm>devstat</code> list. The second parameter is attach order. See below for a list of available priorities.</dd><dt>id</dt><dd>Identification for GEOM nodes.</dd></dl><p class=Pp>Each device is given a device type. Pass-through devices have the same underlying device type and interface as the device they provide an interface for, but they also have the pass-through flag set. The base device types are identical to the SCSI device type numbers, so with SCSI peripherals, the device type returned from an inquiry is usually ORed with the SCSI interface type and the pass-through flag if appropriate. The device type flags are as follows:</p><div class="Bd Pp Bd-indent"><pre>
typedef enum {
	DEVSTAT_TYPE_DIRECT	= 0x000,
	DEVSTAT_TYPE_SEQUENTIAL	= 0x001,
	DEVSTAT_TYPE_PRINTER	= 0x002,
	DEVSTAT_TYPE_PROCESSOR	= 0x003,
	DEVSTAT_TYPE_WORM	= 0x004,
	DEVSTAT_TYPE_CDROM	= 0x005,
	DEVSTAT_TYPE_SCANNER	= 0x006,
	DEVSTAT_TYPE_OPTICAL	= 0x007,
	DEVSTAT_TYPE_CHANGER	= 0x008,
	DEVSTAT_TYPE_COMM	= 0x009,
	DEVSTAT_TYPE_ASC0	= 0x00a,
	DEVSTAT_TYPE_ASC1	= 0x00b,
	DEVSTAT_TYPE_STORARRAY	= 0x00c,
	DEVSTAT_TYPE_ENCLOSURE	= 0x00d,
	DEVSTAT_TYPE_FLOPPY	= 0x00e,
	DEVSTAT_TYPE_MASK	= 0x00f,
	DEVSTAT_TYPE_IF_SCSI	= 0x010,
	DEVSTAT_TYPE_IF_IDE	= 0x020,
	DEVSTAT_TYPE_IF_OTHER	= 0x030,
	DEVSTAT_TYPE_IF_MASK	= 0x0f0,
	DEVSTAT_TYPE_PASS	= 0x100
} devstat_type_flags;
</pre></div><p class=Pp>Devices have a priority associated with them, which controls roughly where they are placed in the <code class=Nm>devstat</code> list. The priorities are as follows:</p><div class="Bd Pp Bd-indent"><pre>
typedef enum {
	DEVSTAT_PRIORITY_MIN	= 0x000,
	DEVSTAT_PRIORITY_OTHER	= 0x020,
	DEVSTAT_PRIORITY_PASS	= 0x030,
	DEVSTAT_PRIORITY_FD	= 0x040,
	DEVSTAT_PRIORITY_WFD	= 0x050,
	DEVSTAT_PRIORITY_TAPE	= 0x060,
	DEVSTAT_PRIORITY_CD	= 0x090,
	DEVSTAT_PRIORITY_DISK	= 0x110,
	DEVSTAT_PRIORITY_ARRAY	= 0x120,
	DEVSTAT_PRIORITY_MAX	= 0xfff
} devstat_priority;
</pre></div><p class=Pp>Each device has associated with it flags to indicate what operations are supported or not supported. The <var class=Va>devstat_support_flags</var> values are as follows:</p><dl class=Bl-tag><dt>DEVSTAT_ALL_SUPPORTED</dt><dd>Every statistic type is supported by the device.</dd><dt>DEVSTAT_NO_BLOCKSIZE</dt><dd>This device does not have a blocksize.</dd><dt>DEVSTAT_NO_ORDERED_TAGS</dt><dd>This device does not support ordered tags.</dd><dt>DEVSTAT_BS_UNAVAILABLE</dt><dd>This device supports a blocksize, but it is currently unavailable. This flag is most often used with removable media drives.</dd></dl><p class=Pp>Transactions to a device fall into one of three categories, which are represented in the <var class=Va>flags</var> passed into <code class=Fn>devstat_end_transaction</code>(). The transaction types are as follows:</p><div class="Bd Pp Bd-indent"><pre>
typedef enum {
	DEVSTAT_NO_DATA	= 0x00,
	DEVSTAT_READ	= 0x01,
	DEVSTAT_WRITE	= 0x02,
	DEVSTAT_FREE	= 0x03
} devstat_trans_flags;
#define DEVSTAT_N_TRANS_FLAGS   4
</pre></div><p class=Pp>DEVSTAT_NO_DATA is a type of transactions to the device which are neither reads or writes. For instance, SCSI drivers often send a test unit ready command to SCSI devices. The test unit ready command does not read or write any data. It merely causes the device to return its status.</p><p class=Pp>There are four possible values for the <var class=Va>tag_type</var> argument to <code class=Fn>devstat_end_transaction</code>():</p><dl class=Bl-tag><dt>DEVSTAT_TAG_SIMPLE</dt><dd>The transaction had a simple tag.</dd><dt>DEVSTAT_TAG_HEAD</dt><dd>The transaction had a head of queue tag.</dd><dt>DEVSTAT_TAG_ORDERED</dt><dd>The transaction had an ordered tag.</dd><dt>DEVSTAT_TAG_NONE</dt><dd>The device does not support tags.</dd></dl><p class=Pp>The tag type values correspond to the lower four bits of the SCSI tag definitions. In CAM, for instance, the <var class=Va>tag_action</var> from the CCB is ORed with 0xf to determine the tag type to pass in to <code class=Fn>devstat_end_transaction</code>().</p><p class=Pp>There is a macro, <code class=Dv>DEVSTAT_VERSION</code> that is defined in <code class=In>&lt;<a class=In href=../src/sys/devicestat.h.html>sys/devicestat.h</a>&gt;</code>. This is the current version of the <code class=Nm>devstat</code> subsystem, and it should be incremented each time a change is made that would require recompilation of userland programs that access <code class=Nm>devstat</code> statistics. Userland programs use this version, via the <var class=Va>kern.devstat.version</var><code class=Nm>sysctl</code> variable to determine whether they are in sync with the kernel <code class=Nm>devstat</code> structures.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=systat.1.html>systat(1)</a>, <a class=Xr href=devstat.3.html>devstat(3)</a>, <a class=Xr href=iostat.8.html>iostat(8)</a>, <a class=Xr href=rpc.rstatd.8.html>rpc.rstatd(8)</a>, <a class=Xr href=vmstat.8.html>vmstat(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>devstat</code> statistics system appeared in <span class=Ux>FreeBSD 3.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Kenneth Merry</span> &lt;<a class=Mt href=mailto:ken@FreeBSD.org>ken@FreeBSD.org</a>&gt; </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> There may be a need for <code class=Fn>spl</code>() protection around some of the <code class=Nm>devstat</code> list manipulation code to ensure, for example, that the list of devices is not changed while someone is fetching the <var class=Va>kern.devstat.all</var><code class=Nm>sysctl</code> variable. </section></div><table class=foot><tr><td class=foot-date>July 15, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>