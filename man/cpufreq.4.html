<!DOCTYPE html>
<html><head><meta charset=utf-8><title>cpufreq(4)</title><keywords content=man,cpufreq></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>cpufreq(4)</h1><table class=head><tr><td class=head-ltitle>CPUFREQ(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>CPUFREQ(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>cpufreq</code> — <div class=Nd>CPU frequency control framework</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=Cd>device cpufreq</code><p class=Pp><br><code class=In>#include &lt;<a class=In href=../src/sys/cpu.h.html>sys/cpu.h</a>&gt;</code></p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_levels</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">struct cf_level *levels</var>, <var class=Fa style="white-space: nowrap;">int *count</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_set</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">const struct cf_level *level</var>, <var class=Fa style="white-space: nowrap;">int priority</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_get</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">struct cf_level *level</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_drv_settings</code>(<var class=Fa>device_t dev</var>, <var class=Fa>struct cf_setting *sets</var>, <var class=Fa>int *count</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_drv_type</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">int *type</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_drv_set</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">const struct cf_setting *set</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>cpufreq_drv_get</code>(<var class=Fa style="white-space: nowrap;">device_t dev</var>, <var class=Fa style="white-space: nowrap;">struct cf_setting *set</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>cpufreq</code> driver provides a unified kernel and user interface to CPU frequency control drivers. It combines multiple drivers offering different settings into a single interface of all possible levels. Users can access this interface directly via <a class=Xr href=sysctl.8.html>sysctl(8)</a> or by indicating to <span class=Pa>/etc/rc.d/power_profile</span> that it should switch settings when the AC line state changes via <a class=Xr href=rc.conf.5.html>rc.conf(5)</a>. </section><section class=Sh><h2 class=Sh id=SYSCTL_VARIABLES><a class=permalink href=#SYSCTL_VARIABLES>SYSCTL VARIABLES</a></h2> These settings may be overridden by kernel drivers requesting alternate settings. If this occurs, the original values will be restored once the condition has passed (e.g., the system has cooled sufficiently). If a sysctl cannot be set due to an override condition, it will return <code class=Er>EPERM</code>. <p class=Pp>The frequency cannot be changed if TSC is in use as the timecounter and the hardware does not support invariant TSC. This is because the timecounter system needs to use a source that has a constant rate. (On invariant TSC hardware, the TSC runs at the P0 rate regardless of the configured P-state.) Modern hardware mostly has invariant TSC. The timecounter source can be changed with the <span class=Pa>kern.timecounter.hardware</span> sysctl. Available modes are in <span class=Pa>kern.timecounter.choice</span> sysctl entry.</p><dl class=Bl-tag><dt><var class=Va>dev.cpu.%d.freq</var></dt><dd>Current active CPU frequency in MHz.</dd><dt><var class=Va>dev.cpu.%d.freq_driver</var></dt><dd>The specific <code class=Nm>cpufreq</code> driver used by this cpu.</dd><dt><var class=Va>dev.cpu.%d.freq_levels</var></dt><dd>Currently available levels for the CPU (frequency/power usage). Values are in units of MHz and milliwatts.</dd><dt><var class=Va>dev.DEVICE.%d.freq_settings</var></dt><dd>Currently available settings for the driver (frequency/power usage). Values are in units of MHz and milliwatts. This is helpful for understanding which settings are offered by which driver for debugging purposes.</dd><dt><var class=Va>debug.cpufreq.lowest</var></dt><dd>Lowest CPU frequency in MHz to offer to users. This setting is also accessible via a tunable with the same name. This can be used to disable very low levels that may be unusable on some systems.</dd><dt><var class=Va>debug.cpufreq.verbose</var></dt><dd>Print verbose messages. This setting is also accessible via a tunable with the same name.</dd><dt><var class=Va>debug.hwpstate_pstate_limit</var></dt><dd>If enabled, the AMD hwpstate driver limits administrative control of P-states (including by <a class=Xr href=powerd.8.html>powerd(8)</a>) to the value in the 0xc0010061 MSR, known as "PStateCurLim[CurPstateLimit]." It is disabled (0) by default. On some hardware, the limit register seems to simply follow the configured P-state, which results in the inability to ever raise the P-state back to P0 from a reduced frequency state.</dd></dl></section><section class=Sh><h2 class=Sh id=SUPPORTED_DRIVERS><a class=permalink href=#SUPPORTED_DRIVERS>SUPPORTED DRIVERS</a></h2> The following device drivers offer absolute frequency control via the <code class=Nm>cpufreq</code> interface. Usually, only one of these can be active at a time. <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt>acpi_perf</dt><dd>ACPI CPU performance states</dd><dt><a class=Xr href=est.4.html>est(4)</a></dt><dd>Intel Enhanced SpeedStep</dd><dt>hwpstate</dt><dd>AMD Cool'n'Quiet2 used in K10 through Family 17h</dd><dt><a class=Xr href=hwpstate_intel.4.html>hwpstate_intel(4)</a></dt><dd>Intel SpeedShift driver</dd><dt>ichss</dt><dd>Intel SpeedStep for ICH</dd><dt>powernow</dt><dd>AMD PowerNow! and Cool'n'Quiet for K7 and K8</dd><dt>smist</dt><dd>Intel SMI-based SpeedStep for PIIX4</dd></dl><p class=Pp>The following device drivers offer relative frequency control and have an additive effect:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt>acpi_throttle</dt><dd>ACPI CPU throttling</dd><dt>p4tcc</dt><dd>Pentium 4 Thermal Control Circuitry</dd></dl></section><section class=Sh><h2 class=Sh id=KERNEL_INTERFACE><a class=permalink href=#KERNEL_INTERFACE>KERNEL INTERFACE</a></h2> Kernel components can query and set CPU frequencies through the <code class=Nm>cpufreq</code> kernel interface. This involves obtaining a <code class=Nm>cpufreq</code> device, calling <code class=Fn>cpufreq_levels</code>() to get the currently available frequency levels, checking the current level with <code class=Fn>cpufreq_get</code>(), and setting a new one from the list with <code class=Fn>cpufreq_set</code>(). Each level may actually reference more than one <code class=Nm>cpufreq</code> driver but kernel components do not need to be aware of this. The <var class=Va>total_set</var> element of <var class=Vt>struct cf_level</var> provides a summary of the frequency and power for this level. Unknown or irrelevant values are set to <code class=Dv>CPUFREQ_VAL_UNKNOWN</code>. <p class=Pp>The <code class=Fn>cpufreq_levels</code>() method takes a <code class=Nm>cpufreq</code> device and an empty array of <var class=Fa>levels</var>. The <var class=Fa>count</var> value should be set to the number of levels available and after the function completes, will be set to the actual number of levels returned. If there are more levels than <var class=Fa>count</var> will allow, it should return <code class=Er>E2BIG</code>.</p><p class=Pp>The <code class=Fn>cpufreq_get</code>() method takes a pointer to space to store a <var class=Fa>level</var>. After successful completion, the output will be the current active level and is equal to one of the levels returned by <code class=Fn>cpufreq_levels</code>().</p><p class=Pp>The <code class=Fn>cpufreq_set</code>() method takes a pointer a <var class=Fa>level</var> and attempts to activate it. The <var class=Fa>priority</var> (i.e., <code class=Dv>CPUFREQ_PRIO_KERN</code>) tells <code class=Nm>cpufreq</code> whether to override previous settings while activating this level. If <var class=Fa>priority</var> is higher than the current active level, that level will be saved and overridden with the new level. If a level is already saved, the new level is set without overwriting the older saved level. If <code class=Fn>cpufreq_set</code>() is called with a <code class=Dv>NULL</code><var class=Fa>level</var>, the saved level will be restored. If there is no saved level, <code class=Fn>cpufreq_set</code>() will return <code class=Er>ENXIO</code>. If <var class=Fa>priority</var> is lower than the current active level's priority, this method returns <code class=Er>EPERM</code>.</p></section><section class=Sh><h2 class=Sh id=DRIVER_INTERFACE><a class=permalink href=#DRIVER_INTERFACE>DRIVER INTERFACE</a></h2> Kernel drivers offering hardware-specific CPU frequency control export their individual settings through the <code class=Nm>cpufreq</code> driver interface. This involves implementing these methods: <code class=Fn>cpufreq_drv_settings</code>(), <code class=Fn>cpufreq_drv_type</code>(), <code class=Fn>cpufreq_drv_set</code>(), and <code class=Fn>cpufreq_drv_get</code>(). Additionally, the driver must attach a device as a child of a CPU device so that these methods can be called by the <code class=Nm>cpufreq</code> framework. <p class=Pp>The <code class=Fn>cpufreq_drv_settings</code>() method returns an array of currently available settings, each of type <var class=Vt>struct cf_setting</var>. The driver should set unknown or irrelevant values to <code class=Dv>CPUFREQ_VAL_UNKNOWN</code>. All the following elements for each setting should be returned:</p><div class="Bd Pp"><pre>
struct cf_setting {
	int	freq;	/* CPU clock in MHz or 100ths of a percent. */
	int	volts;	/* Voltage in mV. */
	int	power;	/* Power consumed in mW. */
	int	lat;	/* Transition latency in us. */
	device_t dev;	/* Driver providing this setting. */
};
</pre></div><p class=Pp>On entry to this method, <var class=Fa>count</var> contains the number of settings that can be returned. On successful completion, the driver sets it to the actual number of settings returned. If the driver offers more settings than <var class=Fa>count</var> will allow, it should return <code class=Er>E2BIG</code>.</p><p class=Pp>The <code class=Fn>cpufreq_drv_type</code>() method indicates the type of settings it offers, either <code class=Dv>CPUFREQ_TYPE_ABSOLUTE</code> or <code class=Dv>CPUFREQ_TYPE_RELATIVE</code>. Additionally, the driver may set the <code class=Dv>CPUFREQ_FLAG_INFO_ONLY</code> flag if the settings it provides are information for other drivers only and cannot be passed to <code class=Fn>cpufreq_drv_set</code>() to activate them.</p><p class=Pp>The <code class=Fn>cpufreq_drv_set</code>() method takes a driver setting and makes it active. If the setting is invalid or not currently available, it should return <code class=Er>EINVAL</code>.</p><p class=Pp>The <code class=Fn>cpufreq_drv_get</code>() method returns the currently-active driver setting. The <var class=Vt>struct cf_setting</var> returned must be valid for passing to <code class=Fn>cpufreq_drv_set</code>(), including all elements being filled out correctly. If the driver cannot infer the current setting (even by estimating it with <code class=Fn>cpu_est_clockrate</code>()) then it should set all elements to <code class=Dv>CPUFREQ_VAL_UNKNOWN</code>.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=acpi.4.html>acpi(4)</a>, <a class=Xr href=est.4.html>est(4)</a>, <a class=Xr href=timecounters.4.html>timecounters(4)</a>, <a class=Xr href=powerd.8.html>powerd(8)</a>, <a class=Xr href=sysctl.8.html>sysctl(8)</a></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Nate Lawson</span><br><span class=An>Bruno Ducrot</span> contributed the <span class=Pa>powernow</span> driver. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> The following drivers have not yet been converted to the <code class=Nm>cpufreq</code> interface: <a class=Xr href=longrun.4.html>longrun(4)</a>. <p class=Pp>Notification of CPU and bus frequency changes is not implemented yet.</p><p class=Pp>When multiple CPUs offer frequency control, they cannot be set to different levels and must all offer the same frequency settings.</p></section></div><table class=foot><tr><td class=foot-date>April 4, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>