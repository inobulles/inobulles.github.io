<!DOCTYPE html>
<html><head><meta charset=utf-8><title>setkey(8)</title><keywords content=man,setkey></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>setkey(8)</h1><table class=head><tr><td class=head-ltitle>SETKEY(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>SETKEY(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>setkey</code> — <div class=Nd>manually manipulate the IPsec SA/SP database</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>setkey</code></td><td>[<code class=Fl>-v</code>] <code class=Fl>-c</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>setkey</code></td><td>[<code class=Fl>-v</code>] <code class=Fl>-f</code><var class=Ar>filename</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>setkey</code></td><td>[<code class=Fl>-Pgltv</code>] <code class=Fl>-D</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>setkey</code></td><td>[<code class=Fl>-Pv</code>] <code class=Fl>-F</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>setkey</code></td><td>[<code class=Fl>-h</code>] <code class=Fl>-x</code></td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>setkey</code> utility adds, updates, dumps, or flushes Security Association Database (SAD) entries as well as Security Policy Database (SPD) entries in the kernel. <p class=Pp>The <code class=Nm>setkey</code> utility takes a series of operations from the standard input (if invoked with <code class=Fl>-c</code>) or the file named <var class=Ar>filename</var> (if invoked with <code class=Fl>-f</code><var class=Ar>filename</var>).</p><dl class=Bl-tag><dt><a class=permalink href=#D><code class=Fl id=D>-D</code></a></dt><dd>Dump the SAD entries. If with <code class=Fl>-P</code>, the SPD entries are dumped.</dd><dt><a class=permalink href=#F><code class=Fl id=F>-F</code></a></dt><dd>Flush the SAD entries. If with <code class=Fl>-P</code>, the SPD entries are flushed.</dd><dt><a class=permalink href=#g><code class=Fl id=g>-g</code></a></dt><dd>Only SPD entries with global scope are dumped with <code class=Fl>-D</code> and <code class=Fl>-P</code> flags.</dd><dt><a class=permalink href=#t><code class=Fl id=t>-t</code></a></dt><dd>Only SPD entries with ifnet scope are dumped with <code class=Fl>-D</code> and <code class=Fl>-P</code> flags. Such SPD entries are linked to the corresponding <a class=Xr href=if_ipsec.4.html>if_ipsec(4)</a> virtual tunneling interface.</dd><dt><a class=permalink href=#h><code class=Fl id=h>-h</code></a></dt><dd>Add hexadecimal dump on <code class=Fl>-x</code> mode.</dd><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a></dt><dd>Loop forever with short output on <code class=Fl>-D</code>.</dd><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Be verbose. The program will dump messages exchanged on <code class=Dv>PF_KEY</code> socket, including messages sent from other processes to the kernel.</dd><dt><a class=permalink href=#x><code class=Fl id=x>-x</code></a></dt><dd>Loop forever and dump all the messages transmitted to <code class=Dv>PF_KEY</code> socket. <code class=Fl>-xx</code> makes each timestamp unformatted.</dd></dl><section class=Ss><h2 class=Ss id=Configuration_syntax><a class=permalink href=#Configuration_syntax>Configuration syntax</a></h2> With <code class=Fl>-c</code> or <code class=Fl>-f</code> on the command line, <code class=Nm>setkey</code> accepts the following configuration syntax. Lines starting with hash signs (‘<code class=Li>#</code>’) are treated as comment lines. <dl class=Bl-tag><dt><a class=permalink href=#add><code class=Li id=add>add</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src</var><var class=Ar>dst</var><var class=Ar>protocol</var><var class=Ar>spi</var> [<var class=Ar>extensions</var>] <var class=Ar>algorithm ...</var><code class=Li>;</code></dt><dd>Add an SAD entry. <code class=Li>add</code> can fail with multiple reasons, including when the key length does not match the specified algorithm.</dd><dt><a class=permalink href=#get><code class=Li id=get>get</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src</var><var class=Ar>dst</var><var class=Ar>protocol</var><var class=Ar>spi</var><code class=Li>;</code></dt><dd>Show an SAD entry.</dd><dt><a class=permalink href=#delete><code class=Li id=delete>delete</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src</var><var class=Ar>dst</var><var class=Ar>protocol</var><var class=Ar>spi</var><code class=Li>;</code></dt><dd>Remove an SAD entry.</dd><dt><a class=permalink href=#deleteall><code class=Li id=deleteall>deleteall</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src</var><var class=Ar>dst</var><var class=Ar>protocol</var><code class=Li>;</code></dt><dd>Remove all SAD entries that match the specification.</dd><dt><a class=permalink href=#flush><code class=Li id=flush>flush</code></a> [<var class=Ar>protocol</var>] <code class=Li>;</code></dt><dd>Clear all SAD entries matched by the options. <code class=Fl>-F</code> on the command line achieves the same functionality.</dd><dt><a class=permalink href=#dump><code class=Li id=dump>dump</code></a> [<var class=Ar>protocol</var>] <code class=Li>;</code></dt><dd>Dumps all SAD entries matched by the options. <code class=Fl>-D</code> on the command line achieves the same functionality.</dd><dt><a class=permalink href=#spdadd><code class=Li id=spdadd>spdadd</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src_range</var><var class=Ar>dst_range</var><var class=Ar>upperspec</var><var class=Ar>policy</var><code class=Li>;</code></dt><dd>Add an SPD entry.</dd><dt><a class=permalink href=#spddelete><code class=Li id=spddelete>spddelete</code></a> [<code class=Fl>-46n</code>] <var class=Ar>src_range</var><var class=Ar>dst_range</var><var class=Ar>upperspec</var><code class=Fl>-P</code><var class=Ar>direction</var><code class=Li>;</code></dt><dd>Delete an SPD entry.</dd><dt><a class=permalink href=#spdflush><code class=Li id=spdflush>spdflush</code></a><code class=Li>;</code></dt><dd>Clear all SPD entries. <code class=Fl>-FP</code> on the command line achieves the same functionality.</dd><dt><a class=permalink href=#spddump><code class=Li id=spddump>spddump</code></a><code class=Li>;</code></dt><dd>Dumps all SPD entries. <code class=Fl>-DP</code> on the command line achieves the same functionality.</dd></dl><p class=Pp>Meta-arguments are as follows:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><var class=Ar>src</var></dt><dd style="width: auto;"> </dd><dt><var class=Ar>dst</var></dt><dd>Source/destination of the secure communication is specified as IPv4/v6 address. The <code class=Nm>setkey</code> utility can resolve a FQDN into numeric addresses. If the FQDN resolves into multiple addresses, <code class=Nm>setkey</code> will install multiple SAD/SPD entries into the kernel by trying all possible combinations. <code class=Fl>-4</code>, <code class=Fl>-6</code> and <code class=Fl>-n</code> restricts the address resolution of FQDN in certain ways. <code class=Fl>-4</code> and <code class=Fl>-6</code> restrict results into IPv4/v6 addresses only, respectively. <code class=Fl>-n</code> avoids FQDN resolution and requires addresses to be numeric addresses. <p class=Pp></p></dd><dt><var class=Ar>protocol</var></dt><dd><var class=Ar>protocol</var> is one of following: <dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#esp><code class=Li id=esp>esp</code></a></dt><dd>ESP based on rfc2406</dd><dt><a class=permalink href=#esp-old><code class=Li id=esp-old>esp-old</code></a></dt><dd>ESP based on rfc1827</dd><dt><a class=permalink href=#ah><code class=Li id=ah>ah</code></a></dt><dd>AH based on rfc2402</dd><dt><a class=permalink href=#ah-old><code class=Li id=ah-old>ah-old</code></a></dt><dd>AH based on rfc1826</dd><dt><a class=permalink href=#ipcomp><code class=Li id=ipcomp>ipcomp</code></a></dt><dd>IPComp</dd><dt><a class=permalink href=#tcp><code class=Li id=tcp>tcp</code></a></dt><dd>TCP-MD5 based on rfc2385</dd></dl><p class=Pp></p></dd><dt><var class=Ar>spi</var></dt><dd>Security Parameter Index (SPI) for the SAD and the SPD. <var class=Ar>spi</var> must be a decimal number, or a hexadecimal number with ‘<code class=Li>0x</code>’ prefix. SPI values between 0 and 255 are reserved for future use by IANA and they cannot be used. <p class=Pp></p></dd><dt><var class=Ar>extensions</var></dt><dd>take some of the following: <dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#m><code class=Fl id=m>-m</code></a><var class=Ar>mode</var></dt><dd>Specify a security protocol mode for use. <var class=Ar>mode</var> is one of following: <code class=Li>transport</code>, <code class=Li>tunnel</code> or <code class=Li>any</code>. The default value is <code class=Li>any</code>.</dd><dt><a class=permalink href=#r><code class=Fl id=r>-r</code></a><var class=Ar>size</var></dt><dd>Specify the bitmap size in octets of the anti-replay window. <var class=Ar>size</var> is a 32-bit unsigned integer, and its value is one eighth of the anti-replay window size in packets. If <var class=Ar>size</var> is zero or not specified, an anti-replay check does not take place.</dd><dt><a class=permalink href=#u><code class=Fl id=u>-u</code></a><var class=Ar>id</var></dt><dd>Specify the identifier of the policy entry in SPD. See <var class=Ar>policy</var>.</dd><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a><var class=Ar>pad_option</var></dt><dd>defines the content of the ESP padding. <var class=Ar>pad_option</var> is one of following: <dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#zero-pad><code class=Li id=zero-pad>zero-pad</code></a></dt><dd>All of the padding are zero.</dd><dt><a class=permalink href=#random-pad><code class=Li id=random-pad>random-pad</code></a></dt><dd>A series of randomized values are set.</dd><dt><a class=permalink href=#seq-pad><code class=Li id=seq-pad>seq-pad</code></a></dt><dd>A series of sequential increasing numbers started from 1 are set.</dd></dl></dd><dt><a class=permalink href=#f_2><code class=Fl id=f_2>-f</code></a><code class=Li>nocyclic-seq</code></dt><dd>Do not allow cyclic sequence number.</dd><dt><a class=permalink href=#lh><code class=Fl id=lh>-lh</code></a><var class=Ar>time</var></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#ls><code class=Fl id=ls>-ls</code></a><var class=Ar>time</var></dt><dd>Specify hard/soft life time duration of the SA.</dd></dl><p class=Pp></p></dd><dt><var class=Ar>algorithm</var></dt><dd><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#E><code class=Fl id=E>-E</code></a><var class=Ar>ealgo</var><var class=Ar>key</var></dt><dd>Specify an encryption or Authenticated Encryption with Associated Data (AEAD) algorithm <var class=Ar>ealgo</var> for ESP.</dd><dt><a class=permalink href=#E_2><code class=Fl id=E_2>-E</code></a><var class=Ar>ealgo</var><var class=Ar>key</var><code class=Fl>-A</code><var class=Ar>aalgo</var><var class=Ar>key</var></dt><dd>Specify a encryption algorithm <var class=Ar>ealgo</var>, as well as a payload authentication algorithm <var class=Ar>aalgo</var>, for ESP.</dd><dt><a class=permalink href=#A><code class=Fl id=A>-A</code></a><var class=Ar>aalgo</var><var class=Ar>key</var></dt><dd>Specify an authentication algorithm for AH.</dd><dt><a class=permalink href=#C><code class=Fl id=C>-C</code></a><var class=Ar>calgo</var> [<code class=Fl>-R</code>]</dt><dd>Specify a compression algorithm for IPComp. If <code class=Fl>-R</code> is specified, the <var class=Ar>spi</var> field value will be used as the IPComp CPI (compression parameter index) on wire as is. If <code class=Fl>-R</code> is not specified, the kernel will use well-known CPI on wire, and <var class=Ar>spi</var> field will be used only as an index for kernel internal usage.</dd></dl><p class=Pp><var class=Ar>key</var> must be double-quoted character string, or a series of hexadecimal digits preceded by ‘<code class=Li>0x</code>’.</p><p class=Pp>Possible values for <var class=Ar>ealgo</var>, <var class=Ar>aalgo</var> and <var class=Ar>calgo</var> are specified in separate section.</p><p class=Pp></p></dd><dt><var class=Ar>src_range</var></dt><dd style="width: auto;"> </dd><dt><var class=Ar>dst_range</var></dt><dd>These are selections of the secure communication specified as IPv4/v6 address or IPv4/v6 address range, and it may accompany TCP/UDP port specification. This takes the following form: <div class="Bd Pp"><pre>
<var class=Ar>address
</var>
<var class=Ar>address/prefixlen
</var>
<var class=Ar>address[port]
</var>
<var class=Ar>address/prefixlen[port]
</var>
    </pre></div><p class=Pp><var class=Ar>prefixlen</var> and <var class=Ar>port</var> must be a decimal number. The square brackets around <var class=Ar>port</var> are necessary and are not manpage metacharacters. For FQDN resolution, the rules applicable to <var class=Ar>src</var> and <var class=Ar>dst</var> apply here as well.</p><p class=Pp></p></dd><dt><var class=Ar>upperspec</var></dt><dd>The upper layer protocol to be used. You can use one of the words in <span class=Pa>/etc/protocols</span> as <var class=Ar>upperspec</var>, as well as <code class=Li>icmp6</code>, <code class=Li>ip4</code>, or <code class=Li>any</code>. The word <code class=Li>any</code> stands for “any protocol”. The protocol number may also be used to specify the <var class=Ar>upperspec</var>. A type and code related to ICMPv6 may also be specified as an <var class=Ar>upperspec</var>. The type is specified first, followed by a comma and then the relevant code. The specification must be placed after <code class=Li>icmp6</code>. The kernel considers a zero to be a wildcard but cannot distinguish between a wildcard and an ICMPv6 type which is zero. The following example shows a policy where IPSec is not required for inbound Neighbor Solicitations: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>spdadd ::/0 ::/0 icmp6 135,0 -P in none;</code></div><p class=Pp>NOTE: <var class=Ar>upperspec</var> does not work in the forwarding case at this moment, as it requires extra reassembly at forwarding node, which is not implemented at this moment. Although there are many protocols in <span class=Pa>/etc/protocols</span>, protocols other than TCP, UDP and ICMP may not be suitable to use with IPsec.</p><p class=Pp></p></dd><dt><var class=Ar>policy</var></dt><dd><var class=Ar>policy</var> is expressed in one of the following three formats: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#P><code class=Fl id=P>-P</code></a><var class=Ar>direction</var><code class=Li>discard</code></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#P_2><code class=Fl id=P_2>-P</code></a><var class=Ar>direction</var><code class=Li>none</code></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#P_3><code class=Fl id=P_3>-P</code></a><var class=Ar>direction</var><code class=Li>ipsec</code><var class=Ar>protocol/mode/src-dst/level</var> [...]</dt><dd style="width: auto;"> </dd></dl><p class=Pp>The direction of a policy must be specified as one of: <code class=Li>out</code>, <code class=Li>in</code>, <code class=Li>discard</code>, <code class=Li>none</code>, or <code class=Li>ipsec</code>. The <code class=Li>discard</code> direction means that packets matching the supplied indices will be discarded while <code class=Li>none</code> means that IPsec operations will not take place on the packet and <code class=Li>ipsec</code> means that IPsec operation will take place onto the packet. The <var class=Ar>protocol/mode/src-dst/level</var> statement gives the rule for how to process the packet. The <var class=Ar>protocol</var> is specified as <code class=Li>ah</code>, <code class=Li>esp</code> or <code class=Li>ipcomp</code>. The <var class=Ar>mode</var> is either <code class=Li>transport</code> or <code class=Li>tunnel</code>. If <var class=Ar>mode</var> is <code class=Li>tunnel</code>, you must specify the end-point addresses of the SA as <var class=Ar>src</var> and <var class=Ar>dst</var> with a dash, ‘-’, between the addresses. If <var class=Ar>mode</var> is <code class=Li>transport</code>, both <var class=Ar>src</var> and <var class=Ar>dst</var> can be omitted. The <var class=Ar>level</var> is one of the following: <code class=Li>default</code>, <code class=Li>use</code>, <code class=Li>require</code> or <code class=Li>unique</code>. If the SA is not available in every level, the kernel will request the SA from the key exchange daemon. A value of <code class=Li>default</code> tells the kernel to use the system wide default protocol e.g., the one from the <code class=Li>esp_trans_deflev</code> sysctl variable, when the kernel processes the packet. A value of <code class=Li>use</code> means that the kernel will use an SA if it is available, otherwise the kernel will pass the packet as it would normally. A value of <code class=Li>require</code> means that an SA is required whenever the kernel sends a packet matched that matches the policy. The <code class=Li>unique</code> level is the same as <code class=Li>require</code> but, in addition, it allows the policy to bind with the unique out-bound SA. For example, if you specify the policy level <code class=Li>unique</code>, <a class=Xr href=racoon.8.html>racoon(8)</a> (<span class=Pa>ports/security/ipsec-tools</span>) will configure the SA for the policy. If you configure the SA by manual keying for that policy, you can put the decimal number as the policy identifier after <code class=Li>unique</code> separated by colon ‘<code class=Li>:</code>’ as in the following example: <code class=Li>unique:number</code>. In order to bind this policy to the SA, <code class=Li>number</code> must be between 1 and 32767, which corresponds to <var class=Ar>extensions</var><code class=Fl>-u</code> of manual SA configuration.</p><p class=Pp>When you want to use an SA bundle, you can define multiple rules. For example, if an IP header was followed by an AH header followed by an ESP header followed by an upper layer protocol header, the rule would be:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>esp/transport//require ah/transport//require;</code></div><p class=Pp>The rule order is very important.</p><p class=Pp>Note that “<code class=Li>discard</code>” and “<code class=Li>none</code>” are not in the syntax described in <a class=Xr href=ipsec_set_policy.3.html>ipsec_set_policy(3)</a>. There are small, but important, differences in the syntax. See <a class=Xr href=ipsec_set_policy.3.html>ipsec_set_policy(3)</a> for details.</p></dd></dl></section></section><section class=Sh><h2 class=Sh id=ALGORITHMS><a class=permalink href=#ALGORITHMS>ALGORITHMS</a></h2> The following lists show the supported algorithms. <section class=Ss><h2 class=Ss id=Authentication_Algorithms><a class=permalink href=#Authentication_Algorithms>Authentication Algorithms</a></h2> The following authentication algorithms can be used as <var class=Ar>aalgo</var> in the <code class=Fl>-A</code><var class=Ar>aalgo</var> of the <var class=Ar>protocol</var> parameter: <div class="Bd Pp Bd-indent"><pre>
algorithm	keylen (bits)	comment
hmac-sha1	160		ah/esp: rfc2404
		160		ah-old/esp-old: 128bit ICV (no document)
null		0 to 2048	for debugging
hmac-sha2-256	256		ah/esp: 128bit ICV (RFC4868)
		256		ah-old/esp-old: 128bit ICV (no document)
hmac-sha2-384	384		ah/esp: 192bit ICV (RFC4868)
		384		ah-old/esp-old: 128bit ICV (no document)
hmac-sha2-512	512		ah/esp: 256bit ICV (RFC4868)
		512		ah-old/esp-old: 128bit ICV (no document)
aes-xcbc-mac	128		ah/esp: 96bit ICV (RFC3566)
		128		ah-old/esp-old: 128bit ICV (no document)
tcp-md5		8 to 640	tcp: rfc2385
</pre></div></section><section class=Ss><h2 class=Ss id=Encryption_Algorithms><a class=permalink href=#Encryption_Algorithms>Encryption Algorithms</a></h2> The following encryption algorithms can be used as the <var class=Ar>ealgo</var> in the <code class=Fl>-E</code><var class=Ar>ealgo</var> of the <var class=Ar>protocol</var> parameter: <div class="Bd Pp Bd-indent"><pre>
algorithm	keylen (bits)	comment
null		0 to 2048	rfc2410
aes-cbc		128/192/256	rfc3602
aes-ctr		160/224/288	rfc3686
aes-gcm-16	160/224/288	AEAD; rfc4106
</pre></div><p class=Pp>Note that the first 128/192/256 bits of a key for <code class=Li>aes-ctr</code> or <code class=Li>aes-gcm-16</code> will be used as the AES key, and the remaining 32 bits will be used as the nonce.</p><p class=Pp>AEAD encryption algorithms such as <code class=Li>aes-gcm-16</code> include authentication and should not be paired with a separate authentication algorithm via <code class=Fl>-A</code>.</p></section><section class=Ss><h2 class=Ss id=Compression_Algorithms><a class=permalink href=#Compression_Algorithms>Compression Algorithms</a></h2> The following compression algorithms can be used as the <var class=Ar>calgo</var> in the <code class=Fl>-C</code><var class=Ar>calgo</var> of the <var class=Ar>protocol</var> parameter: <div class="Bd Pp Bd-indent"><pre>
algorithm	comment
deflate		rfc2394
</pre></div></section></section><section class=Sh><h2 class=Sh id=EXIT_STATUS><a class=permalink href=#EXIT_STATUS>EXIT STATUS</a></h2> The <code class=Nm>setkey</code> utility exits 0 on success, and &gt;0 if an error occurs. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> Add an ESP SA between two IPv6 addresses using the AES-GCM AEAD algorithm. <div class="Bd Pp Bd-indent"><pre>
add 3ffe:501:4819::1 3ffe:501:481d::1 esp 123457
	-E aes-gcm-16 0x3ffe050148193ffe050148193ffe050148193ffe ;

</pre></div> Add an authentication SA between two FQDN specified hosts: <div class="Bd Pp Bd-indent"><pre>
add -6 myhost.example.com yourhost.example.com ah 123456
	-A hmac-sha2-256 "AH SA configuration!" ;

</pre></div> Get the SA information associated with first example above: <div class="Bd Pp Bd-indent"><pre>
get 3ffe:501:4819::1 3ffe:501:481d::1 ah 123456 ;

</pre></div> Flush all entries from the database: <div class="Bd Pp Bd-indent"><pre>
flush ;

</pre></div> Dump the ESP entries from the database: <div class="Bd Pp Bd-indent"><pre>
dump esp ;

</pre></div> Add a security policy between two networks that uses ESP in tunnel mode: <div class="Bd Pp Bd-indent"><pre>
spdadd 10.0.11.41/32[21] 10.0.11.33/32[any] any
	-P out ipsec esp/tunnel/192.168.0.1-192.168.1.2/require ;

</pre></div> Use TCP MD5 between two numerically specified hosts: <div class="Bd Pp Bd-indent"><pre>
add 10.1.10.34 10.1.10.36 tcp 0x1000 -A tcp-md5 "TCP-MD5 BGP secret" ;
add 10.1.10.36 10.1.10.34 tcp 0x1001 -A tcp-md5 "TCP-MD5 BGP secret" ;
</pre></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=ipsec_set_policy.3.html>ipsec_set_policy(3)</a>, <a class=Xr href=if_ipsec.4.html>if_ipsec(4)</a>, <a class=Xr href=racoon.8.html>racoon(8)</a> (<span class=Pa>ports/security/ipsec-tools</span>), <a class=Xr href=sysctl.8.html>sysctl(8)</a><p class=Pp><cite class=Rs><span class=RsT>Changed manual key configuration for IPsec</span>, <a href=https://www.kame.net/newsletter/19991007/ class=RsU>https://www.kame.net/newsletter/19991007/</a>, <span class=RsD>October 1999</span>.</cite></p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>setkey</code> utility first appeared in WIDE Hydrangea IPv6 protocol stack kit. The utility was completely re-designed in June 1998. It first appeared in <span class=Ux>FreeBSD 4.0</span>. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> The <code class=Nm>setkey</code> utility should report and handle syntax errors better. <p class=Pp>For IPsec gateway configuration, <var class=Ar>src_range</var> and <var class=Ar>dst_range</var> with TCP/UDP port number do not work, as the gateway does not reassemble packets (cannot inspect upper-layer headers).</p></section></div><table class=foot><tr><td class=foot-date>April 27, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>