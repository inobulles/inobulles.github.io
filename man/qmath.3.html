<!DOCTYPE html>
<html><head><meta charset=utf-8><title>qmath(3)</title><keywords content=man,qmath></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>qmath(3)</h1><table class=head><tr><td class=head-ltitle>QMATH(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>QMATH(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>qmath</code> — <div class=Nd>fixed-point math library based on the “Q” number format</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/qmath.h.html>sys/qmath.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>qmath</code> data types and APIs support fixed-point math based on the “Q” number format. The APIs have been built around the following data types: <var class=Vt>s8q_t</var>, <var class=Vt>u8q_t</var>, <var class=Vt>s16q_t</var>, <var class=Vt>u16q_t</var>, <var class=Vt>s32q_t</var>, <var class=Vt>u32q_t</var>, <var class=Vt>s64q_t</var>, and <var class=Vt>u64q_t</var>, which are referred to generically in the earlier API definitions as <var class=Fa>QTYPE</var>. The <var class=Fa>ITYPE</var> refers to the <a class=Xr href=stdint.7.html>stdint(7)</a> integer types. <var class=Fa>NTYPE</var> is used to refer to any numeric type and is therefore a superset of <var class=Fa>QTYPE</var> and <var class=Fa>ITYPE</var>. <p class=Pp>This scheme can represent Q numbers with [2, 4, 6, 8, 16, 32, 48] bits of precision after the binary radix point, depending on the <var class=Fa>rpshft</var> argument to <code class=Fn>Q_INI</code>(). The number of bits available for the integral component is not explicitly specified, and implicitly consumes the remaining available bits of the chosen Q data type.</p><p class=Pp>Operations on Q numbers maintain the precision of their arguments. The fractional component is truncated to fit into the destination, with no rounding. None of the operations is affected by the floating-point environment.</p><p class=Pp>For more details, see the <a class=Sx href=#IMPLEMENTATION_DETAILS>IMPLEMENTATION DETAILS</a> below.</p></section><section class=Sh><h2 class=Sh id=LIST_OF_FUNCTIONS><a class=permalink href=#LIST_OF_FUNCTIONS>LIST OF FUNCTIONS</a></h2><section class=Ss><h2 class=Ss id=Functions_which_create/initialise_a_Q_number><a class=permalink href=#Functions_which_create/initialise_a_Q_number>Functions which create/initialise a Q number</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_INI.3.html>Q_INI(3)</a></td><td>initialise a Q number</td></tr></table></section><section class=Ss><h2 class=Ss id=Numeric_functions_which_operate_on_two_Q_numbers><a class=permalink href=#Numeric_functions_which_operate_on_two_Q_numbers>Numeric functions which operate on two Q numbers</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_QADDQ.3.html>Q_QADDQ(3)</a></td><td>addition</td></tr><tr><td><a class=Xr href=Q_QDIVQ.3.html>Q_QDIVQ(3)</a></td><td>division</td></tr><tr><td><a class=Xr href=Q_QMULQ.3.html>Q_QMULQ(3)</a></td><td>multiplication</td></tr><tr><td><a class=Xr href=Q_QSUBQ.3.html>Q_QSUBQ(3)</a></td><td>subtraction</td></tr><tr><td><a class=Xr href=Q_NORMPREC.3.html>Q_NORMPREC(3)</a></td><td>normalisation</td></tr><tr><td><a class=Xr href=Q_QMAXQ.3.html>Q_QMAXQ(3)</a></td><td>maximum function</td></tr><tr><td><a class=Xr href=Q_QMINQ.3.html>Q_QMINQ(3)</a></td><td>minimum function</td></tr><tr><td><a class=Xr href=Q_QCLONEQ.3.html>Q_QCLONEQ(3)</a></td><td>identical copy</td></tr><tr><td><a class=Xr href=Q_QCPYVALQ.3.html>Q_QCPYVALQ(3)</a></td><td>representational copy</td></tr></table></section><section class=Ss><h2 class=Ss id=Numeric_functions_which_apply_integers_to_a_Q_number><a class=permalink href=#Numeric_functions_which_apply_integers_to_a_Q_number>Numeric functions which apply integers to a Q number</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_QADDI.3.html>Q_QADDI(3)</a></td><td>addition</td></tr><tr><td><a class=Xr href=Q_QDIVI.3.html>Q_QDIVI(3)</a></td><td>division</td></tr><tr><td><a class=Xr href=Q_QMULI.3.html>Q_QMULI(3)</a></td><td>multiplication</td></tr><tr><td><a class=Xr href=Q_QSUBI.3.html>Q_QSUBI(3)</a></td><td>subtraction</td></tr><tr><td><a class=Xr href=Q_QFRACI.3.html>Q_QFRACI(3)</a></td><td>fraction</td></tr><tr><td><a class=Xr href=Q_QCPYVALI.3.html>Q_QCPYVALI(3)</a></td><td>overwrite</td></tr></table></section><section class=Ss><h2 class=Ss id=Numeric_functions_which_operate_on_a_single_Q_number><a class=permalink href=#Numeric_functions_which_operate_on_a_single_Q_number>Numeric functions which operate on a single Q number</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_QABS.3.html>Q_QABS(3)</a></td><td>absolute value</td></tr><tr><td><a class=Xr href=Q_Q2D.3.html>Q_Q2D(3)</a></td><td>double representation</td></tr><tr><td><a class=Xr href=Q_Q2F.3.html>Q_Q2F(3)</a></td><td>float representation</td></tr></table></section><section class=Ss><h2 class=Ss id=Comparison_and_logic_functions><a class=permalink href=#Comparison_and_logic_functions>Comparison and logic functions</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_SIGNED.3.html>Q_SIGNED(3)</a></td><td>determine sign</td></tr><tr><td><a class=Xr href=Q_LTZ.3.html>Q_LTZ(3)</a></td><td>less than zero</td></tr><tr><td><a class=Xr href=Q_PRECEQ.3.html>Q_PRECEQ(3)</a></td><td>compare bits</td></tr><tr><td><a class=Xr href=Q_QLTQ.3.html>Q_QLTQ(3)</a></td><td>less than</td></tr><tr><td><a class=Xr href=Q_QLEQ.3.html>Q_QLEQ(3)</a></td><td>less or equal</td></tr><tr><td><a class=Xr href=Q_QGTQ.3.html>Q_QGTQ(3)</a></td><td>greater than</td></tr><tr><td><a class=Xr href=Q_QGEQ.3.html>Q_QGEQ(3)</a></td><td>greater or equal</td></tr><tr><td><a class=Xr href=Q_QEQ.3.html>Q_QEQ(3)</a></td><td>equal</td></tr><tr><td><a class=Xr href=Q_QNEQ.3.html>Q_QNEQ(3)</a></td><td>not equal</td></tr><tr><td><a class=Xr href=Q_OFLOW.3.html>Q_OFLOW(3)</a></td><td>would overflow</td></tr><tr><td><a class=Xr href=Q_RELPREC.3.html>Q_RELPREC(3)</a></td><td>relative precision</td></tr></table></section><section class=Ss><h2 class=Ss id=Functions_which_manipulate_the_control/sign_data_bits><a class=permalink href=#Functions_which_manipulate_the_control/sign_data_bits>Functions which manipulate the control/sign data bits</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_SIGNSHFT.3.html>Q_SIGNSHFT(3)</a></td><td>sign bit position</td></tr><tr><td><a class=Xr href=Q_SSIGN.3.html>Q_SSIGN(3)</a></td><td>sign bit</td></tr><tr><td><a class=Xr href=Q_CRAWMASK.3.html>Q_CRAWMASK(3)</a></td><td>control bitmask</td></tr><tr><td><a class=Xr href=Q_SRAWMASK.3.html>Q_SRAWMASK(3)</a></td><td>sign bitmask</td></tr><tr><td><a class=Xr href=Q_GCRAW.3.html>Q_GCRAW(3)</a></td><td>raw control bits</td></tr><tr><td><a class=Xr href=Q_GCVAL.3.html>Q_GCVAL(3)</a></td><td>value of control bits</td></tr><tr><td><a class=Xr href=Q_SCVAL.3.html>Q_SCVAL(3)</a></td><td>set control bits</td></tr></table></section><section class=Ss><h2 class=Ss id=Functions_which_manipulate_the_combined_integer/fractional_data_bits><a class=permalink href=#Functions_which_manipulate_the_combined_integer/fractional_data_bits>Functions which manipulate the combined integer/fractional data bits</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_IFRAWMASK.3.html>Q_IFRAWMASK(3)</a></td><td>integer/fractional bitmask</td></tr><tr><td><a class=Xr href=Q_IFVALIMASK.3.html>Q_IFVALIMASK(3)</a></td><td>value of integer bits</td></tr><tr><td><a class=Xr href=Q_IFVALFMASK.3.html>Q_IFVALFMASK(3)</a></td><td>value of fractional bits</td></tr><tr><td><a class=Xr href=Q_GIFRAW.3.html>Q_GIFRAW(3)</a></td><td>raw integer/fractional bits</td></tr><tr><td><a class=Xr href=Q_GIFABSVAL.3.html>Q_GIFABSVAL(3)</a></td><td>absolute value of fractional bits</td></tr><tr><td><a class=Xr href=Q_GIFVAL.3.html>Q_GIFVAL(3)</a></td><td>real value of fractional bits</td></tr><tr><td><a class=Xr href=Q_SIFVAL.3.html>Q_SIFVAL(3)</a></td><td>set integer/fractional bits</td></tr><tr><td><a class=Xr href=Q_SIFVALS.3.html>Q_SIFVALS(3)</a></td><td>set separate integer/fractional values</td></tr></table></section><section class=Ss><h2 class=Ss id=Functions_which_manipulate_the_integer_data_bits><a class=permalink href=#Functions_which_manipulate_the_integer_data_bits>Functions which manipulate the integer data bits</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_IRAWMASK.3.html>Q_IRAWMASK(3)</a></td><td>integer bitmask</td></tr><tr><td><a class=Xr href=Q_GIRAW.3.html>Q_GIRAW(3)</a></td><td>raw integer bits</td></tr><tr><td><a class=Xr href=Q_GIABSVAL.3.html>Q_GIABSVAL(3)</a></td><td>absolute value of integer bits</td></tr><tr><td><a class=Xr href=Q_GIVAL.3.html>Q_GIVAL(3)</a></td><td>real value of integer bits</td></tr><tr><td><a class=Xr href=Q_SIVAL.3.html>Q_SIVAL(3)</a></td><td>set integer bits</td></tr></table></section><section class=Ss><h2 class=Ss id=Functions_which_manipulate_the_fractional_data_bits><a class=permalink href=#Functions_which_manipulate_the_fractional_data_bits>Functions which manipulate the fractional data bits</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_FRAWMASK.3.html>Q_FRAWMASK(3)</a></td><td>fractional bitmask</td></tr><tr><td><a class=Xr href=Q_GFRAW.3.html>Q_GFRAW(3)</a></td><td>raw fractional bits</td></tr><tr><td><a class=Xr href=Q_GFABSVAL.3.html>Q_GFABSVAL(3)</a></td><td>absolute value of fractional bits</td></tr><tr><td><a class=Xr href=Q_GFVAL.3.html>Q_GFVAL(3)</a></td><td>real value of fractional bits</td></tr><tr><td><a class=Xr href=Q_SFVAL.3.html>Q_SFVAL(3)</a></td><td>set fractional bits</td></tr></table></section><section class=Ss><h2 class=Ss id=Miscellaneous_functions/variables><a class=permalink href=#Miscellaneous_functions/variables>Miscellaneous functions/variables</a></h2><table class=Bl-column><tr><td><i class=Em>Name</i></td><td>Description</td></tr><tr><td><a class=Xr href=Q_NCBITS.3.html>Q_NCBITS(3)</a></td><td>number of reserved control bits</td></tr><tr><td><a class=Xr href=Q_BT.3.html>Q_BT(3)</a></td><td>C data type</td></tr><tr><td><a class=Xr href=Q_TC.3.html>Q_TC(3)</a></td><td>casted data type</td></tr><tr><td><a class=Xr href=Q_NTBITS.3.html>Q_NTBITS(3)</a></td><td>number of total bits</td></tr><tr><td><a class=Xr href=Q_NFCBITS.3.html>Q_NFCBITS(3)</a></td><td>number of control-encoded fractional bits</td></tr><tr><td><a class=Xr href=Q_MAXNFBITS.3.html>Q_MAXNFBITS(3)</a></td><td>number of maximum fractional bits</td></tr><tr><td><a class=Xr href=Q_NFBITS.3.html>Q_NFBITS(3)</a></td><td>number of effective fractional bits</td></tr><tr><td><a class=Xr href=Q_NIBITS.3.html>Q_NIBITS(3)</a></td><td>number of integer bits</td></tr><tr><td><a class=Xr href=Q_RPSHFT.3.html>Q_RPSHFT(3)</a></td><td>bit position of radix point</td></tr><tr><td><a class=Xr href=Q_ABS.3.html>Q_ABS(3)</a></td><td>absolute value</td></tr><tr><td><a class=Xr href=Q_MAXSTRLEN.3.html>Q_MAXSTRLEN(3)</a></td><td>number of characters to render string</td></tr><tr><td><a class=Xr href=Q_TOSTR.3.html>Q_TOSTR(3)</a></td><td>render string</td></tr><tr><td><a class=Xr href=Q_SHL.3.html>Q_SHL(3)</a></td><td>left-shifted value</td></tr><tr><td><a class=Xr href=Q_SHR.3.html>Q_SHR(3)</a></td><td>right-shifted value</td></tr><tr><td><a class=Xr href=Q_DEBUG.3.html>Q_DEBUG(3)</a></td><td>render debugging information</td></tr><tr><td><a class=Xr href=Q_DFV2BFV.3.html>Q_DFV2BFV(3)</a></td><td>convert decimal fractional value</td></tr></table></section></section><section class=Sh><h2 class=Sh id=IMPLEMENTATION_DETAILS><a class=permalink href=#IMPLEMENTATION_DETAILS>IMPLEMENTATION DETAILS</a></h2> The <code class=Nm>qmath</code> data types and APIs support fixed-point math based on the “Q” number format. This implementation uses the Q notation <i class=Em>Qm.n</i>, where <i class=Em>m</i> specifies the number of bits for integral data (excluding the sign bit for signed types), and <i class=Em>n</i> specifies the number of bits for fractional data. <p class=Pp>The APIs have been built around the following q_t derived data types:</p><div class="Bd Pp Bd-indent"><pre>
typedef int8_t		s8q_t;
typedef uint8_t		u8q_t;
typedef int16_t		s16q_t;
typedef uint16_t	u16q_t;
typedef int32_t		s32q_t;
typedef uint32_t	u32q_t;
typedef int64_t		s64q_t;
typedef uint64_t	u64q_t;
</pre></div><p class=Pp>These types are referred to generically in the earlier API definitions as <var class=Fa>QTYPE</var>, while <var class=Fa>ITYPE</var> refers to the <a class=Xr href=stdint.7.html>stdint(7)</a> integer types the Q data types are derived from. <var class=Fa>NTYPE</var> is used to refer to any numeric type and is therefore a superset of <var class=Fa>QTYPE</var> and <var class=Fa>ITYPE</var>.</p><p class=Pp>The 3 least significant bits (LSBs) of all q_t data types are reserved for embedded control data:</p><ul class=Bl-dash><li>bits 1-2 specify the binary radix point shift index operand, with 00,01,10,11 == 1,2,3,4.</li><li>bit 3 specifies the radix point shift index operand multiplier as 2 (0) or 16 (1).</li></ul><p class=Pp>This scheme can therefore represent Q numbers with [2,4,6,8,16,32,48,64] bits of precision after the binary radix point. The number of bits available for the integral component is not explicitly specified, and implicitly consumes the remaining available bits of the chosen Q data type.</p><p class=Pp>Additionally, the most significant bit (MSB) of signed Q types stores the sign bit, with bit value 0 representing a positive number and bit value 1 representing a negative number. Negative numbers are stored as absolute values with the sign bit set, rather than the more typical two's complement representation. This avoids having to bit shift negative numbers, which can result in undefined behaviour from some compilers.</p><p class=Pp>This binary representation used for Q numbers therefore comprises a set of distinct data bit types and associated bit counts. Data bit types/labels, listed in LSB to MSB order, are: control ‘C’, fractional ‘F’, integer ‘I’ and sign ‘S’. The following example illustrates the binary representation of a Q20.8 number represented using a s32q_t variable:</p><div class="Bd Pp Bd-indent"><pre>
M                                                             L
S                                                             S
B                                                             B

3 3 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1
1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0 9 8 7 6 5 4 3 2 1 0

S I I I I I I I I I I I I I I I I I I I I F F F F F F F F C C C
</pre></div><p class=Pp>Important bit counts are: total, control, control-encoded fractional, maximum fractional, effective fractional and integer bits.</p><p class=Pp>The count of total bits is derived from the size of the q_t data type. For example, a s32q_t has 32 total bits.</p><p class=Pp>The count of control-encoded fractional bits is derived from calculating the number of fractional bits per the control bit encoding scheme. For example, the control bits binary value of 101 encodes a fractional bit count of 2 x 16 = 32 fractional bits.</p><p class=Pp>The count of maximum fractional bits is derived from the difference between the counts of total bits and control/sign bits. For example, a s32q_t has a maximum of 32 - 3 - 1 = 28 fractional bits.</p><p class=Pp>The count of effective fractional bits is derived from the minimum of the control-encoded fractional bits and the maximum fractional bits. For example, a s32q_t with 32 control-encoded fractional bits is effectively limited to 28 fractional bits.</p><p class=Pp>The count of integer bits is derived from the difference between the counts of total bits and all other non-integer data bits (the sum of control, fractional and sign bits.) For example, a s32q_t with 8 effective fractional bits has 32 - 3 - 8 - 1 = 20 integer bits. The count of integer bits can be zero if all available numeric data bits have been reserved for fractional data, e.g., when the number of control-encoded fractional bits is greater than or equal to the underlying Q data type's maximum fractional bits.</p></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2><section class=Ss><h2 class=Ss id="Calculating_area_of_a_circle_with_r=4.2_and_rpshft=16"><a class=permalink href="#Calculating_area_of_a_circle_with_r=4.2_and_rpshft=16">Calculating area of a circle with r=4.2 and rpshft=16</a></h2><div class="Bd Bd-indent"><pre>
u64q_t a, pi, r;
char buf[32]

Q_INI(&amp;a, 0, 0, 16);
Q_INI(&amp;pi, 3, 14159, 16);
Q_INI(&amp;r, 4, 2, 16);

Q_QCLONEQ(&amp;a, r);
Q_QMULQ(&amp;a, r);
Q_QMULQ(&amp;a, pi);

Q_TOSTR(a, -1, 10, buf, sizeof(buf));
printf("%s\n", buf);
</pre></div></section><section class=Ss><h2 class=Ss id=Debugging><a class=permalink href=#Debugging>Debugging</a></h2> Declare a Q20.8 s32q_t number <var class=Fa>s32</var>, initialise it with the fixed-point value for 5/3, and render a debugging representation of the variable (including its full precision decimal C-string representation), to the console: <div class="Bd Pp Bd-indent"><pre>
s32q_t s32;
Q_INI(&amp;s32, 0, 0, 8);
Q_QFRACI(&amp;s32, 5, 3);
char buf[Q_MAXSTRLEN(s32, 10)];
Q_TOSTR(s32, -1, 10, buf, sizeof(buf));
printf(Q_DEBUG(s32, "", "\n\ttostr=%s\n\n", 0), buf);
</pre></div><p class=Pp>The above code outputs the following to the console:</p><div class="Bd Pp Bd-indent"><pre>
"s32"@0x7fffffffe7d4
	type=s32q_t, Qm.n=Q20.8, rpshft=11, imin=0xfff00001, \
imax=0xfffff
	qraw=0x00000d53
	imask=0x7ffff800, fmask=0x000007f8, cmask=0x00000007, \
ifmask=0x7ffffff8
	iraw=0x00000800, iabsval=0x1, ival=0x1
	fraw=0x00000550, fabsval=0xaa, fval=0xaa
	tostr=1.664
</pre></div><p class=Pp>Note: The “\” present in the rendered output above indicates a manual line break inserted to keep the man page within 80 columns and is not part of the actual output.</p></section></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=errno.2.html>errno(2)</a>, <a class=Xr href=math.3.html>math(3)</a>, <a class=Xr href=Q_FRAWMASK.3.html>Q_FRAWMASK(3)</a>, <a class=Xr href=Q_IFRAWMASK.3.html>Q_IFRAWMASK(3)</a>, <a class=Xr href=Q_INI.3.html>Q_INI(3)</a>, <a class=Xr href=Q_IRAWMASK.3.html>Q_IRAWMASK(3)</a>, <a class=Xr href=Q_QABS.3.html>Q_QABS(3)</a>, <a class=Xr href=Q_QADDI.3.html>Q_QADDI(3)</a>, <a class=Xr href=Q_QADDQ.3.html>Q_QADDQ(3)</a>, <a class=Xr href=Q_SIGNED.3.html>Q_SIGNED(3)</a>, <a class=Xr href=Q_SIGNSHFT.3.html>Q_SIGNSHFT(3)</a>, <a class=Xr href=stdint.7.html>stdint(7)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>qmath</code> functions first appeared in <span class=Ux>FreeBSD 13.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>qmath</code> functions and this manual page were written by <span class=An>Lawrence Stewart</span> &lt;<a class=Mt href=mailto:lstewart@FreeBSD.org>lstewart@FreeBSD.org</a>&gt; and sponsored by Netflix, Inc. </section></div><table class=foot><tr><td class=foot-date>July 4, 2019</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>