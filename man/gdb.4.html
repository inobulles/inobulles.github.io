<!DOCTYPE html>
<html><head><meta charset=utf-8><title>gdb(4)</title><keywords content=man,gdb></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>gdb(4)</h1><table class=head><tr><td class=head-ltitle>GDB(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>GDB(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>gdb</code> — <div class=Nd>external kernel debugger</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=Cd>makeoptions DEBUG=-g</code><br><code class=Cd>options DDB</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>gdb</code> kernel debugger is a variation of <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) which understands some aspects of the <span class=Ux>FreeBSD</span> kernel environment. It can be used in a number of ways: <ul class=Bl-bullet><li>It can be used to examine the memory of the processor on which it runs.</li><li>It can be used to analyse a processor dump after a panic.</li><li>It can be used to debug another system interactively via a serial or firewire link. In this mode, the processor can be stopped and single stepped.</li><li>With a firewire link, it can be used to examine the memory of a remote system without the participation of that system. In this mode, the processor cannot be stopped and single stepped, but it can be of use when the remote system has crashed and is no longer responding.</li></ul><p class=Pp>When used for remote debugging, <code class=Nm>gdb</code> requires the presence of the <a class=Xr href=ddb.4.html>ddb(4)</a> kernel debugger. Commands exist to switch between <code class=Nm>gdb</code> and <a class=Xr href=ddb.4.html>ddb(4)</a>.</p></section><section class=Sh><h2 class=Sh id=PREPARING_FOR_DEBUGGING><a class=permalink href=#PREPARING_FOR_DEBUGGING>PREPARING FOR DEBUGGING</a></h2> When debugging kernels, it is practically essential to have built a kernel with debugging symbols (<code class=Cd>makeoptions DEBUG=-g</code>). It is easiest to perform operations from the kernel build directory, by default <span class=Pa>/usr/obj/usr/src/sys/GENERIC</span>. <p class=Pp>First, ensure you have a copy of the debug macros in the directory:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>make gdbinit</code></div><p class=Pp>This command performs some transformations on the macros installed in <span class=Pa>/usr/src/tools/debugscripts</span> to adapt them to the local environment.</p><section class=Ss><h2 class=Ss id=Inspecting_the_environment_of_the_local_machine><a class=permalink href=#Inspecting_the_environment_of_the_local_machine>Inspecting the environment of the local machine</a></h2> To look at and change the contents of the memory of the system you are running on, <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>gdb -k -wcore kernel.debug /dev/mem</code></div><p class=Pp>In this mode, you need the <code class=Fl>-k</code> flag to indicate to <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) that the “dump file” <span class=Pa>/dev/mem</span> is a kernel data file. You can look at live data, and if you include the <code class=Fl>-wcore</code> option, you can change it at your peril. The system does not stop (obviously), so a number of things will not work. You can set breakpoints, but you cannot “continue” execution, so they will not work.</p></section><section class=Ss><h2 class=Ss id=Debugging_a_crash_dump><a class=permalink href=#Debugging_a_crash_dump>Debugging a crash dump</a></h2> By default, crash dumps are stored in the directory <span class=Pa>/var/crash</span>. Investigate them from the kernel build directory with: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>gdb -k kernel.debug /var/crash/vmcore.29</code></div><p class=Pp>In this mode, the system is obviously stopped, so you can only look at it.</p></section><section class=Ss><h2 class=Ss id=Debugging_a_live_system_with_a_remote_link><a class=permalink href=#Debugging_a_live_system_with_a_remote_link>Debugging a live system with a remote link</a></h2> In the following discussion, the term “local system” refers to the system running the debugger, and “remote system” refers to the live system being debugged. <p class=Pp>To debug a live system with a remote link, the kernel must be compiled with the option <code class=Cd>options DDB</code>. The option <code class=Cd>options BREAK_TO_DEBUGGER</code> enables the debugging machine stop the debugged machine once a connection has been established by pressing ‘<code class=Li>^C</code>’.</p></section><section class=Ss><h2 class=Ss id=Debugging_a_live_system_with_a_remote_serial_link><a class=permalink href=#Debugging_a_live_system_with_a_remote_serial_link>Debugging a live system with a remote serial link</a></h2> When using a serial port for the remote link on the i386 platform, the serial port must be identified by setting the flag bit <code class=Li>0x80</code> for the specified interface. Generally, this port will also be used as a serial console (flag bit <code class=Li>0x10</code>), so the entry in <span class=Pa>/boot/device.hints</span> should be: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>hint.sio.0.flags="0x90"</code></div></section><section class=Ss><h2 class=Ss id=Debugging_a_live_system_with_a_remote_firewire_link><a class=permalink href=#Debugging_a_live_system_with_a_remote_firewire_link>Debugging a live system with a remote firewire link</a></h2> As with serial debugging, to debug a live system with a firewire link, the kernel must be compiled with the option <code class=Cd>options DDB</code>. <p class=Pp>A number of steps must be performed to set up a firewire link:</p><ul class=Bl-bullet><li>Ensure that both systems have <a class=Xr href=firewire.4.html>firewire(4)</a> support, and that the kernel of the remote system includes the <a class=Xr href=dcons.4.html>dcons(4)</a> and <a class=Xr href=dcons_crom.4.html>dcons_crom(4)</a> drivers. If they are not compiled into the kernel, load the KLDs: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>kldload firewire</code></div><p class=Pp>On the remote system only:</p><div class="Bd Pp Bd-indent"><pre>
kldload dcons
kldload dcons_crom
    </pre></div><p class=Pp>You should see something like this in the <a class=Xr href=dmesg.8.html>dmesg(8)</a> output of the remote system:</p><div class="Bd Pp Bd-indent"><pre>
fwohci0: BUS reset
fwohci0: node_id=0x8800ffc0, gen=2, non CYCLEMASTER mode
firewire0: 2 nodes, maxhop &lt;= 1, cable IRM = 1
firewire0: bus manager 1
firewire0: New S400 device ID:00c04f3226e88061
dcons_crom0: &lt;dcons configuration ROM&gt; on firewire0
dcons_crom0: bus_addr 0x22a000
    </pre></div><p class=Pp>It is a good idea to load these modules at boot time with the following entry in <span class=Pa>/boot/loader.conf</span>:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>dcons_crom_enable="YES"</code></div><p class=Pp>This ensures that all three modules are loaded. There is no harm in loading <a class=Xr href=dcons.4.html>dcons(4)</a> and <a class=Xr href=dcons_crom.4.html>dcons_crom(4)</a> on the local system, but if you only want to load the <a class=Xr href=firewire.4.html>firewire(4)</a> module, include the following in <span class=Pa>/boot/loader.conf</span>:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>firewire_enable="YES"</code></div></li><li>Next, use <a class=Xr href=fwcontrol.8.html>fwcontrol(8)</a> to find the firewire node corresponding to the remote machine. On the local machine you might see: <div class="Bd Pp Bd-indent"><pre>
# fwcontrol
2 devices (info_len=2)
node        EUI64        status
   1  0x00c04f3226e88061      0
   0  0x000199000003622b      1
    </pre></div><p class=Pp>The first node is always the local system, so in this case, node 0 is the remote system. If there are more than two systems, check from the other end to find which node corresponds to the remote system. On the remote machine, it looks like this:</p><div class="Bd Pp Bd-indent"><pre>
# fwcontrol
2 devices (info_len=2)
node        EUI64        status
   0  0x000199000003622b      0
   1  0x00c04f3226e88061      1
    </pre></div></li><li>Next, establish a firewire connection with <a class=Xr href=dconschat.8.html>dconschat(8)</a>: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>dconschat -br -G 5556 -t 0x000199000003622b</code></div><p class=Pp><code class=Li>0x000199000003622b</code> is the EUI64 address of the remote node, as determined from the output of <a class=Xr href=fwcontrol.8.html>fwcontrol(8)</a> above. When started in this manner, <a class=Xr href=dconschat.8.html>dconschat(8)</a> establishes a local tunnel connection from port <code class=Li>localhost:5556</code> to the remote debugger. You can also establish a console port connection with the <code class=Fl>-C</code> option to the same invocation <a class=Xr href=dconschat.8.html>dconschat(8)</a>. See the <a class=Xr href=dconschat.8.html>dconschat(8)</a> manpage for further details.</p><p class=Pp>The <a class=Xr href=dconschat.8.html>dconschat(8)</a> utility does not return control to the user. It displays error messages and console output for the remote system, so it is a good idea to start it in its own window.</p></li><li>Finally, establish connection: <div class="Bd Pp Bd-indent"><pre>
# gdb kernel.debug
GNU gdb 5.2.1 (FreeBSD)
<i class=Em>(political statements omitted)
</i>
Ready to go.  Enter 'tr' to connect to the remote target
with /dev/cuau0, 'tr /dev/cuau1' to connect to a different port
or 'trf portno' to connect to the remote target with the firewire
interface.  portno defaults to 5556.

Type 'getsyms' after connection to load kld symbols.

If you are debugging a local system, you can use 'kldsyms' instead
to load the kld symbols.  That is a less obnoxious interface.
(gdb) trf
0xc21bd378 in ?? ()
    </pre></div><p class=Pp>The <code class=Ic>trf</code> macro assumes a connection on port 5556. If you want to use a different port (by changing the invocation of <a class=Xr href=dconschat.8.html>dconschat(8)</a> above), use the <code class=Ic>tr</code> macro instead. For example, if you want to use port 4711, run <a class=Xr href=dconschat.8.html>dconschat(8)</a> like this:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>dconschat -br -G 4711 -t 0x000199000003622b</code></div><p class=Pp>Then establish connection with:</p><div class="Bd Pp Bd-indent"><pre>
(gdb) tr localhost:4711
0xc21bd378 in ?? ()
    </pre></div></li></ul></section><section class=Ss><h2 class=Ss id=Non_cooperative_debugging_a_live_system_with_a_remote_firewire_link><a class=permalink href=#Non_cooperative_debugging_a_live_system_with_a_remote_firewire_link>Non-cooperative debugging a live system with a remote firewire link</a></h2> In addition to the conventional debugging via firewire described in the previous section, it is possible to debug a remote system without its cooperation, once an initial connection has been established. This corresponds to debugging a local machine using <span class=Pa>/dev/mem</span>. It can be very useful if a system crashes and the debugger no longer responds. To use this method, set the <a class=Xr href=sysctl.8.html>sysctl(8)</a> variables <var class=Va>hw.firewire.fwmem.eui64_hi</var> and <var class=Va>hw.firewire.fwmem.eui64_lo</var> to the upper and lower halves of the EUI64 ID of the remote system, respectively. From the previous example, the remote machine shows: <div class="Bd Pp Bd-indent"><pre>
# fwcontrol
2 devices (info_len=2)
node        EUI64        status
   0  0x000199000003622b      0
   1  0x00c04f3226e88061      1
</pre></div><p class=Pp>Enter:</p><div class="Bd Pp Bd-indent"><pre>
# sysctl -w hw.firewire.fwmem.eui64_hi=0x00019900
hw.firewire.fwmem.eui64_hi: 0 -&gt; 104704
# sysctl -w hw.firewire.fwmem.eui64_lo=0x0003622b
hw.firewire.fwmem.eui64_lo: 0 -&gt; 221739
</pre></div><p class=Pp>Note that the variables must be explicitly stated in hexadecimal. After this, you can examine the remote machine's state with the following input:</p><div class="Bd Pp Bd-indent"><pre>
# gdb -k kernel.debug /dev/fwmem0.0
GNU gdb 5.2.1 (FreeBSD)
<i class=Em>(messages omitted)
</i>
Reading symbols from /boot/kernel/dcons.ko...done.
Loaded symbols for /boot/kernel/dcons.ko
Reading symbols from /boot/kernel/dcons_crom.ko...done.
Loaded symbols for /boot/kernel/dcons_crom.ko
#0  sched_switch (td=0xc0922fe0) at /usr/src/sys/kern/sched_4bsd.c:621
0xc21bd378 in ?? ()
</pre></div><p class=Pp>In this case, it is not necessary to load the symbols explicitly. The remote system continues to run.</p></section></section><section class=Sh><h2 class=Sh id=COMMANDS><a class=permalink href=#COMMANDS>COMMANDS</a></h2> The user interface to <code class=Nm>gdb</code> is via <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>), so <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) commands also work. This section discusses only the extensions for kernel debugging that get installed in the kernel build directory. <section class=Ss><h2 class=Ss id=Debugging_environment><a class=permalink href=#Debugging_environment>Debugging environment</a></h2> The following macros manipulate the debugging environment: <dl class=Bl-tag><dt><a class=permalink href=#ddb><code class=Ic id=ddb>ddb</code></a></dt><dd>Switch back to <a class=Xr href=ddb.4.html>ddb(4)</a>. This command is only meaningful when performing remote debugging.</dd><dt><a class=permalink href=#getsyms><code class=Ic id=getsyms>getsyms</code></a></dt><dd>Display <code class=Ic>kldstat</code> information for the target machine and invite user to paste it back in. This is required because <code class=Nm>gdb</code> does not allow data to be passed to shell scripts. It is necessary for remote debugging and crash dumps; for local memory debugging use <code class=Ic>kldsyms</code> instead.</dd><dt><a class=permalink href=#kldsyms><code class=Ic id=kldsyms>kldsyms</code></a></dt><dd>Read in the symbol tables for the debugging machine. This does not work for remote debugging and crash dumps; use <code class=Ic>getsyms</code> instead.</dd><dt><a class=permalink href=#tr><code class=Ic id=tr>tr</code></a><var class=Ar>interface</var></dt><dd>Debug a remote system via the specified serial or firewire interface.</dd><dt><a class=permalink href=#tr0><code class=Ic id=tr0>tr0</code></a></dt><dd>Debug a remote system via serial interface <span class=Pa>/dev/cuau0</span>.</dd><dt><a class=permalink href=#tr1><code class=Ic id=tr1>tr1</code></a></dt><dd>Debug a remote system via serial interface <span class=Pa>/dev/cuau1</span>.</dd><dt><a class=permalink href=#trf><code class=Ic id=trf>trf</code></a></dt><dd>Debug a remote system via firewire interface at default port 5556.</dd></dl><p class=Pp>The commands <code class=Ic>tr0</code>, <code class=Ic>tr1</code> and <code class=Ic>trf</code> are convenience commands which invoke <code class=Ic>tr</code>.</p></section><section class=Ss><h2 class=Ss id=The_current_process_environment><a class=permalink href=#The_current_process_environment>The current process environment</a></h2> The following macros are convenience functions intended to make things easier than the standard <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) commands. <dl class=Bl-tag><dt><a class=permalink href=#f0><code class=Ic id=f0>f0</code></a></dt><dd>Select stack frame 0 and show assembler-level details.</dd><dt><a class=permalink href=#f1><code class=Ic id=f1>f1</code></a></dt><dd>Select stack frame 1 and show assembler-level details.</dd><dt><a class=permalink href=#f2><code class=Ic id=f2>f2</code></a></dt><dd>Select stack frame 2 and show assembler-level details.</dd><dt><a class=permalink href=#f3><code class=Ic id=f3>f3</code></a></dt><dd>Select stack frame 3 and show assembler-level details.</dd><dt><a class=permalink href=#f4><code class=Ic id=f4>f4</code></a></dt><dd>Select stack frame 4 and show assembler-level details.</dd><dt><a class=permalink href=#f5><code class=Ic id=f5>f5</code></a></dt><dd>Select stack frame 5 and show assembler-level details.</dd><dt><a class=permalink href=#xb><code class=Ic id=xb>xb</code></a></dt><dd>Show 12 words in hex, starting at current <var class=Va>ebp</var> value.</dd><dt><a class=permalink href=#xi><code class=Ic id=xi>xi</code></a></dt><dd>List the next 10 instructions from the current <var class=Va>eip</var> value.</dd><dt><a class=permalink href=#xp><code class=Ic id=xp>xp</code></a></dt><dd>Show the register contents and the first four parameters of the current stack frame.</dd><dt><a class=permalink href=#xp0><code class=Ic id=xp0>xp0</code></a></dt><dd>Show the first parameter of current stack frame in various formats.</dd><dt><a class=permalink href=#xp1><code class=Ic id=xp1>xp1</code></a></dt><dd>Show the second parameter of current stack frame in various formats.</dd><dt><a class=permalink href=#xp2><code class=Ic id=xp2>xp2</code></a></dt><dd>Show the third parameter of current stack frame in various formats.</dd><dt><a class=permalink href=#xp3><code class=Ic id=xp3>xp3</code></a></dt><dd>Show the fourth parameter of current stack frame in various formats.</dd><dt><a class=permalink href=#xp4><code class=Ic id=xp4>xp4</code></a></dt><dd>Show the fifth parameter of current stack frame in various formats.</dd><dt><a class=permalink href=#xs><code class=Ic id=xs>xs</code></a></dt><dd>Show the last 12 words on stack in hexadecimal.</dd><dt><a class=permalink href=#xxp><code class=Ic id=xxp>xxp</code></a></dt><dd>Show the register contents and the first ten parameters.</dd><dt><a class=permalink href=#z><code class=Ic id=z>z</code></a></dt><dd>Single step 1 instruction (over calls) and show next instruction.</dd><dt><a class=permalink href=#zs><code class=Ic id=zs>zs</code></a></dt><dd>Single step 1 instruction (through calls) and show next instruction.</dd></dl></section><section class=Ss><h2 class=Ss id=Examining_other_processes><a class=permalink href=#Examining_other_processes>Examining other processes</a></h2> The following macros access other processes. The <code class=Nm>gdb</code> debugger does not understand the concept of multiple processes, so they effectively bypass the entire <code class=Nm>gdb</code> environment. <dl class=Bl-tag><dt><a class=permalink href=#btp><code class=Ic id=btp>btp</code></a><var class=Ar>pid</var></dt><dd>Show a backtrace for the process <var class=Ar>pid</var>.</dd><dt><a class=permalink href=#btpa><code class=Ic id=btpa>btpa</code></a></dt><dd>Show backtraces for all processes in the system.</dd><dt><a class=permalink href=#btpp><code class=Ic id=btpp>btpp</code></a></dt><dd>Show a backtrace for the process previously selected with <code class=Ic>defproc</code>.</dd><dt><a class=permalink href=#btr><code class=Ic id=btr>btr</code></a><var class=Ar>ebp</var></dt><dd>Show a backtrace from the <var class=Ar>ebp</var> address specified.</dd><dt><a class=permalink href=#defproc><code class=Ic id=defproc>defproc</code></a><var class=Ar>pid</var></dt><dd>Specify the PID of the process for some other commands in this section.</dd><dt><a class=permalink href=#fr><code class=Ic id=fr>fr</code></a><var class=Ar>frame</var></dt><dd>Show frame <var class=Ar>frame</var> of the stack of the process previously selected with <code class=Ic>defproc</code>.</dd><dt><a class=permalink href=#pcb><code class=Ic id=pcb>pcb</code></a><var class=Ar>proc</var></dt><dd>Show some PCB contents of the process <var class=Ar>proc</var>.</dd></dl></section><section class=Ss><h2 class=Ss id=Examining_data_structures><a class=permalink href=#Examining_data_structures>Examining data structures</a></h2> You can use standard <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) commands to look at most data structures. The macros in this section are convenience functions which typically display the data in a more readable format, or which omit less interesting parts of the structure. <dl class=Bl-tag><dt><a class=permalink href=#bp><code class=Ic id=bp>bp</code></a></dt><dd>Show information about the buffer header pointed to by the variable <var class=Va>bp</var> in the current frame.</dd><dt><a class=permalink href=#bpd><code class=Ic id=bpd>bpd</code></a></dt><dd>Show the contents (<var class=Vt>char *</var>) of <var class=Va>bp-&gt;data</var> in the current frame.</dd><dt><a class=permalink href=#bpl><code class=Ic id=bpl>bpl</code></a></dt><dd>Show detailed information about the buffer header (<var class=Vt>struct bp</var>) pointed at by the local variable <var class=Va>bp</var>.</dd><dt><a class=permalink href=#bpp><code class=Ic id=bpp>bpp</code></a><var class=Ar>bp</var></dt><dd>Show summary information about the buffer header (<var class=Vt>struct bp</var>) pointed at by the parameter <var class=Ar>bp</var>.</dd><dt><a class=permalink href=#bx><code class=Ic id=bx>bx</code></a></dt><dd>Print a number of fields from the buffer header pointed at in by the pointer <var class=Ar>bp</var> in the current environment.</dd><dt><a class=permalink href=#vdev><code class=Ic id=vdev>vdev</code></a></dt><dd>Show some information of the <var class=Vt>vnode</var> pointed to by the local variable <var class=Va>vp</var>.</dd></dl></section><section class=Ss><h2 class=Ss id=Miscellaneous_macros><a class=permalink href=#Miscellaneous_macros>Miscellaneous macros</a></h2><dl class=Bl-tag><dt><a class=permalink href=#checkmem><code class=Ic id=checkmem>checkmem</code></a></dt><dd>Check unallocated memory for modifications. This assumes that the kernel has been compiled with <code class=Cd>options DIAGNOSTIC</code>. This causes the contents of free memory to be set to <code class=Li>0xdeadc0de</code>.</dd><dt><a class=permalink href=#dmesg><code class=Ic id=dmesg>dmesg</code></a></dt><dd>Print the system message buffer. This corresponds to the <a class=Xr href=dmesg.8.html>dmesg(8)</a> utility. This macro used to be called <code class=Ic>msgbuf</code>. It can take a very long time over a serial line, and it is even slower via firewire or local memory due to inefficiencies in <code class=Nm>gdb</code>. When debugging a crash dump or over firewire, it is not necessary to start <code class=Nm>gdb</code> to access the message buffer: instead, use an appropriate variation of <div class="Bd Pp Bd-indent"><pre>
dmesg -M /var/crash/vmcore.0 -N kernel.debug
dmesg -M /dev/fwmem0.0 -N kernel.debug
    </pre></div></dd><dt><a class=permalink href=#kldstat><code class=Ic id=kldstat>kldstat</code></a></dt><dd>Equivalent of the <a class=Xr href=kldstat.8.html>kldstat(8)</a> utility without options.</dd><dt><a class=permalink href=#pname><code class=Ic id=pname>pname</code></a></dt><dd>Print the command name of the current process.</dd><dt><a class=permalink href=#ps><code class=Ic id=ps>ps</code></a></dt><dd>Show process status. This corresponds in concept, but not in appearance, to the <a class=Xr href=ps.1.html>ps(1)</a> utility. When debugging a crash dump or over firewire, it is not necessary to start <code class=Nm>gdb</code> to display the <a class=Xr href=ps.1.html>ps(1)</a> output: instead, use an appropriate variation of <div class="Bd Pp Bd-indent"><pre>
ps -M /var/crash/vmcore.0 -N kernel.debug
ps -M /dev/fwmem0.0 -N kernel.debug
    </pre></div></dd><dt><a class=permalink href=#y><code class=Ic id=y>y</code></a></dt><dd>Kludge for writing macros. When writing macros, it is convenient to paste them back into the <code class=Nm>gdb</code> window. Unfortunately, if the macro is already defined, <code class=Nm>gdb</code> insists on asking <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>Redefine foo?</code></div><p class=Pp>It will not give up until you answer ‘<code class=Li>y</code>’. This command is that answer. It does nothing else except to print a warning message to remind you to remove it again.</p></dd></dl></section></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>), <a class=Xr href=ps.1.html>ps(1)</a>, <a class=Xr href=ddb.4.html>ddb(4)</a>, <a class=Xr href=firewire.4.html>firewire(4)</a>, <a class=Xr href=dconschat.8.html>dconschat(8)</a>, <a class=Xr href=dmesg.8.html>dmesg(8)</a>, <a class=Xr href=fwcontrol.8.html>fwcontrol(8)</a>, <a class=Xr href=kldload.8.html>kldload(8)</a></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> This man page was written by <span class=An>Greg Lehey</span> &lt;<a class=Mt href=mailto:grog@FreeBSD.org>grog@FreeBSD.org</a>&gt;. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> The <a class=Xr href=gdb.1.html>gdb(1)</a> (<span class=Pa>ports/devel/gdb</span>) debugger was never designed to debug kernels, and it is not a very good match. Many problems exist. <p class=Pp>The <code class=Nm>gdb</code> implementation is very inefficient, and many operations are slow.</p><p class=Pp>Serial debugging is even slower, and race conditions can make it difficult to run the link at more than 9600 bps. Firewire connections do not have this problem.</p><p class=Pp>The debugging macros “just grew.” In general, the person who wrote them did so while looking for a specific problem, so they may not be general enough, and they may behave badly when used in ways for which they were not intended, even if those ways make sense.</p><p class=Pp>Many of these commands only work on the ia32 architecture.</p></section></div><table class=foot><tr><td class=foot-date>May 17, 2016</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>