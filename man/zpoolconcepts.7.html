<!DOCTYPE html>
<html><head><meta charset=utf-8><title>zpoolconcepts(7)</title><keywords content=man,zpoolconcepts></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>zpoolconcepts(7)</h1><table class=head><tr><td class=head-ltitle>ZPOOLCONCEPTS(7)</td><td class=head-vol>FreeBSD Miscellaneous Information Manual</td><td class=head-rtitle>ZPOOLCONCEPTS(7)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>zpoolconcepts</code> — <div class=Nd>overview of ZFS storage pools</div></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2><section class=Ss><h2 class=Ss id=Virtual_Devices_(vdevs)><a class=permalink href=#Virtual_Devices_(vdevs)>Virtual Devices (vdevs)</a></h2> A "virtual device" describes a single device or a collection of devices organized according to certain performance and fault characteristics. The following virtual devices are supported: <dl class=Bl-tag><dt><b class=Sy>disk</b></dt><dd>A block device, typically located under <span class=Pa>/dev</span>. ZFS can use individual slices or partitions, though the recommended mode of operation is to use whole disks. A disk can be specified by a full path, or it can be a shorthand name (the relative portion of the path under <span class=Pa>/dev</span>). A whole disk can be specified by omitting the slice or partition designation. For example, <span class=Pa>sda</span> is equivalent to <span class=Pa>/dev/sda</span>. When given a whole disk, ZFS automatically labels the disk, if necessary.</dd><dt><b class=Sy>file</b></dt><dd>A regular file. The use of files as a backing store is strongly discouraged. It is designed primarily for experimental purposes, as the fault tolerance of a file is only as good as the file system on which it resides. A file must be specified by a full path.</dd><dt><b class=Sy>mirror</b></dt><dd>A mirror of two or more devices. Data is replicated in an identical fashion across all components of a mirror. A mirror with <i class=Em>N</i><span class=No>disks of size</span><i class=Em>X</i><span class=No>can hold</span><i class=Em>X</i><span class=No>bytes and can withstand</span><i class=Em>N-1</i> devices failing without losing data.</dd><dt><b class=Sy>raidz</b>, <b class=Sy>raidz1</b>, <b class=Sy>raidz2</b>, <b class=Sy>raidz3</b></dt><dd>A variation on RAID-5 that allows for better distribution of parity and eliminates the RAID-5 “write hole” (in which data and parity become inconsistent after a power loss). Data and parity is striped across all disks within a raidz group. <p class=Pp>A raidz group can have single, double, or triple parity, meaning that the raidz group can sustain one, two, or three failures, respectively, without losing any data. The <b class=Sy>raidz1</b> vdev type specifies a single-parity raidz group; the <b class=Sy>raidz2</b> vdev type specifies a double-parity raidz group; and the <b class=Sy>raidz3</b> vdev type specifies a triple-parity raidz group. The <b class=Sy>raidz</b> vdev type is an alias for <b class=Sy>raidz1</b>.</p><p class=Pp>A raidz group with <i class=Em>N</i><span class=No>disks of size</span><i class=Em>X</i><span class=No>with</span><i class=Em>P</i><span class=No>parity disks can hold approximately</span><i class=Em>(N-P)*X</i><span class=No>bytes and can withstand</span><i class=Em>P</i><span class=No>devices failing without losing data.</span> The minimum number of devices in a raidz group is one more than the number of parity disks. The recommended number is between 3 and 9 to help increase performance.</p></dd><dt><b class=Sy>draid</b>, <b class=Sy>draid1</b>, <b class=Sy>draid2</b>, <b class=Sy>draid3</b></dt><dd>A variant of raidz that provides integrated distributed hot spares which allows for faster resilvering while retaining the benefits of raidz. A dRAID vdev is constructed from multiple internal raidz groups, each with <i class=Em>D</i><span class=No>data devices and</span><i class=Em>P</i><span class=No>parity devices.</span> These groups are distributed over all of the children in order to fully utilize the available disk performance. <p class=Pp>Unlike raidz, dRAID uses a fixed stripe width (padding as necessary with zeros) to allow fully sequential resilvering. This fixed stripe width significantly effects both usable capacity and IOPS. For example, with the default <i class=Em>D=8</i><span class=No>and</span><i class=Em>4 KiB</i><span class=No>disk sectors the minimum allocation size is</span><i class=Em>32 KiB</i>. If using compression, this relatively large allocation size can reduce the effective compression ratio. When using ZFS volumes and dRAID, the default of the <b class=Sy>volblocksize</b> property is increased to account for the allocation size. If a dRAID pool will hold a significant amount of small blocks, it is recommended to also add a mirrored <b class=Sy>special</b> vdev to store those blocks.</p><p class=Pp>In regards to I/O, performance is similar to raidz since for any read all <i class=Em>D</i><span class=No>data disks must be accessed.</span> Delivered random IOPS can be reasonably approximated as <b class=Sy>floor((N-S)/(D+P))*single_drive_IOPS</b>.</p><p class=Pp>Like raidz, a dRAID can have single-, double-, or triple-parity. The <b class=Sy>draid1</b>, <b class=Sy>draid2</b>, and <b class=Sy>draid3</b> types can be used to specify the parity level. The <b class=Sy>draid</b> vdev type is an alias for <b class=Sy>draid1</b>.</p><p class=Pp>A dRAID with <i class=Em>N</i><span class=No>disks of size</span><i class=Em>X</i>, <i class=Em>D</i><span class=No>data disks per redundancy group,</span><i class=Em>P</i><span class=No>parity level, and</span><i class=Em>S</i><span class=No>distributed hot spares can hold approximately</span><i class=Em>(N-S)*(D/(D+P))*X</i><span class=No>bytes and can withstand</span><i class=Em>P</i> devices failing without losing data.</p></dd><dt><b class=Sy>draid</b>[<var class=Ar>parity</var>][<b class=Sy>:</b><var class=Ar>data</var><b class=Sy>d</b>][<b class=Sy>:</b><var class=Ar>children</var><b class=Sy>c</b>][<b class=Sy>:</b><var class=Ar>spares</var><b class=Sy>s</b>]</dt><dd>A non-default dRAID configuration can be specified by appending one or more of the following optional arguments to the <b class=Sy>draid</b> keyword: <dl class="Bl-tag Bl-compact"><dt><var class=Ar>parity</var></dt><dd>The parity level (1-3).</dd><dt><var class=Ar>data</var></dt><dd>The number of data devices per redundancy group. In general, a smaller value of <i class=Em>D</i><span class=No>will increase IOPS, improve the compression ratio,</span> and speed up resilvering at the expense of total usable capacity. Defaults to <i class=Em>8</i>, <span class=No>unless</span><i class=Em>N-P-S</i><span class=No>is less than</span><i class=Em>8</i>.</dd><dt><var class=Ar>children</var></dt><dd>The expected number of children. Useful as a cross-check when listing a large number of devices. An error is returned when the provided number of children differs.</dd><dt><var class=Ar>spares</var></dt><dd>The number of distributed hot spares. Defaults to zero.</dd></dl></dd><dt><b class=Sy>spare</b></dt><dd>A pseudo-vdev which keeps track of available hot spares for a pool. For more information, see the <a class=Sx href=#Hot_Spares>Hot Spares</a> section.</dd><dt><b class=Sy>log</b></dt><dd>A separate intent log device. If more than one log device is specified, then writes are load-balanced between devices. Log devices can be mirrored. However, raidz vdev types are not supported for the intent log. For more information, see the <a class=Sx href=#Intent_Log>Intent Log</a> section.</dd><dt><b class=Sy>dedup</b></dt><dd>A device dedicated solely for deduplication tables. The redundancy of this device should match the redundancy of the other normal devices in the pool. If more than one dedup device is specified, then allocations are load-balanced between those devices.</dd><dt><b class=Sy>special</b></dt><dd>A device dedicated solely for allocating various kinds of internal metadata, and optionally small file blocks. The redundancy of this device should match the redundancy of the other normal devices in the pool. If more than one special device is specified, then allocations are load-balanced between those devices. <p class=Pp>For more information on special allocations, see the <a class=Sx href=#Special_Allocation_Class>Special Allocation Class</a> section.</p></dd><dt><b class=Sy>cache</b></dt><dd>A device used to cache storage pool data. A cache device cannot be configured as a mirror or raidz group. For more information, see the <a class=Sx href=#Cache_Devices>Cache Devices</a> section.</dd></dl><p class=Pp>Virtual devices cannot be nested, so a mirror or raidz virtual device can only contain files or disks. Mirrors of mirrors (or other combinations) are not allowed.</p><p class=Pp>A pool can have any number of virtual devices at the top of the configuration (known as “root vdevs”). Data is dynamically distributed across all top-level devices to balance data among devices. As new virtual devices are added, ZFS automatically places data on the newly available devices.</p><p class=Pp>Virtual devices are specified one at a time on the command line, separated by whitespace. Keywords like <b class=Sy>mirror</b><span class=No>and</span><b class=Sy>raidz</b> are used to distinguish where a group ends and another begins. For example, the following creates a pool with two root vdevs, each a mirror of two disks:</p><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>create</code><var class=Ar>mypool</var><b class=Sy>mirror</b><var class=Ar>sda sdb</var><b class=Sy>mirror</b><var class=Ar>sdc sdd</var></code></div></section><section class=Ss><h2 class=Ss id=Device_Failure_and_Recovery><a class=permalink href=#Device_Failure_and_Recovery>Device Failure and Recovery</a></h2> ZFS supports a rich set of mechanisms for handling device failure and data corruption. All metadata and data is checksummed, and ZFS automatically repairs bad data from a good copy when corruption is detected. <p class=Pp>In order to take advantage of these features, a pool must make use of some form of redundancy, using either mirrored or raidz groups. While ZFS supports running in a non-redundant configuration, where each root vdev is simply a disk or file, this is strongly discouraged. A single case of bit corruption can render some or all of your data unavailable.</p><p class=Pp>A pool's health status is described by one of three states: <b class=Sy>online</b>, <b class=Sy>degraded</b>, <span class=No>or</span><b class=Sy>faulted</b>. An online pool has all devices operating normally. A degraded pool is one in which one or more devices have failed, but the data is still available due to a redundant configuration. A faulted pool has corrupted metadata, or one or more faulted devices, and insufficient replicas to continue functioning.</p><p class=Pp>The health of the top-level vdev, such as a mirror or raidz device, is potentially impacted by the state of its associated vdevs, or component devices. A top-level vdev or component device is in one of the following states:</p><dl class=Bl-tag><dt><b class=Sy>DEGRADED</b></dt><dd>One or more top-level vdevs is in the degraded state because one or more component devices are offline. Sufficient replicas exist to continue functioning. <p class=Pp>One or more component devices is in the degraded or faulted state, but sufficient replicas exist to continue functioning. The underlying conditions are as follows:</p><ul class="Bl-bullet Bl-compact"><li>The number of checksum errors exceeds acceptable levels and the device is degraded as an indication that something may be wrong. ZFS continues to use the device as necessary.</li><li>The number of I/O errors exceeds acceptable levels. The device could not be marked as faulted because there are insufficient replicas to continue functioning.</li></ul></dd><dt><b class=Sy>FAULTED</b></dt><dd>One or more top-level vdevs is in the faulted state because one or more component devices are offline. Insufficient replicas exist to continue functioning. <p class=Pp>One or more component devices is in the faulted state, and insufficient replicas exist to continue functioning. The underlying conditions are as follows:</p><ul class="Bl-bullet Bl-compact"><li>The device could be opened, but the contents did not match expected values.</li><li>The number of I/O errors exceeds acceptable levels and the device is faulted to prevent further use of the device.</li></ul></dd><dt><b class=Sy>OFFLINE</b></dt><dd>The device was explicitly taken offline by the <code class=Nm>zpool</code><code class=Cm>offline</code> command.</dd><dt><b class=Sy>ONLINE</b></dt><dd>The device is online and functioning.</dd><dt><b class=Sy>REMOVED</b></dt><dd>The device was physically removed while the system was running. Device removal detection is hardware-dependent and may not be supported on all platforms.</dd><dt><b class=Sy>UNAVAIL</b></dt><dd>The device could not be opened. If a pool is imported when a device was unavailable, then the device will be identified by a unique identifier instead of its path since the path was never correct in the first place.</dd></dl><p class=Pp>Checksum errors represent events where a disk returned data that was expected to be correct, but was not. In other words, these are instances of silent data corruption. The checksum errors are reported in <code class=Nm>zpool</code><code class=Cm>status</code> and <code class=Nm>zpool</code><code class=Cm>events</code>. When a block is stored redundantly, a damaged block may be reconstructed (e.g. from raidz parity or a mirrored copy). In this case, ZFS reports the checksum error against the disks that contained damaged data. If a block is unable to be reconstructed (e.g. due to 3 disks being damaged in a raidz2 group), it is not possible to determine which disks were silently corrupted. In this case, checksum errors are reported for all disks on which the block is stored.</p><p class=Pp>If a device is removed and later re-attached to the system, ZFS attempts online the device automatically. Device attachment detection is hardware-dependent and might not be supported on all platforms.</p></section><section class=Ss><h2 class=Ss id=Hot_Spares><a class=permalink href=#Hot_Spares>Hot Spares</a></h2> ZFS allows devices to be associated with pools as “hot spares”. These devices are not actively used in the pool, but when an active device fails, it is automatically replaced by a hot spare. To create a pool with hot spares, specify a <b class=Sy>spare</b> vdev with any number of devices. For example, <div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>create</code><var class=Ar>pool</var><b class=Sy>mirror</b><var class=Ar>sda sdb</var><b class=Sy>spare</b><var class=Ar>sdc sdd</var></code></div><p class=Pp>Spares can be shared across multiple pools, and can be added with the <code class=Nm>zpool</code><code class=Cm>add</code> command and removed with the <code class=Nm>zpool</code><code class=Cm>remove</code> command. Once a spare replacement is initiated, a new <b class=Sy>spare</b> vdev is created within the configuration that will remain there until the original device is replaced. At this point, the hot spare becomes available again if another device fails.</p><p class=Pp>If a pool has a shared spare that is currently being used, the pool can not be exported since other pools may use this shared spare, which may lead to potential data corruption.</p><p class=Pp>Shared spares add some risk. If the pools are imported on different hosts, and both pools suffer a device failure at the same time, both could attempt to use the spare at the same time. This may not be detected, resulting in data corruption.</p><p class=Pp>An in-progress spare replacement can be cancelled by detaching the hot spare. If the original faulted device is detached, then the hot spare assumes its place in the configuration, and is removed from the spare list of all active pools.</p><p class=Pp>The <b class=Sy>draid</b> vdev type provides distributed hot spares. These hot spares are named after the dRAID vdev they're a part of (<b class=Sy>draid1</b>-<var class=Ar>2</var>-<var class=Ar>3</var><span class=No>specifies spare</span><var class=Ar>3</var><span class=No>of vdev</span><var class=Ar>2</var>, <span class=No>which is a single parity dRAID</span>) and may only be used by that dRAID vdev. Otherwise, they behave the same as normal hot spares.</p><p class=Pp>Spares cannot replace log devices.</p></section><section class=Ss><h2 class=Ss id=Intent_Log><a class=permalink href=#Intent_Log>Intent Log</a></h2> The ZFS Intent Log (ZIL) satisfies POSIX requirements for synchronous transactions. For instance, databases often require their transactions to be on stable storage devices when returning from a system call. NFS and other applications can also use <a class=Xr href=fsync.2.html>fsync(2)</a> to ensure data stability. By default, the intent log is allocated from blocks within the main pool. However, it might be possible to get better performance using separate intent log devices such as NVRAM or a dedicated disk. For example: <div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>create</code><var class=Ar>pool sda sdb</var><b class=Sy>log</b><var class=Ar>sdc</var></code></div><p class=Pp>Multiple log devices can also be specified, and they can be mirrored. See the <a class=Sx href=#EXAMPLES>EXAMPLES</a> section for an example of mirroring multiple log devices.</p><p class=Pp>Log devices can be added, replaced, attached, detached and removed. In addition, log devices are imported and exported as part of the pool that contains them. Mirrored devices can be removed by specifying the top-level mirror vdev.</p></section><section class=Ss><h2 class=Ss id=Cache_Devices><a class=permalink href=#Cache_Devices>Cache Devices</a></h2> Devices can be added to a storage pool as “cache devices”. These devices provide an additional layer of caching between main memory and disk. For read-heavy workloads, where the working set size is much larger than what can be cached in main memory, using cache devices allows much more of this working set to be served from low latency media. Using cache devices provides the greatest performance improvement for random read-workloads of mostly static content. <p class=Pp>To create a pool with cache devices, specify a <b class=Sy>cache</b> vdev with any number of devices. For example:</p><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>create</code><var class=Ar>pool sda sdb</var><b class=Sy>cache</b><var class=Ar>sdc sdd</var></code></div><p class=Pp>Cache devices cannot be mirrored or part of a raidz configuration. If a read error is encountered on a cache device, that read I/O is reissued to the original storage pool device, which might be part of a mirrored or raidz configuration.</p><p class=Pp>The content of the cache devices is persistent across reboots and restored asynchronously when importing the pool in L2ARC (persistent L2ARC). This can be disabled by setting <b class=Sy>l2arc_rebuild_enabled</b>=<b class=Sy>0</b>. For cache devices smaller than <i class=Em>1 GiB</i>, we do not write the metadata structures required for rebuilding the L2ARC in order not to waste space. This can be changed with <b class=Sy>l2arc_rebuild_blocks_min_l2size</b>. The cache device header (<i class=Em>512 B</i>) is updated even if no metadata structures are written. Setting <b class=Sy>l2arc_headroom</b>=<b class=Sy>0</b> will result in scanning the full-length ARC lists for cacheable content to be written in L2ARC (persistent ARC). If a cache device is added with <code class=Nm>zpool</code><code class=Cm>add</code> its label and header will be overwritten and its contents are not going to be restored in L2ARC, even if the device was previously part of the pool. If a cache device is onlined with <code class=Nm>zpool</code><code class=Cm>online</code> its contents will be restored in L2ARC. This is useful in case of memory pressure where the contents of the cache device are not fully restored in L2ARC. The user can off- and online the cache device when there is less memory pressure in order to fully restore its contents to L2ARC.</p></section><section class=Ss><h2 class=Ss id=Pool_checkpoint><a class=permalink href=#Pool_checkpoint>Pool checkpoint</a></h2> Before starting critical procedures that include destructive actions (like <code class=Nm>zfs</code><code class=Cm>destroy</code>), an administrator can checkpoint the pool's state and in the case of a mistake or failure, rewind the entire pool back to the checkpoint. Otherwise, the checkpoint can be discarded when the procedure has completed successfully. <p class=Pp>A pool checkpoint can be thought of as a pool-wide snapshot and should be used with care as it contains every part of the pool's state, from properties to vdev configuration. Thus, certain operations are not allowed while a pool has a checkpoint. Specifically, vdev removal/attach/detach, mirror splitting, and changing the pool's GUID. Adding a new vdev is supported, but in the case of a rewind it will have to be added again. Finally, users of this feature should keep in mind that scrubs in a pool that has a checkpoint do not repair checkpointed data.</p><p class=Pp>To create a checkpoint for a pool:</p><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>checkpoint</code><var class=Ar>pool</var></code></div><p class=Pp>To later rewind to its checkpointed state, you need to first export it and then rewind it during import:</p><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>export</code><var class=Ar>pool</var></code></div><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>import</code><code class=Fl>--rewind-to-checkpoint</code><var class=Ar>pool</var></code></div><p class=Pp>To discard the checkpoint from a pool:</p><div class="Bd Bd-indent"><code class=Li># <code class=Nm>zpool</code><code class=Cm>checkpoint</code><code class=Fl>-d</code><var class=Ar>pool</var></code></div><p class=Pp>Dataset reservations (controlled by the <b class=Sy>reservation</b><span class=No>and</span><b class=Sy>refreservation</b> properties) may be unenforceable while a checkpoint exists, because the checkpoint is allowed to consume the dataset's reservation. Finally, data that is part of the checkpoint but has been freed in the current state of the pool won't be scanned during a scrub.</p></section><section class=Ss><h2 class=Ss id=Special_Allocation_Class><a class=permalink href=#Special_Allocation_Class>Special Allocation Class</a></h2> Allocations in the special class are dedicated to specific block types. By default this includes all metadata, the indirect blocks of user data, and any deduplication tables. The class can also be provisioned to accept small file blocks. <p class=Pp>A pool must always have at least one normal (non-<b class=Sy>dedup</b>/-<b class=Sy>special</b>) vdev before other devices can be assigned to the special class. If the <b class=Sy>special</b> class becomes full, then allocations intended for it will spill back into the normal class.</p><p class=Pp>Deduplication tables can be excluded from the special class by unsetting the <b class=Sy>zfs_ddt_data_is_special</b> ZFS module parameter.</p><p class=Pp>Inclusion of small file blocks in the special class is opt-in. Each dataset can control the size of small file blocks allowed in the special class by setting the <b class=Sy>special_small_blocks</b> property to nonzero. See <a class=Xr href=zfsprops.7.html>zfsprops(7)</a> for more info on this property.</p></section></section></div><table class=foot><tr><td class=foot-date>June 2, 2021</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>