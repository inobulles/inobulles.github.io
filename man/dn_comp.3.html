<!DOCTYPE html>
<html><head><meta charset=utf-8><title>dn_comp(3)</title><keywords content=man,dn_comp></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>dn_comp(3)</h1><table class=head><tr><td class=head-ltitle>RESOLVER(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>RESOLVER(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>res_query</code>, <code class=Nm>res_search</code>, <code class=Nm>res_mkquery</code>, <code class=Nm>res_send</code>, <code class=Nm>res_init</code>, <code class=Nm>dn_comp</code>, <code class=Nm>dn_expand</code>, <code class=Nm>dn_skipname</code>, <code class=Nm>ns_get16</code>, <code class=Nm>ns_get32</code>, <code class=Nm>ns_put16</code>, <code class=Nm>ns_put32</code> — <div class=Nd>resolver routines</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>Standard C Library (libc, -lc)</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netinet/in.h.html>netinet/in.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/arpa/nameser.h.html>arpa/nameser.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/resolv.h.html>resolv.h</a>&gt;</code><p class=Pp><var class=Ft>int</var><br><code class=Fn>res_query</code>(<var class=Fa>const char *dname</var>, <var class=Fa>int class</var>, <var class=Fa>int type</var>, <var class=Fa>u_char *answer</var>, <var class=Fa>int anslen</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>res_search</code>(<var class=Fa>const char *dname</var>, <var class=Fa>int class</var>, <var class=Fa>int type</var>, <var class=Fa>u_char *answer</var>, <var class=Fa>int anslen</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>res_mkquery</code>(<var class=Fa>int op</var>, <var class=Fa>const char *dname</var>, <var class=Fa>int class</var>, <var class=Fa>int type</var>, <var class=Fa>const u_char *data</var>, <var class=Fa>int datalen</var>, <var class=Fa>const u_char *newrr_in</var>, <var class=Fa>u_char *buf</var>, <var class=Fa>int buflen</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>res_send</code>(<var class=Fa>const u_char *msg</var>, <var class=Fa>int msglen</var>, <var class=Fa>u_char *answer</var>, <var class=Fa>int anslen</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>res_init</code>(<var class=Fa style="white-space: nowrap;">void</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>dn_comp</code>(<var class=Fa>const char *exp_dn</var>, <var class=Fa>u_char *comp_dn</var>, <var class=Fa>int length</var>, <var class=Fa>u_char **dnptrs</var>, <var class=Fa>u_char **lastdnptr</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>dn_expand</code>(<var class=Fa>const u_char *msg</var>, <var class=Fa>const u_char *eomorig</var>, <var class=Fa>const u_char *comp_dn</var>, <var class=Fa>char *exp_dn</var>, <var class=Fa>int length</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>dn_skipname</code>(<var class=Fa style="white-space: nowrap;">const u_char *comp_dn</var>, <var class=Fa style="white-space: nowrap;">const u_char *eom</var>);</p><p class=Pp><var class=Ft>u_int</var><br><code class=Fn>ns_get16</code>(<var class=Fa style="white-space: nowrap;">const u_char *src</var>);</p><p class=Pp><var class=Ft>u_long</var><br><code class=Fn>ns_get32</code>(<var class=Fa style="white-space: nowrap;">const u_char *src</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ns_put16</code>(<var class=Fa style="white-space: nowrap;">u_int src</var>, <var class=Fa style="white-space: nowrap;">u_char *dst</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ns_put32</code>(<var class=Fa style="white-space: nowrap;">u_long src</var>, <var class=Fa style="white-space: nowrap;">u_char *dst</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> These routines are used for making, sending and interpreting query and reply messages with Internet domain name servers. <p class=Pp>Global configuration and state information that is used by the resolver routines is kept in the structure <var class=Va>_res</var>. Most of the values have reasonable defaults and can be ignored. Options stored in <var class=Va>_res.options</var> are defined in <code class=In>&lt;<a class=In href=../src/resolv.h.html>resolv.h</a>&gt;</code> and are as follows. Options are stored as a simple bit mask containing the bitwise ``or'' of the options enabled.</p><dl class=Bl-tag><dt><a class=permalink href=#RES_INIT><code class=Dv id=RES_INIT>RES_INIT</code></a></dt><dd>True if the initial name server address and default domain name are initialized (i.e., <code class=Fn>res_init</code>() has been called).</dd><dt><a class=permalink href=#RES_DEBUG><code class=Dv id=RES_DEBUG>RES_DEBUG</code></a></dt><dd>Print debugging messages.</dd><dt><a class=permalink href=#RES_AAONLY><code class=Dv id=RES_AAONLY>RES_AAONLY</code></a></dt><dd>Accept authoritative answers only. With this option, <code class=Fn>res_send</code>() should continue until it finds an authoritative answer or finds an error. Currently this is not implemented.</dd><dt><a class=permalink href=#RES_USEVC><code class=Dv id=RES_USEVC>RES_USEVC</code></a></dt><dd>Use TCP connections for queries instead of UDP datagrams.</dd><dt><a class=permalink href=#RES_STAYOPEN><code class=Dv id=RES_STAYOPEN>RES_STAYOPEN</code></a></dt><dd>Used with <code class=Dv>RES_USEVC</code> to keep the TCP connection open between queries. This is useful only in programs that regularly do many queries. UDP should be the normal mode used.</dd><dt><a class=permalink href=#RES_IGNTC><code class=Dv id=RES_IGNTC>RES_IGNTC</code></a></dt><dd>Unused currently (ignore truncation errors, i.e., do not retry with TCP).</dd><dt><a class=permalink href=#RES_RECURSE><code class=Dv id=RES_RECURSE>RES_RECURSE</code></a></dt><dd>Set the recursion-desired bit in queries. This is the default. (<code class=Fn>res_send</code>() does not do iterative queries and expects the name server to handle recursion.)</dd><dt><a class=permalink href=#RES_DEFNAMES><code class=Dv id=RES_DEFNAMES>RES_DEFNAMES</code></a></dt><dd>If set, <code class=Fn>res_search</code>() will append the default domain name to single-component names (those that do not contain a dot). This option is enabled by default.</dd><dt><a class=permalink href=#RES_DNSRCH><code class=Dv id=RES_DNSRCH>RES_DNSRCH</code></a></dt><dd>If this option is set, <code class=Fn>res_search</code>() will search for host names in the current domain and in parent domains; see <a class=Xr href=hostname.7.html>hostname(7)</a>. This is used by the standard host lookup routine <a class=Xr href=gethostbyname.3.html>gethostbyname(3)</a>. This option is enabled by default.</dd><dt><a class=permalink href=#RES_NOALIASES><code class=Dv id=RES_NOALIASES>RES_NOALIASES</code></a></dt><dd>This option turns off the user level aliasing feature controlled by the “<code class=Ev>HOSTALIASES</code>” environment variable. Network daemons should set this option.</dd><dt><a class=permalink href=#RES_USE_INET6><code class=Dv id=RES_USE_INET6>RES_USE_INET6</code></a></dt><dd>Enables support for IPv6-only applications. This causes IPv4 addresses to be returned as an IPv4 mapped address. For example, <code class=Li>10.1.1.1</code> will be returned as <code class=Li>::ffff:10.1.1.1</code>. The option is meaningful with certain kernel configuration only.</dd><dt><a class=permalink href=#RES_USE_EDNS0><code class=Dv id=RES_USE_EDNS0>RES_USE_EDNS0</code></a></dt><dd>Enables support for OPT pseudo-RR for EDNS0 extension. With the option, resolver code will attach OPT pseudo-RR into DNS queries, to inform of our receive buffer size. The option will allow DNS servers to take advantage of non-default receive buffer size, and to send larger replies. DNS query packets with EDNS0 extension is not compatible with non-EDNS0 DNS servers.</dd></dl><p class=Pp>The <code class=Fn>res_init</code>() routine reads the configuration file (if any; see <a class=Xr href=resolver.5.html>resolver(5)</a>) to get the default domain name, search list and the Internet address of the local name server(s). If no server is configured, the host running the resolver is tried. The current domain name is defined by the hostname if not specified in the configuration file; it can be overridden by the environment variable <code class=Ev>LOCALDOMAIN</code>. This environment variable may contain several blank-separated tokens if you wish to override the <i class=Em>search list</i> on a per-process basis. This is similar to the <code class=Ic>search</code> command in the configuration file. Another environment variable “<code class=Ev>RES_OPTIONS</code>” can be set to override certain internal resolver options which are otherwise set by changing fields in the <var class=Va>_res</var> structure or are inherited from the configuration file's <code class=Ic>options</code> command. The syntax of the “<code class=Ev>RES_OPTIONS</code>” environment variable is explained in <a class=Xr href=resolver.5.html>resolver(5)</a>. Initialization normally occurs on the first call to one of the following routines.</p><p class=Pp>The <code class=Fn>res_query</code>() function provides an interface to the server query mechanism. It constructs a query, sends it to the local server, awaits a response, and makes preliminary checks on the reply. The query requests information of the specified <var class=Fa>type</var> and <var class=Fa>class</var> for the specified fully-qualified domain name <var class=Fa>dname</var>. The reply message is left in the <var class=Fa>answer</var> buffer with length <var class=Fa>anslen</var> supplied by the caller.</p><p class=Pp>The <code class=Fn>res_search</code>() routine makes a query and awaits a response like <code class=Fn>res_query</code>(), but in addition, it implements the default and search rules controlled by the <code class=Dv>RES_DEFNAMES</code> and <code class=Dv>RES_DNSRCH</code> options. It returns the first successful reply.</p><p class=Pp>The remaining routines are lower-level routines used by <code class=Fn>res_query</code>(). The <code class=Fn>res_mkquery</code>() function constructs a standard query message and places it in <var class=Fa>buf</var>. It returns the size of the query, or -1 if the query is larger than <var class=Fa>buflen</var>. The query type <var class=Fa>op</var> is usually <code class=Dv>QUERY</code>, but can be any of the query types defined in <code class=In>&lt;<a class=In href=../src/arpa/nameser.h.html>arpa/nameser.h</a>&gt;</code>. The domain name for the query is given by <var class=Fa>dname</var>. The <var class=Fa>newrr_in</var> argument is currently unused but is intended for making update messages.</p><p class=Pp>The <code class=Fn>res_send</code>() routine sends a pre-formatted query and returns an answer. It will call <code class=Fn>res_init</code>() if <code class=Dv>RES_INIT</code> is not set, send the query to the local name server, and handle timeouts and retries. The length of the reply message is returned, or -1 if there were errors.</p><p class=Pp>The <code class=Fn>dn_comp</code>() function compresses the domain name <var class=Fa>exp_dn</var> and stores it in <var class=Fa>comp_dn</var>. The size of the compressed name is returned or -1 if there were errors. The size of the array pointed to by <var class=Fa>comp_dn</var> is given by <var class=Fa>length</var>. The compression uses an array of pointers <var class=Fa>dnptrs</var> to previously-compressed names in the current message. The first pointer points to the beginning of the message and the list ends with <code class=Dv>NULL</code>. The limit to the array is specified by <var class=Fa>lastdnptr</var>. A side effect of <code class=Fn>dn_comp</code>() is to update the list of pointers for labels inserted into the message as the name is compressed. If <var class=Fa>dnptr</var> is <code class=Dv>NULL</code>, names are not compressed. If <var class=Fa>lastdnptr</var> is <code class=Dv>NULL</code>, the list of labels is not updated.</p><p class=Pp>The <code class=Fn>dn_expand</code>() entry expands the compressed domain name <var class=Fa>comp_dn</var> to a full domain name The compressed name is contained in a query or reply message; <var class=Fa>msg</var> is a pointer to the beginning of the message. The uncompressed name is placed in the buffer indicated by <var class=Fa>exp_dn</var> which is of size <var class=Fa>length</var>. The size of compressed name is returned or -1 if there was an error.</p><p class=Pp>The <code class=Fn>dn_skipname</code>() function skips over a compressed domain name, which starts at a location pointed to by <var class=Fa>comp_dn</var>. The compressed name is contained in a query or reply message; <var class=Fa>eom</var> is a pointer to the end of the message. The size of compressed name is returned or -1 if there was an error.</p><p class=Pp>The <code class=Fn>ns_get16</code>() function gets a 16-bit quantity from a buffer pointed to by <var class=Fa>src</var>.</p><p class=Pp>The <code class=Fn>ns_get32</code>() function gets a 32-bit quantity from a buffer pointed to by <var class=Fa>src</var>.</p><p class=Pp>The <code class=Fn>ns_put16</code>() function puts a 16-bit quantity <var class=Fa>src</var> to a buffer pointed to by <var class=Fa>dst</var>.</p><p class=Pp>The <code class=Fn>ns_put32</code>() function puts a 32-bit quantity <var class=Fa>src</var> to a buffer pointed to by <var class=Fa>dst</var>.</p></section><section class=Sh><h2 class=Sh id=IMPLEMENTATION_NOTES><a class=permalink href=#IMPLEMENTATION_NOTES>IMPLEMENTATION NOTES</a></h2> This implementation of the resolver is thread-safe, but it will not function properly if the programmer attempts to declare his or her own <var class=Va>_res</var> structure in an attempt to replace the per-thread version referred to by that macro. <p class=Pp>The following compile-time option can be specified to change the default behavior of resolver routines when necessary.</p><dl class=Bl-tag><dt><a class=permalink href=#RES_ENFORCE_RFC1034><code class=Dv id=RES_ENFORCE_RFC1034>RES_ENFORCE_RFC1034</code></a></dt><dd>If this symbol is defined during compile-time, <code class=Fn>res_search</code>() will enforce RFC 1034 check, namely, disallow using of underscore character within host names. This is used by the standard host lookup routines like <a class=Xr href=gethostbyname.3.html>gethostbyname(3)</a>. For compatibility reasons this option is not enabled by default.</dd></dl></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2> The <code class=Fn>res_init</code>() function will return 0 on success, or -1 in a threaded program if per-thread storage could not be allocated. <p class=Pp>The <code class=Fn>res_mkquery</code>(), <code class=Fn>res_search</code>(), and <code class=Fn>res_query</code>() functions return the size of the response on success, or -1 if an error occurs. The integer <var class=Vt>h_errno</var> may be checked to determine the reason for error. See <a class=Xr href=gethostbyname.3.html>gethostbyname(3)</a> for more information.</p></section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class=Bl-tag><dt><span class=Pa>/etc/resolv.conf</span></dt><dd>The configuration file, see <a class=Xr href=resolver.5.html>resolver(5)</a>.</dd></dl></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=gethostbyname.3.html>gethostbyname(3)</a>, <a class=Xr href=resolver.5.html>resolver(5)</a>, <a class=Xr href=hostname.7.html>hostname(7)</a>, <a class=Xr href=named.8.html>named(8)</a><p class=Pp><span class=RsT>RFC1032,</span><span class=RsT>RFC1033,</span><span class=RsT>RFC1034,</span><span class=RsT>RFC1035,</span><span class=RsT>RFC974</span></p><p class=Pp><cite class=Rs><span class=RsT>Name Server Operations Guide for BIND</span>.</cite></p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>res_query</code> function appeared in <span class=Ux>4.3BSD</span>. </section></div><table class=foot><tr><td class=foot-date>May 29, 2009</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>