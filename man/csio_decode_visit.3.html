<!DOCTYPE html>
<html><head><meta charset=utf-8><title>csio_decode_visit(3)</title><keywords content=man,csio_decode_visit></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>csio_decode_visit(3)</h1><table class=head><tr><td class=head-ltitle>CAM_CDBPARSE(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>CAM_CDBPARSE(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>csio_build</code>, <code class=Nm>csio_build_visit</code>, <code class=Nm>csio_decode</code>, <code class=Nm>csio_decode_visit</code>, <code class=Nm>buff_decode</code>, <code class=Nm>buff_decode_visit</code>, <code class=Nm>csio_encode</code>, <code class=Nm>csio_encode_visit</code>, <code class=Nm>buff_encode_visit</code> — <div class=Nd>CAM user library SCSI buffer parsing routines</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>Common Access Method User Library (libcam, -lcam)</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/stdio.h.html>stdio.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/camlib.h.html>camlib.h</a>&gt;</code><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_build</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>uint8_t *data_ptr</var>, <var class=Fa>uint32_t dxfer_len</var>, <var class=Fa>uint32_t flags</var>, <var class=Fa>int retry_count</var>, <var class=Fa>int timeout</var>, <var class=Fa>const char *cmd_spec</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_build_visit</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>uint8_t *data_ptr</var>, <var class=Fa>uint32_t dxfer_len</var>, <var class=Fa>uint32_t flags</var>, <var class=Fa>int retry_count</var>, <var class=Fa>int timeout</var>, <var class=Fa>const char *cmd_spec</var>, <var class=Fa>int (*arg_get)(void *hook, char *field_name)</var>, <var class=Fa>void *gethook</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_decode</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_decode_visit</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>void (*arg_put)(void *hook</var>, <var class=Fa>int letter</var>, <var class=Fa>void *val</var>, <var class=Fa>int count</var>, <var class=Fa>char *name)</var>, <var class=Fa>void *puthook</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>buff_decode</code>(<var class=Fa>uint8_t *buff</var>, <var class=Fa>size_t len</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>buff_decode_visit</code>(<var class=Fa>uint8_t *buff</var>, <var class=Fa>size_t len</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>void (*arg_put)(void *, int, void *, int, char *)</var>, <var class=Fa>void *puthook</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_encode</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>csio_encode_visit</code>(<var class=Fa>struct ccb_scsiio *csio</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>int (*arg_get)(void *hook, char *field_name)</var>, <var class=Fa>void *gethook</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>buff_encode_visit</code>(<var class=Fa>uint8_t *buff</var>, <var class=Fa>size_t len</var>, <var class=Fa>const char *fmt</var>, <var class=Fa>int (*arg_get)(void *hook, char *field_name)</var>, <var class=Fa>void *gethook</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The CAM buffer/CDB encoding and decoding routines provide a relatively easy migration path for userland SCSI applications written with the similarly-named <var class=Va>scsireq_</var>* functions from the old <span class=Ux>FreeBSD</span> SCSI layer. <p class=Pp>These functions may be used in new applications, but users may find it easier to use the various SCSI CCB building functions included with the <a class=Xr href=cam.3.html>cam(3)</a> library, e.g., <code class=Fn>cam_fill_csio</code>(), <code class=Fn>scsi_start_stop</code>(), and <code class=Fn>scsi_read_write</code>().</p><p class=Pp><code class=Fn>csio_build</code>() builds up a <var class=Va>ccb_scsiio</var> structure based on the information provided in the variable argument list. It gracefully handles a NULL <var class=Fa>data_ptr</var> argument passed to it.</p><p class=Pp><var class=Fa>dxfer_len</var> is the length of the data phase; the data transfer direction is determined by the <var class=Fa>flags</var> argument.</p><p class=Pp><var class=Fa>data_ptr</var> is the data buffer used during the SCSI data phase. If no data is to be transferred for the SCSI command in question, this should be set to NULL. If there is data to transfer for the command, this buffer must be at least <var class=Fa>dxfer_len</var> long.</p><p class=Pp><var class=Fa>flags</var> are the flags defined in <code class=In>&lt;<a class=In href=../src/cam/cam_ccb.h.html>cam/cam_ccb.h</a>&gt;</code>:</p><div class="Bd Pp"><pre>
/* Common CCB header */
/* CAM CCB flags */
typedef enum {
     CAM_CDB_POINTER       = 0x00000001,/* The CDB field is a pointer    */
     CAM_QUEUE_ENABLE      = 0x00000002,/* SIM queue actions are enabled */
     CAM_CDB_LINKED        = 0x00000004,/* CCB contains a linked CDB     */
     CAM_SCATTER_VALID     = 0x00000010,/* Scatter/gather list is valid  */
     CAM_DIS_AUTOSENSE     = 0x00000020,/* Disable autosense feature     */
     CAM_DIR_RESV          = 0x00000000,/* Data direction (00:reserved)  */
     CAM_DIR_IN            = 0x00000040,/* Data direction (01:DATA IN)   */
     CAM_DIR_OUT           = 0x00000080,/* Data direction (10:DATA OUT)  */
     CAM_DIR_NONE          = 0x000000C0,/* Data direction (11:no data)   */
     CAM_DIR_MASK          = 0x000000C0,/* Data direction Mask		 */
     CAM_SOFT_RST_OP       = 0x00000100,/* Use Soft reset alternative    */
     CAM_ENG_SYNC          = 0x00000200,/* Flush resid bytes on complete */
     CAM_DEV_QFRZDIS       = 0x00000400,/* Disable DEV Q freezing	 */
     CAM_DEV_QFREEZE       = 0x00000800,/* Freeze DEV Q on execution     */
     CAM_HIGH_POWER        = 0x00001000,/* Command takes a lot of power  */
     CAM_SENSE_PTR         = 0x00002000,/* Sense data is a pointer	 */
     CAM_SENSE_PHYS        = 0x00004000,/* Sense pointer is physical addr*/
     CAM_TAG_ACTION_VALID  = 0x00008000,/* Use the tag action in this ccb*/
     CAM_PASS_ERR_RECOVER  = 0x00010000,/* Pass driver does err. recovery*/
     CAM_DIS_DISCONNECT    = 0x00020000,/* Disable disconnect		 */
     CAM_SG_LIST_PHYS      = 0x00040000,/* SG list has physical addrs.   */
     CAM_MSG_BUF_PHYS      = 0x00080000,/* Message buffer ptr is physical*/
     CAM_SNS_BUF_PHYS      = 0x00100000,/* Autosense data ptr is physical*/
     CAM_DATA_PHYS         = 0x00200000,/* SG/Buffer data ptrs are phys. */
     CAM_CDB_PHYS          = 0x00400000,/* CDB pointer is physical	 */
     CAM_ENG_SGLIST        = 0x00800000,/* SG list is for the HBA engine */

/* Phase cognizant mode flags */
     CAM_DIS_AUTOSRP       = 0x01000000,/* Disable autosave/restore ptrs */
     CAM_DIS_AUTODISC      = 0x02000000,/* Disable auto disconnect	 */
     CAM_TGT_CCB_AVAIL     = 0x04000000,/* Target CCB available		 */
     CAM_TGT_PHASE_MODE    = 0x08000000,/* The SIM runs in phase mode	 */
     CAM_MSGB_VALID        = 0x20000000,/* Message buffer valid		 */
     CAM_STATUS_VALID      = 0x40000000,/* Status buffer valid		 */
     CAM_DATAB_VALID       = 0x80000000,/* Data buffer valid		 */

/* Host target Mode flags */
     CAM_TERM_IO           = 0x20000000,/* Terminate I/O Message sup.    */
     CAM_DISCONNECT        = 0x40000000,/* Disconnects are mandatory     */
     CAM_SEND_STATUS       = 0x80000000,/* Send status after data phase  */
} ccb_flags;
</pre></div><p class=Pp>Multiple flags should be ORed together. Any of the CCB flags may be used, although it is worth noting several important ones here:</p><dl class=Bl-tag><dt><a class=permalink href=#CAM_DIR_IN><code class=Dv id=CAM_DIR_IN>CAM_DIR_IN</code></a></dt><dd>This indicates that the operation in question is a read operation. i.e., data is being read from the SCSI device to the user-supplied buffer.</dd><dt><a class=permalink href=#CAM_DIR_OUT><code class=Dv id=CAM_DIR_OUT>CAM_DIR_OUT</code></a></dt><dd>This indicates that the operation is a write operation. i.e., data is being written from the user-supplied buffer to the device.</dd><dt><a class=permalink href=#CAM_DIR_NONE><code class=Dv id=CAM_DIR_NONE>CAM_DIR_NONE</code></a></dt><dd>This indicates that there is no data to be transferred for this command.</dd><dt><a class=permalink href=#CAM_DEV_QFRZDIS><code class=Dv id=CAM_DEV_QFRZDIS>CAM_DEV_QFRZDIS</code></a></dt><dd>This flag disables device queue freezing as an error recovery mechanism.</dd><dt><a class=permalink href=#CAM_PASS_ERR_RECOVER><code class=Dv id=CAM_PASS_ERR_RECOVER>CAM_PASS_ERR_RECOVER</code></a></dt><dd>This flag tells the <a class=Xr href=pass.4.html>pass(4)</a> driver to enable error recovery. The default is to not perform error recovery, which means that the retry count will not be honored without this flag, among other things.</dd><dt><a class=permalink href=#CAM_DATA_PHYS><code class=Dv id=CAM_DATA_PHYS>CAM_DATA_PHYS</code></a></dt><dd>This indicates that the address contained in <var class=Fa>data_ptr</var> is a physical address, not a virtual address.</dd></dl><p class=Pp>The <var class=Fa>retry_count</var> tells the kernel how many times to retry the command in question. The retry count is ignored unless the <a class=Xr href=pass.4.html>pass(4)</a> driver is told to enable error recovery via the <code class=Dv>CAM_PASS_ERR_RECOVER</code> flag.</p><p class=Pp>The <var class=Fa>timeout</var> tells the kernel how long to wait for the given command to complete. If the timeout expires and the command has not completed, the CCB will be returned from the kernel with an appropriate error status.</p><p class=Pp><var class=Fa>cmd_spec</var> is a CDB format specifier used to build up the SCSI CDB. This text string is made up of a list of field specifiers. Field specifiers specify the value for each CDB field (including indicating that the value be taken from the next argument in the variable argument list), the width of the field in bits or bytes, and an optional name. White space is ignored, and the pound sign ('#') introduces a comment that ends at the end of the current line.</p><p class=Pp>The optional name is the first part of a field specifier and is in curly braces. The text in curly braces in this example are the names:</p><div class="Bd Bd-indent"><code class=Li>{PS} v:b1 {Reserved} 0:b1 {Page Code} v:b6 # Mode select page</code></div><p class=Pp>This field specifier has two one bit fields and one six bit field. The second one bit field is the constant value 0 and the first one bit field and the six bit field are taken from the variable argument list. Multi byte fields are swapped into the SCSI byte order in the CDB and white space is ignored.</p><p class=Pp>When the field is a hex value or the letter v, (e.g., <var class=Fa>1A</var> or <var class=Fa>v</var>) then a single byte value is copied to the next unused byte of the CDB. When the letter <var class=Fa>v</var> is used the next integer argument is taken from the variable argument list and that value used.</p><p class=Pp>A constant hex value followed by a field width specifier or the letter <var class=Fa>v</var> followed by a field width specifier (e.g., <var class=Fa>3:4</var>, <var class=Fa>3:b4</var>, <var class=Fa>3:i3</var>, <var class=Fa>v:i3</var>) specifies a field of a given bit or byte width. Either the constant value or (for the V specifier) the next integer value from the variable argument list is copied to the next unused bits or bytes of the CDB.</p><p class=Pp>A decimal number or the letter <var class=Fa>b</var> followed by a decimal number field width indicates a bit field of that width. The bit fields are packed as tightly as possible beginning with the high bit (so that it reads the same as the SCSI spec), and a new byte of the CDB is started whenever a byte fills completely or when an <var class=Fa>i</var> field is encountered.</p><p class=Pp>A field width specifier consisting of the letter <var class=Fa>i</var> followed by either 1, 2, 3 or 4 indicates a 1, 2, 3 or 4 byte integral value that must be swapped into SCSI byte order (MSB first).</p><p class=Pp>For the <var class=Fa>v</var> field specifier the next integer argument is taken from the variable argument list and that value is used swapped into SCSI byte order.</p><p class=Pp><code class=Fn>csio_build_visit</code>() operates similarly to <code class=Fn>csio_build</code>(), except that the values to substitute for variable arguments in <var class=Fa>cmd_spec</var> are retrieved via the <code class=Fn>arg_get</code>() function passed in to <code class=Fn>csio_build_visit</code>() instead of via <a class=Xr href=stdarg.3.html>stdarg(3)</a>. The <code class=Fn>arg_get</code>() function takes two arguments:</p><dl class=Bl-tag><dt><var class=Fa>gethook</var></dt><dd>is passed into the <code class=Fn>arg_get</code>() function at each invocation. This enables the <code class=Fn>arg_get</code>() function to keep some state in between calls without using global or static variables.</dd><dt><var class=Fa>field_name</var></dt><dd>is the field name supplied in <var class=Fa>fmt</var>, if any.</dd></dl><p class=Pp><code class=Fn>csio_decode</code>() is used to decode information from the data in phase of the SCSI transfer.</p><p class=Pp>The decoding is similar to the command specifier processing of <code class=Fn>csio_build</code>() except that the data is extracted from the data pointed to by <var class=Fa>csio-&gt;data_ptr</var>. The stdarg list should be pointers to integers instead of integer values. A seek field type and a suppression modifier are added. The <var class=Fa>*</var> suppression modifier (e.g., <var class=Fa>*i3</var> or <var class=Fa>*b4</var>) suppresses assignment from the field and can be used to skip over bytes or bits in the data, without having to copy them to a dummy variable in the arg list.</p><p class=Pp>The seek field type <var class=Fa>s</var> permits you to skip over data. This seeks to an absolute position (<var class=Fa>s3</var>) or a relative position (<var class=Fa>s+3</var>) in the data, based on whether or not the presence of the '+' sign. The seek value can be specified as <var class=Fa>v</var> and the next integer value from the argument list will be used as the seek value.</p><p class=Pp><code class=Fn>csio_decode_visit</code>() operates like <code class=Fn>csio_decode</code>() except that instead of placing the decoded contents of the buffer in variadic arguments, the decoded buffer contents are returned to the user via the <code class=Fn>arg_put</code>() function that is passed in. The <code class=Fn>arg_put</code>() function takes several arguments:</p><dl class=Bl-tag><dt><var class=Fa>hook</var></dt><dd>The "hook" is a mechanism to allow the <code class=Fn>arg_put</code>() function to save state in between calls.</dd><dt><var class=Fa>letter</var></dt><dd>is the letter describing the format of the argument being passed into the function.</dd><dt><var class=Fa>val</var></dt><dd>is a void pointer to the value being passed into the function.</dd><dt><var class=Fa>count</var></dt><dd>is the size of the value being passed into the <code class=Fn>arg_put</code>() function. The argument format determines the unit of measure.</dd><dt><var class=Fa>name</var></dt><dd>This is a text description of the field, if one was provided in the <var class=Fa>fmt</var>.</dd></dl><p class=Pp><code class=Fn>buff_decode</code>() decodes an arbitrary data buffer using the method described above for <code class=Fn>csio_decode</code>().</p><p class=Pp><code class=Fn>buff_decode_visit</code>() decodes an arbitrary data buffer using the method described above for <code class=Fn>csio_decode_visit</code>().</p><p class=Pp><code class=Fn>csio_encode</code>() encodes the <var class=Fa>data_ptr</var> portion (not the CDB!) of a <var class=Va>ccb_scsiio</var> structure, using the method described above for <code class=Fn>csio_build</code>().</p><p class=Pp><code class=Fn>csio_encode_visit</code>() encodes the <var class=Fa>data_ptr</var> portion (not the CDB!) of a <var class=Va>ccb_scsiio</var> structure, using the method described above for <code class=Fn>csio_build_visit</code>().</p><p class=Pp><code class=Fn>buff_encode_visit</code>() encodes an arbitrary data pointer, using the method described above for <code class=Fn>csio_build_visit</code>().</p></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2><code class=Fn>csio_build</code>(), <code class=Fn>csio_build_visit</code>(), <code class=Fn>csio_encode</code>(), <code class=Fn>csio_encode_visit</code>(), and <code class=Fn>buff_encode_visit</code>() return the number of fields processed. <p class=Pp><code class=Fn>csio_decode</code>(), <code class=Fn>csio_decode_visit</code>(), <code class=Fn>buff_decode</code>(), and <code class=Fn>buff_decode_visit</code>() return the number of assignments performed.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=cam.3.html>cam(3)</a>, <a class=Xr href=pass.4.html>pass(4)</a>, <a class=Xr href=camcontrol.8.html>camcontrol(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The CAM versions of these functions are based upon similar functions implemented for the old <span class=Ux>FreeBSD</span> SCSI layer. The encoding/decoding functions in the old SCSI code were written by <span class=An>Peter Dufault</span> &lt;<a class=Mt href=mailto:dufault@hda.com>dufault@hda.com</a>&gt;. <p class=Pp>Many systems have comparable interfaces to permit a user to construct a SCSI command in user space.</p><p class=Pp>The old <var class=Va>scsireq</var> data structure was almost identical to the SGI /dev/scsi data structure. If anyone knows the name of the authors it should go here; Peter Dufault first read about it in a 1989 Sun Expert magazine.</p><p class=Pp>The new CCB data structures are derived from the CAM-2 and CAM-3 specifications.</p><p class=Pp><span class=An>Peter Dufault</span> implemented a clone of SGI's interface in <span class=Ux>386BSD</span> that led to the original <span class=Ux>FreeBSD</span> SCSI library and the related kernel ioctl. If anyone needs that for compatibility, contact <a class=Mt href=mailto:dufault@hda.com>dufault@hda.com</a>.</p></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Kenneth Merry</span> &lt;<a class=Mt href=mailto:ken@FreeBSD.org>ken@FreeBSD.org</a>&gt; implemented the CAM versions of these encoding and decoding functions. This current work is based upon earlier work by <span class=An>Peter Dufault</span> &lt;<a class=Mt href=mailto:dufault@hda.com>dufault@hda.com</a>&gt;. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> There should probably be a function that encodes both the CDB and the data buffer portions of a SCSI CCB. I discovered this while implementing the arbitrary command execution code in <a class=Xr href=camcontrol.8.html>camcontrol(8)</a>, but I have not yet had time to implement such a function. <p class=Pp>Some of the CCB flag descriptions really do not belong here. Rather they belong in a generic CCB man page. Since that man page has not yet been written, the shorter descriptions here will have to suffice.</p></section></div><table class=foot><tr><td class=foot-date>March 13, 2017</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>