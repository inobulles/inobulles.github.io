<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ntp-keygen(8)</title><keywords content=man,ntp-keygen></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ntp-keygen(8)</h1><table class=head><tr><td class=head-ltitle>NTP_KEYGEN(8)</td><td class=head-vol>FreeBSD System Manager's Manual (user)</td><td class=head-rtitle>NTP_KEYGEN(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ntp-keygen</code> — <div class=Nd>Create a NTP host key</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>ntp-keygen</code></td><td>[<code class=Fl>-flags</code>] [<code class=Fl>-flag</code> [<var class=Ar>value</var>]] [<code class=Fl>--option-name</code>[[=| ]<var class=Ar>value</var>]] <p class=Pp>All arguments must be options.</p></td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> This program generates cryptographic data files used by the NTPv4 authentication and identification schemes. It can generate message digest keys used in symmetric key cryptography and, if the OpenSSL software library has been installed, it can generate host keys, signing keys, certificates, and identity keys and parameters used in Autokey public key cryptography. These files are used for cookie encryption, digital signature, and challenge/response identification algorithms compatible with the Internet standard security infrastructure. <p class=Pp>The message digest symmetric keys file is generated in a format compatible with NTPv3. All other files are in PEM-encoded printable ASCII format, so they can be embedded as MIME attachments in email to other sites and certificate authorities. By default, files are not encrypted.</p><p class=Pp>When used to generate message digest symmetric keys, the program produces a file containing ten pseudo-random printable ASCII strings suitable for the MD5 message digest algorithm included in the distribution. If the OpenSSL library is installed, it produces an additional ten hex-encoded random bit strings suitable for SHA1, AES-128-CMAC, and other message digest algorithms. The message digest symmetric keys file must be distributed and stored using secure means beyond the scope of NTP itself. Besides the keys used for ordinary NTP associations, additional keys can be defined as passwords for the <a class=Xr href=ntpq.8.html>ntpq(8)</a> and <a class=Xr href=ntpdc.8.html>ntpdc(8)</a> utility programs.</p><p class=Pp>The remaining generated files are compatible with other OpenSSL applications and other Public Key Infrastructure (PKI) resources. Certificates generated by this program are compatible with extant industry practice, although some users might find the interpretation of X509v3 extension fields somewhat liberal. However, the identity keys are probably not compatible with anything other than Autokey.</p><p class=Pp>Some files used by this program are encrypted using a private password. The <code class=Fl>-p</code> option specifies the read password for local encrypted files and the <code class=Fl>-q</code> option the write password for encrypted files sent to remote sites. If no password is specified, the host name returned by the Unix <a class=Xr href=hostname.1.html>hostname(1)</a> command, normally the DNS name of the host, is used as the the default read password, for convenience. The <code class=Nm>ntp-keygen</code> program prompts for the password if it reads an encrypted file and the password is missing or incorrect. If an encrypted file is read successfully and no write password is specified, the read password is used as the write password by default.</p><p class=Pp>The <code class=Cm>pw</code> option of the <code class=Ic>crypto</code><a class=Xr href=ntpd.8.html>ntpd(8)</a> configuration command specifies the read password for previously encrypted local files. This must match the local read password used by this program. If not specified, the host name is used. Thus, if files are generated by this program without an explicit password, they can be read back by <a class=Xr href=ntpd.8.html>ntpd(8)</a> without specifying an explicit password but only on the same host. If the write password used for encryption is specified as the host name, these files can be read by that host with no explicit password.</p><p class=Pp>Normally, encrypted files for each host are generated by that host and used only by that host, although exceptions exist as noted later on this page. The symmetric keys file, normally called <span class=Pa>ntp.keys</span>, is usually installed in <span class=Pa>/etc</span>. Other files and links are usually installed in <span class=Pa>/usr/local/etc</span>, which is normally in a shared filesystem in NFS-mounted networks and cannot be changed by shared clients. In these cases, NFS clients can specify the files in another directory such as <span class=Pa>/etc</span> using the <code class=Ic>keysdir</code><a class=Xr href=ntpd.8.html>ntpd(8)</a> configuration file command.</p><p class=Pp>This program directs commentary and error messages to the standard error stream <span class=Pa>stderr</span> and remote files to the standard output stream <span class=Pa>stdout</span> where they can be piped to other applications or redirected to files. The names used for generated files and links all begin with the string <span class=Pa>ntpkey*</span> and include the file type, generating host and filestamp, as described in the <a class=Sx href=#Cryptographic_Data_Files>Cryptographic Data Files</a> section below.</p><section class=Ss><h2 class=Ss id=Running_the_Program><a class=permalink href=#Running_the_Program>Running the Program</a></h2> The safest way to run the <code class=Nm>ntp-keygen</code> program is logged in directly as root. The recommended procedure is change to the <var class=Ar>keys</var> directory, usually <span class=Pa>/usr/local/etc</span>, then run the program. <p class=Pp>To test and gain experience with Autokey concepts, log in as root and change to the <var class=Ar>keys</var> directory, usually <span class=Pa>/usr/local/etc</span>. When run for the first time, or if all files with names beginning with <span class=Pa>ntpkey*</span> have been removed, use the <code class=Nm>ntp-keygen</code> command without arguments to generate a default <code class=Cm>RSA</code> host key and matching <code class=Cm>RSA-MD5</code> certificate file with expiration date one year hence, which is all that is necessary in many cases. The program also generates soft links from the generic names to the respective files. If run again without options, the program uses the existing keys and parameters and generates a new certificate file with new expiration date one year hence, and soft link.</p><p class=Pp>The host key is used to encrypt the cookie when required and so must be <code class=Cm>RSA</code> type. By default, the host key is also the sign key used to encrypt signatures. When necessary, a different sign key can be specified and this can be either <code class=Cm>RSA</code> or <code class=Cm>DSA</code> type. By default, the message digest type is <code class=Cm>MD5</code>, but any combination of sign key type and message digest type supported by the OpenSSL library can be specified, including those using the <code class=Cm>AES128CMAC</code>, <code class=Cm>MD2</code>, <code class=Cm>MD5</code>, <code class=Cm>MDC2</code>, <code class=Cm>SHA</code>, <code class=Cm>SHA1</code> and <code class=Cm>RIPE160</code> message digest algorithms. However, the scheme specified in the certificate must be compatible with the sign key. Certificates using any digest algorithm are compatible with <code class=Cm>RSA</code> sign keys; however, only <code class=Cm>SHA</code> and <code class=Cm>SHA1</code> certificates are compatible with <code class=Cm>DSA</code> sign keys.</p><p class=Pp>Private/public key files and certificates are compatible with other OpenSSL applications and very likely other libraries as well. Certificates or certificate requests derived from them should be compatible with extant industry practice, although some users might find the interpretation of X509v3 extension fields somewhat liberal. However, the identification parameter files, although encoded as the other files, are probably not compatible with anything other than Autokey.</p><p class=Pp>Running the program as other than root and using the Unix <a class=Xr href=su.1.html>su(1)</a> command to assume root may not work properly, since by default the OpenSSL library looks for the random seed file <span class=Pa>.rnd</span> in the user home directory. However, there should be only one <span class=Pa>.rnd</span>, most conveniently in the root directory, so it is convenient to define the <code class=Ev>RANDFILE</code> environment variable used by the OpenSSL library as the path to <span class=Pa>.rnd</span>.</p><p class=Pp>Installing the keys as root might not work in NFS-mounted shared file systems, as NFS clients may not be able to write to the shared keys directory, even as root. In this case, NFS clients can specify the files in another directory such as <span class=Pa>/etc</span> using the <code class=Ic>keysdir</code><a class=Xr href=ntpd.8.html>ntpd(8)</a> configuration file command. There is no need for one client to read the keys and certificates of other clients or servers, as these data are obtained automatically by the Autokey protocol.</p><p class=Pp>Ordinarily, cryptographic files are generated by the host that uses them, but it is possible for a trusted agent (TA) to generate these files for other hosts; however, in such cases files should always be encrypted. The subject name and trusted name default to the hostname of the host generating the files, but can be changed by command line options. It is convenient to designate the owner name and trusted name as the subject and issuer fields, respectively, of the certificate. The owner name is also used for the host and sign key files, while the trusted name is used for the identity files.</p><p class=Pp>All files are installed by default in the keys directory <span class=Pa>/usr/local/etc</span>, which is normally in a shared filesystem in NFS-mounted networks. The actual location of the keys directory and each file can be overridden by configuration commands, but this is not recommended. Normally, the files for each host are generated by that host and used only by that host, although exceptions exist as noted later on this page.</p><p class=Pp>Normally, files containing private values, including the host key, sign key and identification parameters, are permitted root read/write-only; while others containing public values are permitted world readable. Alternatively, files containing private values can be encrypted and these files permitted world readable, which simplifies maintenance in shared file systems. Since uniqueness is insured by the <var class=Ar>hostname</var> and <var class=Ar>filestamp</var> file name extensions, the files for an NTP server and dependent clients can all be installed in the same shared directory.</p><p class=Pp>The recommended practice is to keep the file name extensions when installing a file and to install a soft link from the generic names specified elsewhere on this page to the generated files. This allows new file generations to be activated simply by changing the link. If a link is present, <a class=Xr href=ntpd.8.html>ntpd(8)</a> follows it to the file name to extract the <var class=Ar>filestamp</var>. If a link is not present, <a class=Xr href=ntpd.8.html>ntpd(8)</a> extracts the <var class=Ar>filestamp</var> from the file itself. This allows clients to verify that the file and generation times are always current. The <code class=Nm>ntp-keygen</code> program uses the same <var class=Ar>filestamp</var> extension for all files generated at one time, so each generation is distinct and can be readily recognized in monitoring data.</p><p class=Pp>Run the command on as many hosts as necessary. Designate one of them as the trusted host (TH) using <code class=Nm>ntp-keygen</code> with the <code class=Fl>-T</code> option and configure it to synchronize from reliable Internet servers. Then configure the other hosts to synchronize to the TH directly or indirectly. A certificate trail is created when Autokey asks the immediately ascendant host towards the TH to sign its certificate, which is then provided to the immediately descendant host on request. All group hosts should have acyclic certificate trails ending on the TH.</p><p class=Pp>The host key is used to encrypt the cookie when required and so must be RSA type. By default, the host key is also the sign key used to encrypt signatures. A different sign key can be assigned using the <code class=Fl>-S</code> option and this can be either <code class=Cm>RSA</code> or <code class=Cm>DSA</code> type. By default, the signature message digest type is <code class=Cm>MD5</code>, but any combination of sign key type and message digest type supported by the OpenSSL library can be specified using the <code class=Fl>-c</code> option.</p><p class=Pp>The rules say cryptographic media should be generated with proventic filestamps, which means the host should already be synchronized before this program is run. This of course creates a chicken-and-egg problem when the host is started for the first time. Accordingly, the host time should be set by some other means, such as eyeball-and-wristwatch, at least so that the certificate lifetime is within the current year. After that and when the host is synchronized to a proventic source, the certificate should be re-generated.</p><p class=Pp>Additional information on trusted groups and identity schemes is on the “Autokey Public-Key Authentication” page.</p><p class=Pp>File names begin with the prefix <span class=Pa>ntpkey</span>_ and end with the suffix <span class=Pa>_</span><var class=Ar>hostname</var>. <var class=Ar>filestamp</var>, where <var class=Ar>hostname</var> is the owner name, usually the string returned by the Unix <a class=Xr href=hostname.1.html>hostname(1)</a> command, and <var class=Ar>filestamp</var> is the NTP seconds when the file was generated, in decimal digits. This both guarantees uniqueness and simplifies maintenance procedures, since all files can be quickly removed by a <code class=Ic>rm</code><span class=Pa>ntpkey*</span> command or all files generated at a specific time can be removed by a <code class=Ic>rm</code><span class=Pa>*</span><var class=Ar>filestamp</var> command. To further reduce the risk of misconfiguration, the first two lines of a file contain the file name and generation date and time as comments.</p></section><section class=Ss><h2 class=Ss id=Trusted_Hosts_and_Groups><a class=permalink href=#Trusted_Hosts_and_Groups>Trusted Hosts and Groups</a></h2> Each cryptographic configuration involves selection of a signature scheme and identification scheme, called a cryptotype, as explained in the <a class=Sx href=#Authentication_Options>Authentication Options</a> section of <a class=Xr href=ntp.conf.5.html>ntp.conf(5)</a>. The default cryptotype uses <code class=Cm>RSA</code> encryption, <code class=Cm>MD5</code> message digest and <code class=Cm>TC</code> identification. First, configure a NTP subnet including one or more low-stratum trusted hosts from which all other hosts derive synchronization directly or indirectly. Trusted hosts have trusted certificates; all other hosts have nontrusted certificates. These hosts will automatically and dynamically build authoritative certificate trails to one or more trusted hosts. A trusted group is the set of all hosts that have, directly or indirectly, a certificate trail ending at a trusted host. The trail is defined by static configuration file entries or dynamic means described on the <a class=Sx href=#Automatic_NTP_Configuration_Options>Automatic NTP Configuration Options</a> section of <a class=Xr href=ntp.conf.5.html>ntp.conf(5)</a>. <p class=Pp>On each trusted host as root, change to the keys directory. To insure a fresh fileset, remove all <span class=Pa>ntpkey</span> files. Then run <code class=Nm>ntp-keygen</code><code class=Fl>-T</code> to generate keys and a trusted certificate. On all other hosts do the same, but leave off the <code class=Fl>-T</code> flag to generate keys and nontrusted certificates. When complete, start the NTP daemons beginning at the lowest stratum and working up the tree. It may take some time for Autokey to instantiate the certificate trails throughout the subnet, but setting up the environment is completely automatic.</p><p class=Pp>If it is necessary to use a different sign key or different digest/signature scheme than the default, run <code class=Nm>ntp-keygen</code> with the <code class=Fl>-S</code><var class=Ar>type</var> option, where <var class=Ar>type</var> is either <code class=Cm>RSA</code> or <code class=Cm>DSA</code>. The most frequent need to do this is when a <code class=Cm>DSA</code>-signed certificate is used. If it is necessary to use a different certificate scheme than the default, run <code class=Nm>ntp-keygen</code> with the <code class=Fl>-c</code><var class=Ar>scheme</var> option and selected <var class=Ar>scheme</var> as needed. If <code class=Nm>ntp-keygen</code> is run again without these options, it generates a new certificate using the same scheme and sign key, and soft link.</p><p class=Pp>After setting up the environment it is advisable to update certificates from time to time, if only to extend the validity interval. Simply run <code class=Nm>ntp-keygen</code> with the same flags as before to generate new certificates using existing keys, and soft links. However, if the host or sign key is changed, <a class=Xr href=ntpd.8.html>ntpd(8)</a> should be restarted. When <a class=Xr href=ntpd.8.html>ntpd(8)</a> is restarted, it loads any new files and restarts the protocol. Other dependent hosts will continue as usual until signatures are refreshed, at which time the protocol is restarted.</p></section><section class=Ss><h2 class=Ss id=Identity_Schemes><a class=permalink href=#Identity_Schemes>Identity Schemes</a></h2> As mentioned on the Autonomous Authentication page, the default <code class=Cm>TC</code> identity scheme is vulnerable to a middleman attack. However, there are more secure identity schemes available, including <code class=Cm>PC</code>, <code class=Cm>IFF</code>, <code class=Cm>GQ</code> and <code class=Cm>MV</code> schemes described below. These schemes are based on a TA, one or more trusted hosts and some number of nontrusted hosts. Trusted hosts prove identity using values provided by the TA, while the remaining hosts prove identity using values provided by a trusted host and certificate trails that end on that host. The name of a trusted host is also the name of its sugroup and also the subject and issuer name on its trusted certificate. The TA is not necessarily a trusted host in this sense, but often is. <p class=Pp>In some schemes there are separate keys for servers and clients. A server can also be a client of another server, but a client can never be a server for another client. In general, trusted hosts and nontrusted hosts that operate as both server and client have parameter files that contain both server and client keys. Hosts that operate only as clients have key files that contain only client keys.</p><p class=Pp>The PC scheme supports only one trusted host in the group. On trusted host alice run <code class=Nm>ntp-keygen</code><code class=Fl>-P</code><code class=Fl>-p</code><var class=Ar>password</var> to generate the host key file <span class=Pa>ntpkey</span>_ <code class=Cm>RSA</code><span class=Pa>key_alice.</span><var class=Ar>filestamp</var> and trusted private certificate file <span class=Pa>ntpkey</span>_ <code class=Cm>RSA-MD5 _</code><span class=Pa>cert_alice.</span><var class=Ar>filestamp</var>, and soft links. Copy both files to all group hosts; they replace the files which would be generated in other schemes. On each host <var class=Ar>bob</var> install a soft link from the generic name <span class=Pa>ntpkey_host_</span><var class=Ar>bob</var> to the host key file and soft link <span class=Pa>ntpkey_cert_</span><var class=Ar>bob</var> to the private certificate file. Note the generic links are on bob, but point to files generated by trusted host alice. In this scheme it is not possible to refresh either the keys or certificates without copying them to all other hosts in the group, and recreating the soft links.</p><p class=Pp>For the <code class=Cm>IFF</code> scheme proceed as in the <code class=Cm>TC</code> scheme to generate keys and certificates for all group hosts, then for every trusted host in the group, generate the <code class=Cm>IFF</code> parameter file. On trusted host alice run <code class=Nm>ntp-keygen</code><code class=Fl>-T</code><code class=Fl>-I</code><code class=Fl>-p</code><var class=Ar>password</var> to produce her parameter file <span class=Pa>ntpkey_IFFpar_alice.</span><var class=Ar>filestamp</var>, which includes both server and client keys. Copy this file to all group hosts that operate as both servers and clients and install a soft link from the generic <span class=Pa>ntpkey_iff_alice</span> to this file. If there are no hosts restricted to operate only as clients, there is nothing further to do. As the <code class=Cm>IFF</code> scheme is independent of keys and certificates, these files can be refreshed as needed.</p><p class=Pp>If a rogue client has the parameter file, it could masquerade as a legitimate server and present a middleman threat. To eliminate this threat, the client keys can be extracted from the parameter file and distributed to all restricted clients. After generating the parameter file, on alice run <code class=Nm>ntp-keygen</code><code class=Fl>-e</code> and pipe the output to a file or email program. Copy or email this file to all restricted clients. On these clients install a soft link from the generic <span class=Pa>ntpkey_iff_alice</span> to this file. To further protect the integrity of the keys, each file can be encrypted with a secret password.</p><p class=Pp>For the <code class=Cm>GQ</code> scheme proceed as in the <code class=Cm>TC</code> scheme to generate keys and certificates for all group hosts, then for every trusted host in the group, generate the <code class=Cm>IFF</code> parameter file. On trusted host alice run <code class=Nm>ntp-keygen</code><code class=Fl>-T</code><code class=Fl>-G</code><code class=Fl>-p</code><var class=Ar>password</var> to produce her parameter file <span class=Pa>ntpkey_GQpar_alice.</span><var class=Ar>filestamp</var>, which includes both server and client keys. Copy this file to all group hosts and install a soft link from the generic <span class=Pa>ntpkey_gq_alice</span> to this file. In addition, on each host <var class=Ar>bob</var> install a soft link from generic <span class=Pa>ntpkey_gq_</span><var class=Ar>bob</var> to this file. As the <code class=Cm>GQ</code> scheme updates the <code class=Cm>GQ</code> parameters file and certificate at the same time, keys and certificates can be regenerated as needed.</p><p class=Pp>For the <code class=Cm>MV</code> scheme, proceed as in the <code class=Cm>TC</code> scheme to generate keys and certificates for all group hosts. For illustration assume trish is the TA, alice one of several trusted hosts and bob one of her clients. On TA trish run <code class=Nm>ntp-keygen</code><code class=Fl>-V</code><var class=Ar>n</var><code class=Fl>-p</code><var class=Ar>password</var>, where <var class=Ar>n</var> is the number of revokable keys (typically 5) to produce the parameter file <span class=Pa>ntpkeys_MVpar_trish.</span><var class=Ar>filestamp</var> and client key files <span class=Pa>ntpkeys_MVkey</span><var class=Ar>d _</var><span class=Pa>trish.</span><var class=Ar>filestamp</var> where <var class=Ar>d</var> is the key number (0 &lt; <var class=Ar>d</var> &lt; <var class=Ar>n</var>). Copy the parameter file to alice and install a soft link from the generic <span class=Pa>ntpkey_mv_alice</span> to this file. Copy one of the client key files to alice for later distribution to her clients. It does not matter which client key file goes to alice, since they all work the same way. Alice copies the client key file to all of her clients. On client bob install a soft link from generic <span class=Pa>ntpkey_mvkey_bob</span> to the client key file. As the <code class=Cm>MV</code> scheme is independent of keys and certificates, these files can be refreshed as needed.</p></section><section class=Ss><h2 class=Ss id=Command_Line_Options><a class=permalink href=#Command_Line_Options>Command Line Options</a></h2><dl class=Bl-tag><dt><a class=permalink href=#b><code class=Fl id=b>-b</code></a><code class=Fl>--imbits</code>= <var class=Ar>modulus</var></dt><dd>Set the number of bits in the identity modulus for generating identity keys to <var class=Ar>modulus</var> bits. The number of bits in the identity modulus defaults to 256, but can be set to values from 256 to 2048 (32 to 256 octets). Use the larger moduli with caution, as this can consume considerable computing resources and increases the size of authenticated packets.</dd><dt><a class=permalink href=#c><code class=Fl id=c>-c</code></a><code class=Fl>--certificate</code>= <var class=Ar>scheme</var></dt><dd>Select certificate signature encryption/message digest scheme. The <var class=Ar>scheme</var> can be one of the following: <code class=Cm>RSA-MD2</code>, <code class=Cm>RSA-MD5</code>, <code class=Cm>RSA-MDC2</code>, <code class=Cm>RSA-SHA</code>, <code class=Cm>RSA-SHA1</code>, <code class=Cm>RSA-RIPEMD160</code>, <code class=Cm>DSA-SHA</code>, or <code class=Cm>DSA-SHA1</code>. Note that <code class=Cm>RSA</code> schemes must be used with an <code class=Cm>RSA</code> sign key and <code class=Cm>DSA</code> schemes must be used with a <code class=Cm>DSA</code> sign key. The default without this option is <code class=Cm>RSA-MD5</code>. If compatibility with FIPS 140-2 is required, either the <code class=Cm>DSA-SHA</code> or <code class=Cm>DSA-SHA1</code> scheme must be used.</dd><dt><a class=permalink href=#C><code class=Fl id=C>-C</code></a><code class=Fl>--cipher</code>= <var class=Ar>cipher</var></dt><dd>Select the OpenSSL cipher to encrypt the files containing private keys. The default without this option is three-key triple DES in CBC mode, <code class=Cm>des-ede3-cbc</code>. The <code class=Ic>openssl</code><code class=Fl>-h</code> command provided with OpenSSL displays available ciphers.</dd><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a><code class=Fl>--debug-level</code></dt><dd>Increase debugging verbosity level. This option displays the cryptographic data produced in eye-friendly billboards.</dd><dt><a class=permalink href=#D><code class=Fl id=D>-D</code></a><code class=Fl>--set-debug-level</code>= <var class=Ar>level</var></dt><dd>Set the debugging verbosity to <var class=Ar>level</var>. This option displays the cryptographic data produced in eye-friendly billboards.</dd><dt><a class=permalink href=#e><code class=Fl id=e>-e</code></a><code class=Fl>--id-key</code></dt><dd>Write the <code class=Cm>IFF</code> or <code class=Cm>GQ</code> public parameters from the <var class=Ar>IFFkey or GQkey</var> client keys file previously specified as unencrypted data to the standard output stream <span class=Pa>stdout</span>. This is intended for automatic key distribution by email.</dd><dt><a class=permalink href=#G><code class=Fl id=G>-G</code></a><code class=Fl>--gq-params</code></dt><dd>Generate a new encrypted <code class=Cm>GQ</code> parameters and key file for the Guillou-Quisquater (GQ) identity scheme. This option is mutually exclusive with the <code class=Fl>-I</code> and <code class=Fl>-V</code> options.</dd><dt><a class=permalink href=#H><code class=Fl id=H>-H</code></a><code class=Fl>--host-key</code></dt><dd>Generate a new encrypted <code class=Cm>RSA</code> public/private host key file.</dd><dt><a class=permalink href=#I><code class=Fl id=I>-I</code></a><code class=Fl>--iffkey</code></dt><dd>Generate a new encrypted <code class=Cm>IFF</code> key file for the Schnorr (IFF) identity scheme. This option is mutually exclusive with the <code class=Fl>-G</code> and Fl V options.</dd><dt><a class=permalink href=#i><code class=Fl id=i>-i</code></a><code class=Fl>--ident</code>= <var class=Ar>group</var></dt><dd>Set the optional Autokey group name to <var class=Ar>group</var>. This is used in the identity scheme parameter file names of <code class=Cm>IFF</code>, <code class=Cm>GQ</code>, and <code class=Cm>MV</code> client parameters files. In that role, the default is the host name if no group is provided. The group name, if specified using <code class=Fl>-i</code> or <code class=Fl>-s</code> following an ‘<code class=Li>@</code>’ character, is also used in certificate subject and issuer names in the form <var class=Ar>host @ group</var> and should match the group specified via <code class=Ic>crypto</code><code class=Cm>ident</code> or <code class=Ic>server</code><code class=Cm>ident</code> in the ntpd configuration file.</dd><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a><code class=Fl>--lifetime</code>= <var class=Ar>days</var></dt><dd>Set the lifetime for certificate expiration to <var class=Ar>days</var>. The default lifetime is one year (365 days).</dd><dt><a class=permalink href=#m><code class=Fl id=m>-m</code></a><code class=Fl>--modulus</code>= <var class=Ar>bits</var></dt><dd>Set the number of bits in the prime modulus for generating files to <var class=Ar>bits</var>. The modulus defaults to 512, but can be set from 256 to 2048 (32 to 256 octets). Use the larger moduli with caution, as this can consume considerable computing resources and increases the size of authenticated packets.</dd><dt><a class=permalink href=#M><code class=Fl id=M>-M</code></a><code class=Fl>--md5key</code></dt><dd>Generate a new symmetric keys file containing 10 <code class=Cm>MD5</code> keys, and if OpenSSL is available, 10 <code class=Cm>SHA</code> keys. An <code class=Cm>MD5</code> key is a string of 20 random printable ASCII characters, while a <code class=Cm>SHA</code> key is a string of 40 random hex digits. The file can be edited using a text editor to change the key type or key content. This option is mutually exclusive with all other options.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a><code class=Fl>--password</code>= <var class=Ar>passwd</var></dt><dd>Set the password for reading and writing encrypted files to <var class=Ar>passwd</var>. These include the host, sign and identify key files. By default, the password is the string returned by the Unix <code class=Ic>hostname</code> command.</dd><dt><a class=permalink href=#P><code class=Fl id=P>-P</code></a><code class=Fl>--pvt-cert</code></dt><dd>Generate a new private certificate used by the <code class=Cm>PC</code> identity scheme. By default, the program generates public certificates. Note: the PC identity scheme is not recommended for new installations.</dd><dt><a class=permalink href=#q><code class=Fl id=q>-q</code></a><code class=Fl>--export-passwd</code>= <var class=Ar>passwd</var></dt><dd>Set the password for writing encrypted <code class=Cm>IFF</code>, <code class=Cm>GQ and MV</code> identity files redirected to <span class=Pa>stdout</span> to <var class=Ar>passwd</var>. In effect, these files are decrypted with the <code class=Fl>-p</code> password, then encrypted with the <code class=Fl>-q</code> password. By default, the password is the string returned by the Unix <code class=Ic>hostname</code> command.</dd><dt><a class=permalink href=#s><code class=Fl id=s>-s</code></a><code class=Fl>--subject-key</code>= <var class=Ar>file ...</var> [host] [@ <var class=Ar>group</var>]</dt><dd>Specify the Autokey host name, where <var class=Ar>host</var> is the optional host name and <var class=Ar>group</var> is the optional group name. The host name, and if provided, group name are used in <var class=Ar>host @ group</var> form as certificate subject and issuer. Specifying <code class=Fl>-s</code><code class=Fl>-@</code><var class=Ar>group</var> is allowed, and results in leaving the host name unchanged, as with <code class=Fl>-i</code><var class=Ar>group</var>. The group name, or if no group is provided, the host name are also used in the file names of <code class=Cm>IFF</code>, <code class=Cm>GQ</code>, and <code class=Cm>MV</code> identity scheme client parameter files. If <var class=Ar>host</var> is not specified, the default host name is the string returned by the Unix <code class=Ic>hostname</code> command.</dd><dt><a class=permalink href=#S><code class=Fl id=S>-S</code></a><code class=Fl>--sign-key</code>= [<code class=Cm>RSA</code> | <code class=Cm>DSA</code>]</dt><dd>Generate a new encrypted public/private sign key file of the specified type. By default, the sign key is the host key and has the same type. If compatibility with FIPS 140-2 is required, the sign key type must be <code class=Cm>DSA</code>.</dd><dt><a class=permalink href=#T><code class=Fl id=T>-T</code></a><code class=Fl>--trusted-cert</code></dt><dd>Generate a trusted certificate. By default, the program generates a non-trusted certificate.</dd><dt><a class=permalink href=#V><code class=Fl id=V>-V</code></a><code class=Fl>--mv-params</code><var class=Ar>nkeys</var></dt><dd>Generate <var class=Ar>nkeys</var> encrypted server keys and parameters for the Mu-Varadharajan (MV) identity scheme. This option is mutually exclusive with the <code class=Fl>-I</code> and <code class=Fl>-G</code> options. Note: support for this option should be considered a work in progress.</dd></dl></section><section class=Ss><h2 class=Ss id=Random_Seed_File><a class=permalink href=#Random_Seed_File>Random Seed File</a></h2> All cryptographically sound key generation schemes must have means to randomize the entropy seed used to initialize the internal pseudo-random number generator used by the library routines. The OpenSSL library uses a designated random seed file for this purpose. The file must be available when starting the NTP daemon and <code class=Nm>ntp-keygen</code> program. If a site supports OpenSSL or its companion OpenSSH, it is very likely that means to do this are already available. <p class=Pp>It is important to understand that entropy must be evolved for each generation, for otherwise the random number sequence would be predictable. Various means dependent on external events, such as keystroke intervals, can be used to do this and some systems have built-in entropy sources. Suitable means are described in the OpenSSL software documentation, but are outside the scope of this page.</p><p class=Pp>The entropy seed used by the OpenSSL library is contained in a file, usually called <span class=Pa>.rnd</span>, which must be available when starting the NTP daemon or the <code class=Nm>ntp-keygen</code> program. The NTP daemon will first look for the file using the path specified by the <code class=Cm>randfile</code> subcommand of the <code class=Ic>crypto</code> configuration command. If not specified in this way, or when starting the <code class=Nm>ntp-keygen</code> program, the OpenSSL library will look for the file using the path specified by the <code class=Ev>RANDFILE</code> environment variable in the user home directory, whether root or some other user. If the <code class=Ev>RANDFILE</code> environment variable is not present, the library will look for the <span class=Pa>.rnd</span> file in the user home directory. Since both the <code class=Nm>ntp-keygen</code> program and <a class=Xr href=ntpd.8.html>ntpd(8)</a> daemon must run as root, the logical place to put this file is in <span class=Pa>/.rnd</span> or <span class=Pa>/root/.rnd</span>. If the file is not available or cannot be written, the daemon exits with a message to the system log and the program exits with a suitable error message.</p></section><section class=Ss><h2 class=Ss id=Cryptographic_Data_Files><a class=permalink href=#Cryptographic_Data_Files>Cryptographic Data Files</a></h2> All file formats begin with two nonencrypted lines. The first line contains the file name, including the generated host name and filestamp, in the format <span class=Pa>ntpkey_</span><var class=Ar>key _</var><var class=Ar>name</var>. <var class=Ar>filestamp</var>, where <var class=Ar>key</var> is the key or parameter type, <var class=Ar>name</var> is the host or group name and <var class=Ar>filestamp</var> is the filestamp (NTP seconds) when the file was created. By convention, <var class=Ar>key</var> names in generated file names include both upper and lower case characters, while <var class=Ar>key</var> names in generated link names include only lower case characters. The filestamp is not used in generated link names. The second line contains the datestamp in conventional Unix <span class=Pa>date</span> format. Lines beginning with ‘<code class=Li>#</code>’ are considered comments and ignored by the <code class=Nm>ntp-keygen</code> program and <a class=Xr href=ntpd.8.html>ntpd(8)</a> daemon. <p class=Pp>The remainder of the file contains cryptographic data, encoded first using ASN.1 rules, then encrypted if necessary, and finally written in PEM-encoded printable ASCII text, preceded and followed by MIME content identifier lines.</p><p class=Pp>The format of the symmetric keys file, ordinarily named <span class=Pa>ntp.keys</span>, is somewhat different than the other files in the interest of backward compatibility. Ordinarily, the file is generated by this program, but it can be constructed and edited using an ordinary text editor.</p><div class="Bd Pp Bd-indent"><pre>
# ntpkey_MD5key_bk.ntp.org.3595864945
# Thu Dec 12 19:22:25 2013
1  MD5 L";Nw&lt;`.I&lt;f4U0)247"i  # MD5 key
2  MD5 &amp;&gt;l0%XXK9O'51VwV&lt;xq~  # MD5 key
3  MD5 lb4zLW~d^!K:]RsD'qb6  # MD5 key
4  MD5 Yue:tL[+vR)M`n~bY,'?  # MD5 key
5  MD5 B;fx'Kgr/&amp;4ZTbL6=RxA  # MD5 key
6  MD5 4eYwa`o}3i@@V@..R9!l  # MD5 key
7  MD5 `A.([h+;wTQ|xfi%Sn_!  # MD5 key
8  MD5 45:V,r4]l6y^JH6"Sh?F  # MD5 key
9  MD5 3-5vcn*6l29DS?Xdsg)*  # MD5 key
10 MD5 2late4Me              # MD5 key
11 SHA1 a27872d3030a9025b8446c751b4551a7629af65c  # SHA1 key
12 SHA1 21bc3b4865dbb9e920902abdccb3e04ff97a5e74  # SHA1 key
13 SHA1 2b7736fe24fef5ba85ae11594132ab5d6f6daba9  # SHA1 key
14 SHA  a5332809c8878dd3a5b918819108a111509aeceb  # SHA  key
15 MD2  2fe16c88c760ff2f16d4267e36c1aa6c926e6964  # MD2  key
16 MD4  b2691811dc19cfc0e2f9bcacd74213f29812183d  # MD4  key
17 MD5  e4d6735b8bdad58ec5ffcb087300a17f7fef1f7c  # MD5  key
18 MDC2 a8d5e2315c025bf3a79174c87fbd10477de2eabc  # MDC2 key
19 RIPEMD160 77ca332cafb30e3cafb174dcd5b80ded7ba9b3d2  # RIPEMD160 key
20 AES128CMAC f92ff73eee86c1e7dc638d6489a04e4e555af878  # AES128CMAC key
</pre></div><div class="Bd Bd-indent">Figure 1. Typical Symmetric Key File</div><p class=Pp>Figure 1 shows a typical symmetric keys file used by the reference implementation. Following the header the keys are entered one per line in the format</p><div class="Bd Bd-indent"><var class=Ar>keyno</var><var class=Ar>type</var><var class=Ar>key</var></div> where <var class=Ar>keyno</var> is a positive integer in the range 1-65535; <var class=Ar>type</var> is the key type for the message digest algorithm, which in the absence of the OpenSSL library must be <code class=Cm>MD5</code> to designate the MD5 message digest algorithm; if the OpenSSL library is installed, the key type can be any message digest algorithm supported by that library; however, if compatibility with FIPS 140-2 is required, the key type must be either <code class=Cm>SHA</code> or <code class=Cm>SHA1</code>; <var class=Ar>key</var> is the key itself, which is a printable ASCII string 20 characters or less in length: each character is chosen from the 93 printable characters in the range 0x21 through 0x7e ( ‘<code class=Li></code>’! through ‘<code class=Li>~</code>’ ) excluding space and the ‘<code class=Li>#</code>’ character, and terminated by whitespace or a ‘<code class=Li>#</code>’ character. An OpenSSL key consists of a hex-encoded ASCII string of 40 characters, which is truncated as necessary. <p class=Pp>Note that the keys used by the <a class=Xr href=ntpq.8.html>ntpq(8)</a> and <a class=Xr href=ntpdc.8.html>ntpdc(8)</a> programs are checked against passwords requested by the programs and entered by hand, so it is generally appropriate to specify these keys in human readable ASCII format.</p><p class=Pp>The <code class=Nm>ntp-keygen</code> program generates a symmetric keys file <span class=Pa>ntpkey_MD5key_</span><var class=Ar>hostname</var>.<var class=Ar>filestamp</var>. Since the file contains private shared keys, it should be visible only to root and distributed by secure means to other subnet hosts. The NTP daemon loads the file <span class=Pa>ntp.keys</span>, so <code class=Nm>ntp-keygen</code> installs a soft link from this name to the generated file. Subsequently, similar soft links must be installed by manual or automated means on the other subnet hosts. While this file is not used with the Autokey Version 2 protocol, it is needed to authenticate some remote configuration commands used by the <a class=Xr href=ntpq.8.html>ntpq(8)</a> and <a class=Xr href=ntpdc.8.html>ntpdc(8)</a> utilities.</p></section></section><section class=Sh><h2 class=Sh id=OPTIONS><a class=permalink href=#OPTIONS>OPTIONS</a></h2><dl class=Bl-tag><dt><a class=permalink href=#b_2><code class=Fl id=b_2>-b</code></a><var class=Ar>imbits</var>, <code class=Fl>--imbits</code>=<var class=Ar>imbits</var></dt><dd>identity modulus bits. This option takes an integer number as its argument. The value of <var class=Ar>imbits</var> is constrained to being: <pre>
in the range  256 through 2048
    </pre><p class=Pp>The number of bits in the identity modulus. The default is 256.</p></dd><dt><a class=permalink href=#c_2><code class=Fl id=c_2>-c</code></a><var class=Ar>scheme</var>, <code class=Fl>--certificate</code>=<var class=Ar>scheme</var></dt><dd>certificate scheme. <p class=Pp>scheme is one of RSA-MD2, RSA-MD5, RSA-MDC2, RSA-SHA, RSA-SHA1, RSA-RIPEMD160, DSA-SHA, or DSA-SHA1.</p><p class=Pp>Select the certificate signature encryption/message digest scheme. Note that RSA schemes must be used with a RSA sign key and DSA schemes must be used with a DSA sign key. The default without this option is RSA-MD5.</p></dd><dt><a class=permalink href=#C_2><code class=Fl id=C_2>-C</code></a><var class=Ar>cipher</var>, <code class=Fl>--cipher</code>=<var class=Ar>cipher</var></dt><dd>privatekey cipher. <p class=Pp>Select the cipher which is used to encrypt the files containing private keys. The default is three-key triple DES in CBC mode, equivalent to "<b>-C des-ede3-cbc</b>". The openssl tool lists ciphers available in "<b>openssl -h</b>" output.</p></dd><dt><a class=permalink href=#d_2><code class=Fl id=d_2>-d</code></a>, <code class=Fl>--debug-level</code></dt><dd>Increase debug verbosity level. This option may appear an unlimited number of times. <p class=Pp></p></dd><dt><a class=permalink href=#D_2><code class=Fl id=D_2>-D</code></a><var class=Ar>number</var>, <code class=Fl>--set-debug-level</code>=<var class=Ar>number</var></dt><dd>Set the debug verbosity level. This option may appear an unlimited number of times. This option takes an integer number as its argument. <p class=Pp></p></dd><dt><a class=permalink href=#e_2><code class=Fl id=e_2>-e</code></a>, <code class=Fl>--id-key</code></dt><dd>Write IFF or GQ identity keys. <p class=Pp>Write the public parameters from the IFF or GQ client keys to the standard output. This is intended for automatic key distribution by email.</p></dd><dt><a class=permalink href=#G_2><code class=Fl id=G_2>-G</code></a>, <code class=Fl>--gq-params</code></dt><dd>Generate GQ parameters and keys. <p class=Pp>Generate parameters and keys for the GQ identification scheme, obsoleting any that may exist.</p></dd><dt><a class=permalink href=#H_2><code class=Fl id=H_2>-H</code></a>, <code class=Fl>--host-key</code></dt><dd>generate RSA host key. <p class=Pp>Generate new host keys, obsoleting any that may exist.</p></dd><dt><a class=permalink href=#I_2><code class=Fl id=I_2>-I</code></a>, <code class=Fl>--iffkey</code></dt><dd>generate IFF parameters. <p class=Pp>Generate parameters for the IFF identification scheme, obsoleting any that may exist.</p></dd><dt><a class=permalink href=#i_2><code class=Fl id=i_2>-i</code></a><var class=Ar>group</var>, <code class=Fl>--ident</code>=<var class=Ar>group</var></dt><dd>set Autokey group name. <p class=Pp>Set the optional Autokey group name to name. This is used in the file name of IFF, GQ, and MV client parameters files. In that role, the default is the host name if this option is not provided. The group name, if specified using <b>-i/--ident</b> or using <b>-s/--subject-name</b> following an '<b>@</b>' character, is also a part of the self-signed host certificate subject and issuer names in the form <b>host@group</b> and should match the ´<b>crypto ident</b>' or '<b>server ident</b>' configuration in the <b>ntpd</b> configuration file.</p></dd><dt><a class=permalink href=#l_2><code class=Fl id=l_2>-l</code></a><var class=Ar>lifetime</var>, <code class=Fl>--lifetime</code>=<var class=Ar>lifetime</var></dt><dd>set certificate lifetime. This option takes an integer number as its argument. <p class=Pp>Set the certificate expiration to lifetime days from now.</p></dd><dt><a class=permalink href=#m_2><code class=Fl id=m_2>-m</code></a><var class=Ar>modulus</var>, <code class=Fl>--modulus</code>=<var class=Ar>modulus</var></dt><dd>prime modulus. This option takes an integer number as its argument. The value of <var class=Ar>modulus</var> is constrained to being: <pre>
in the range  256 through 2048
    </pre><p class=Pp>The number of bits in the prime modulus. The default is 512.</p></dd><dt><a class=permalink href=#M_2><code class=Fl id=M_2>-M</code></a>, <code class=Fl>--md5key</code></dt><dd>generate symmetric keys. <p class=Pp>Generate symmetric keys, obsoleting any that may exist.</p></dd><dt><a class=permalink href=#P_2><code class=Fl id=P_2>-P</code></a>, <code class=Fl>--pvt-cert</code></dt><dd>generate PC private certificate. <p class=Pp>Generate a private certificate. By default, the program generates public certificates.</p></dd><dt><a class=permalink href=#p_2><code class=Fl id=p_2>-p</code></a><var class=Ar>passwd</var>, <code class=Fl>--password</code>=<var class=Ar>passwd</var></dt><dd>local private password. <p class=Pp>Local files containing private data are encrypted with the DES-CBC algorithm and the specified password. The same password must be specified to the local ntpd via the "crypto pw password" configuration command. The default password is the local hostname.</p></dd><dt><a class=permalink href=#q_2><code class=Fl id=q_2>-q</code></a><var class=Ar>passwd</var>, <code class=Fl>--export-passwd</code>=<var class=Ar>passwd</var></dt><dd>export IFF or GQ group keys with password. <p class=Pp>Export IFF or GQ identity group keys to the standard output, encrypted with the DES-CBC algorithm and the specified password. The same password must be specified to the remote ntpd via the "crypto pw password" configuration command. See also the option --id-key (-e) for unencrypted exports.</p></dd><dt><a class=permalink href=#s_2><code class=Fl id=s_2>-s</code></a><var class=Ar>host@group</var>, <code class=Fl>--subject-name</code>=<var class=Ar>host@group</var></dt><dd>set host and optionally group name. <p class=Pp>Set the Autokey host name, and optionally, group name specified following an '<b>@</b>' character. The host name is used in the file name of generated host and signing certificates, without the group name. The host name, and if provided, group name are used in <b>host@group</b> form for the host certificate subject and issuer fields. Specifying '<b>-s @group</b>' is allowed, and results in leaving the host name unchanged while appending <b>@group</b> to the subject and issuer fields, as with <b>-i group</b>. The group name, or if not provided, the host name are also used in the file names of IFF, GQ, and MV client parameter files.</p></dd><dt><a class=permalink href=#S_2><code class=Fl id=S_2>-S</code></a><var class=Ar>sign</var>, <code class=Fl>--sign-key</code>=<var class=Ar>sign</var></dt><dd>generate sign key (RSA or DSA). <p class=Pp>Generate a new sign key of the designated type, obsoleting any that may exist. By default, the program uses the host key as the sign key.</p></dd><dt><a class=permalink href=#T_2><code class=Fl id=T_2>-T</code></a>, <code class=Fl>--trusted-cert</code></dt><dd>trusted certificate (TC scheme). <p class=Pp>Generate a trusted certificate. By default, the program generates a non-trusted certificate.</p></dd><dt><a class=permalink href=#V_2><code class=Fl id=V_2>-V</code></a><var class=Ar>num</var>, <code class=Fl>--mv-params</code>=<var class=Ar>num</var></dt><dd>generate &lt;num&gt; MV parameters. This option takes an integer number as its argument. <p class=Pp>Generate parameters and keys for the Mu-Varadharajan (MV) identification scheme.</p></dd><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a><var class=Ar>num</var>, <code class=Fl>--mv-keys</code>=<var class=Ar>num</var></dt><dd>update &lt;num&gt; MV keys. This option takes an integer number as its argument. <p class=Pp>This option has not been fully documented.</p></dd><dt><a class=permalink href=#?><code class=Fl id=?>-?</code></a>, <code class=Fl>--help</code></dt><dd>Display usage information and exit.</dd><dt><a class=permalink href=#!><code class=Fl id=!>-!</code></a>, <code class=Fl>--more-help</code></dt><dd>Pass the extended usage information through a pager.</dd><dt><a class=permalink href=#_><code class=Fl id=_>-&gt;</code></a> [<var class=Ar>cfgfile</var>], <code class=Fl>--save-opts</code> [=<var class=Ar>cfgfile</var>]</dt><dd>Save the option state to <i>cfgfile</i>. The default is the <i>last</i> configuration file listed in the <b>OPTION PRESETS</b> section, below. The command will exit after updating the config file.</dd><dt><a class=permalink href=#__2><code class=Fl id=__2>-&lt;</code></a><var class=Ar>cfgfile</var>, <code class=Fl>--load-opts</code>=<var class=Ar>cfgfile</var>, <code class=Fl>--no-load-opts</code></dt><dd>Load options from <i>cfgfile</i>. The <i>no-load-opts</i> form will disable the loading of earlier config/rc/ini files. <i>--no-load-opts</i> is handled early, out of order.</dd><dt><a class=permalink href=#_-version><code class=Fl id=_-version>--version</code></a> [{<var class=Ar>v|c|n</var>}]</dt><dd>Output version of program and exit. The default mode is `v', a simple version. The `c' mode will print copyright information and `n' will print the full copyright notice.</dd></dl></section><section class=Sh><h2 class=Sh id=OPTION_PRESETS><a class=permalink href=#OPTION_PRESETS>OPTION PRESETS</a></h2> Any option that is not marked as <i>not presettable</i> may be preset by loading values from configuration ("RC" or ".INI") file(s) and values from environment variables named: <pre>
  <b>NTP_KEYGEN_&lt;option-name&gt;</b> or <b>NTP_KEYGEN</b>
</pre> The environmental presets take precedence (are processed later than) the configuration files. The <i>homerc</i> files are "<i>$HOME</i>", and "<i>.</i>". If any of these are directories, then the file <i>.ntprc</i> is searched for within those directories. </section><section class=Sh><h2 class=Sh id=USAGE><a class=permalink href=#USAGE>USAGE</a></h2></section><section class=Sh><h2 class=Sh id=ENVIRONMENT><a class=permalink href=#ENVIRONMENT>ENVIRONMENT</a></h2> See <b>OPTION PRESETS</b> for configuration environment variables. </section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2> See <b>OPTION PRESETS</b> for configuration files. </section><section class=Sh><h2 class=Sh id=EXIT_STATUS><a class=permalink href=#EXIT_STATUS>EXIT STATUS</a></h2> One of the following exit values will be returned: <dl class=Bl-tag><dt>0 (EXIT_SUCCESS)</dt><dd>Successful program execution.</dd><dt>1 (EXIT_FAILURE)</dt><dd>The operation failed or the command syntax was not valid.</dd><dt>66 (EX_NOINPUT)</dt><dd>A specified configuration file could not be loaded.</dd><dt>70 (EX_SOFTWARE)</dt><dd>libopts had an internal operational error. Please report it to autogen-users@lists.sourceforge.net. Thank you.</dd></dl></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The University of Delaware and Network Time Foundation </section><section class=Sh><h2 class=Sh id=COPYRIGHT><a class=permalink href=#COPYRIGHT>COPYRIGHT</a></h2> Copyright (C) 1992-2017 The University of Delaware and Network Time Foundation all rights reserved. This program is released under the terms of the NTP license, &lt;http://ntp.org/license&gt;. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> It can take quite a while to generate some cryptographic values. <p class=Pp>Please report bugs to http://bugs.ntp.org .</p><p class=Pp>Please send bug reports to: http://bugs.ntp.org, bugs@ntp.org</p></section><section class=Sh><h2 class=Sh id=NOTES><a class=permalink href=#NOTES>NOTES</a></h2> Portions of this document came from FreeBSD. <p class=Pp>This manual page was <i>AutoGen</i>-erated from the <b>ntp-keygen</b> option definitions.</p></section></div><table class=foot><tr><td class=foot-date>August 14 2018</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>