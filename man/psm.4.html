<!DOCTYPE html>
<html><head><meta charset=utf-8><title>psm(4)</title><keywords content=man,psm></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>psm(4)</h1><table class=head><tr><td class=head-ltitle>PSM(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>PSM(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>psm</code> — <div class=Nd>PS/2 mouse style pointing device driver</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=Cd>options KBD_RESETDELAY=N</code><br><code class=Cd>options KBD_MAXWAIT=N</code><br><code class=Cd>options PSM_DEBUG=N</code><br><code class=Cd>options KBDIO_DEBUG=N</code><br><code class=Cd>device psm</code><p class=Pp>In <span class=Pa>/boot/device.hints</span>: <br><code class=Cd>hint.psm.0.at="atkbdc"</code><br><code class=Cd>hint.psm.0.irq="12"</code></p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>psm</code> driver provides support for the PS/2 mouse style pointing device. Currently there can be only one <code class=Nm>psm</code> device node in the system. As the PS/2 mouse port is located at the auxiliary port of the keyboard controller, the keyboard controller driver, <code class=Nm>atkbdc</code>, must also be configured in the kernel. Note that there is currently no provision of changing the <i class=Em>irq</i> number. <p class=Pp>Basic PS/2 style pointing device has two or three buttons. Some devices may have a roller or a wheel and/or additional buttons.</p><section class=Ss><h2 class=Ss id=Device_Resolution><a class=permalink href=#Device_Resolution>Device Resolution</a></h2> The PS/2 style pointing device usually has several grades of resolution, that is, sensitivity of movement. They are typically 25, 50, 100 and 200 pulse per inch. Some devices may have finer resolution. The current resolution can be changed at runtime. The <code class=Nm>psm</code> driver allows the user to initially set the resolution via the driver flag (see <a class=Sx href=#DRIVER_CONFIGURATION>DRIVER CONFIGURATION</a>) or change it later via the <a class=Xr href=ioctl.2.html>ioctl(2)</a> command <code class=Dv>MOUSE_SETMODE</code> (see <a class=Sx href=#IOCTLS>IOCTLS</a>). </section><section class=Ss><h2 class=Ss id=Report_Rate><a class=permalink href=#Report_Rate>Report Rate</a></h2> Frequency, or report rate, at which the device sends movement and button state reports to the host system is also configurable. The PS/2 style pointing device typically supports 10, 20, 40, 60, 80, 100 and 200 reports per second. 60 or 100 appears to be the default value for many devices. Note that when there is no movement and no button has changed its state, the device will not send anything to the host system. The report rate can be changed via an ioctl call. </section><section class=Ss><h2 class=Ss id=Operation_Levels><a class=permalink href=#Operation_Levels>Operation Levels</a></h2> The <code class=Nm>psm</code> driver has three levels of operation. The current operation level can be set via an ioctl call. <p class=Pp>At the level zero the basic support is provided; the device driver will report horizontal and vertical movement of the attached device and state of up to three buttons. The movement and status are encoded in a series of fixed-length data packets (see <a class=Sx href=#Data_Packet_Format>Data Packet Format</a>). This is the default level of operation and the driver is initially at this level when opened by the user program.</p><p class=Pp>The operation level one, the `extended' level, supports a roller (or wheel), if any, and up to 11 buttons. The movement of the roller is reported as movement along the Z axis. 8 byte data packets are sent to the user program at this level.</p><p class=Pp>At the operation level two, data from the pointing device is passed to the user program as is. Conversely, command from the user program is passed to the pointing device as is and the user program is responsible for status validation and error recovery. Modern PS/2 type pointing devices often use proprietary data format. Therefore, the user program is expected to have intimate knowledge about the format from a particular device when operating the driver at this level. This level is called `native' level.</p></section><section class=Ss><h2 class=Ss id=Data_Packet_Format><a class=permalink href=#Data_Packet_Format>Data Packet Format</a></h2> Data packets read from the <code class=Nm>psm</code> driver are formatted differently at each operation level. <p class=Pp>A data packet from the PS/2 mouse style pointing device is three bytes long at the operation level zero:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt>Byte 1</dt><dd><dl class="Bl-tag Bl-compact"><dt>bit 7</dt><dd>One indicates overflow in the vertical movement count.</dd><dt>bit 6</dt><dd>One indicates overflow in the horizontal movement count.</dd><dt>bit 5</dt><dd>Set if the vertical movement count is negative.</dd><dt>bit 4</dt><dd>Set if the horizontal movement count is negative.</dd><dt>bit 3</dt><dd>Always one.</dd><dt>bit 2</dt><dd>Middle button status; set if pressed. For devices without the middle button, this bit is always zero.</dd><dt>bit 1</dt><dd>Right button status; set if pressed.</dd><dt>bit 0</dt><dd>Left button status; set if pressed.</dd></dl></dd><dt>Byte 2</dt><dd>Horizontal movement count in two's complement; -256 through 255. Note that the sign bit is in the first byte.</dd><dt>Byte 3</dt><dd>Vertical movement count in two's complement; -256 through 255. Note that the sign bit is in the first byte.</dd></dl><p class=Pp>At the level one, a data packet is encoded in the standard format <code class=Dv>MOUSE_PROTO_SYSMOUSE</code> as defined in <a class=Xr href=mouse.4.html>mouse(4)</a>.</p><p class=Pp>At the level two, native level, there is no standard on the size and format of the data packet.</p></section><section class=Ss><h2 class=Ss id=Acceleration><a class=permalink href=#Acceleration>Acceleration</a></h2> The <code class=Nm>psm</code> driver can somewhat `accelerate' the movement of the pointing device. The faster you move the device, the further the pointer travels on the screen. The driver has an internal variable which governs the effect of the acceleration. Its value can be modified via the driver flag or via an ioctl call. </section></section><section class=Sh><h2 class=Sh id=DRIVER_CONFIGURATION><a class=permalink href=#DRIVER_CONFIGURATION>DRIVER CONFIGURATION</a></h2><section class=Ss><h2 class=Ss id=Kernel_Configuration_Options><a class=permalink href=#Kernel_Configuration_Options>Kernel Configuration Options</a></h2> There are following kernel configuration options to control the <code class=Nm>psm</code> driver. They may be set in the kernel configuration file (see <a class=Xr href=config.8.html>config(8)</a>). <dl class=Bl-tag><dt><i class=Em>KBD_RESETDELAY=X</i>, <i class=Em>KBD_MAXWAIT=Y</i></dt><dd>The <code class=Nm>psm</code> driver will attempt to reset the pointing device during the boot process. It sometimes takes a long while before the device will respond after reset. These options control how long the driver should wait before it eventually gives up waiting. The driver will wait <var class=Fa>X</var> * <var class=Fa>Y</var> msecs at most. If the driver seems unable to detect your pointing device, you may want to increase these values. The default values are 200 msec for <var class=Fa>X</var> and 5 for <var class=Fa>Y</var>.</dd><dt><i class=Em>PSM_DEBUG=N</i>, <i class=Em>KBDIO_DEBUG=N</i></dt><dd>Sets the debug level to <var class=Fa>N</var>. The default debug level is zero. See <a class=Sx href=#DIAGNOSTICS>DIAGNOSTICS</a> for debug logging.</dd></dl></section><section class=Ss><h2 class=Ss id=Driver_Flags><a class=permalink href=#Driver_Flags>Driver Flags</a></h2> The <code class=Nm>psm</code> driver accepts the following driver flags. Set them in <span class=Pa>/boot/device.hints</span> (see <a class=Sx href=#EXAMPLES>EXAMPLES</a> below). <dl class=Bl-tag><dt>bit 0..3 RESOLUTION</dt><dd>This flag specifies the resolution of the pointing device. It must be zero through four. The greater the value is, the finer resolution the device will select. Actual resolution selected by this field varies according to the model of the device. Typical resolutions are: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><i class=Em>1 (low)</i></dt><dd>25 pulse per inch (ppi)</dd><dt><i class=Em>2 (medium low)</i></dt><dd>50 ppi</dd><dt><i class=Em>3 (medium high)</i></dt><dd>100 ppi</dd><dt><i class=Em>4 (high)</i></dt><dd>200 ppi</dd></dl><p class=Pp>Leaving this flag zero will selects the default resolution for the device (whatever it is).</p></dd><dt>bit 4..7 ACCELERATION</dt><dd>This flag controls the amount of acceleration effect. The smaller the value of this flag is, more sensitive the movement becomes. The minimum value allowed, thus the value for the most sensitive setting, is one. Setting this flag to zero will completely disables the acceleration effect.</dd><dt>bit 8 NOCHECKSYNC</dt><dd>The <code class=Nm>psm</code> driver tries to detect the first byte of the data packet by checking the bit pattern of that byte. Although this method should work with most PS/2 pointing devices, it may interfere with some devices which are not so compatible with known devices. If you think your pointing device is not functioning as expected, and the kernel frequently prints the following message to the console, <div class="Bd Pp Bd-indent"><pre>
psmintr: out of sync (xxxx != yyyy).
    </pre></div><p class=Pp>set this flag to disable synchronization check and see if it helps.</p></dd><dt>bit 9 NOIDPROBE</dt><dd>The <code class=Nm>psm</code> driver will not try to identify the model of the pointing device and will not carry out model-specific initialization. The device should always act like a standard PS/2 mouse without such initialization. Extra features, such as wheels and additional buttons, will not be recognized by the <code class=Nm>psm</code> driver.</dd><dt>bit 10 NORESET</dt><dd>When this flag is set, the <code class=Nm>psm</code> driver will not reset the pointing device when initializing the device. If the <span class=Ux>FreeBSD</span> kernel is started after another OS has run, the pointing device will inherit settings from the previous OS. However, because there is no way for the <code class=Nm>psm</code> driver to know the settings, the device and the driver may not work correctly. The flag should never be necessary under normal circumstances.</dd><dt>bit 11 FORCETAP</dt><dd>Some pad devices report as if the fourth button is pressed when the user `taps' the surface of the device (see <a class=Sx href=#CAVEATS>CAVEATS</a>). This flag will make the <code class=Nm>psm</code> driver assume that the device behaves this way. Without the flag, the driver will assume this behavior for ALPS GlidePoint models only.</dd><dt>bit 12 IGNOREPORTERROR</dt><dd>This flag makes <code class=Nm>psm</code> driver ignore certain error conditions when probing the PS/2 mouse port. It should never be necessary under normal circumstances.</dd><dt>bit 13 HOOKRESUME</dt><dd>The built-in PS/2 pointing device of some laptop computers is somehow not operable immediately after the system `resumes' from the power saving mode, though it will eventually become available. There are reports that stimulating the device by performing I/O will help waking up the device quickly. This flag will enable a piece of code in the <code class=Nm>psm</code> driver to hook the `resume' event and exercise some harmless I/O operations on the device.</dd><dt>bit 14 INITAFTERSUSPEND</dt><dd>This flag adds more drastic action for the above problem. It will cause the <code class=Nm>psm</code> driver to reset and re-initialize the pointing device after the `resume' event.</dd></dl></section></section><section class=Sh><h2 class=Sh id=LOADER_TUNABLES><a class=permalink href=#LOADER_TUNABLES>LOADER TUNABLES</a></h2> Extended support for Synaptics touchpads can be enabled by setting <var class=Va>hw.psm.synaptics_support</var> to <i class=Em>1</i> at boot-time. This will enable <code class=Nm>psm</code> to handle packets from guest devices (sticks) and extra buttons. Similarly, extended support for IBM/Lenovo TrackPoint and Elantech touchpads can be enabled by setting <var class=Va>hw.psm.trackpoint_support</var> or <var class=Va>hw.psm.elantech_support</var>, respectively, to <i class=Em>1</i> at boot-time. <p class=Pp>Tap and drag gestures can be disabled by setting <var class=Va>hw.psm.tap_enabled</var> to <i class=Em>0</i> at boot-time. Currently, this is supported on Synaptics touchpads regardless of Extended support state and on Elantech touchpads with Extended support enabled. The behaviour may be changed after boot by setting the sysctl with the same name and by restarting <a class=Xr href=moused.8.html>moused(8)</a> using <span class=Pa>/etc/rc.d/moused</span>.</p><p class=Pp>Active multiplexing support can be disabled by setting <var class=Va>hw.psm.mux_disabled</var> to <i class=Em>1</i> at boot-time. This will prevent <code class=Nm>psm</code> from enabling active multiplexing mode needed for some Synaptics touchpads.</p></section><section class=Sh><h2 class=Sh id=IOCTLS><a class=permalink href=#IOCTLS>IOCTLS</a></h2> There are a few <a class=Xr href=ioctl.2.html>ioctl(2)</a> commands for mouse drivers. These commands and related structures and constants are defined in <code class=In>&lt;<a class=In href=../src/sys/mouse.h.html>sys/mouse.h</a>&gt;</code>. General description of the commands is given in <a class=Xr href=mouse.4.html>mouse(4)</a>. This section explains the features specific to the <code class=Nm>psm</code> driver. <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#MOUSE_GETLEVEL><code class=Dv id=MOUSE_GETLEVEL>MOUSE_GETLEVEL</code></a><var class=Ar>int *level</var></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#MOUSE_SETLEVEL><code class=Dv id=MOUSE_SETLEVEL>MOUSE_SETLEVEL</code></a><var class=Ar>int *level</var></dt><dd>These commands manipulate the operation level of the <code class=Nm>psm</code> driver. <p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_GETHWINFO><code class=Dv id=MOUSE_GETHWINFO>MOUSE_GETHWINFO</code></a><var class=Ar>mousehw_t *hw</var></dt><dd>Returns the hardware information of the attached device in the following structure. <div class="Bd Pp"><pre>
typedef struct mousehw {
    int buttons;    /* number of buttons */
    int iftype;     /* I/F type */
    int type;       /* mouse/track ball/pad... */
    int model;      /* I/F dependent model ID */
    int hwid;       /* I/F dependent hardware ID */
} mousehw_t;
    </pre></div><p class=Pp>The <code class=Dv>buttons</code> field holds the number of buttons on the device. The <code class=Nm>psm</code> driver currently can detect the 3 button mouse from Logitech and report accordingly. The 3 button mouse from the other manufacturer may or may not be reported correctly. However, it will not affect the operation of the driver.</p><p class=Pp>The <code class=Dv>iftype</code> is always <code class=Dv>MOUSE_IF_PS2</code>.</p><p class=Pp>The <code class=Dv>type</code> tells the device type: <code class=Dv>MOUSE_MOUSE</code>, <code class=Dv>MOUSE_TRACKBALL</code>, <code class=Dv>MOUSE_STICK</code>, <code class=Dv>MOUSE_PAD</code>, or <code class=Dv>MOUSE_UNKNOWN</code>. The user should not heavily rely on this field, as the driver may not always, in fact it is very rarely able to, identify the device type.</p><p class=Pp>The <code class=Dv>model</code> is always <code class=Dv>MOUSE_MODEL_GENERIC</code> at the operation level 0. It may be <code class=Dv>MOUSE_MODEL_GENERIC</code> or one of <code class=Dv>MOUSE_MODEL_XXX</code> constants at higher operation levels. Again the <code class=Nm>psm</code> driver may or may not set an appropriate value in this field.</p><p class=Pp>The <code class=Dv>hwid</code> is the ID value returned by the device. Known IDs include:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><i class=Em>0</i></dt><dd>Mouse (Microsoft, Logitech and many other manufacturers)</dd><dt><i class=Em>2</i></dt><dd>Microsoft Ballpoint mouse</dd><dt><i class=Em>3</i></dt><dd>Microsoft IntelliMouse</dd></dl><p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_SYN_GETHWINFO><code class=Dv id=MOUSE_SYN_GETHWINFO>MOUSE_SYN_GETHWINFO</code></a><var class=Ar>synapticshw_t *synhw</var></dt><dd>Retrieves extra information associated with Synaptics Touchpad. Only available when a supported device has been detected. <div class="Bd Pp"><pre>
typedef struct synapticshw {
    int infoMajor;	/* major hardware revision */
    int infoMinor;	/* minor hardware revision */
    int infoRot180;	/* touchpad is rotated */
    int infoPortrait;	/* touchpad is a portrait */
    int infoSensor;	/* sensor model */
    int infoHardware;	/* hardware model */
    int infoNewAbs;	/* supports the newabs format */
    int capPen;		/* can detect a pen */
    int infoSimplC;	/* supports simple commands */
    int infoGeometry;	/* touchpad dimensions */
    int capExtended;	/* supports extended packets */
    int capSleep;	/* can be suspended/resumed */
    int capFourButtons;	/* has four buttons */
    int capMultiFinger;	/* can detect multiple fingers */
    int capPalmDetect;	/* can detect a palm */
    int capPassthrough;	/* can passthrough guest packets */
    int capMiddle;	/* has a physical middle button */
    int nExtendedButtons; /* has N additional buttons */
    int nExtendedQueries; /* supports N extended queries */
} synapticshw_t;
    </pre></div><p class=Pp>See the <i class=Em>Synaptics TouchPad Interfacing Guide</i> for more information about the fields in this structure.</p><p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_GETMODE><code class=Dv id=MOUSE_GETMODE>MOUSE_GETMODE</code></a><var class=Ar>mousemode_t *mode</var></dt><dd>The command gets the current operation parameters of the mouse driver. <div class="Bd Pp"><pre>
typedef struct mousemode {
    int protocol;    /* MOUSE_PROTO_XXX */
    int rate;        /* report rate (per sec), -1 if unknown */
    int resolution;  /* MOUSE_RES_XXX, -1 if unknown */
    int accelfactor; /* acceleration factor */
    int level;       /* driver operation level */
    int packetsize;  /* the length of the data packet */
    unsigned char syncmask[2]; /* sync. bits */
} mousemode_t;
    </pre></div><p class=Pp>The <code class=Dv>protocol</code> is <code class=Dv>MOUSE_PROTO_PS2</code> at the operation level zero and two. <code class=Dv>MOUSE_PROTO_SYSMOUSE</code> at the operation level one.</p><p class=Pp>The <code class=Dv>rate</code> is the status report rate (reports/sec) at which the device will send movement report to the host computer. Typical supported values are 10, 20, 40, 60, 80, 100 and 200. Some mice may accept other arbitrary values too.</p><p class=Pp>The <code class=Dv>resolution</code> of the pointing device must be one of <code class=Dv>MOUSE_RES_XXX</code> constants or a positive value. The greater the value is, the finer resolution the mouse will select. Actual resolution selected by the <code class=Dv>MOUSE_RES_XXX</code> constant varies according to the model of mouse. Typical resolutions are:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#MOUSE_RES_LOW><code class=Dv id=MOUSE_RES_LOW>MOUSE_RES_LOW</code></a></dt><dd>25 ppi</dd><dt><a class=permalink href=#MOUSE_RES_MEDIUMLOW><code class=Dv id=MOUSE_RES_MEDIUMLOW>MOUSE_RES_MEDIUMLOW</code></a></dt><dd>50 ppi</dd><dt><a class=permalink href=#MOUSE_RES_MEDIUMHIGH><code class=Dv id=MOUSE_RES_MEDIUMHIGH>MOUSE_RES_MEDIUMHIGH</code></a></dt><dd>100 ppi</dd><dt><a class=permalink href=#MOUSE_RES_HIGH><code class=Dv id=MOUSE_RES_HIGH>MOUSE_RES_HIGH</code></a></dt><dd>200 ppi</dd></dl><p class=Pp>The <code class=Dv>accelfactor</code> field holds a value to control acceleration feature (see <a class=Sx href=#Acceleration>Acceleration</a>). It must be zero or greater. If it is zero, acceleration is disabled.</p><p class=Pp>The <code class=Dv>packetsize</code> field specifies the length of the data packet. It depends on the operation level and the model of the pointing device.</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><i class=Em>level 0</i></dt><dd>3 bytes</dd><dt><i class=Em>level 1</i></dt><dd>8 bytes</dd><dt><i class=Em>level 2</i></dt><dd>Depends on the model of the device</dd></dl><p class=Pp>The array <code class=Dv>syncmask</code> holds a bit mask and pattern to detect the first byte of the data packet. <code class=Dv>syncmask[0]</code> is the bit mask to be ANDed with a byte. If the result is equal to <code class=Dv>syncmask[1]</code>, the byte is likely to be the first byte of the data packet. Note that this detection method is not 100% reliable, thus, should be taken only as an advisory measure.</p><p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_SETMODE><code class=Dv id=MOUSE_SETMODE>MOUSE_SETMODE</code></a><var class=Ar>mousemode_t *mode</var></dt><dd>The command changes the current operation parameters of the mouse driver as specified in <var class=Ar>mode</var>. Only <code class=Dv>rate</code>, <code class=Dv>resolution</code>, <code class=Dv>level</code> and <code class=Dv>accelfactor</code> may be modifiable. Setting values in the other field does not generate error and has no effect. <p class=Pp>If you do not want to change the current setting of a field, put -1 there. You may also put zero in <code class=Dv>resolution</code> and <code class=Dv>rate</code>, and the default value for the fields will be selected.</p><p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_READDATA><code class=Dv id=MOUSE_READDATA>MOUSE_READDATA</code></a><var class=Ar>mousedata_t *data</var></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#MOUSE_READSTATE><code class=Dv id=MOUSE_READSTATE>MOUSE_READSTATE</code></a><var class=Ar>mousedata_t *state</var></dt><dd>These commands are not currently supported by the <code class=Nm>psm</code> driver. <p class=Pp></p></dd><dt><a class=permalink href=#MOUSE_GETSTATUS><code class=Dv id=MOUSE_GETSTATUS>MOUSE_GETSTATUS</code></a><var class=Ar>mousestatus_t *status</var></dt><dd>The command returns the current state of buttons and movement counts as described in <a class=Xr href=mouse.4.html>mouse(4)</a>.</dd></dl></section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class="Bl-tag Bl-compact"><dt><span class=Pa>/dev/psm0</span></dt><dd>`non-blocking' device node</dd><dt><span class=Pa>/dev/bpsm0</span></dt><dd>`blocking' device node</dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> In order to install the <code class=Nm>psm</code> driver, you need to add <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>device atkbdc</code></div><div class="Bd Bd-indent"><code class=Li>device psm</code></div><p class=Pp>to your kernel configuration file, and put the following lines to <span class=Pa>/boot/device.hints</span>.</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>hint.atkbdc.0.at="isa"</code></div><div class="Bd Bd-indent"><code class=Li>hint.atkbdc.0.port="0x060"</code></div><div class="Bd Bd-indent"><code class=Li>hint.psm.0.at="atkbdc"</code></div><div class="Bd Bd-indent"><code class=Li>hint.psm.0.irq="12"</code></div><p class=Pp>If you add the following statement to <span class=Pa>/boot/device.hints</span>,</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>hint.psm.0.flags="0x2000"</code></div><p class=Pp>you will add the optional code to stimulate the pointing device after the `resume' event.</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li>hint.psm.0.flags="0x24"</code></div><p class=Pp>The above line will set the device resolution high (4) and the acceleration factor to 2.</p></section><section class=Sh><h2 class=Sh id=DIAGNOSTICS><a class=permalink href=#DIAGNOSTICS>DIAGNOSTICS</a></h2> At debug level 0, little information is logged except for the following line during boot process: <div class="Bd Pp Bd-indent"><pre>
psm0: device ID X
</pre></div><p class=Pp>where <var class=Fa>X</var> the device ID code returned by the found pointing device. See <code class=Dv>MOUSE_GETINFO</code> for known IDs.</p><p class=Pp>At debug level 1 more information will be logged while the driver probes the auxiliary port (mouse port). Messages are logged with the LOG_KERN facility at the LOG_DEBUG level (see <a class=Xr href=syslogd.8.html>syslogd(8)</a>).</p><div class="Bd Pp Bd-indent"><pre>
psm0: current command byte:xxxx
kbdio: TEST_AUX_PORT status:0000
kbdio: RESET_AUX return code:00fa
kbdio: RESET_AUX status:00aa
kbdio: RESET_AUX ID:0000
[...]
psm: status 00 02 64
psm0 irq 12 on isa
psm0: model AAAA, device ID X, N buttons
psm0: config:00000www, flags:0000uuuu, packet size:M
psm0: syncmask:xx, syncbits:yy
</pre></div><p class=Pp>The first line shows the command byte value of the keyboard controller just before the auxiliary port is probed. It usually is 40, 45, 47 or 65, depending on how the motherboard BIOS initialized the keyboard controller upon power-up.</p><p class=Pp>The second line shows the result of the keyboard controller's test on the auxiliary port interface, with zero indicating no error; note that some controllers report no error even if the port does not exist in the system, however.</p><p class=Pp>The third through fifth lines show the reset status of the pointing device. The functioning device should return the sequence of FA AA &lt;ID&gt;. The ID code is described above.</p><p class=Pp>The seventh line shows the current hardware settings. These bytes are formatted as follows:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt>Byte 1</dt><dd><dl class="Bl-tag Bl-compact"><dt>bit 7</dt><dd>Reserved.</dd><dt>bit 6</dt><dd>0 - stream mode, 1 - remote mode. In the stream mode, the pointing device sends the device status whenever its state changes. In the remote mode, the host computer must request the status to be sent. The <code class=Nm>psm</code> driver puts the device in the stream mode.</dd><dt>bit 5</dt><dd>Set if the pointing device is currently enabled. Otherwise zero.</dd><dt>bit 4</dt><dd>0 - 1:1 scaling, 1 - 2:1 scaling. 1:1 scaling is the default.</dd><dt>bit 3</dt><dd>Reserved.</dd><dt>bit 2</dt><dd>Left button status; set if pressed.</dd><dt>bit 1</dt><dd>Middle button status; set if pressed.</dd><dt>bit 0</dt><dd>Right button status; set if pressed.</dd></dl></dd><dt>Byte 2</dt><dd><dl class="Bl-tag Bl-compact"><dt>bit 7</dt><dd>Reserved.</dd><dt>bit 6..0</dt><dd>Resolution code: zero through three. Actual resolution for the resolution code varies from one device to another.</dd></dl></dd><dt>Byte 3</dt><dd>The status report rate (reports/sec) at which the device will send movement report to the host computer.</dd></dl><p class=Pp>Note that the pointing device will not be enabled until the <code class=Nm>psm</code> driver is opened by the user program.</p><p class=Pp>The rest of the lines show the device ID code, the number of detected buttons and internal variables.</p><p class=Pp>At debug level 2, much more detailed information is logged.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=ioctl.2.html>ioctl(2)</a>, <a class=Xr href=syslog.3.html>syslog(3)</a>, <a class=Xr href=atkbdc.4.html>atkbdc(4)</a>, <a class=Xr href=mouse.4.html>mouse(4)</a>, <a class=Xr href=sysmouse.4.html>sysmouse(4)</a>, <a class=Xr href=moused.8.html>moused(8)</a>, <a class=Xr href=syslogd.8.html>syslogd(8)</a><p class=Pp><cite class=Rs><span class=RsT>Synaptics TouchPad Interfacing Guide</span>, <a href=http://www.synaptics.com/ class=RsU>http://www.synaptics.com/</a>.</cite></p></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>psm</code> driver is based on the work done by quite a number of people, including <span class=An>Eric Forsberg</span>, <span class=An>Sandi Donno</span>, <span class=An>Rick Macklem</span>, <span class=An>Andrew Herbert</span>, <span class=An>Charles Hannum</span>, <span class=An>Shoji Yuen</span> and <span class=An>Kazutaka Yokota</span> to name the few. <p class=Pp>This manual page was written by <span class=An>Kazutaka Yokota</span> &lt;<a class=Mt href=mailto:yokota@FreeBSD.org>yokota@FreeBSD.org</a>&gt;.</p></section><section class=Sh><h2 class=Sh id=CAVEATS><a class=permalink href=#CAVEATS>CAVEATS</a></h2> Many pad devices behave as if the first (left) button were pressed if the user `taps' the surface of the pad. In contrast, some pad products, e.g. some versions of ALPS GlidePoint and Interlink VersaPad, treat the tapping action as fourth button events. <p class=Pp>It is reported that ALPS GlidePoint, Synaptics Touchpad, IBM/Lenovo TrackPoint, and Interlink VersaPad require <i class=Em>INITAFTERSUSPEND</i> flag in order to recover from suspended state. This flag is automatically set when one of these devices is detected by the <code class=Nm>psm</code> driver.</p><p class=Pp>Some PS/2 mouse models from MouseSystems require to be put in the high resolution mode to work properly. Use the driver flag to set resolution.</p><p class=Pp>There is not a guaranteed way to re-synchronize with the first byte of the packet once we are out of synchronization with the data stream. However, if you are using the <i>XFree86</i> server and experiencing the problem, you may be able to make the X server synchronize with the mouse by switching away to a virtual terminal and getting back to the X server, unless the X server is accessing the mouse via <a class=Xr href=moused.8.html>moused(8)</a>. Clicking any button without moving the mouse may also work.</p></section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Enabling the extended support for Synaptics touchpads has been reported to cause problems with responsivity on some (newer) models of Synaptics hardware, particularly those with guest devices. </section></div><table class=foot><tr><td class=foot-date>June 2, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>