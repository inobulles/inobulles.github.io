<!DOCTYPE html>
<html><head><meta charset=utf-8><title>geli(8)</title><keywords content=man,geli></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>geli(8)</h1><table class=head><tr><td class=head-ltitle>GELI(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>GELI(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>geli</code> — <div class=Nd>control utility for the cryptographic GEOM class</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2> To compile GEOM_ELI into your kernel, add the following lines to your kernel configuration file: <div class="Bd Pp Bd-indent"><code class=Cd>device crypto</code><br><code class=Cd>options GEOM_ELI</code></div><p class=Pp>Alternatively, to load the GEOM_ELI module at boot time, add the following line to your <a class=Xr href=loader.conf.5.html>loader.conf(5)</a>:</p><div class="Bd Pp Bd-indent"><pre>
geom_eli_load="YES"
</pre></div><p class=Pp><span class=No>Usage of the</span><code class=Nm>geli</code> utility:</p><p class=Pp></p><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>init</code> [<code class=Fl>-bdgPRTv</code>] [<code class=Fl>-a</code><var class=Ar>aalgo</var>] [<code class=Fl>-B</code><var class=Ar>backupfile</var>] [<code class=Fl>-e</code><var class=Ar>ealgo</var>] [<code class=Fl>-i</code><var class=Ar>iterations</var>] [<code class=Fl>-J</code><var class=Ar>newpassfile</var>] [<code class=Fl>-K</code><var class=Ar>newkeyfile</var>] [<code class=Fl>-l</code><var class=Ar>keylen</var>] [<code class=Fl>-s</code><var class=Ar>sectorsize</var>] [<code class=Fl>-V</code><var class=Ar>version</var>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>label - an alias for</code><code class=Cm>init</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>attach</code> [<code class=Fl>-Cdprv</code>] [<code class=Fl>-n</code><var class=Ar>keyno</var>] [<code class=Fl>-j</code><var class=Ar>passfile</var>] [<code class=Fl>-k</code><var class=Ar>keyfile</var>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>detach</code> [<code class=Fl>-fl</code>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>stop - an alias for</code><code class=Cm>detach</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>onetime</code> [<code class=Fl>-dRT</code>] [<code class=Fl>-a</code><var class=Ar>aalgo</var>] [<code class=Fl>-e</code><var class=Ar>ealgo</var>] [<code class=Fl>-l</code><var class=Ar>keylen</var>] [<code class=Fl>-s</code><var class=Ar>sectorsize</var>] <var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>configure</code> [<code class=Fl>-bBdDgGrRtT</code>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>setkey</code> [<code class=Fl>-pPv</code>] [<code class=Fl>-i</code><var class=Ar>iterations</var>] [<code class=Fl>-j</code><var class=Ar>passfile</var>] [<code class=Fl>-J</code><var class=Ar>newpassfile</var>] [<code class=Fl>-k</code><var class=Ar>keyfile</var>] [<code class=Fl>-K</code><var class=Ar>newkeyfile</var>] [<code class=Fl>-n</code><var class=Ar>keyno</var>] <var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>delkey</code> [<code class=Fl>-afv</code>] [<code class=Fl>-n</code><var class=Ar>keyno</var>] <var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>kill</code> [<code class=Fl>-av</code>] [<var class=Ar>prov ...</var>]</td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>backup</code> [<code class=Fl>-v</code>] <var class=Ar>prov</var><var class=Ar>file</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>restore</code> [<code class=Fl>-fv</code>] <var class=Ar>file</var><var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>suspend</code> [<code class=Fl>-v</code>] <code class=Fl>-a</code> | <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>resume</code> [<code class=Fl>-pv</code>] [<code class=Fl>-j</code><var class=Ar>passfile</var>] [<code class=Fl>-k</code><var class=Ar>keyfile</var>] <var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>resize</code> [<code class=Fl>-v</code>] <code class=Fl>-s</code><var class=Ar>oldsize</var><var class=Ar>prov</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>version</code> [<var class=Ar>prov ...</var>]</td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>clear</code> [<code class=Fl>-v</code>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>dump</code> [<code class=Fl>-v</code>] <var class=Ar>prov ...</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>list</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>status</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>load</code></td></tr></table><br><table class=Nm><tr><td><code class=Nm>geli</code></td><td><code class=Cm>unload</code></td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>geli</code> utility is used to configure encryption on GEOM providers. <p class=Pp>The following is a list of the most important features:</p><p class=Pp></p><ul class="Bl-bullet Bd-indent Bl-compact"><li>Utilizes the <a class=Xr href=crypto.9.html>crypto(9)</a> framework, so when there is crypto hardware available, <code class=Nm>geli</code> will make use of it automatically.</li><li>Supports many cryptographic algorithms (currently <code class=Nm>AES-XTS</code>, <code class=Nm>AES-CBC</code>, and <code class=Nm>Camellia-CBC</code>).</li><li>Can optionally perform data authentication (integrity verification) utilizing one of the following algorithms: <code class=Nm>HMAC/SHA1</code>, <code class=Nm>HMAC/RIPEMD160</code>, <code class=Nm>HMAC/SHA256</code>, <code class=Nm>HMAC/SHA384</code> or <code class=Nm>HMAC/SHA512</code>.</li><li>Can create a User Key from up to two, piecewise components: a passphrase entered via prompt or read from one or more passfiles; a keyfile read from one or more files.</li><li>Allows encryption of the root partition. The user is asked for the passphrase before the root filesystem is mounted.</li><li>Strengthens the passphrase component of the User Key with: <cite class=Rs><span class=RsA>B. Kaliski</span>, <span class=RsT>PKCS #5: Password-Based Cryptography Specification, Version 2.0.</span>, <span class=RsR>RFC</span>, <span class=RsN>2898</span>.</cite></li><li>Allows the use of two independent User Keys (e.g., a “user key” and a “company key”).</li><li>It is fast - <code class=Nm>geli</code> performs simple sector-to-sector encryption.</li><li>Allows the encrypted Master Key to be backed up and restored, so that if a user has to quickly destroy key material, it is possible to get the data back by restoring keys from backup.</li><li>Providers can be configured to automatically detach on last close, so users do not have to remember to detach providers after unmounting the filesystems.</li><li>Allows attaching a provider with a random, one-time Master Key, which is useful for swap partitions and temporary filesystems.</li><li>Allows verification of data integrity (data authentication).</li><li>Allows suspending and resuming encrypted devices.</li></ul><p class=Pp>The first argument to <code class=Nm>geli</code> indicates an action to be performed:</p><dl class=Bl-tag><dt><a class=permalink href=#init><code class=Cm id=init>init</code></a></dt><dd>Initialize providers which need to be encrypted. If multiple providers are listed as arguments, they will all be initialized with the same passphrase and/or User Key. A unique salt will be randomly generated for each provider to ensure the Master Key for each is unique. Here you can set up the cryptographic algorithm to use, Data Key length, etc. The last sector of the providers is used to store metadata. The <code class=Cm>init</code> subcommand also automatically writes metadata backups to <span class=Pa>/var/backups/&lt;prov&gt;.eli</span> file. The metadata can be recovered with the <code class=Cm>restore</code> subcommand described below. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a><code class=Fl id=a>-a</code></a><var class=Ar>aalgo</var></dt><dd>Enable data integrity verification (authentication) using the given algorithm. This will reduce the size of storage available and also reduce speed. For example, when using 4096 bytes sector and <code class=Nm>HMAC/SHA256</code> algorithm, 89% of the original provider storage will be available for use. Currently supported algorithms are: <code class=Nm>HMAC/SHA1</code>, <code class=Nm>HMAC/RIPEMD160</code>, <code class=Nm>HMAC/SHA256</code>, <code class=Nm>HMAC/SHA384</code> and <code class=Nm>HMAC/SHA512</code>. If the option is not given, there will be no authentication, only encryption. The recommended algorithm is <code class=Nm>HMAC/SHA256</code>.</dd><dt><a class=permalink href=#b><code class=Fl id=b>-b</code></a></dt><dd>Try to decrypt this partition during boot, before the root partition is mounted. This makes it possible to use an encrypted root partition. One will still need bootable unencrypted storage with a <span class=Pa>/boot/</span> directory, which can be a CD-ROM disc or USB pen-drive, that can be removed after boot.</dd><dt><a class=permalink href=#B><code class=Fl id=B>-B</code></a><var class=Ar>backupfile</var></dt><dd>File name to use for metadata backup instead of the default <span class=Pa>/var/backups/&lt;prov&gt;.eli</span>. To inhibit backups, you can use <span class=Pa>none</span> as the <var class=Ar>backupfile</var>. If multiple providers were initialized in the one command, you can use <span class=Pa>PROV</span> (all upper-case) in the file name, and it will be replaced with the provider name. If <span class=Pa>PROV</span> is not found in the file name and multiple providers were initialized in the one command, <span class=Pa>-&lt;prov&gt;</span> will be appended to the end of the file name specified.</dd><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a></dt><dd>When entering the passphrase to boot from this encrypted root filesystem, echo ‘<code class=Li>*</code>’ characters. This makes the length of the passphrase visible.</dd><dt><a class=permalink href=#e><code class=Fl id=e>-e</code></a><var class=Ar>ealgo</var></dt><dd>Encryption algorithm to use. Currently supported algorithms are: <code class=Nm>AES-XTS</code>, <code class=Nm>AES-CBC</code>, <code class=Nm>Camellia-CBC</code>, and <code class=Nm>NULL</code>. The default and recommended algorithm is <code class=Nm>AES-XTS</code>. <code class=Nm>NULL</code> is unencrypted.</dd><dt><a class=permalink href=#g><code class=Fl id=g>-g</code></a></dt><dd>Enable booting from this encrypted root filesystem. The boot loader prompts for the passphrase and loads <a class=Xr href=loader.8.html>loader(8)</a> from the encrypted partition.</dd><dt><a class=permalink href=#i><code class=Fl id=i>-i</code></a><var class=Ar>iterations</var></dt><dd>Number of iterations to use with PKCS#5v2 when processing User Key passphrase component. If this option is not specified, <code class=Nm>geli</code> will find the number of iterations which is equal to 2 seconds of crypto work. If 0 is given, PKCS#5v2 will not be used. PKCS#5v2 processing is performed once, after all parts of the passphrase component have been read.</dd><dt><a class=permalink href=#J><code class=Fl id=J>-J</code></a><var class=Ar>newpassfile</var></dt><dd>Specifies a file which contains the passphrase component of the User Key (or part of it). If <var class=Ar>newpassfile</var> is given as -, standard input will be used. Only the first line (excluding new-line character) is taken from the given file. This argument can be specified multiple times, which has the effect of reassembling a single passphrase split across multiple files. Cannot be combined with the <code class=Fl>-P</code> option.</dd><dt><a class=permalink href=#K><code class=Fl id=K>-K</code></a><var class=Ar>newkeyfile</var></dt><dd>Specifies a file which contains the keyfile component of the User Key (or part of it). If <var class=Ar>newkeyfile</var> is given as -, standard input will be used. This argument can be specified multiple times, which has the effect of reassembling a single keyfile split across multiple keyfile parts.</dd><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a><var class=Ar>keylen</var></dt><dd>Data Key length to use with the given cryptographic algorithm. If the length is not specified, the selected algorithm uses its <i class=Em>default</i> key length. <dl class="Bl-ohang Bd-indent"><dt><code class=Nm>AES-XTS</code></dt><dd><i class=Em>128</i>, 256</dd><dt><code class=Nm>AES-CBC</code>, <code class=Nm>Camellia-CBC</code></dt><dd><i class=Em>128</i>, 192, 256</dd></dl></dd><dt><a class=permalink href=#P><code class=Fl id=P>-P</code></a></dt><dd>Do not use a passphrase as a component of the User Key. Cannot be combined with the <code class=Fl>-J</code> option.</dd><dt><a class=permalink href=#s><code class=Fl id=s>-s</code></a><var class=Ar>sectorsize</var></dt><dd>Change decrypted provider's sector size. Increasing the sector size allows increased performance, because encryption/decryption which requires an initialization vector is done per sector; fewer sectors means less computational work.</dd><dt><a class=permalink href=#R><code class=Fl id=R>-R</code></a></dt><dd>Turn off automatic expansion. By default, if the underlying provider grows, the encrypted provider will grow automatically too. The metadata will be moved to the new location. If automatic expansion if turned off and the underlying provider changes size, attaching encrypted provider will no longer be possible as the metadata will no longer be located in the last sector. In this case <code class=Nm>GELI</code> will only log the previous size of the underlying provider, so metadata can be found easier, if resize was done by mistake.</dd><dt><a class=permalink href=#T><code class=Fl id=T>-T</code></a></dt><dd>Don't pass through <code class=Dv>BIO_DELETE</code> calls (i.e., TRIM/UNMAP). This can prevent an attacker from knowing how much space you're actually using and which sectors contain live data, but will also prevent the backing store (SSD, etc) from reclaiming space you're not using, which may degrade its performance and lifespan. The underlying provider may or may not actually obliterate the deleted sectors when TRIM is enabled, so it should not be considered to add any security.</dd><dt><a class=permalink href=#V><code class=Fl id=V>-V</code></a><var class=Ar>version</var></dt><dd>Metadata version to use. This option is helpful when creating a provider that may be used by older <code class=Nm>FreeBSD/GELI</code> versions. Consult the <a class=Sx href=#HISTORY>HISTORY</a> section to find which metadata version is supported by which <span class=Ux>FreeBSD</span> version. Note that using an older version of metadata may limit the number of features available.</dd></dl></dd><dt><a class=permalink href=#attach><code class=Cm id=attach>attach</code></a></dt><dd>Attach the given providers. The encrypted Master Keys are loaded from the metadata and decrypted using the given passphrase/keyfile and new GEOM providers are created using the specified provider names. A “.eli” suffix is added to the user specified provider names. Multiple providers can only be attached with a single <code class=Cm>attach</code> command if they all have the same passphrase and keyfiles. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#C><code class=Fl id=C>-C</code></a></dt><dd>Do a dry-run decryption. This is useful to verify passphrase and keyfile without decrypting the device.</dd><dt><a class=permalink href=#d_2><code class=Fl id=d_2>-d</code></a></dt><dd>If specified, the decrypted providers are detached automatically on last close, so the user does not have to remember to detach providers after unmounting the filesystems. This only works when providers were opened for writing, and will not work if the filesystems on the providers were mounted read-only. Probably a better choice is the <code class=Fl>-l</code> option for the <code class=Cm>detach</code> subcommand.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a><var class=Ar>keyno</var></dt><dd>Specifies the index number of the Master Key copy to use (could be 0 or 1). If the index number is not provided all keys will be tested.</dd><dt><a class=permalink href=#j><code class=Fl id=j>-j</code></a><var class=Ar>passfile</var></dt><dd>Specifies a file which contains the passphrase component of the User Key (or part of it). For more information see the description of the <code class=Fl>-J</code> option for the <code class=Cm>init</code> subcommand. The same passfiles are used for all listed providers.</dd><dt><a class=permalink href=#k><code class=Fl id=k>-k</code></a><var class=Ar>keyfile</var></dt><dd>Specifies a file which contains the keyfile component of the User Key (or part of it). For more information see the description of the <code class=Fl>-K</code> option for the <code class=Cm>init</code> subcommand. The same keyfiles are used for all listed providers.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a></dt><dd>Do not use a passphrase as a component of the User Keys. Cannot be combined with the <code class=Fl>-j</code> option.</dd><dt><a class=permalink href=#r><code class=Fl id=r>-r</code></a></dt><dd>Attach read-only providers. They are not opened for writing.</dd></dl></dd><dt><a class=permalink href=#detach><code class=Cm id=detach>detach</code></a></dt><dd>Detach the given providers, which means remove the devfs entry and clear the Master Key and Data Keys from memory. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a></dt><dd>Force detach - detach even if the provider is open.</dd><dt><a class=permalink href=#l_2><code class=Fl id=l_2>-l</code></a></dt><dd>Mark provider to detach on last close, after the last filesystem has been unmounted. If this option is specified, the provider will not be detached while it is open, but will be automatically detached when it is closed for the last time even if it was only opened for reading.</dd></dl></dd><dt><a class=permalink href=#onetime><code class=Cm id=onetime>onetime</code></a></dt><dd>Attach the given providers with a random, one-time (ephemeral) Master Key. The command can be used to encrypt swap partitions or temporary filesystems. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a_2><code class=Fl id=a_2>-a</code></a><var class=Ar>aalgo</var></dt><dd>Enable data integrity verification (authentication). For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#e_2><code class=Fl id=e_2>-e</code></a><var class=Ar>ealgo</var></dt><dd>Encryption algorithm to use. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#d_3><code class=Fl id=d_3>-d</code></a></dt><dd>Detach on last close, after the last filesystem has been unmounted. Note: this option is not usable for temporary filesystems as the provider is detached after the filesystem has been created. It still can, and should, be used for swap partitions. For more information, see the description of the <code class=Cm>attach</code> subcommand.</dd><dt><a class=permalink href=#l_3><code class=Fl id=l_3>-l</code></a><var class=Ar>keylen</var></dt><dd>Data Key length to use with the given cryptographic algorithm. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#s_2><code class=Fl id=s_2>-s</code></a><var class=Ar>sectorsize</var></dt><dd>Change decrypted provider's sector size. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#R_2><code class=Fl id=R_2>-R</code></a></dt><dd>Turn off automatic expansion. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#T_2><code class=Fl id=T_2>-T</code></a></dt><dd>Disable TRIM/UNMAP passthru. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd></dl></dd><dt><a class=permalink href=#configure><code class=Cm id=configure>configure</code></a></dt><dd>Change configuration of the given providers. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#b_2><code class=Fl id=b_2>-b</code></a></dt><dd>Set the BOOT flag on the given providers. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#B_2><code class=Fl id=B_2>-B</code></a></dt><dd>Remove the BOOT flag from the given providers.</dd><dt><a class=permalink href=#d_4><code class=Fl id=d_4>-d</code></a></dt><dd>When entering the passphrase to boot from this encrypted root filesystem, echo ‘<code class=Li>*</code>’ characters. This makes the length of the passphrase visible.</dd><dt><a class=permalink href=#D><code class=Fl id=D>-D</code></a></dt><dd>Disable echoing of any characters when a passphrase is entered to boot from this encrypted root filesystem. This hides the passphrase length.</dd><dt><a class=permalink href=#g_2><code class=Fl id=g_2>-g</code></a></dt><dd>Enable booting from this encrypted root filesystem. The boot loader prompts for the passphrase and loads <a class=Xr href=loader.8.html>loader(8)</a> from the encrypted partition.</dd><dt><a class=permalink href=#G><code class=Fl id=G>-G</code></a></dt><dd>Deactivate booting from this encrypted root partition.</dd><dt><a class=permalink href=#r_2><code class=Fl id=r_2>-r</code></a></dt><dd>Turn on automatic expansion. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#R_3><code class=Fl id=R_3>-R</code></a></dt><dd>Turn off automatic expansion.</dd><dt><a class=permalink href=#t><code class=Fl id=t>-t</code></a></dt><dd>Enable TRIM/UNMAP passthru. For more information, see the description of the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#T_3><code class=Fl id=T_3>-T</code></a></dt><dd>Disable TRIM/UNMAP passthru.</dd></dl></dd><dt><a class=permalink href=#setkey><code class=Cm id=setkey>setkey</code></a></dt><dd>Install a copy of the Master Key into the selected slot, encrypted with a new User Key. If the selected slot is populated, replace the existing copy. A provider has one Master Key, which can be stored in one or both slots, each encrypted with an independent User Key. With the <code class=Cm>init</code> subcommand, only key number 0 is initialized. The User Key can be changed at any time: for an attached provider, for a detached provider, or on the backup file. When a provider is attached, the user does not have to provide an existing passphrase/keyfile. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#i_2><code class=Fl id=i_2>-i</code></a><var class=Ar>iterations</var></dt><dd>Number of iterations to use with PKCS#5v2. If 0 is given, PKCS#5v2 will not be used. To be able to use this option with the <code class=Cm>setkey</code> subcommand, only one key has to be defined and this key must be changed.</dd><dt><a class=permalink href=#j_2><code class=Fl id=j_2>-j</code></a><var class=Ar>passfile</var></dt><dd>Specifies a file which contains the passphrase component of a current User Key (or part of it).</dd><dt><a class=permalink href=#J_2><code class=Fl id=J_2>-J</code></a><var class=Ar>newpassfile</var></dt><dd>Specifies a file which contains the passphrase component of the new User Key (or part of it).</dd><dt><a class=permalink href=#k_2><code class=Fl id=k_2>-k</code></a><var class=Ar>keyfile</var></dt><dd>Specifies a file which contains the keyfile component of a current User Key (or part of it).</dd><dt><a class=permalink href=#K_2><code class=Fl id=K_2>-K</code></a><var class=Ar>newkeyfile</var></dt><dd>Specifies a file which contains the keyfile component of the new User Key (or part of it).</dd><dt><a class=permalink href=#n_2><code class=Fl id=n_2>-n</code></a><var class=Ar>keyno</var></dt><dd>Specifies the index number of the Master Key copy to change (could be 0 or 1). If the provider is attached and no key number is given, the key used for attaching the provider will be changed. If the provider is detached (or we are operating on a backup file) and no key number is given, the first Master Key copy to be successfully decrypted with the provided User Key passphrase/keyfile will be changed.</dd><dt><a class=permalink href=#p_2><code class=Fl id=p_2>-p</code></a></dt><dd>Do not use a passphrase as a component of the current User Key. Cannot be combined with the <code class=Fl>-j</code> option.</dd><dt><a class=permalink href=#P_2><code class=Fl id=P_2>-P</code></a></dt><dd>Do not use a passphrase as a component of the new User Key. Cannot be combined with the <code class=Fl>-J</code> option.</dd></dl></dd><dt><a class=permalink href=#delkey><code class=Cm id=delkey>delkey</code></a></dt><dd>Destroy (overwrite with random data) the selected Master Key copy. If one is destroying keys for an attached provider, the provider will not be detached even if all copies of the Master Key are destroyed. It can even be rescued with the <code class=Cm>setkey</code> subcommand because the Master Key is still in memory. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a_3><code class=Fl id=a_3>-a</code></a></dt><dd>Destroy all copies of the Master Key (does not need <code class=Fl>-f</code> option).</dd><dt><a class=permalink href=#f_2><code class=Fl id=f_2>-f</code></a></dt><dd>Force key destruction. This option is needed to destroy the last copy of the Master Key.</dd><dt><a class=permalink href=#n_3><code class=Fl id=n_3>-n</code></a><var class=Ar>keyno</var></dt><dd>Specifies the index number of the Master Key copy. If the provider is attached and no key number is given, the key used for attaching the provider will be destroyed. If provider is detached (or we are operating on a backup file) the key number has to be given.</dd></dl></dd><dt><a class=permalink href=#kill><code class=Cm id=kill>kill</code></a></dt><dd>This command should be used only in emergency situations. It will destroy all copies of the Master Key on a given provider and will detach it forcibly (if it is attached). This is absolutely a one-way command - if you do not have a metadata backup, your data is gone for good. In case the provider was attached with the <code class=Fl>-r</code> flag, the keys will not be destroyed, only the provider will be detached. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a_4><code class=Fl id=a_4>-a</code></a></dt><dd>If specified, all currently attached providers will be killed.</dd></dl></dd><dt><a class=permalink href=#backup><code class=Cm id=backup>backup</code></a></dt><dd>Backup metadata from the given provider to the given file.</dd><dt><a class=permalink href=#restore><code class=Cm id=restore>restore</code></a></dt><dd>Restore metadata from the given file to the given provider. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#f_3><code class=Fl id=f_3>-f</code></a></dt><dd>Metadata contains the size of the provider to ensure that the correct partition or slice is attached. If an attempt is made to restore metadata to a provider that has a different size, <code class=Nm>geli</code> will refuse to restore the data unless the <code class=Fl>-f</code> switch is used. If the partition or slice has been grown, the <code class=Cm>resize</code> subcommand should be used rather than attempting to relocate the metadata through <code class=Cm>backup</code> and <code class=Cm>restore</code>.</dd></dl></dd><dt><a class=permalink href=#suspend><code class=Cm id=suspend>suspend</code></a></dt><dd>Suspend device by waiting for all inflight requests to finish, clearing all sensitive information such as the Master Key and Data Keys from kernel memory, and blocking all further I/O requests until the <code class=Cm>resume</code> subcommand is executed. This functionality is useful for laptops. Suspending a laptop should not leave an encrypted device attached. The <code class=Cm>suspend</code> subcommand can be used rather than closing all files and directories from filesystems on the encrypted device, unmounting the filesystem, and detaching the device. Any access to the encrypted device will be blocked until the Master Key is reloaded through the <code class=Cm>resume</code> subcommand. Thus there is no need to close nor unmount anything. The <code class=Cm>suspend</code> subcommand does not work with devices created with the <code class=Cm>onetime</code> subcommand. Please note that sensitive data might still be present in memory locations such as the filesystem cache after suspending an encrypted device. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#a_5><code class=Fl id=a_5>-a</code></a></dt><dd>Suspend all <code class=Nm>geli</code> devices.</dd></dl></dd><dt><a class=permalink href=#resume><code class=Cm id=resume>resume</code></a></dt><dd>Resume previously suspended device. The caller must ensure that executing this subcommand does not access the suspended device, leading to a deadlock. For example, suspending a device which contains the filesystem where the <code class=Nm>geli</code> utility is stored is a bad idea. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#j_3><code class=Fl id=j_3>-j</code></a><var class=Ar>passfile</var></dt><dd>Specifies a file which contains the passphrase component of the User Key, or part of it. For more information see the description of the <code class=Fl>-J</code> option for the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#k_3><code class=Fl id=k_3>-k</code></a><var class=Ar>keyfile</var></dt><dd>Specifies a file which contains the keyfile component of the User Key, or part of it. For more information see the description of the <code class=Fl>-K</code> option for the <code class=Cm>init</code> subcommand.</dd><dt><a class=permalink href=#p_3><code class=Fl id=p_3>-p</code></a></dt><dd>Do not use a passphrase as a component of the User Key. Cannot be combined with the <code class=Fl>-j</code> option.</dd></dl></dd><dt><a class=permalink href=#resize><code class=Cm id=resize>resize</code></a></dt><dd>Inform <code class=Nm>geli</code> that the provider has been resized. The old metadata block is relocated to the correct position at the end of the provider and the provider size is updated. <p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#s_3><code class=Fl id=s_3>-s</code></a><var class=Ar>oldsize</var></dt><dd>The size of the provider before it was resized.</dd></dl></dd><dt><a class=permalink href=#version><code class=Cm id=version>version</code></a></dt><dd>If no arguments are given, the <code class=Cm>version</code> subcommand will print the version of <code class=Nm>geli</code> userland utility as well as the version of the <code class=Nm>ELI</code> GEOM class. <p class=Pp>If GEOM providers are specified, the <code class=Cm>version</code> subcommand will print metadata version used by each of them.</p></dd><dt><a class=permalink href=#clear><code class=Cm id=clear>clear</code></a></dt><dd>Clear metadata from the given providers. <i class=Em>WARNING</i>: This will erase with zeros the encrypted Master Key copies stored in the metadata.</dd><dt><a class=permalink href=#dump><code class=Cm id=dump>dump</code></a></dt><dd>Dump metadata stored on the given providers.</dd><dt><a class=permalink href=#list><code class=Cm id=list>list</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#status><code class=Cm id=status>status</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#load><code class=Cm id=load>load</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd><dt><a class=permalink href=#unload><code class=Cm id=unload>unload</code></a></dt><dd>See <a class=Xr href=geom.8.html>geom(8)</a>.</dd></dl><p class=Pp>Additional options include:</p><dl class=Bl-tag><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Be more verbose.</dd></dl></section><section class=Sh><h2 class=Sh id=KEY_SUMMARY><a class=permalink href=#KEY_SUMMARY>KEY SUMMARY</a></h2><section class=Ss><h2 class=Ss id=Master_Key><a class=permalink href=#Master_Key>Master Key</a></h2> Upon <code class=Cm>init</code>, the <code class=Nm>geli</code> utility generates a random Master Key for the provider. The Master Key never changes during the lifetime of the provider. Each copy of the provider metadata, active or backed up to a file, can store up to two, independently-encrypted copies of the Master Key. </section><section class=Ss><h2 class=Ss id=User_Key><a class=permalink href=#User_Key>User Key</a></h2> Each stored copy of the Master Key is encrypted with a User Key, which is generated by the <code class=Nm>geli</code> utility from a passphrase and/or a keyfile. The <code class=Nm>geli</code> utility first reads all parts of the keyfile in the order specified on the command line, then reads all parts of the stored passphrase in the order specified on the command line. If no passphrase parts are specified, the system prompts the user to enter the passphrase. The passphrase is optionally strengthened by PKCS#5v2. The User Key is a digest computed over the concatenated keyfile and passphrase. </section><section class=Ss><h2 class=Ss id=Data_Key><a class=permalink href=#Data_Key>Data Key</a></h2> During operation, one or more Data Keys are deterministically derived by the kernel from the Master Key and cached in memory. The number of Data Keys used by a given provider, and the way they are derived, depend on the GELI version and whether the provider is configured to use data authentication. </section></section><section class=Sh><h2 class=Sh id=SYSCTL_VARIABLES><a class=permalink href=#SYSCTL_VARIABLES>SYSCTL VARIABLES</a></h2> The following <a class=Xr href=sysctl.8.html>sysctl(8)</a> variables can be used to control the behavior of the <code class=Nm>ELI</code> GEOM class. The default value is shown next to each variable. Some variables can also be set in <span class=Pa>/boot/loader.conf</span>. <dl class=Bl-tag><dt><var class=Va>kern.geom.eli.version</var></dt><dd>Version number of the <code class=Nm>ELI</code> GEOM class.</dd><dt><var class=Va>kern.geom.eli.debug</var>: <span class=No>0</span></dt><dd>Debug level of the <code class=Nm>ELI</code> GEOM class. This can be set to a number between 0 and 3 inclusive. If set to 0, minimal debug information is printed. If set to 3, the maximum amount of debug information is printed.</dd><dt><var class=Va>kern.geom.eli.tries</var>: <span class=No>3</span></dt><dd>Number of times a user is asked for the passphrase. This is only used for providers which are attached on boot, before the root filesystem is mounted. If set to 0, attaching providers on boot will be disabled. This variable should be set in <span class=Pa>/boot/loader.conf</span>.</dd><dt><var class=Va>kern.geom.eli.overwrites</var>: <span class=No>5</span></dt><dd>Specifies how many times the Master Key is overwritten with random values when it is destroyed. After this operation it is filled with zeros.</dd><dt><var class=Va>kern.geom.eli.visible_passphrase</var>: <span class=No>0</span></dt><dd>If set to 1, the passphrase entered on boot will be visible. This alternative should be used with caution as the entered passphrase can be logged and exposed via <a class=Xr href=dmesg.8.html>dmesg(8)</a>. This variable should be set in <span class=Pa>/boot/loader.conf</span>.</dd><dt><var class=Va>kern.geom.eli.threads</var>: <span class=No>0</span></dt><dd>Specifies how many kernel threads should be used for doing software cryptography. Its purpose is to increase performance on SMP systems. If set to 0, a CPU-pinned thread will be started for every active CPU.</dd><dt><var class=Va>kern.geom.eli.batch</var>: <span class=No>0</span></dt><dd>When set to 1, can speed-up crypto operations by using batching. Batching reduces the number of interrupts by responding to a group of crypto requests with one interrupt. The crypto card and the driver has to support this feature.</dd><dt><var class=Va>kern.geom.eli.key_cache_limit</var>: <span class=No>8192</span></dt><dd>Specifies how many Data Keys to cache. The default limit (8192 keys) will allow caching of all keys for a 4TB provider with 512 byte sectors and will take around 1MB of memory.</dd><dt><var class=Va>kern.geom.eli.key_cache_hits</var></dt><dd>Reports how many times we were looking up a Data Key and it was already in cache. This sysctl is not updated for providers that need fewer Data Keys than the limit specified in <var class=Va>kern.geom.eli.key_cache_limit</var>.</dd><dt><var class=Va>kern.geom.eli.key_cache_misses</var></dt><dd>Reports how many times we were looking up a Data Key and it was not in cache. This sysctl is not updated for providers that need fewer Data Keys than the limit specified in <var class=Va>kern.geom.eli.key_cache_limit</var>. <var class=Va>kern.geom.eli.unmapped_io</var> Enable support for unmapped I/O buffers, currently implemented only on 64-bit platforms. This is an optimization which reduces the overhead of I/O processing. This variable is intended for debugging purposes and must be set in <span class=Pa>/boot/loader.conf</span>.</dd></dl></section><section class=Sh><h2 class=Sh id=EXIT_STATUS><a class=permalink href=#EXIT_STATUS>EXIT STATUS</a></h2> Exit status is 0 on success, and 1 if the command fails. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> Initialize a provider which is going to be encrypted with a passphrase and random data from a file on the user's pen drive. Use 4kB sector size. Attach the provider, create a filesystem, and mount it. Do the work. Unmount the provider and detach it: <div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/random of=/mnt/pendrive/da2.key bs=64 count=1
# geli init -s 4096 -K /mnt/pendrive/da2.key /dev/da2
Enter new passphrase:
Reenter new passphrase:
# geli attach -k /mnt/pendrive/da2.key /dev/da2
Enter passphrase:
# dd if=/dev/random of=/dev/da2.eli bs=1m
# newfs /dev/da2.eli
# mount /dev/da2.eli /mnt/secret
...
# umount /mnt/secret
# geli detach da2.eli
</pre></div><p class=Pp>Create an encrypted provider, but use two User Keys: one for your employee and one for you as the company's security officer (so it is not a tragedy if the employee “accidentally” forgets his passphrase):</p><div class="Bd Pp Bd-indent"><pre>
# geli init /dev/da2
Enter new passphrase:	(enter security officer's passphrase)
Reenter new passphrase:
# geli setkey -n 1 /dev/da2
Enter passphrase:	(enter security officer's passphrase)
Enter new passphrase:	(let your employee enter his passphrase ...)
Reenter new passphrase:	(... twice)
</pre></div><p class=Pp>You are the security officer in your company. Create an encrypted provider for use by the user, but remember that users forget their passphrases, so backup the Master Key with your own random key:</p><div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/random of=/mnt/pendrive/keys/`hostname` bs=64 count=1
# geli init -P -K /mnt/pendrive/keys/`hostname` /dev/ada0s1e
# geli backup /dev/ada0s1e /mnt/pendrive/backups/`hostname`
(use key number 0, so the encrypted Master Key will be re-encrypted by this)
# geli setkey -n 0 -k /mnt/pendrive/keys/`hostname` /dev/ada0s1e
(allow the user to enter his passphrase)
Enter new passphrase:
Reenter new passphrase:
</pre></div><p class=Pp>Encrypted swap partition setup:</p><div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/random of=/dev/ada0s1b bs=1m
# geli onetime -d ada0s1b
# swapon /dev/ada0s1b.eli
</pre></div><p class=Pp>The example below shows how to configure two providers which will be attached on boot, before the root filesystem is mounted. One of them is using passphrase and three keyfile parts and the other is using only a keyfile in one part:</p><div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/random of=/dev/da0 bs=1m
# dd if=/dev/random of=/boot/keys/da0.key0 bs=32k count=1
# dd if=/dev/random of=/boot/keys/da0.key1 bs=32k count=1
# dd if=/dev/random of=/boot/keys/da0.key2 bs=32k count=1
# geli init -b -K /boot/keys/da0.key0 -K /boot/keys/da0.key1 -K /boot/keys/da0.key2 da0
Enter new passphrase:
Reenter new passphrase:
# dd if=/dev/random of=/dev/da1s3a bs=1m
# dd if=/dev/random of=/boot/keys/da1s3a.key bs=128k count=1
# geli init -b -P -K /boot/keys/da1s3a.key da1s3a
</pre></div><p class=Pp>The providers are initialized, now we have to add these lines to <span class=Pa>/boot/loader.conf</span>:</p><div class="Bd Pp Bd-indent"><pre>
geli_da0_keyfile0_load="YES"
geli_da0_keyfile0_type="da0:geli_keyfile0"
geli_da0_keyfile0_name="/boot/keys/da0.key0"
geli_da0_keyfile1_load="YES"
geli_da0_keyfile1_type="da0:geli_keyfile1"
geli_da0_keyfile1_name="/boot/keys/da0.key1"
geli_da0_keyfile2_load="YES"
geli_da0_keyfile2_type="da0:geli_keyfile2"
geli_da0_keyfile2_name="/boot/keys/da0.key2"

geli_da1s3a_keyfile0_load="YES"
geli_da1s3a_keyfile0_type="da1s3a:geli_keyfile0"
geli_da1s3a_keyfile0_name="/boot/keys/da1s3a.key"
</pre></div><p class=Pp>If there is only one keyfile, the index might be omitted:</p><div class="Bd Pp Bd-indent"><pre>
geli_da1s3a_keyfile_load="YES"
geli_da1s3a_keyfile_type="da1s3a:geli_keyfile"
geli_da1s3a_keyfile_name="/boot/keys/da1s3a.key"
</pre></div><p class=Pp>By convention, these loader variables are called <var class=Va>geli_</var><span class=No>&lt;</span><var class=Ar>device</var><span class=No>&gt;</span><var class=Va>_load</var>. However, the actual name prefix before <var class=Va>_load</var>, <var class=Va>_type</var>, or <var class=Va>_name</var> does not matter. At boot time, the <code class=Nm>geli</code> module searches through all <span class=No>&lt;</span><var class=Va>prefix</var><span class=No>&gt;</span><var class=Va>_type</var><span class=No>-like</span> variables that have a value of “&lt;<var class=Ar>device</var><span class=No>&gt;:geli_keyfile</span>”. The paths to keyfiles are then extracted from <span class=No>&lt;</span><var class=Ar>prefix</var><span class=No>&gt;</span><var class=Va>_name</var> variables. In the example above, <var class=Ar>prefix</var> is “<code class=Li>geli_da1s3a_keyfile</code>”.</p><p class=Pp>Not only configure encryption, but also data integrity verification using <code class=Nm>HMAC/SHA256</code>.</p><div class="Bd Pp Bd-indent"><pre>
# geli init -a hmac/sha256 -s 4096 /dev/da0
Enter new passphrase:
Reenter new passphrase:
# geli attach /dev/da0
Enter passphrase:
# dd if=/dev/random of=/dev/da0.eli bs=1m
# newfs /dev/da0.eli
# mount /dev/da0.eli /mnt/secret
</pre></div><p class=Pp><code class=Cm>geli</code> writes the metadata backup by default to the <span class=Pa>/var/backups/&lt;prov&gt;.eli</span> file. If the metadata is lost in any way (e.g., by accidental overwrite), it can be restored. Consider the following situation:</p><div class="Bd Pp Bd-indent"><pre>
# geli init /dev/da0
Enter new passphrase:
Reenter new passphrase:

Metadata backup can be found in /var/backups/da0.eli and
can be restored with the following command:

	# geli restore /var/backups/da0.eli /dev/da0

# geli clear /dev/da0
# geli attach /dev/da0
geli: Cannot read metadata from /dev/da0: Invalid argument.
# geli restore /var/backups/da0.eli /dev/da0
# geli attach /dev/da0
Enter passphrase:
</pre></div><p class=Pp>If an encrypted filesystem is extended, it is necessary to relocate and update the metadata:</p><div class="Bd Pp Bd-indent"><pre>
# gpart create -s GPT ada0
# gpart add -s 1g -t freebsd-ufs -i 1 ada0
# geli init -K keyfile -P ada0p1
# gpart resize -s 2g -i 1 ada0
# geli resize -s 1g ada0p1
# geli attach -k keyfile -p ada0p1
</pre></div><p class=Pp>Initialize provider with the passphrase split into two files. The provider can be attached using those two files or by entering “foobar” as the passphrase at the <code class=Nm>geli</code> prompt:</p><div class="Bd Pp Bd-indent"><pre>
# echo foo &gt; da0.pass0
# echo bar &gt; da0.pass1
# geli init -J da0.pass0 -J da0.pass1 da0
# geli attach -j da0.pass0 -j da0.pass1 da0
# geli detach da0
# geli attach da0
Enter passphrase: foobar
</pre></div><p class=Pp>Suspend all <code class=Nm>geli</code> devices on a laptop, suspend the laptop, then resume devices one by one after resuming the laptop:</p><div class="Bd Pp Bd-indent"><pre>
# geli suspend -a
# zzz
&lt;resume your laptop&gt;
# geli resume -p -k keyfile gpt/secret
# geli resume gpt/private
Enter passphrase:
</pre></div><p class=Pp>To create a <code class=Nm>geli</code> encrypted filesystem with a file as storage device follow this example. First a file named private0 is created in <span class=Pa>/usr</span> and attached as a memory disk like <span class=Pa>/dev/md0</span> for example.</p><div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/zero of=/usr/private0 bs=1m count=256
# chmod 0600 /usr/private0
# mdconfig -t vnode -f /usr/private0
</pre></div><p class=Pp>It is recommended to place the following line in <a class=Xr href=rc.conf.5.html>rc.conf(5)</a> to have the memory disk automatically created during boot.</p><div class="Bd Pp Bd-indent"><pre>
mdconfig_md0="-t vnode -f /usr/private0"
</pre></div><p class=Pp>After <span class=Pa>/dev/md0</span> is created a random key has to be generated and stored in a secure location, like <span class=Pa>/root</span> for example. This key should be protected by a passphrase, which is requested when geli init is called.</p><div class="Bd Pp Bd-indent"><pre>
# dd if=/dev/random of=/root/private0.key bs=64 count=1
# geli init -K /root/private0.key -s 4096 /dev/md0
Enter new passphrase:
Reenter new passphrase:
# geli attach -k /root/private0.key /dev/md0
Enter passphrase:
# dd if=/dev/random of=/dev/md0.eli bs=1m
</pre></div><p class=Pp>Once the initialization of the <span class=Pa>/dev/md0.eli</span> device is ready create a UFS filesystem and mount it for example in <span class=Pa>/private</span>.</p><div class="Bd Pp Bd-indent"><pre>
# newfs /dev/md0.eli
# mount /dev/md0.eli /private
</pre></div><p class=Pp>After a system reboot the <code class=Nm>geli</code> device can be mounted again with the following commands. The call of geli attach will ask for the passphrase. It is recommended to do this procedure after the boot, because otherwise the boot process would be waiting for the passphrase input.</p><div class="Bd Pp Bd-indent"><pre>
# geli attach -k /root/private0.key /dev/md0
Enter passphrase:
# mount /dev/md0.eli /private
</pre></div></section><section class=Sh><h2 class=Sh id=ENCRYPTION_MODES><a class=permalink href=#ENCRYPTION_MODES>ENCRYPTION MODES</a></h2><code class=Nm>geli</code> supports two encryption modes: <code class=Nm>XTS</code>, which was standardized as <code class=Nm>IEEE P1619</code> and <code class=Nm>CBC</code> with unpredictable IV. The <code class=Nm>CBC</code> mode used by <code class=Nm>geli</code> is very similar to the mode <code class=Nm>ESSIV</code>. </section><section class=Sh><h2 class=Sh id=DATA_AUTHENTICATION><a class=permalink href=#DATA_AUTHENTICATION>DATA AUTHENTICATION</a></h2><code class=Nm>geli</code> can verify data integrity when an authentication algorithm is specified. When data corruption/modification is detected, <code class=Nm>geli</code> will not return any data, but instead will return an error (<code class=Er>EINVAL</code>). The offset and size of the corrupted data will be printed on the console. It is important to know against which attacks <code class=Nm>geli</code> provides protection for your data. If data is modified in-place or copied from one place on the disk to another even without modification, <code class=Nm>geli</code> should be able to detect such a change. If an attacker can remember the encrypted data, he can overwrite any future changes with the data he owns without it being noticed. In other words <code class=Nm>geli</code> will not protect your data against replay attacks. <p class=Pp>It is recommended to write to the whole provider before first use, in order to make sure that all sectors and their corresponding checksums are properly initialized into a consistent state. One can safely ignore data authentication errors that occur immediately after the first time a provider is attached and before it is initialized in this way.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=crypto.4.html>crypto(4)</a>, <a class=Xr href=gbde.4.html>gbde(4)</a>, <a class=Xr href=geom.4.html>geom(4)</a>, <a class=Xr href=loader.conf.5.html>loader.conf(5)</a>, <a class=Xr href=gbde.8.html>gbde(8)</a>, <a class=Xr href=geom.8.html>geom(8)</a>, <a class=Xr href=crypto.9.html>crypto(9)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>geli</code> utility appeared in <span class=Ux>FreeBSD 6.0</span>. Support for the <code class=Nm>Camellia</code> block cipher was implemented by Yoshisato Yanagisawa in <span class=Ux>FreeBSD 7.0</span>. <p class=Pp>Highest <code class=Nm>GELI</code> metadata version supported by the given <span class=Ux>FreeBSD</span> version:</p><table class="Bl-column Bd-indent"><tr><td><b class=Sy>FreeBSD</b></td><td><b class=Sy>GELI</b></td></tr><tr><td><b class=Sy>version</b></td><td><b class=Sy>version</b><p class=Pp></p></td></tr><tr><td><a class=permalink href=#6.0><code class=Li id=6.0>6.0</code></a></td><td>0</td></tr><tr><td><a class=permalink href=#6.1><code class=Li id=6.1>6.1</code></a></td><td>0</td></tr><tr><td><a class=permalink href=#6.2><code class=Li id=6.2>6.2</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#6.3><code class=Li id=6.3>6.3</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#6.4><code class=Li id=6.4>6.4</code></a></td><td>3 <p class=Pp></p></td></tr><tr><td><a class=permalink href=#7.0><code class=Li id=7.0>7.0</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#7.1><code class=Li id=7.1>7.1</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#7.2><code class=Li id=7.2>7.2</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#7.3><code class=Li id=7.3>7.3</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#7.4><code class=Li id=7.4>7.4</code></a></td><td>3 <p class=Pp></p></td></tr><tr><td><a class=permalink href=#8.0><code class=Li id=8.0>8.0</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#8.1><code class=Li id=8.1>8.1</code></a></td><td>3</td></tr><tr><td><a class=permalink href=#8.2><code class=Li id=8.2>8.2</code></a></td><td>5 <p class=Pp></p></td></tr><tr><td><a class=permalink href=#9.0><code class=Li id=9.0>9.0</code></a></td><td>6 <p class=Pp></p></td></tr><tr><td><a class=permalink href=#10.0><code class=Li id=10.0>10.0</code></a></td><td>7</td></tr></table></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Pawel Jakub Dawidek</span> &lt;<a class=Mt href=mailto:pjd@FreeBSD.org>pjd@FreeBSD.org</a>&gt; </section></div><table class=foot><tr><td class=foot-date>April 18, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>