<!DOCTYPE html>
<html><head><meta charset=utf-8><title>siftr(4)</title><keywords content=man,siftr></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>siftr(4)</h1><table class=head><tr><td class=head-ltitle>SIFTR(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>SIFTR(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>SIFTR</code> — <div class=Nd>Statistical Information For TCP Research</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2> To load the driver as a module at run-time, run the following command as root: <div class="Bd Pp Bd-indent"><pre>
kldload siftr
</pre></div><p class=Pp>Alternatively, to load the driver as a module at boot time, add the following line into the <a class=Xr href=loader.conf.5.html>loader.conf(5)</a> file:</p><div class="Bd Pp Bd-indent"><pre>
siftr_load="YES"
</pre></div></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>SIFTR</code> (<i class=Em>S</i>tatistical <i class=Em>I</i>nformation <i class=Em>F</i>or <i class=Em>T</i>CP <i class=Em>R</i>esearch) kernel module logs a range of statistics on active TCP connections to a log file. It provides the ability to make highly granular measurements of TCP connection state, aimed at system administrators, developers and researchers. <section class=Ss><h2 class=Ss id=Compile_time_Configuration><a class=permalink href=#Compile_time_Configuration>Compile-time Configuration</a></h2> The default operation of <code class=Nm>SIFTR</code> is to capture IPv4 TCP/IP packets. <code class=Nm>SIFTR</code> can be configured to support IPv4 and IPv6 by uncommenting: <div class="Bd Pp Bd-indent"><pre>
CFLAGS+=-DSIFTR_IPV6
</pre></div><p class=Pp>in ⟨sys/modules/siftr/Makefile⟩ and recompiling.</p><p class=Pp>In the IPv4-only (default) mode, standard dotted decimal notation (e.g. "136.186.229.95") is used to format IPv4 addresses for logging. In IPv6 mode, standard dotted decimal notation is used to format IPv4 addresses, and standard colon-separated hex notation (see RFC 4291) is used to format IPv6 addresses for logging. Note that SIFTR uses uncompressed notation to format IPv6 addresses. For example, the address "fe80::20f:feff:fea2:531b" would be logged as "fe80:0:0:0:20f:feff:fea2:531b".</p></section><section class=Ss><h2 class=Ss id=Run_time_Configuration><a class=permalink href=#Run_time_Configuration>Run-time Configuration</a></h2><code class=Nm>SIFTR</code> utilises the <a class=Xr href=sysctl.8.html>sysctl(8)</a> interface to export its configuration variables to user-space. The following variables are available: <div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>net.inet.siftr.enabled</var></dt><dd>controls whether the module performs its measurements or not. By default, the value is set to 0, which means the module will not be taking any measurements. Having the module loaded with <var class=Va>net.inet.siftr.enabled</var> set to 0 will have no impact on the performance of the network stack, as the packet filtering hooks are only inserted when <var class=Va>net.inet.siftr.enabled</var> is set to 1.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>net.inet.siftr.ppl</var></dt><dd>controls how many inbound/outbound packets for a given TCP connection will cause a log message to be generated for the connection. By default, the value is set to 1, which means the module will log a message for every packet of every TCP connection. The value can be set to any integer in the range [1,2^32], and can be changed at any time, even while the module is enabled.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>net.inet.siftr.logfile</var></dt><dd>controls the path to the file that the module writes its log messages to. By default, the file /var/log/siftr.log is used. The path can be changed at any time, even while the module is enabled.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>net.inet.siftr.genhashes</var></dt><dd>controls whether a hash is generated for each TCP packet seen by <code class=Nm>SIFTR</code>. By default, the value is set to 0, which means no hashes are generated. The hashes are useful to correlate which TCP packet triggered the generation of a particular log message, but calculating them adds additional computational overhead into the fast path.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>net.inet.siftr.port_filter</var></dt><dd>controls on which source or destination port siftr should capture <code class=Nm>SIFTR</code>. By default, the value is set to 0, which means all ports are eligible for logging. Set to any other value, only packets where either the source or destination port is equal to this number are logged.</dd></dl></div></section><section class=Ss><h2 class=Ss id=Log_Format><a class=permalink href=#Log_Format>Log Format</a></h2> A typical <code class=Nm>SIFTR</code> log file will contain 3 different types of log message. All messages are written in plain ASCII text. <p class=Pp>Note: The “\” present in the example log messages in this section indicates a line continuation and is not part of the actual log message.</p><p class=Pp>The first type of log message is written to the file when the module is enabled and starts collecting data from the running kernel. The text below shows an example module enable log. The fields are tab delimited key-value pairs which describe some basic information about the system.</p><div class="Bd Pp Bd-indent"><pre>
enable_time_secs=1238556193    enable_time_usecs=462104 \
siftrver=1.2.2    hz=1000    tcp_rtt_scale=32 \
sysname=FreeBSD    sysver=604000    ipmode=4
</pre></div><p class=Pp>Field descriptions are as follows:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>enable_time_secs</var></dt><dd>time at which the module was enabled, in seconds since the UNIX epoch.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>enable_time_usecs</var></dt><dd>time at which the module was enabled, in microseconds since enable_time_secs.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>siftrver</var></dt><dd>version of <code class=Nm>SIFTR</code>.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>hz</var></dt><dd>tick rate of the kernel in ticks per second.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>tcp_rtt_scale</var></dt><dd>smoothed RTT estimate scaling factor.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>sysname</var></dt><dd>operating system name.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>sysver</var></dt><dd>operating system version.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>ipmode</var></dt><dd>IP mode as defined at compile time. An ipmode of "4" means IPv6 is not supported and IP addresses are logged in regular dotted quad format. An ipmode of "6" means IPv6 is supported, and IP addresses are logged in dotted quad or hex format, as described in the “Compile-time Configuration” subsection.</dd></dl></div><p class=Pp>The second type of log message is written to the file when a data log message is generated. The text below shows an example data log triggered by an IPv4 TCP/IP packet. The data is CSV formatted.</p><div class="Bd Pp Bd-indent"><pre>
o,0xbec491a5,1238556193.463551,172.16.7.28,22,172.16.2.5,55931, \
1073725440,172312,34,66560,66608,8,1,4,1448,936,1,996,255, \
33304,208,66608,0,208,0
</pre></div><p class=Pp>Field descriptions are as follows:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>1</var></dt><dd>Direction of packet that triggered the log message. Either “i” for in, or “o” for out.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>2</var></dt><dd>Hash of the packet that triggered the log message.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>3</var></dt><dd>Time at which the packet that triggered the log message was processed by the <a class=Xr href=pfil.9.html>pfil(9)</a> hook function, in seconds and microseconds since the UNIX epoch.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>4</var></dt><dd>The IPv4 or IPv6 address of the local host, in dotted quad (IPv4 packet) or colon-separated hex (IPv6 packet) notation.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>5</var></dt><dd>The TCP port that the local host is communicating via.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>6</var></dt><dd>The IPv4 or IPv6 address of the foreign host, in dotted quad (IPv4 packet) or colon-separated hex (IPv6 packet) notation.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>7</var></dt><dd>The TCP port that the foreign host is communicating via.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>8</var></dt><dd>The slow start threshold for the flow, in bytes.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>9</var></dt><dd>The current congestion window for the flow, in bytes.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>10</var></dt><dd>The current state of the t_flags2 field for the flow.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>11</var></dt><dd>The current sending window for the flow, in bytes. The post scaled value is reported, except during the initial handshake (first few packets), during which time the unscaled value is reported.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>12</var></dt><dd>The current receive window for the flow, in bytes. The post scaled value is always reported.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>13</var></dt><dd>The current window scaling factor for the sending window.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>14</var></dt><dd>The current window scaling factor for the receiving window.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>15</var></dt><dd>The current state of the TCP finite state machine, as defined in ⟨<span class=Pa>netinet/tcp_fsm.h</span>⟩.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>16</var></dt><dd>The maximum segment size for the flow, in bytes.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>17</var></dt><dd>The current smoothed RTT estimate for the flow, in units of TCP_RTT_SCALE * HZ, where TCP_RTT_SCALE is a define found in tcp_var.h, and HZ is the kernel's tick timer. Divide by TCP_RTT_SCALE * HZ to get the RTT in secs. TCP_RTT_SCALE and HZ are reported in the enable log message.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>18</var></dt><dd>SACK enabled indicator. 1 if SACK enabled, 0 otherwise.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>19</var></dt><dd>The current state of the TCP flags for the flow. See ⟨<span class=Pa>netinet/tcp_var.h</span>⟩ for information about the various flags.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>20</var></dt><dd>The current retransmission timeout length for the flow, in units of HZ, where HZ is the kernel's tick timer. Divide by HZ to get the timeout length in seconds. HZ is reported in the enable log message.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>21</var></dt><dd>The current size of the socket send buffer in bytes.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>22</var></dt><dd>The current number of bytes in the socket send buffer.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>23</var></dt><dd>The current size of the socket receive buffer in bytes.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>24</var></dt><dd>The current number of bytes in the socket receive buffer.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>25</var></dt><dd>The current number of unacknowledged bytes in-flight. Bytes acknowledged via SACK are not excluded from this count.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>26</var></dt><dd>The current number of segments in the reassembly queue.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>27</var></dt><dd>Flowid for the connection. A caveat: Zero '0' either represents a valid flowid or a default value when it's not being set. There is no easy way to differentiate without looking at actual network interface card and drivers being used.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>28</var></dt><dd>Flow type for the connection. Flowtype defines which protocol fields are hashed to produce the flowid. A complete listing is available in <span class=Pa>sys/mbuf.h</span> under <code class=Dv>M_HASHTYPE_*</code>.</dd></dl></div><p class=Pp>The third type of log message is written to the file when the module is disabled and ceases collecting data from the running kernel. The text below shows an example module disable log. The fields are tab delimited key-value pairs which provide statistics about operations since the module was most recently enabled.</p><div class="Bd Pp Bd-indent"><pre>
disable_time_secs=1238556197    disable_time_usecs=933607 \
num_inbound_tcp_pkts=356    num_outbound_tcp_pkts=627 \
total_tcp_pkts=983    num_inbound_skipped_pkts_malloc=0 \
num_outbound_skipped_pkts_malloc=0    num_inbound_skipped_pkts_mtx=0 \
num_outbound_skipped_pkts_mtx=0    num_inbound_skipped_pkts_tcb=0 \
num_outbound_skipped_pkts_tcb=0    num_inbound_skipped_pkts_icb=0 \
num_outbound_skipped_pkts_icb=0    total_skipped_tcp_pkts=0 \
flow_list=172.16.7.28;22-172.16.2.5;55931,
</pre></div><p class=Pp>Field descriptions are as follows:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>disable_time_secs</var></dt><dd>Time at which the module was disabled, in seconds since the UNIX epoch.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>disable_time_usecs</var></dt><dd>Time at which the module was disabled, in microseconds since disable_time_secs.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_inbound_tcp_pkts</var></dt><dd>Number of TCP packets that traversed up the network stack. This only includes inbound TCP packets during the periods when <code class=Nm>SIFTR</code> was enabled.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_outbound_tcp_pkts</var></dt><dd>Number of TCP packets that traversed down the network stack. This only includes outbound TCP packets during the periods when <code class=Nm>SIFTR</code> was enabled.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>total_tcp_pkts</var></dt><dd>The summation of num_inbound_tcp_pkts and num_outbound_tcp_pkts.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_inbound_skipped_pkts_malloc</var></dt><dd>Number of inbound packets that were not processed because of failed <code class=Fn>malloc</code>() calls.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_outbound_skipped_pkts_malloc</var></dt><dd>Number of outbound packets that were not processed because of failed <code class=Fn>malloc</code>() calls.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_inbound_skipped_pkts_mtx</var></dt><dd>Number of inbound packets that were not processed because of failure to add the packet to the packet processing queue.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_outbound_skipped_pkts_mtx</var></dt><dd>Number of outbound packets that were not processed because of failure to add the packet to the packet processing queue.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_inbound_skipped_pkts_tcb</var></dt><dd>Number of inbound packets that were not processed because of failure to find the TCP control block associated with the packet.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_outbound_skipped_pkts_tcb</var></dt><dd>Number of outbound packets that were not processed because of failure to find the TCP control block associated with the packet.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_inbound_skipped_pkts_icb</var></dt><dd>Number of inbound packets that were not processed because of failure to find the IP control block associated with the packet.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>num_outbound_skipped_pkts_icb</var></dt><dd>Number of outbound packets that were not processed because of failure to find the IP control block associated with the packet.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>total_skipped_tcp_pkts</var></dt><dd>The summation of all skipped packet counters.</dd></dl></div><div class=Bd-indent><dl class=Bl-tag><dt><var class=Va>flow_list</var></dt><dd>A CSV list of TCP flows that triggered data log messages to be generated since the module was loaded. Each flow entry in the CSV list is formatted as “local_ip;local_port-foreign_ip;foreign_port”. If there are no entries in the list (i.e., no data log messages were generated), the value will be blank. If there is at least one entry in the list, a trailing comma will always be present.</dd></dl></div><p class=Pp>The total number of data log messages found in the log file for a module enable/disable cycle should equate to total_tcp_pkts - total_skipped_tcp_pkts.</p></section></section><section class=Sh><h2 class=Sh id=IMPLEMENTATION_NOTES><a class=permalink href=#IMPLEMENTATION_NOTES>IMPLEMENTATION NOTES</a></h2><code class=Nm>SIFTR</code> hooks into the network stack using the <a class=Xr href=pfil.9.html>pfil(9)</a> interface. In its current incarnation, it hooks into the AF_INET/AF_INET6 (IPv4/IPv6) <a class=Xr href=pfil.9.html>pfil(9)</a> filtering points, which means it sees packets at the IP layer of the network stack. This means that TCP packets inbound to the stack are intercepted before they have been processed by the TCP layer. Packets outbound from the stack are intercepted after they have been processed by the TCP layer. <p class=Pp>The diagram below illustrates how <code class=Nm>SIFTR</code> inserts itself into the stack.</p><div class="Bd Pp Bd-indent"><pre>
----------------------------------
           Upper Layers
----------------------------------
    ^                       |
    |                       |
    |                       |
    |                       v
 TCP in                  TCP out
----------------------------------
    ^                      |
    |________     _________|
            |     |
            |     v
           ---------
           | SIFTR |
           ---------
            ^     |
    ________|     |__________
    |                       |
    |                       v
IPv{4/6} in            IPv{4/6} out
----------------------------------
    ^                       |
    |                       |
    |                       v
Layer 2 in             Layer 2 out
----------------------------------
          Physical Layer
----------------------------------
</pre></div><p class=Pp><code class=Nm>SIFTR</code> uses the <a class=Xr href=alq.9.html>alq(9)</a> interface to manage writing data to disk.</p><p class=Pp>At first glance, you might mistakenly think that <code class=Nm>SIFTR</code> extracts information from individual TCP packets. This is not the case. <code class=Nm>SIFTR</code> uses TCP packet events (inbound and outbound) for each TCP flow originating from the system to trigger a dump of the state of the TCP control block for that flow. With the PPL set to 1, we are in effect sampling each TCP flow's control block state as frequently as flow packets enter/leave the system. For example, setting PPL to 2 halves the sampling rate i.e., every second flow packet (inbound OR outbound) causes a dump of the control block state.</p><p class=Pp>The distinction between interrogating individual packets versus interrogating the control block is important, because <code class=Nm>SIFTR</code> does not remove the need for packet capturing tools like <a class=Xr href=tcpdump.1.html>tcpdump(1)</a>. <code class=Nm>SIFTR</code> allows you to correlate and observe the cause-and-affect relationship between what you see on the wire (captured using a tool like <a class=Xr href=tcpdump.1.html>tcpdump(1)</a>) and changes in the TCP control block corresponding to the flow of interest. It is therefore useful to use <code class=Nm>SIFTR</code> and a tool like <a class=Xr href=tcpdump.1.html>tcpdump(1)</a> to gather the necessary data to piece together the complete picture. Use of either tool on its own will not be able to provide all of the necessary data.</p><p class=Pp>As a result of needing to interrogate the TCP control block, certain packets during the lifecycle of a connection are unable to trigger a <code class=Nm>SIFTR</code> log message. The initial handshake takes place without the existence of a control block and the final ACK is exchanged when the connection is in the TIMEWAIT state.</p><p class=Pp><code class=Nm>SIFTR</code> was designed to minimise the delay introduced to packets traversing the network stack. This design called for a highly optimised and minimal hook function that extracted the minimal details necessary whilst holding the packet up, and passing these details to another thread for actual processing and logging.</p><p class=Pp>This multithreaded design does introduce some contention issues when accessing the data structure shared between the threads of operation. When the hook function tries to place details in the structure, it must first acquire an exclusive lock. Likewise, when the processing thread tries to read details from the structure, it must also acquire an exclusive lock to do so. If one thread holds the lock, the other must wait before it can obtain it. This does introduce some additional bounded delay into the kernel's packet processing code path.</p><p class=Pp>In some cases (e.g., low memory, connection termination), TCP packets that enter the <code class=Nm>SIFTR</code><a class=Xr href=pfil.9.html>pfil(9)</a> hook function will not trigger a log message to be generated. <code class=Nm>SIFTR</code> refers to this outcome as a “skipped packet”. Note that <code class=Nm>SIFTR</code> always ensures that packets are allowed to continue through the stack, even if they could not successfully trigger a data log message. <code class=Nm>SIFTR</code> will therefore not introduce any packet loss for TCP/IP packets traversing the network stack.</p><section class=Ss><h2 class=Ss id=Important_Behaviours><a class=permalink href=#Important_Behaviours>Important Behaviours</a></h2> The behaviour of a log file path change whilst the module is enabled is as follows: <ol class=Bl-enum><li>Attempt to open the new file path for writing. If this fails, the path change will fail and the existing path will continue to be used.</li><li>Assuming the new path is valid and opened successfully: <ul class=Bl-dash><li>Flush all pending log messages to the old file path.</li><li>Close the old file path.</li><li>Switch the active log file pointer to point at the new file path.</li><li>Commence logging to the new file.</li></ul></li></ol><p class=Pp>During the time between the flush of pending log messages to the old file and commencing logging to the new file, new log messages will still be generated and buffered. As soon as the new file path is ready for writing, the accumulated log messages will be written out to the file.</p></section></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> To enable the module's operations, run the following command as root: sysctl net.inet.siftr.enabled=1 <p class=Pp>To change the granularity of log messages such that 1 log message is generated for every 10 TCP packets per connection, run the following command as root: sysctl net.inet.siftr.ppl=10</p><p class=Pp>To change the log file location to /tmp/siftr.log, run the following command as root: sysctl net.inet.siftr.logfile=/tmp/siftr.log</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=tcpdump.1.html>tcpdump(1)</a>, <a class=Xr href=tcp.4.html>tcp(4)</a>, <a class=Xr href=sysctl.8.html>sysctl(8)</a>, <a class=Xr href=alq.9.html>alq(9)</a>, <a class=Xr href=pfil.9.html>pfil(9)</a></section><section class=Sh><h2 class=Sh id=ACKNOWLEDGEMENTS><a class=permalink href=#ACKNOWLEDGEMENTS>ACKNOWLEDGEMENTS</a></h2> Development of this software was made possible in part by grants from the Cisco University Research Program Fund at Community Foundation Silicon Valley, and the FreeBSD Foundation. </section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2><code class=Nm>SIFTR</code> first appeared in <span class=Ux>FreeBSD 7.4</span> and <span class=Ux>FreeBSD 8.2</span>. <p class=Pp><code class=Nm>SIFTR</code> was first released in 2007 by Lawrence Stewart and James Healy whilst working on the NewTCP research project at Swinburne University of Technology's Centre for Advanced Internet Architectures, Melbourne, Australia, which was made possible in part by a grant from the Cisco University Research Program Fund at Community Foundation Silicon Valley. More details are available at:</p><p class=Pp>http://caia.swin.edu.au/urp/newtcp/</p><p class=Pp>Work on <code class=Nm>SIFTR</code> v1.2.x was sponsored by the FreeBSD Foundation as part of the “Enhancing the FreeBSD TCP Implementation” project 2008-2009. More details are available at:</p><p class=Pp>https://www.freebsdfoundation.org/</p><p class=Pp>http://caia.swin.edu.au/freebsd/etcp09/</p></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><code class=Nm>SIFTR</code> was written by <span class=An>Lawrence Stewart</span> &lt;<a class=Mt href=mailto:lstewart@FreeBSD.org>lstewart@FreeBSD.org</a>&gt; and <span class=An>James Healy</span> &lt;<a class=Mt href=mailto:jimmy@deefa.com>jimmy@deefa.com</a>&gt;. <p class=Pp>This manual page was written by <span class=An>Lawrence Stewart</span> &lt;<a class=Mt href=mailto:lstewart@FreeBSD.org>lstewart@FreeBSD.org</a>&gt;.</p></section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Current known limitations and any relevant workarounds are outlined below: <ul class=Bl-dash><li>The internal queue used to pass information between the threads of operation is currently unbounded. This allows <code class=Nm>SIFTR</code> to cope with bursty network traffic, but sustained high packet-per-second traffic can cause exhaustion of kernel memory if the processing thread cannot keep up with the packet rate.</li><li>If using <code class=Nm>SIFTR</code> on a machine that is also running other modules utilising the <a class=Xr href=pfil.9.html>pfil(9)</a> framework e.g. <a class=Xr href=dummynet.4.html>dummynet(4)</a>, <a class=Xr href=ipfw.8.html>ipfw(8)</a>, <a class=Xr href=pf.4.html>pf(4)</a>, the order in which you load the modules is important. You should kldload the other modules first, as this will ensure TCP packets undergo any necessary manipulations before <code class=Nm>SIFTR</code> “sees” and processes them.</li><li>There is a known, harmless lock order reversal warning between the <a class=Xr href=pfil.9.html>pfil(9)</a> mutex and tcbinfo TCP lock reported by <a class=Xr href=witness.4.html>witness(4)</a> when <code class=Nm>SIFTR</code> is enabled in a kernel compiled with <a class=Xr href=witness.4.html>witness(4)</a> support.</li><li>There is no way to filter which TCP flows you wish to capture data for. Post processing is required to separate out data belonging to particular flows of interest.</li><li>The module does not detect deletion of the log file path. New log messages will simply be lost if the log file being used by <code class=Nm>SIFTR</code> is deleted whilst the module is set to use the file. Switching to a new log file using the <i class=Em>net.inet.siftr.logfile</i> variable will create the new file and allow log messages to begin being written to disk again. The new log file path must differ from the path to the deleted file.</li><li>The hash table used within the code is sized to hold 65536 flows. This is not a hard limit, because chaining is used to handle collisions within the hash table structure. However, we suspect (based on analogies with other hash table performance data) that the hash table look up performance (and therefore the module's packet processing performance) will degrade in an exponential manner as the number of unique flows handled in a module enable/disable cycle approaches and surpasses 65536.</li><li>There is no garbage collection performed on the flow hash table. The only way currently to flush it is to disable <code class=Nm>SIFTR</code>.</li><li>The PPL variable applies to packets that make it into the processing thread, not total packets received in the hook function. Packets are skipped before the PPL variable is applied, which means there may be a slight discrepancy in the triggering of log messages. For example, if PPL was set to 10, and the 8th packet since the last log message is skipped, the 11th packet will actually trigger the log message to be generated. This is discussed in greater depth in CAIA technical report 070824A.</li><li>At the time of writing, there was no simple way to hook into the TCP layer to intercept packets. <code class=Nm>SIFTR</code>'s use of IP layer hook points means all IP traffic will be processed by the <code class=Nm>SIFTR</code><a class=Xr href=pfil.9.html>pfil(9)</a> hook function, which introduces minor, but nonetheless unnecessary packet delay and processing overhead on the system for non-TCP packets as well. Hooking in at the IP layer is also not ideal from the data gathering point of view. Packets traversing up the stack will be intercepted and cause a log message generation BEFORE they have been processed by the TCP layer, which means we cannot observe the cause-and-affect relationship between inbound events and the corresponding TCP control block as precisely as could be. Ideally, <code class=Nm>SIFTR</code> should intercept packets after they have been processed by the TCP layer i.e. intercept packets coming up the stack after they have been processed by <code class=Fn>tcp_input</code>(), and intercept packets coming down the stack after they have been processed by <code class=Fn>tcp_output</code>(). The current code still gives satisfactory granularity though, as inbound events tend to trigger outbound events, allowing the cause-and-effect to be observed indirectly by capturing the state on outbound events as well.</li><li>The “inflight bytes” value logged by <code class=Nm>SIFTR</code> does not take into account bytes that have been <span class=No>SACK</span>'ed by the receiving host.</li><li>Packet hash generation does not currently work for IPv6 based TCP packets.</li><li>Compressed notation is not used for IPv6 address representation. This consumes more bytes than is necessary in log output.</li></ul></section></div><table class=foot><tr><td class=foot-date>April 7, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>