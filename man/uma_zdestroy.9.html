<!DOCTYPE html>
<html><head><meta charset=utf-8><title>uma_zdestroy(9)</title><keywords content=man,uma_zdestroy></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>uma_zdestroy(9)</h1><table class=head><tr><td class=head-ltitle>UMA(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>UMA(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>UMA</code> — <div class=Nd>general-purpose kernel object allocator</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/param.h.html>sys/param.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/sys/queue.h.html>sys/queue.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/vm/uma.h.html>vm/uma.h</a>&gt;</code><p class=Pp><code class=Cd>options UMA_FIRSTTOUCH</code><br><code class=Cd>options UMA_XDOMAIN</code></p><div class="Bd Pp"><pre>
typedef int (*uma_ctor)(void *mem, int size, void *arg, int flags);
typedef void (*uma_dtor)(void *mem, int size, void *arg);
typedef int (*uma_init)(void *mem, int size, int flags);
typedef void (*uma_fini)(void *mem, int size);
typedef int (*uma_import)(void *arg, void **store, int count, int domain,
    int flags);
typedef void (*uma_release)(void *arg, void **store, int count);
typedef void *(*uma_alloc)(uma_zone_t zone, vm_size_t size, int domain,
    uint8_t *pflag, int wait);
typedef void (*uma_free)(void *item, vm_size_t size, uint8_t pflag);

</pre></div><br><var class=Ft>uma_zone_t</var><br><code class=Fn>uma_zcreate</code>(<var class=Fa>char *name</var>, <var class=Fa>int size</var>, <var class=Fa>uma_ctor ctor</var>, <var class=Fa>uma_dtor dtor</var>, <var class=Fa>uma_init zinit</var>, <var class=Fa>uma_fini zfini</var>, <var class=Fa>int align</var>, <var class=Fa>uint16_t flags</var>); <p class=Pp><var class=Ft>uma_zone_t</var><br><code class=Fn>uma_zcache_create</code>(<var class=Fa>char *name</var>, <var class=Fa>int size</var>, <var class=Fa>uma_ctor ctor</var>, <var class=Fa>uma_dtor dtor</var>, <var class=Fa>uma_init zinit</var>, <var class=Fa>uma_fini zfini</var>, <var class=Fa>uma_import zimport</var>, <var class=Fa>uma_release zrelease</var>, <var class=Fa>void *arg</var>, <var class=Fa>int flags</var>);</p><p class=Pp><var class=Ft>uma_zone_t</var><br><code class=Fn>uma_zsecond_create</code>(<var class=Fa>char *name</var>, <var class=Fa>uma_ctor ctor</var>, <var class=Fa>uma_dtor dtor</var>, <var class=Fa>uma_init zinit</var>, <var class=Fa>uma_fini zfini</var>, <var class=Fa>uma_zone_t master</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zdestroy</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>);</p><p class=Pp><var class=Ft>void *</var><br><code class=Fn>uma_zalloc</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>void *</var><br><code class=Fn>uma_zalloc_arg</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>void *</var><br><code class=Fn>uma_zalloc_domain</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>, <var class=Fa style="white-space: nowrap;">int domain</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>void *</var><br><code class=Fn>uma_zalloc_pcpu</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>void *</var><br><code class=Fn>uma_zalloc_pcpu_arg</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zfree</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *item</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zfree_arg</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *item</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zfree_domain</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *item</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zfree_pcpu</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *item</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zfree_pcpu_arg</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void *item</var>, <var class=Fa style="white-space: nowrap;">void *arg</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_prealloc</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int nitems</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_reserve</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int nitems</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_reserve_kva</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int nitems</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_set_allocf</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">uma_alloc allocf</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_set_freef</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">uma_free freef</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>uma_zone_set_max</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int nitems</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>uma_zone_set_maxcache</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">int nitems</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>uma_zone_get_max</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>uma_zone_get_cur</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_set_warning</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">const char *warning</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_zone_set_maxaction</code>(<var class=Fa style="white-space: nowrap;">uma_zone_t zone</var>, <var class=Fa style="white-space: nowrap;">void (*maxaction)(uma_zone_t)</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>uma_reclaim</code>();</p><p class=Pp><code class=In>#include &lt;<a class=In href=../src/sys/sysctl.h.html>sys/sysctl.h</a>&gt;</code></p><p class=Pp><code class=Fn>SYSCTL_UMA_MAX</code>(<var class=Fa style="white-space: nowrap;">parent</var>, <var class=Fa style="white-space: nowrap;">nbr</var>, <var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">access</var>, <var class=Fa style="white-space: nowrap;">zone</var>, <var class=Fa style="white-space: nowrap;">descr</var>);</p><p class=Pp><code class=Fn>SYSCTL_ADD_UMA_MAX</code>(<var class=Fa style="white-space: nowrap;">ctx</var>, <var class=Fa style="white-space: nowrap;">parent</var>, <var class=Fa style="white-space: nowrap;">nbr</var>, <var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">access</var>, <var class=Fa style="white-space: nowrap;">zone</var>, <var class=Fa style="white-space: nowrap;">descr</var>);</p><p class=Pp><code class=Fn>SYSCTL_UMA_CUR</code>(<var class=Fa style="white-space: nowrap;">parent</var>, <var class=Fa style="white-space: nowrap;">nbr</var>, <var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">access</var>, <var class=Fa style="white-space: nowrap;">zone</var>, <var class=Fa style="white-space: nowrap;">descr</var>);</p><p class=Pp><code class=Fn>SYSCTL_ADD_UMA_CUR</code>(<var class=Fa style="white-space: nowrap;">ctx</var>, <var class=Fa style="white-space: nowrap;">parent</var>, <var class=Fa style="white-space: nowrap;">nbr</var>, <var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">access</var>, <var class=Fa style="white-space: nowrap;">zone</var>, <var class=Fa style="white-space: nowrap;">descr</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> UMA (Universal Memory Allocator) provides an efficient interface for managing dynamically-sized collections of items of identical size, referred to as zones. Zones keep track of which items are in use and which are not, and UMA provides functions for allocating items from a zone and for releasing them back, making them available for subsequent allocation requests. Zones maintain per-CPU caches with linear scalability on SMP systems as well as round-robin and first-touch policies for NUMA systems. The number of items cached per CPU is bounded, and each zone additionally maintains an unbounded cache of items that is used to quickly satisfy per-CPU cache allocation misses. <p class=Pp>Two types of zones exist: regular zones and cache zones. In a regular zone, items are allocated from a slab, which is one or more virtually contiguous memory pages that have been allocated from the kernel's page allocator. Internally, slabs are managed by a UMA keg, which is responsible for allocating slabs and keeping track of their usage by one or more zones. In typical usage, there is one keg per zone, so slabs are not shared among multiple zones.</p><p class=Pp>Normal zones import items from a keg, and release items back to that keg if requested. Cache zones do not have a keg, and instead use custom import and release methods. For example, some collections of kernel objects are statically allocated at boot-time, and the size of the collection does not change. A cache zone can be used to implement an efficient allocator for the objects in such a collection.</p><p class=Pp>The <code class=Fn>uma_zcreate</code>() and <code class=Fn>uma_zcache_create</code>() functions create a new regular zone and cache zone, respectively. The <code class=Fn>uma_zsecond_create</code>() function creates a regular zone which shares the keg of the zone specified by the <var class=Fa>master</var> argument. The <var class=Fa>name</var> argument is a text name of the zone for debugging and stats; this memory should not be freed until the zone has been deallocated.</p><p class=Pp>The <var class=Fa>ctor</var> and <var class=Fa>dtor</var> arguments are callback functions that are called by the UMA subsystem at the time of the call to <code class=Fn>uma_zalloc</code>() and <code class=Fn>uma_zfree</code>() respectively. Their purpose is to provide hooks for initializing or destroying things that need to be done at the time of the allocation or release of a resource. A good usage for the <var class=Fa>ctor</var> and <var class=Fa>dtor</var> callbacks might be to initialize a data structure embedded in the item, such as a <a class=Xr href=queue.3.html>queue(3)</a> head.</p><p class=Pp>The <var class=Fa>zinit</var> and <var class=Fa>zfini</var> arguments are used to optimize the allocation of items from the zone. They are called by the UMA subsystem whenever it needs to allocate or free items to satisfy requests or memory pressure. A good use for the <var class=Fa>zinit</var> and <var class=Fa>zfini</var> callbacks might be to initialize and destroy a mutex contained within an item. This would allow one to avoid destroying and re-initializing the mutex each time the item is freed and re-allocated. They are not called on each call to <code class=Fn>uma_zalloc</code>() and <code class=Fn>uma_zfree</code>() but rather when an item is imported into a zone's cache, and when a zone releases an item to the slab allocator, typically as a response to memory pressure.</p><p class=Pp>For <code class=Fn>uma_zcache_create</code>(), the <var class=Fa>zimport</var> and <var class=Fa>zrelease</var> functions are called to import items into the zone and to release items from the zone, respectively. The <var class=Fa>zimport</var> function should store pointers to items in the <var class=Fa>store</var> array, which contains a maximum of <var class=Fa>count</var> entries. The function must return the number of imported items, which may be less than the maximum. Similarly, the <var class=Fa>store</var> parameter to the <var class=Fa>zrelease</var> function contains an array of <var class=Fa>count</var> pointers to items. The <var class=Fa>arg</var> parameter passed to <code class=Fn>uma_zcache_create</code>() is provided to the import and release functions. The <var class=Fa>domain</var> parameter to <var class=Fa>zimport</var> specifies the requested <a class=Xr href=numa.4.html>numa(4)</a> domain for the allocation. It is either a NUMA domain number or the special value <code class=Dv>UMA_ANYDOMAIN</code>.</p><p class=Pp>The <var class=Fa>flags</var> argument of <code class=Fn>uma_zcreate</code>() and <code class=Fn>uma_zcache_create</code>() is a subset of the following flags:</p><dl class=Bl-tag><dt><a class=permalink href=#UMA_ZONE_NOFREE><code class=Dv id=UMA_ZONE_NOFREE>UMA_ZONE_NOFREE</code></a></dt><dd>Slabs allocated to the zone's keg are never freed.</dd><dt><a class=permalink href=#UMA_ZONE_NODUMP><code class=Dv id=UMA_ZONE_NODUMP>UMA_ZONE_NODUMP</code></a></dt><dd>Pages belonging to the zone will not be included in minidumps.</dd><dt><a class=permalink href=#UMA_ZONE_PCPU><code class=Dv id=UMA_ZONE_PCPU>UMA_ZONE_PCPU</code></a></dt><dd>An allocation from zone would have <var class=Va>mp_ncpu</var> shadow copies, that are privately assigned to CPUs. A CPU can address its private copy using base the allocation address plus a multiple of the current CPU ID and <code class=Fn>sizeof</code>(<var class=Fa>struct pcpu</var>): <div class="Bd Pp Bd-indent"><pre>
foo_zone = uma_zcreate(..., UMA_ZONE_PCPU);
 ...
foo_base = uma_zalloc(foo_zone, ...);
 ...
critical_enter();
foo_pcpu = (foo_t *)zpcpu_get(foo_base);
/* do something with foo_pcpu */
critical_exit();

    </pre></div> Note that <code class=Dv>M_ZERO</code> cannot be used when allocating items from a PCPU zone. To obtain zeroed memory from a PCPU zone, use the <code class=Fn>uma_zalloc_pcpu</code>() function and its variants instead, and pass <code class=Dv>M_ZERO</code>.</dd><dt><a class=permalink href=#UMA_ZONE_OFFPAGE><code class=Dv id=UMA_ZONE_OFFPAGE>UMA_ZONE_OFFPAGE</code></a></dt><dd>By default book-keeping of items within a slab is done in the slab page itself. This flag explicitly tells subsystem that book-keeping structure should be allocated separately from special internal zone. This flag requires either <code class=Dv>UMA_ZONE_VTOSLAB</code> or <code class=Dv>UMA_ZONE_HASH</code>, since subsystem requires a mechanism to find a book-keeping structure to an item being freed. The subsystem may choose to prefer offpage book-keeping for certain zones implicitly.</dd><dt><a class=permalink href=#UMA_ZONE_ZINIT><code class=Dv id=UMA_ZONE_ZINIT>UMA_ZONE_ZINIT</code></a></dt><dd>The zone will have its <var class=Ft>uma_init</var> method set to internal method that initializes a new allocated slab to all zeros. Do not mistake <var class=Ft>uma_init</var> method with <var class=Ft>uma_ctor</var>. A zone with <code class=Dv>UMA_ZONE_ZINIT</code> flag would not return zeroed memory on every <code class=Fn>uma_zalloc</code>().</dd><dt><a class=permalink href=#UMA_ZONE_HASH><code class=Dv id=UMA_ZONE_HASH>UMA_ZONE_HASH</code></a></dt><dd>The zone should use an internal hash table to find slab book-keeping structure where an allocation being freed belongs to.</dd><dt><a class=permalink href=#UMA_ZONE_VTOSLAB><code class=Dv id=UMA_ZONE_VTOSLAB>UMA_ZONE_VTOSLAB</code></a></dt><dd>The zone should use special field of <var class=Vt>vm_page_t</var> to find slab book-keeping structure where an allocation being freed belongs to.</dd><dt><a class=permalink href=#UMA_ZONE_MALLOC><code class=Dv id=UMA_ZONE_MALLOC>UMA_ZONE_MALLOC</code></a></dt><dd>The zone is for the <a class=Xr href=malloc.9.html>malloc(9)</a> subsystem.</dd><dt><a class=permalink href=#UMA_ZONE_VM><code class=Dv id=UMA_ZONE_VM>UMA_ZONE_VM</code></a></dt><dd>The zone is for the VM subsystem.</dd><dt><a class=permalink href=#UMA_ZONE_NUMA><code class=Dv id=UMA_ZONE_NUMA>UMA_ZONE_NUMA</code></a></dt><dd>The zone should use a first-touch NUMA policy rather than the round-robin default. If the <code class=Dv>UMA_FIRSTTOUCH</code> kernel option is configured, all zones implicitly use a first-touch policy, and the <code class=Dv>UMA_ZONE_NUMA</code> flag has no effect. The <code class=Dv>UMA_XDOMAIN</code> kernel option, when configured, causes UMA to do the extra tracking to ensure that allocations from first-touch zones are always local. Otherwise, consumers that do not free memory on the same domain from which it was allocated will cause mixing in per-CPU caches. See <a class=Xr href=numa.4.html>numa(4)</a> for more details.</dd></dl><p class=Pp>Zones can be destroyed using <code class=Fn>uma_zdestroy</code>(), freeing all memory that is cached in the zone. All items allocated from the zone must be freed to the zone before the zone may be safely destroyed.</p><p class=Pp>To allocate an item from a zone, simply call <code class=Fn>uma_zalloc</code>() with a pointer to that zone and set the <var class=Fa>flags</var> argument to selected flags as documented in <a class=Xr href=malloc.9.html>malloc(9)</a>. It will return a pointer to an item if successful, or <code class=Dv>NULL</code> in the rare case where all items in the zone are in use and the allocator is unable to grow the zone and <code class=Dv>M_NOWAIT</code> is specified.</p><p class=Pp>Items are released back to the zone from which they were allocated by calling <code class=Fn>uma_zfree</code>() with a pointer to the zone and a pointer to the item. If <var class=Fa>item</var> is <code class=Dv>NULL</code>, then <code class=Fn>uma_zfree</code>() does nothing.</p><p class=Pp>The variants <code class=Fn>uma_zalloc_arg</code>() and <code class=Fn>uma_zfree_arg</code>() allow callers to specify an argument for the <code class=Dv>ctor</code> and <code class=Dv>dtor</code> functions of the zone, respectively. The <code class=Fn>uma_zalloc_domain</code>() function allows callers to specify a fixed <a class=Xr href=numa.4.html>numa(4)</a> domain to allocate from. This uses a guaranteed but slow path in the allocator which reduces concurrency. The <code class=Fn>uma_zfree_domain</code>() function should be used to return memory allocated in this fashion. This function infers the domain from the pointer and does not require it as an argument.</p><p class=Pp>The <code class=Fn>uma_prealloc</code>() function allocates slabs for the requested number of items, typically following the initial creation of a zone. Subsequent allocations from the zone will be satisfied using the pre-allocated slabs. Note that slab allocation is performed with the <code class=Dv>M_WAITOK</code> flag, so <code class=Fn>uma_prealloc</code>() may sleep.</p><p class=Pp>The <code class=Fn>uma_zone_reserve</code>() function sets the number of reserved items for the zone. <code class=Fn>uma_zalloc</code>() and variants will ensure that the zone contains at least the reserved number of free items. Reserved items may be allocated by specifying <code class=Dv>M_USE_RESERVE</code> in the allocation request flags. <code class=Fn>uma_zone_reserve</code>() does not perform any pre-allocation by itself.</p><p class=Pp>The <code class=Fn>uma_zone_reserve_kva</code>() function pre-allocates kernel virtual address space for the requested number of items. Subsequent allocations from the zone will be satisfied using the pre-allocated address space. Note that unlike <code class=Fn>uma_zone_reserve</code>(), <code class=Fn>uma_zone_reserve_kva</code>() does not restrict the use of the pre-allocation to <code class=Dv>M_USE_RESERVE</code> requests.</p><p class=Pp>The <code class=Fn>uma_zone_set_allocf</code>() and <code class=Fn>uma_zone_set_freef</code>() functions allow a zone's default slab allocation and free functions to be overridden. This is useful if the zone's items have special memory allocation constraints. For example, if multi-page objects are required to be physically contiguous, an <var class=Fa>allocf</var> function which requests contiguous memory from the kernel's page allocator may be used.</p><p class=Pp>The <code class=Fn>uma_zone_set_max</code>() function limits the number of items (and therefore memory) that can be allocated to <var class=Fa>zone</var>. The <var class=Fa>nitems</var> argument specifies the requested upper limit number of items. The effective limit is returned to the caller, as it may end up being higher than requested due to the implementation rounding up to ensure all memory pages allocated to the zone are utilised to capacity. The limit applies to the total number of items in the zone, which includes allocated items, free items and free items in the per-cpu caches. On systems with more than one CPU it may not be possible to allocate the specified number of items even when there is no shortage of memory, because all of the remaining free items may be in the caches of the other CPUs when the limit is hit.</p><p class=Pp>The <code class=Fn>uma_zone_set_maxcache</code>() function limits the number of free items which may be cached in the zone, excluding the per-CPU caches, which are bounded in size. For example, to implement a ‘<code class=Li>pure</code>’ per-CPU cache, a cache zone may be configured with a maximum cache size of 0.</p><p class=Pp>The <code class=Fn>uma_zone_get_max</code>() function returns the effective upper limit number of items for a zone.</p><p class=Pp>The <code class=Fn>uma_zone_get_cur</code>() function returns an approximation of the number of items currently allocated from the zone. The returned value is approximate because appropriate synchronisation to determine an exact value is not performed by the implementation. This ensures low overhead at the expense of potentially stale data being used in the calculation.</p><p class=Pp>The <code class=Fn>uma_zone_set_warning</code>() function sets a warning that will be printed on the system console when the given zone becomes full and fails to allocate an item. The warning will be printed no more often than every five minutes. Warnings can be turned off globally by setting the <var class=Va>vm.zone_warnings</var> sysctl tunable to <var class=Va>0</var>.</p><p class=Pp>The <code class=Fn>uma_zone_set_maxaction</code>() function sets a function that will be called when the given zone becomes full and fails to allocate an item. The function will be called with the zone locked. Also, the function that called the allocation function may have held additional locks. Therefore, this function should do very little work (similar to a signal handler).</p><p class=Pp>The <code class=Fn>SYSCTL_UMA_MAX</code>(<var class=Fa>parent</var>, <var class=Fa>nbr</var>, <var class=Fa>name</var>, <var class=Fa>access</var>, <var class=Fa>zone</var>, <var class=Fa>descr</var>) macro declares a static <a class=Xr href=sysctl.9.html>sysctl(9)</a> oid that exports the effective upper limit number of items for a zone. The <var class=Fa>zone</var> argument should be a pointer to <var class=Vt>uma_zone_t</var>. A read of the oid returns value obtained through <code class=Fn>uma_zone_get_max</code>(). A write to the oid sets new value via <code class=Fn>uma_zone_set_max</code>(). The <code class=Fn>SYSCTL_ADD_UMA_MAX</code>(<var class=Fa>ctx</var>, <var class=Fa>parent</var>, <var class=Fa>nbr</var>, <var class=Fa>name</var>, <var class=Fa>access</var>, <var class=Fa>zone</var>, <var class=Fa>descr</var>) macro is provided to create this type of oid dynamically.</p><p class=Pp>The <code class=Fn>SYSCTL_UMA_CUR</code>(<var class=Fa>parent</var>, <var class=Fa>nbr</var>, <var class=Fa>name</var>, <var class=Fa>access</var>, <var class=Fa>zone</var>, <var class=Fa>descr</var>) macro declares a static read-only <a class=Xr href=sysctl.9.html>sysctl(9)</a> oid that exports the approximate current occupancy of the zone. The <var class=Fa>zone</var> argument should be a pointer to <var class=Vt>uma_zone_t</var>. A read of the oid returns value obtained through <code class=Fn>uma_zone_get_cur</code>(). The <code class=Fn>SYSCTL_ADD_UMA_CUR</code>(<var class=Fa>ctx</var>, <var class=Fa>parent</var>, <var class=Fa>nbr</var>, <var class=Fa>name</var>, <var class=Fa>zone</var>, <var class=Fa>descr</var>) macro is provided to create this type of oid dynamically.</p></section><section class=Sh><h2 class=Sh id=IMPLEMENTATION_NOTES><a class=permalink href=#IMPLEMENTATION_NOTES>IMPLEMENTATION NOTES</a></h2> The memory that these allocation calls return is not executable. The <code class=Fn>uma_zalloc</code>() function does not support the <code class=Dv>M_EXEC</code> flag to allocate executable memory. Not all platforms enforce a distinction between executable and non-executable memory. </section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=numa.4.html>numa(4)</a>, <a class=Xr href=vmstat.8.html>vmstat(8)</a>, <a class=Xr href=malloc.9.html>malloc(9)</a><p class=Pp><cite class=Rs><span class=RsA>Jeff Bonwick</span>, <span class=RsT>The Slab Allocator: An Object-Caching Kernel Memory Allocator</span>, <span class=RsD>1994</span>.</cite></p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The zone allocator first appeared in <span class=Ux>FreeBSD 3.0</span>. It was radically changed in <span class=Ux>FreeBSD 5.0</span> to function as a slab allocator. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The zone allocator was written by <span class=An>John S. Dyson</span>. The zone allocator was rewritten in large parts by <span class=An>Jeff Roberson</span> &lt;<a class=Mt href=mailto:jeff@FreeBSD.org>jeff@FreeBSD.org</a>&gt; to function as a slab allocator. <p class=Pp>This manual page was written by <span class=An>Dag-Erling Smørgrav</span> &lt;<a class=Mt href=mailto:des@FreeBSD.org>des@FreeBSD.org</a>&gt;. Changes for UMA by <span class=An>Jeroen Ruigrok van der Werven</span> &lt;<a class=Mt href=mailto:asmodai@FreeBSD.org>asmodai@FreeBSD.org</a>&gt;.</p></section></div><table class=foot><tr><td class=foot-date>August 20, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>