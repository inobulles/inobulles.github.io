<!DOCTYPE html>
<html><head><meta charset=utf-8><title>loader_4th(8)</title><keywords content=man,loader_4th></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>loader_4th(8)</h1><table class=head><tr><td class=head-ltitle>LOADER_4TH(8)</td><td class=head-vol>FreeBSD System Manager's Manual</td><td class=head-rtitle>LOADER_4TH(8)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>loader_4th</code> — <div class=Nd>kernel bootstrapping final stage</div></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The program called <code class=Nm>loader_4th</code> is the final stage of <span class=Ux>FreeBSD</span>'s kernel bootstrapping process. On IA32 (i386) architectures, it is a <span class=Pa>BTX</span> client. It is linked statically to <a class=Xr href=libsa.3.html>libsa(3)</a> and usually located in the directory <span class=Pa>/boot</span>. <p class=Pp>It provides a scripting language that can be used to automate tasks, do pre-configuration or assist in recovery procedures. This scripting language is roughly divided in two main components. The smaller one is a set of commands designed for direct use by the casual user, called "builtin commands" for historical reasons. The main drive behind these commands is user-friendliness. The bigger component is an ANS Forth compatible Forth interpreter based on FICL, by <span class=An>John Sadler</span>.</p><p class=Pp>During initialization, <code class=Nm>loader_4th</code> will probe for a console and set the <var class=Va>console</var> variable, or set it to serial console (“<code class=Li>comconsole</code>”) if the previous boot stage used that. If multiple consoles are selected, they will be listed separated by spaces. Then, devices are probed, <var class=Va>currdev</var> and <var class=Va>loaddev</var> are set, and <var class=Va>LINES</var> is set to 24. Next, FICL is initialized, the builtin words are added to its vocabulary, and <span class=Pa>/boot/boot.4th</span> is processed if it exists. No disk switching is possible while that file is being read. The inner interpreter <code class=Nm>loader_4th</code> will use with FICL is then set to <code class=Ic>interpret</code>, which is FICL's default. After that, <span class=Pa>/boot/loader.rc</span> is processed if available. These files are processed through the <code class=Ic>include</code> command, which reads all of them into memory before processing them, making disk changes possible.</p><p class=Pp>At this point, if an <code class=Ic>autoboot</code> has not been tried, and if <var class=Va>autoboot_delay</var> is not set to “<code class=Li>NO</code>” (not case sensitive), then an <code class=Ic>autoboot</code> will be tried. If the system gets past this point, <var class=Va>prompt</var> will be set and <code class=Nm>loader_4th</code> will engage interactive mode. Please note that historically even when <var class=Va>autoboot_delay</var> is set to “<code class=Li>0</code>” user will be able to interrupt autoboot process by pressing some key on the console while kernel and modules are being loaded. In some cases such behaviour may be undesirable, to prevent it set <var class=Va>autoboot_delay</var> to “<code class=Li>-1</code>”, in this case <code class=Nm>loader_4th</code> will engage interactive mode only if <code class=Ic>autoboot</code> has failed.</p></section><section class=Sh><h2 class=Sh id=BUILTIN_COMMANDS><a class=permalink href=#BUILTIN_COMMANDS>BUILTIN COMMANDS</a></h2> In <code class=Nm>loader_4th</code>, builtin commands take parameters from the command line. Presently, the only way to call them from a script is by using <span class=Pa>evaluate</span> on a string. If an error condition occurs, an exception will be generated, which can be intercepted using ANS Forth exception handling words. If not intercepted, an error message will be displayed and the interpreter's state will be reset, emptying the stack and restoring interpreting mode. The commands are described in the <a class=Xr href=loader_simp.8.html>loader_simp(8)</a> “BUILTIN COMMANDS” section. <section class=Ss><h2 class=Ss id=BUILTIN_ENVIRONMENT_VARIABLES><a class=permalink href=#BUILTIN_ENVIRONMENT_VARIABLES>BUILTIN ENVIRONMENT VARIABLES</a></h2> The environment variables common to all interpreters are described in the <a class=Xr href=loader_simp.8.html>loader_simp(8)</a> “BUILTIN ENVIRONMENT VARIABLES” section. </section><section class=Ss><h2 class=Ss id=BUILTIN_PARSER><a class=permalink href=#BUILTIN_PARSER>BUILTIN PARSER</a></h2> When a builtin command is executed, the rest of the line is taken by it as arguments, and it is processed by a special parser which is not used for regular Forth commands. <p class=Pp>This special parser applies the following rules to the parsed text:</p><ol class=Bl-enum><li>All backslash characters are preprocessed. <ul class=Bl-bullet><li>\b , \f , \r , \n and \t are processed as in C.</li><li>\s is converted to a space.</li><li>\v is converted to ASCII 11.</li><li>\z is just skipped. Useful for things like “\0xf\z\0xf”.</li><li>\0xN and \0xNN are replaced by the hex N or NN.</li><li>\NNN is replaced by the octal NNN ASCII character.</li><li>\" , \' and \$ will escape these characters, preventing them from receiving special treatment in Step 2, described below.</li><li>\\ will be replaced with a single \ .</li><li>In any other occurrence, backslash will just be removed.</li></ul></li><li>Every string between non-escaped quotes or double-quotes will be treated as a single word for the purposes of the remaining steps.</li><li>Replace any <code class=Li>$VARIABLE</code> or <code class=Li>${VARIABLE}</code> with the value of the environment variable <var class=Va>VARIABLE</var>.</li><li>Space-delimited arguments are passed to the called builtin command. Spaces can also be escaped through the use of \\ .</li></ol><p class=Pp>An exception to this parsing rule exists, and is described in <a class=Sx href=#BUILTINS_AND_FORTH>BUILTINS AND FORTH</a>.</p></section><section class=Ss><h2 class=Ss id=BUILTINS_AND_FORTH><a class=permalink href=#BUILTINS_AND_FORTH>BUILTINS AND FORTH</a></h2> All builtin words are state-smart, immediate words. If interpreted, they behave exactly as described previously. If they are compiled, though, they extract their arguments from the stack instead of the command line. <p class=Pp>If compiled, the builtin words expect to find, at execution time, the following parameters on the stack:</p><div class="Bd Bd-indent"><var class=Ar>addrN lenN ... addr2 len2 addr1 len1 N</var></div> where <var class=Ar>addrX lenX</var> are strings which will compose the command line that will be parsed into the builtin's arguments. Internally, these strings are concatenated in from 1 to N, with a space put between each one. <p class=Pp>If no arguments are passed, a 0 <i class=Em>must</i> be passed, even if the builtin accepts no arguments.</p><p class=Pp>While this behavior has benefits, it has its trade-offs. If the execution token of a builtin is acquired (through <code class=Ic>'</code> or <code class=Ic>[']</code>), and then passed to <code class=Ic>catch</code> or <code class=Ic>execute</code>, the builtin behavior will depend on the system state</p><div class="Bf Em">at the time <code class=Ic>catch</code> or <code class=Ic>execute</code> is processed!</div> This is particularly annoying for programs that want or need to handle exceptions. In this case, the use of a proxy is recommended. For example: <div class="Bd Bd-indent"><code class=Li>: (boot) boot;</code></div></section></section><section class=Sh><h2 class=Sh id=FICL><a class=permalink href=#FICL>FICL</a></h2> FICL is a Forth interpreter written in C, in the form of a forth virtual machine library that can be called by C functions and vice versa. <p class=Pp>In <code class=Nm>loader_4th</code>, each line read interactively is then fed to FICL, which may call <code class=Nm>loader_4th</code> back to execute the builtin words. The builtin <code class=Ic>include</code> will also feed FICL, one line at a time.</p><p class=Pp>The words available to FICL can be classified into four groups. The ANS Forth standard words, extra FICL words, extra <span class=Ux>FreeBSD</span> words, and the builtin commands; the latter were already described. The ANS Forth standard words are listed in the <a class=Sx href=#STANDARDS>STANDARDS</a> section. The words falling in the two other groups are described in the following subsections.</p><section class=Ss><h2 class=Ss id=FICL_EXTRA_WORDS><a class=permalink href=#FICL_EXTRA_WORDS>FICL EXTRA WORDS</a></h2><dl class=Bl-tag><dt><a class=permalink href=#.env><code class=Ic id=.env>.env</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#.ver><code class=Ic id=.ver>.ver</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#-roll><code class=Ic id=-roll>-roll</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#2constant><code class=Ic id=2constant>2constant</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#_name><code class=Ic id=_name>&gt;name</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#body_><code class=Ic id=body_>body&gt;</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#compare><code class=Ic id=compare>compare</code></a></dt><dd>This is the STRING word set's <code class=Ic>compare</code>.</dd><dt><a class=permalink href=#compile-only><code class=Ic id=compile-only>compile-only</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#endif><code class=Ic id=endif>endif</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#forget-wid><code class=Ic id=forget-wid>forget-wid</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#parse-word><code class=Ic id=parse-word>parse-word</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#sliteral><code class=Ic id=sliteral>sliteral</code></a></dt><dd>This is the STRING word set's <code class=Ic>sliteral</code>.</dd><dt><a class=permalink href=#wid-set-super><code class=Ic id=wid-set-super>wid-set-super</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#w@><code class=Ic id=w@>w@</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#w!><code class=Ic id=w!>w!</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#x.><code class=Ic id=x.>x.</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#empty><code class=Ic id=empty>empty</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#cell-><code class=Ic id=cell->cell-</code></a></dt><dd style="width: auto;"> </dd><dt><a class=permalink href=#-rot><code class=Ic id=-rot>-rot</code></a></dt><dd style="width: auto;"> </dd></dl></section><section class=Ss><h2 class=Ss id=FREEBSD_EXTRA_WORDS><a class=permalink href=#FREEBSD_EXTRA_WORDS>FREEBSD EXTRA WORDS</a></h2><dl class=Bl-tag><dt><a class=permalink href=#$><code class=Ic id=$>$</code></a> (--)</dt><dd>Evaluates the remainder of the input buffer, after having printed it first.</dd><dt><a class=permalink href=#_><code class=Ic id=_>%</code></a> (--)</dt><dd>Evaluates the remainder of the input buffer under a <code class=Ic>catch</code> exception guard.</dd><dt><a class=permalink href=#._><code class=Ic id=._>.#</code></a></dt><dd>Works like . but without outputting a trailing space.</dd><dt><a class=permalink href=#fclose><code class=Ic id=fclose>fclose</code></a> (<var class=Ar>fd --</var>)</dt><dd>Closes a file.</dd><dt><a class=permalink href=#fkey><code class=Ic id=fkey>fkey</code></a> (<var class=Ar>fd -- char</var>)</dt><dd>Reads a single character from a file.</dd><dt><a class=permalink href=#fload><code class=Ic id=fload>fload</code></a> (<var class=Ar>fd --</var>)</dt><dd>Processes a file <i class=Em>fd</i>.</dd><dt><a class=permalink href=#fopen><code class=Ic id=fopen>fopen</code></a> (<var class=Ar>addr len mode</var><code class=Li>--</code><var class=Ar>fd</var>)</dt><dd>Opens a file. Returns a file descriptor, or -1 in case of failure. The <var class=Ar>mode</var> parameter selects whether the file is to be opened for read access, write access, or both. The constants <code class=Dv>O_RDONLY</code>, <code class=Dv>O_WRONLY</code>, and <code class=Dv>O_RDWR</code> are defined in <span class=Pa>/boot/support.4th</span>, indicating read only, write only, and read-write access, respectively.</dd><dt><a class=permalink href=#fread><code class=Ic id=fread>fread</code></a> (<var class=Ar>fd addr len -- len'</var>)</dt><dd>Tries to read <i class=Em>len</i> bytes from file <i class=Em>fd</i> into buffer <i class=Em>addr</i>. Returns the actual number of bytes read, or -1 in case of error or end of file.</dd><dt><a class=permalink href=#heap?><code class=Ic id=heap?>heap?</code></a> (-- <var class=Ar>cells</var>)</dt><dd>Return the space remaining in the dictionary heap, in cells. This is not related to the heap used by dynamic memory allocation words.</dd><dt><a class=permalink href=#inb><code class=Ic id=inb>inb</code></a> (<var class=Ar>port -- char</var>)</dt><dd>Reads a byte from a port.</dd><dt><a class=permalink href=#key><code class=Ic id=key>key</code></a> (-- <var class=Ar>char</var>)</dt><dd>Reads a single character from the console.</dd><dt><a class=permalink href=#key?><code class=Ic id=key?>key?</code></a> (-- <var class=Ar>flag</var>)</dt><dd>Returns <code class=Ic>true</code> if there is a character available to be read from the console.</dd><dt><a class=permalink href=#ms><code class=Ic id=ms>ms</code></a> (<var class=Ar>u --</var>)</dt><dd>Waits <i class=Em>u</i> microseconds.</dd><dt><a class=permalink href=#outb><code class=Ic id=outb>outb</code></a> (<var class=Ar>port char --</var>)</dt><dd>Writes a byte to a port.</dd><dt><a class=permalink href=#seconds><code class=Ic id=seconds>seconds</code></a> (-- <var class=Ar>u</var>)</dt><dd>Returns the number of seconds since midnight.</dd><dt><a class=permalink href=#tib_><code class=Ic id=tib_>tib&gt;</code></a> (-- <var class=Ar>addr len</var>)</dt><dd>Returns the remainder of the input buffer as a string on the stack.</dd><dt><a class=permalink href=#trace!><code class=Ic id=trace!>trace!</code></a> (<var class=Ar>flag --</var>)</dt><dd>Activates or deactivates tracing. Does not work with <code class=Ic>catch</code>.</dd></dl></section><section class=Ss><h2 class=Ss id=FREEBSD_DEFINED_ENVIRONMENTAL_QUERIES><a class=permalink href=#FREEBSD_DEFINED_ENVIRONMENTAL_QUERIES>FREEBSD DEFINED ENVIRONMENTAL QUERIES</a></h2><dl class=Bl-tag><dt>arch-i386</dt><dd><a class=permalink href=#TRUE><code class=Ic id=TRUE>TRUE</code></a> if the architecture is IA32.</dd><dt>FreeBSD_version</dt><dd><span class=Ux>FreeBSD</span> version at compile time.</dd><dt>loader_version</dt><dd><code class=Nm>loader_4th</code> version.</dd></dl></section></section><section class=Sh><h2 class=Sh id=SECURITY><a class=permalink href=#SECURITY>SECURITY</a></h2> Access to the <code class=Nm>loader_4th</code> command line provides several ways of compromising system security, including, but not limited to: <ul class=Bl-bullet><li>Booting from removable storage, by setting the <var class=Va>currdev</var> or <var class=Va>loaddev</var> variables</li><li>Executing binary of choice, by setting the <var class=Va>init_path</var> or <var class=Va>init_script</var> variables</li><li>Overriding ACPI DSDT to inject arbitrary code into the ACPI subsystem</li></ul><p class=Pp>One can prevent unauthorized access to the <code class=Nm>loader_4th</code> command line by setting the <var class=Va>password</var>, or setting <var class=Va>autoboot_delay</var> to -1. See <a class=Xr href=loader.conf.5.html>loader.conf(5)</a> for details. In order for this to be effective, one should also configure the firmware (BIOS or UEFI) to prevent booting from unauthorized devices.</p></section><section class=Sh><h2 class=Sh id=MD><a class=permalink href=#MD>MD</a></h2> Memory disk (MD) can be used when the <code class=Nm>loader_4th</code> was compiled with <var class=Va>MD_IMAGE_SIZE</var>. The size of the memory disk is determined by <var class=Va>MD_IMAGE_SIZE</var>. If MD available, a file system can be embedded into the <code class=Nm>loader_4th</code> with <span class=Pa>/sys/tools/embed_mfs.sh</span>. Then, MD will be probed and be set to <var class=Va>currdev</var> during initialization. <p class=Pp>Currently, MD is only supported in <a class=Xr href=loader.efi.8.html>loader.efi(8)</a>.</p></section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class="Bl-tag Bl-compact"><dt><span class=Pa>/boot/loader</span></dt><dd><code class=Nm>loader_4th</code> itself.</dd><dt><span class=Pa>/boot/boot.4th</span></dt><dd>Additional FICL initialization.</dd><dt><span class=Pa>/boot/defaults/loader.conf</span></dt><dd style="width: auto;"> </dd><dt><span class=Pa>/boot/loader.4th</span></dt><dd>Extra builtin-like words.</dd><dt><span class=Pa>/boot/loader.conf</span></dt><dd style="width: auto;"> </dd><dt><span class=Pa>/boot/loader.conf.local</span></dt><dd><code class=Nm>loader_4th</code> configuration files, as described in <a class=Xr href=loader.conf.5.html>loader.conf(5)</a>.</dd><dt><span class=Pa>/boot/loader.rc</span></dt><dd><code class=Nm>loader_4th</code> bootstrapping script.</dd><dt><span class=Pa>/boot/loader.help</span></dt><dd>Loaded by <code class=Ic>help</code>. Contains the help messages.</dd><dt><span class=Pa>/boot/support.4th</span></dt><dd><span class=Pa>loader.conf</span> processing words.</dd><dt><span class=Pa>/usr/share/examples/bootforth/</span></dt><dd>Assorted examples.</dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> Boot in single user mode: <p class=Pp></p><div class="Bd Bd-indent"><code class=Li>boot -s</code></div><p class=Pp>Load the kernel, a splash screen, and then autoboot in five seconds. Notice that a kernel must be loaded before any other <code class=Ic>load</code> command is attempted.</p><div class="Bd Pp Bd-indent"><pre>
load kernel
load splash_bmp
load -t splash_image_data /boot/chuckrulez.bmp
autoboot 5
</pre></div><p class=Pp>Set the disk unit of the root device to 2, and then boot. This would be needed in a system with two IDE disks, with the second IDE disk hardwired to ada2 instead of ada1.</p><div class="Bd Pp Bd-indent"><pre>
set root_disk_unit=2
boot /boot/kernel/kernel
</pre></div><p class=Pp>Set the default device used for loading a kernel from a ZFS filesystem:</p><div class="Bd Pp Bd-indent"><pre>
set currdev=zfs:tank/ROOT/knowngood:
</pre></div></section><section class=Sh><h2 class=Sh id=ERRORS><a class=permalink href=#ERRORS>ERRORS</a></h2> The following values are thrown by <code class=Nm>loader_4th</code>: <div class=Bd-indent><dl class=Bl-tag><dt>100</dt><dd>Any type of error in the processing of a builtin.</dd><dt>-1</dt><dd><a class=permalink href=#Abort><code class=Ic id=Abort>Abort</code></a> executed.</dd><dt>-2</dt><dd><a class=permalink href=#Abort_><code class=Ic id=Abort_>Abort"</code></a> executed.</dd><dt>-56</dt><dd><a class=permalink href=#Quit><code class=Ic id=Quit>Quit</code></a> executed.</dd><dt>-256</dt><dd>Out of interpreting text.</dd><dt>-257</dt><dd>Need more text to succeed -- will finish on next run.</dd><dt>-258</dt><dd><a class=permalink href=#Bye><code class=Ic id=Bye>Bye</code></a> executed.</dd><dt>-259</dt><dd>Unspecified error.</dd></dl></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=libsa.3.html>libsa(3)</a>, <a class=Xr href=loader.conf.5.html>loader.conf(5)</a>, <a class=Xr href=tuning.7.html>tuning(7)</a>, <a class=Xr href=boot.8.html>boot(8)</a>, <a class=Xr href=btxld.8.html>btxld(8)</a></section><section class=Sh><h2 class=Sh id=STANDARDS><a class=permalink href=#STANDARDS>STANDARDS</a></h2> For the purposes of ANS Forth compliance, loader is an <div class="Bf Em">ANS Forth System with Environmental Restrictions, Providing</div><div class="Bf Li"><span class=No>.(</span>, <span class=No>:noname</span>, <span class=No>?do</span>, parse, pick, roll, refill, to, value, \, false, true, <span class=No>&lt;&gt;</span>, <span class=No>0&lt;&gt;</span>, compile, , erase, nip, tuck</div><i class=Em>and</i><code class=Li>marker</code><div class="Bf Em">from the Core Extensions word set, Providing the Exception Extensions word set, Providing the Locals Extensions word set, Providing the Memory-Allocation Extensions word set, Providing</div><div class="Bf Li">.s, bye, forget, see, words, [if], [else]</div><i class=Em>and</i><code class=Li>[then]</code><div class="Bf Em">from the Programming-Tools extension word set, Providing the Search-Order extensions word set.</div></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>loader_4th</code> first appeared in <span class=Ux>FreeBSD 3.1</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>loader_4th</code> was written by <span class=An>Michael Smith</span> ⟨msmith@FreeBSD.org⟩. <p class=Pp>FICL was written by <span class=An>John Sadler</span> ⟨john_sadler@alum.mit.edu⟩.</p></section></div><table class=foot><tr><td class=foot-date>September 29, 2021</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>