<!DOCTYPE html>
<html><head><meta charset=utf-8><title>atf-c-api(3)</title><keywords content=man,atf-c-api></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>atf-c-api(3)</h1><table class=head><tr><td class=head-ltitle>ATF-C(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>ATF-C(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>atf-c</code>, <code class=Nm>ATF_CHECK</code>, <code class=Nm>ATF_CHECK_MSG</code>, <code class=Nm>ATF_CHECK_EQ</code>, <code class=Nm>ATF_CHECK_EQ_MSG</code>, <code class=Nm>ATF_CHECK_MATCH</code>, <code class=Nm>ATF_CHECK_MATCH_MSG</code>, <code class=Nm>ATF_CHECK_STREQ</code>, <code class=Nm>ATF_CHECK_STREQ_MSG</code>, <code class=Nm>ATF_CHECK_ERRNO</code>, <code class=Nm>ATF_REQUIRE</code>, <code class=Nm>ATF_REQUIRE_MSG</code>, <code class=Nm>ATF_REQUIRE_EQ</code>, <code class=Nm>ATF_REQUIRE_EQ_MSG</code>, <code class=Nm>ATF_REQUIRE_MATCH</code>, <code class=Nm>ATF_REQUIRE_MATCH_MSG</code>, <code class=Nm>ATF_REQUIRE_STREQ</code>, <code class=Nm>ATF_REQUIRE_STREQ_MSG</code>, <code class=Nm>ATF_REQUIRE_ERRNO</code>, <code class=Nm>ATF_TC</code>, <code class=Nm>ATF_TC_BODY</code>, <code class=Nm>ATF_TC_BODY_NAME</code>, <code class=Nm>ATF_TC_CLEANUP</code>, <code class=Nm>ATF_TC_CLEANUP_NAME</code>, <code class=Nm>ATF_TC_HEAD</code>, <code class=Nm>ATF_TC_HEAD_NAME</code>, <code class=Nm>ATF_TC_NAME</code>, <code class=Nm>ATF_TC_WITH_CLEANUP</code>, <code class=Nm>ATF_TC_WITHOUT_HEAD</code>, <code class=Nm>ATF_TP_ADD_TC</code>, <code class=Nm>ATF_TP_ADD_TCS</code>, <code class=Nm>atf_tc_get_config_var</code>, <code class=Nm>atf_tc_get_config_var_wd</code>, <code class=Nm>atf_tc_get_config_var_as_bool</code>, <code class=Nm>atf_tc_get_config_var_as_bool_wd</code>, <code class=Nm>atf_tc_get_config_var_as_long</code>, <code class=Nm>atf_tc_get_config_var_as_long_wd</code>, <code class=Nm>atf_no_error</code>, <code class=Nm>atf_tc_expect_death</code>, <code class=Nm>atf_tc_expect_exit</code>, <code class=Nm>atf_tc_expect_fail</code>, <code class=Nm>atf_tc_expect_pass</code>, <code class=Nm>atf_tc_expect_signal</code>, <code class=Nm>atf_tc_expect_timeout</code>, <code class=Nm>atf_tc_fail</code>, <code class=Nm>atf_tc_fail_nonfatal</code>, <code class=Nm>atf_tc_pass</code>, <code class=Nm>atf_tc_skip</code>, <code class=Nm>atf_utils_cat_file</code>, <code class=Nm>atf_utils_compare_file</code>, <code class=Nm>atf_utils_copy_file</code>, <code class=Nm>atf_utils_create_file</code>, <code class=Nm>atf_utils_file_exists</code>, <code class=Nm>atf_utils_fork</code>, <code class=Nm>atf_utils_free_charpp</code>, <code class=Nm>atf_utils_grep_file</code>, <code class=Nm>atf_utils_grep_string</code>, <code class=Nm>atf_utils_readline</code>, <code class=Nm>atf_utils_redirect</code>, <code class=Nm>atf_utils_wait</code> — <div class=Nd>C API to write ATF-based test programs</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/atf-c.h.html>atf-c.h</a>&gt;</code><p class=Pp><code class=Fn>ATF_CHECK</code>(<var class=Fa style="white-space: nowrap;">expression</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_MSG</code>(<var class=Fa style="white-space: nowrap;">expression</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_EQ</code>(<var class=Fa style="white-space: nowrap;">expected_expression</var>, <var class=Fa style="white-space: nowrap;">actual_expression</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_EQ_MSG</code>(<var class=Fa style="white-space: nowrap;">expected_expression</var>, <var class=Fa style="white-space: nowrap;">actual_expression</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_MATCH</code>(<var class=Fa style="white-space: nowrap;">regexp</var>, <var class=Fa style="white-space: nowrap;">string</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_MATCH_MSG</code>(<var class=Fa style="white-space: nowrap;">regexp</var>, <var class=Fa style="white-space: nowrap;">string</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_STREQ</code>(<var class=Fa style="white-space: nowrap;">string_1</var>, <var class=Fa style="white-space: nowrap;">string_2</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_STREQ_MSG</code>(<var class=Fa style="white-space: nowrap;">string_1</var>, <var class=Fa style="white-space: nowrap;">string_2</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_CHECK_ERRNO</code>(<var class=Fa style="white-space: nowrap;">expected_errno</var>, <var class=Fa style="white-space: nowrap;">bool_expression</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE</code>(<var class=Fa style="white-space: nowrap;">expression</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_MSG</code>(<var class=Fa style="white-space: nowrap;">expression</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_EQ</code>(<var class=Fa style="white-space: nowrap;">expected_expression</var>, <var class=Fa style="white-space: nowrap;">actual_expression</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_EQ_MSG</code>(<var class=Fa style="white-space: nowrap;">expected_expression</var>, <var class=Fa style="white-space: nowrap;">actual_expression</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_MATCH</code>(<var class=Fa style="white-space: nowrap;">regexp</var>, <var class=Fa style="white-space: nowrap;">string</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_MATCH_MSG</code>(<var class=Fa style="white-space: nowrap;">regexp</var>, <var class=Fa style="white-space: nowrap;">string</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_STREQ</code>(<var class=Fa style="white-space: nowrap;">expected_string</var>, <var class=Fa style="white-space: nowrap;">actual_string</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_STREQ_MSG</code>(<var class=Fa style="white-space: nowrap;">expected_string</var>, <var class=Fa style="white-space: nowrap;">actual_string</var>, <var class=Fa style="white-space: nowrap;">fail_msg_fmt</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>ATF_REQUIRE_ERRNO</code>(<var class=Fa style="white-space: nowrap;">expected_errno</var>, <var class=Fa style="white-space: nowrap;">bool_expression</var>);</p><p class=Pp><code class=Fn>ATF_TC</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_BODY</code>(<var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">tc</var>);</p><p class=Pp><code class=Fn>ATF_TC_BODY_NAME</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_CLEANUP</code>(<var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">tc</var>);</p><p class=Pp><code class=Fn>ATF_TC_CLEANUP_NAME</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_HEAD</code>(<var class=Fa style="white-space: nowrap;">name</var>, <var class=Fa style="white-space: nowrap;">tc</var>);</p><p class=Pp><code class=Fn>ATF_TC_HEAD_NAME</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_NAME</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_WITH_CLEANUP</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TC_WITHOUT_HEAD</code>(<var class=Fa style="white-space: nowrap;">name</var>);</p><p class=Pp><code class=Fn>ATF_TP_ADD_TC</code>(<var class=Fa style="white-space: nowrap;">tp_name</var>, <var class=Fa style="white-space: nowrap;">tc_name</var>);</p><p class=Pp><code class=Fn>ATF_TP_ADD_TCS</code>(<var class=Fa style="white-space: nowrap;">tp_name</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">varname</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var_wd</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">variable_name</var>, <var class=Fa style="white-space: nowrap;">default_value</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var_as_bool</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">variable_name</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var_as_bool_wd</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">variable_name</var>, <var class=Fa style="white-space: nowrap;">default_value</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var_as_long</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">variable_name</var>);</p><p class=Pp><code class=Fn>atf_tc_get_config_var_as_long_wd</code>(<var class=Fa style="white-space: nowrap;">tc</var>, <var class=Fa style="white-space: nowrap;">variable_name</var>, <var class=Fa style="white-space: nowrap;">default_value</var>);</p><p class=Pp><code class=Fn>atf_no_error</code>();</p><p class=Pp><code class=Fn>atf_tc_expect_death</code>(<var class=Fa style="white-space: nowrap;">reason</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>atf_tc_expect_exit</code>(<var class=Fa style="white-space: nowrap;">exitcode</var>, <var class=Fa style="white-space: nowrap;">reason</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>atf_tc_expect_fail</code>(<var class=Fa style="white-space: nowrap;">reason</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>atf_tc_expect_pass</code>();</p><p class=Pp><code class=Fn>atf_tc_expect_signal</code>(<var class=Fa style="white-space: nowrap;">signo</var>, <var class=Fa style="white-space: nowrap;">reason</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>atf_tc_expect_timeout</code>(<var class=Fa style="white-space: nowrap;">reason</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p><p class=Pp><code class=Fn>atf_tc_fail</code>(<var class=Fa style="white-space: nowrap;">reason</var>);</p><p class=Pp><code class=Fn>atf_tc_fail_nonfatal</code>(<var class=Fa style="white-space: nowrap;">reason</var>);</p><p class=Pp><code class=Fn>atf_tc_pass</code>();</p><p class=Pp><code class=Fn>atf_tc_skip</code>(<var class=Fa style="white-space: nowrap;">reason</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_cat_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *prefix</var>);</p><p class=Pp><var class=Ft>bool</var><br><code class=Fn>atf_utils_compare_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *contents</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_copy_file</code>(<var class=Fa>const char *source</var>, <var class=Fa>const char *destination</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_create_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *contents</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_file_exists</code>(<var class=Fa>const char *file</var>);</p><p class=Pp><var class=Ft>pid_t</var><br><code class=Fn>atf_utils_fork</code>(<var class=Fa>void</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_free_charpp</code>(<var class=Fa>char **argv</var>);</p><p class=Pp><var class=Ft>bool</var><br><code class=Fn>atf_utils_grep_file</code>(<var class=Fa>const char *regexp</var>, <var class=Fa>const char *file</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>bool</var><br><code class=Fn>atf_utils_grep_string</code>(<var class=Fa>const char *regexp</var>, <var class=Fa>const char *str</var>, <var class=Fa>...</var>);</p><p class=Pp><var class=Ft>char *</var><br><code class=Fn>atf_utils_readline</code>(<var class=Fa>int fd</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_redirect</code>(<var class=Fa>const int fd</var>, <var class=Fa>const char *file</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>atf_utils_wait</code>(<var class=Fa>const pid_t pid</var>, <var class=Fa>const int expected_exit_status</var>, <var class=Fa>const char *expected_stdout</var>, <var class=Fa>const char *expected_stderr</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> ATF provides a C programming interface to implement test programs. C-based test programs follow this template: <div class="Bd Pp Bd-indent"><pre>
... C-specific includes go here ...

#include &lt;atf-c.h&gt;

ATF_TC(tc1);
ATF_TC_HEAD(tc1, tc)
{
    ... first test case's header ...
}
ATF_TC_BODY(tc1, tc)
{
    ... first test case's body ...
}

ATF_TC_WITH_CLEANUP(tc2);
ATF_TC_HEAD(tc2, tc)
{
    ... second test case's header ...
}
ATF_TC_BODY(tc2, tc)
{
    ... second test case's body ...
}
ATF_TC_CLEANUP(tc2, tc)
{
    ... second test case's cleanup ...
}

ATF_TC_WITHOUT_HEAD(tc3);
ATF_TC_BODY(tc3, tc)
{
    ... third test case's body ...
}

... additional test cases ...

ATF_TP_ADD_TCS(tp)
{
    ATF_TP_ADD_TC(tcs, tc1);
    ATF_TP_ADD_TC(tcs, tc2);
    ATF_TP_ADD_TC(tcs, tc3);
    ... add additional test cases ...

    return atf_no_error();
}
</pre></div><section class=Ss><h2 class=Ss id=Definition_of_test_cases><a class=permalink href=#Definition_of_test_cases>Definition of test cases</a></h2> Test cases have an identifier and are composed of three different parts: the header, the body and an optional cleanup routine, all of which are described in <a class=Xr href=atf-test-case.4.html>atf-test-case(4)</a>. To define test cases, one can use the <code class=Fn>ATF_TC</code>(), <code class=Fn>ATF_TC_WITH_CLEANUP</code>() or the <code class=Fn>ATF_TC_WITHOUT_HEAD</code>() macros, which take a single parameter specifying the test case's name. <code class=Fn>ATF_TC</code>(), requires to define a head and a body for the test case, <code class=Fn>ATF_TC_WITH_CLEANUP</code>() requires to define a head, a body and a cleanup for the test case and <code class=Fn>ATF_TC_WITHOUT_HEAD</code>() requires only a body for the test case. It is important to note that these <i class=Em>do not</i> set the test case up for execution when the program is run. In order to do so, a later registration is needed with the <code class=Fn>ATF_TP_ADD_TC</code>() macro detailed in <a class=Sx href=#Program_initialization>Program initialization</a>. <p class=Pp>Later on, one must define the three parts of the body by means of three functions. Their headers are given by the <code class=Fn>ATF_TC_HEAD</code>(), <code class=Fn>ATF_TC_BODY</code>() and <code class=Fn>ATF_TC_CLEANUP</code>() macros, all of which take the test case name provided to the <code class=Fn>ATF_TC</code>() <code class=Fn>ATF_TC_WITH_CLEANUP</code>(), or <code class=Fn>ATF_TC_WITHOUT_HEAD</code>() macros and the name of the variable that will hold a pointer to the test case data. Following each of these, a block of code is expected, surrounded by the opening and closing brackets.</p></section><section class=Ss><h2 class=Ss id=Program_initialization><a class=permalink href=#Program_initialization>Program initialization</a></h2> The library provides a way to easily define the test program's <code class=Fn>main</code>() function. You should never define one on your own, but rely on the library to do it for you. This is done by using the <code class=Fn>ATF_TP_ADD_TCS</code>() macro, which is passed the name of the object that will hold the test cases, i.e., the test program instance. This name can be whatever you want as long as it is a valid variable identifier. <p class=Pp>After the macro, you are supposed to provide the body of a function, which should only use the <code class=Fn>ATF_TP_ADD_TC</code>() macro to register the test cases the test program will execute and return a success error code. The first parameter of this macro matches the name you provided in the former call. The success status can be returned using the <code class=Fn>atf_no_error</code>() function.</p></section><section class=Ss><h2 class=Ss id=Header_definitions><a class=permalink href=#Header_definitions>Header definitions</a></h2> The test case's header can define the meta-data by using the <code class=Fn>atf_tc_set_md_var</code>() method, which takes three parameters: the first one points to the test case data, the second one specifies the meta-data variable to be set and the third one specifies its value. Both of them are strings. </section><section class=Ss><h2 class=Ss id=Configuration_variables><a class=permalink href=#Configuration_variables>Configuration variables</a></h2> The test case has read-only access to the current configuration variables by means of the <var class=Ft>bool</var><code class=Fn>atf_tc_has_config_var</code>(), <var class=Ft>const char *</var><code class=Fn>atf_tc_get_config_var</code>(), <var class=Ft>const char *</var><code class=Fn>atf_tc_get_config_var_wd</code>(), <var class=Ft>bool</var><code class=Fn>atf_tc_get_config_var_as_bool</code>(), <var class=Ft>bool</var><code class=Fn>atf_tc_get_config_var_as_bool_wd</code>(), <var class=Ft>long</var><code class=Fn>atf_tc_get_config_var_as_long</code>(), and the <var class=Ft>long</var><code class=Fn>atf_tc_get_config_var_as_long_wd</code>() functions, which can be called in any of the three parts of a test case. <p class=Pp>The ‘_wd’ variants take a default value for the variable which is returned if the variable is not defined. The other functions without the ‘_wd’ suffix <i class=Em>require</i> the variable to be defined.</p></section><section class=Ss><h2 class=Ss id=Access_to_the_source_directory><a class=permalink href=#Access_to_the_source_directory>Access to the source directory</a></h2> It is possible to get the path to the test case's source directory from any of its three components by querying the ‘srcdir’ configuration variable. </section><section class=Ss><h2 class=Ss id=Requiring_programs><a class=permalink href=#Requiring_programs>Requiring programs</a></h2> Aside from the <var class=Va>require.progs</var> meta-data variable available in the header only, one can also check for additional programs in the test case's body by using the <code class=Fn>atf_tc_require_prog</code>() function, which takes the base name or full path of a single binary. Relative paths are forbidden. If it is not found, the test case will be automatically skipped. </section><section class=Ss><h2 class=Ss id=Test_case_finalization><a class=permalink href=#Test_case_finalization>Test case finalization</a></h2> The test case finalizes either when the body reaches its end, at which point the test is assumed to have <i class=Em>passed</i>, unless any non-fatal errors were raised using <code class=Fn>atf_tc_fail_nonfatal</code>(), or at any explicit call to <code class=Fn>atf_tc_pass</code>(), <code class=Fn>atf_tc_fail</code>() or <code class=Fn>atf_tc_skip</code>(). These three functions terminate the execution of the test case immediately. The cleanup routine will be processed afterwards in a completely automated way, regardless of the test case's termination reason. <p class=Pp><code class=Fn>atf_tc_pass</code>() does not take any parameters. <code class=Fn>atf_tc_fail</code>(), <code class=Fn>atf_tc_fail_nonfatal</code>() and <code class=Fn>atf_tc_skip</code>() take a format string and a variable list of parameters, which describe, in a user-friendly manner, why the test case failed or was skipped, respectively. It is very important to provide a clear error message in both cases so that the user can quickly know why the test did not pass.</p></section><section class=Ss><h2 class=Ss id=Expectations><a class=permalink href=#Expectations>Expectations</a></h2> Everything explained in the previous section changes when the test case expectations are redefined by the programmer. <p class=Pp>Each test case has an internal state called ‘expect’ that describes what the test case expectations are at any point in time. The value of this property can change during execution by any of:</p><dl class=Bl-tag><dt><code class=Fn>atf_tc_expect_death</code>(<var class=Fa>reason</var>, <var class=Fa>...</var>)</dt><dd>Expects the test case to exit prematurely regardless of the nature of the exit.</dd><dt><code class=Fn>atf_tc_expect_exit</code>(<var class=Fa>exitcode</var>, <var class=Fa>reason</var>, <var class=Fa>...</var>)</dt><dd>Expects the test case to exit cleanly. If <var class=Va>exitcode</var> is not ‘-1’, the runtime engine will validate that the exit code of the test case matches the one provided in this call. Otherwise, the exact value will be ignored.</dd><dt><code class=Fn>atf_tc_expect_fail</code>(<var class=Fa>reason</var>, <var class=Fa>...</var>)</dt><dd>Any failure (be it fatal or non-fatal) raised in this mode is recorded. However, such failures do not report the test case as failed; instead, the test case finalizes cleanly and is reported as ‘expected failure’; this report includes the provided <var class=Fa>reason</var> as part of it. If no error is raised while running in this mode, then the test case is reported as ‘failed’. <p class=Pp>This mode is useful to reproduce actual known bugs in tests. Whenever the developer fixes the bug later on, the test case will start reporting a failure, signaling the developer that the test case must be adjusted to the new conditions. In this situation, it is useful, for example, to set <var class=Fa>reason</var> as the bug number for tracking purposes.</p></dd><dt><code class=Fn>atf_tc_expect_pass</code>()</dt><dd>This is the normal mode of execution. In this mode, any failure is reported as such to the user and the test case is marked as ‘failed’.</dd><dt><code class=Fn>atf_tc_expect_signal</code>(<var class=Fa>signo</var>, <var class=Fa>reason</var>, <var class=Fa>...</var>)</dt><dd>Expects the test case to terminate due to the reception of a signal. If <var class=Va>signo</var> is not ‘-1’, the runtime engine will validate that the signal that terminated the test case matches the one provided in this call. Otherwise, the exact value will be ignored.</dd><dt><code class=Fn>atf_tc_expect_timeout</code>(<var class=Fa>reason</var>, <var class=Fa>...</var>)</dt><dd>Expects the test case to execute for longer than its timeout.</dd></dl></section><section class=Ss><h2 class=Ss id=Helper_macros_for_common_checks><a class=permalink href=#Helper_macros_for_common_checks>Helper macros for common checks</a></h2> The library provides several macros that are very handy in multiple situations. These basically check some condition after executing a given statement or processing a given expression and, if the condition is not met, they report the test case as failed. <p class=Pp>The ‘REQUIRE’ variant of the macros immediately abort the test case as soon as an error condition is detected by calling the <code class=Fn>atf_tc_fail</code>() function. Use this variant whenever it makes no sense to continue the execution of a test case when the checked condition is not met. The ‘CHECK’ variant, on the other hand, reports a failure as soon as it is encountered using the <code class=Fn>atf_tc_fail_nonfatal</code>() function, but the execution of the test case continues as if nothing had happened. Use this variant whenever the checked condition is important as a result of the test case, but there are other conditions that can be subsequently checked on the same run without aborting.</p><p class=Pp>Additionally, the ‘MSG’ variants take an extra set of parameters to explicitly specify the failure message. This failure message is formatted according to the <a class=Xr href=printf.3.html>printf(3)</a> formatters.</p><p class=Pp><code class=Fn>ATF_CHECK</code>(), <code class=Fn>ATF_CHECK_MSG</code>(), <code class=Fn>ATF_REQUIRE</code>() and <code class=Fn>ATF_REQUIRE_MSG</code>() take an expression and fail if the expression evaluates to false.</p><p class=Pp><code class=Fn>ATF_CHECK_EQ</code>(), <code class=Fn>ATF_CHECK_EQ_MSG</code>(), <code class=Fn>ATF_REQUIRE_EQ</code>() and <code class=Fn>ATF_REQUIRE_EQ_MSG</code>() take two expressions and fail if the two evaluated values are not equal. The common style is to put the expected value in the first parameter and the actual value in the second parameter.</p><p class=Pp><code class=Fn>ATF_CHECK_MATCH</code>(), <code class=Fn>ATF_CHECK_MATCH_MSG</code>(), <code class=Fn>ATF_REQUIRE_MATCH</code>() and <code class=Fn>ATF_REQUIRE_MATCH_MSG</code>() take a regular expression and a string and fail if the regular expression does not match the given string. Note that the regular expression is not anchored, so it will match anywhere in the string.</p><p class=Pp><code class=Fn>ATF_CHECK_STREQ</code>(), <code class=Fn>ATF_CHECK_STREQ_MSG</code>(), <code class=Fn>ATF_REQUIRE_STREQ</code>() and <code class=Fn>ATF_REQUIRE_STREQ_MSG</code>() take two strings and fail if the two are not equal character by character. The common style is to put the expected string in the first parameter and the actual string in the second parameter.</p><p class=Pp><code class=Fn>ATF_CHECK_ERRNO</code>() and <code class=Fn>ATF_REQUIRE_ERRNO</code>() take, first, the error code that the check is expecting to find in the <var class=Va>errno</var> variable and, second, a boolean expression that, if evaluates to true, means that a call failed and <var class=Va>errno</var> has to be checked against the first value.</p></section><section class=Ss><h2 class=Ss id=Utility_functions><a class=permalink href=#Utility_functions>Utility functions</a></h2> The following functions are provided as part of the <code class=Nm>atf-c</code> API to simplify the creation of a variety of tests. In particular, these are useful to write tests for command-line interfaces. <p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_cat_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *prefix</var>);</p><div class="Bd Pp Bd-indent">Prints the contents of <var class=Fa>file</var> to the standard output, prefixing every line with the string in <var class=Fa>prefix</var>.</div><p class=Pp><var class=Ft>bool</var><code class=Fn>atf_utils_compare_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *contents</var>);</p><div class="Bd Pp Bd-indent">Returns true if the given <var class=Fa>file</var> matches exactly the expected inlined <var class=Fa>contents</var>.</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_copy_file</code>(<var class=Fa>const char *source</var>, <var class=Fa>const char *destination</var>);</p><div class="Bd Pp Bd-indent">Copies the file <var class=Fa>source</var> to <var class=Fa>destination</var>. The permissions of the file are preserved during the code.</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_create_file</code>(<var class=Fa>const char *file</var>, <var class=Fa>const char *contents</var>, <var class=Fa>...</var>);</p><div class="Bd Pp Bd-indent">Creates <var class=Fa>file</var> with the text given in <var class=Fa>contents</var>, which is a formatting string that uses the rest of the variable arguments.</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_file_exists</code>(<var class=Fa>const char *file</var>);</p><div class="Bd Pp Bd-indent">Checks if <var class=Fa>file</var> exists.</div><p class=Pp><var class=Ft>pid_t</var><code class=Fn>atf_utils_fork</code>(<var class=Fa>void</var>);</p><div class="Bd Pp Bd-indent">Forks a process and redirects the standard output and standard error of the child to files for later validation with <code class=Fn>atf_utils_wait</code>(). Fails the test case if the fork fails, so this does not return an error.</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_free_charpp</code>(<var class=Fa>char **argv</var>);</p><div class="Bd Pp Bd-indent">Frees a dynamically-allocated array of dynamically-allocated strings.</div><p class=Pp><var class=Ft>bool</var><code class=Fn>atf_utils_grep_file</code>(<var class=Fa>const char *regexp</var>, <var class=Fa>const char *file</var>, <var class=Fa>...</var>);</p><div class="Bd Pp Bd-indent">Searches for the <var class=Fa>regexp</var>, which is a formatting string representing the regular expression, in the <var class=Fa>file</var>. The variable arguments are used to construct the regular expression.</div><p class=Pp><var class=Ft>bool</var><code class=Fn>atf_utils_grep_string</code>(<var class=Fa>const char *regexp</var>, <var class=Fa>const char *str</var>, <var class=Fa>...</var>);</p><div class="Bd Pp Bd-indent">Searches for the <var class=Fa>regexp</var>, which is a formatting string representing the regular expression, in the literal string <var class=Fa>str</var>. The variable arguments are used to construct the regular expression.</div><p class=Pp><var class=Ft>char *</var><code class=Fn>atf_utils_readline</code>(<var class=Fa>int fd</var>);</p><div class="Bd Pp Bd-indent">Reads a line from the file descriptor <var class=Fa>fd</var>. The line, if any, is returned as a dynamically-allocated buffer that must be released with <a class=Xr href=free.3.html>free(3)</a>. If there was nothing to read, returns ‘NULL’.</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_redirect</code>(<var class=Fa>const int fd</var>, <var class=Fa>const char *file</var>);</p><div class="Bd Pp Bd-indent">Redirects the given file descriptor <var class=Fa>fd</var> to <var class=Fa>file</var>. This function exits the process in case of an error and does not properly mark the test case as failed. As a result, it should only be used in subprocesses of the test case; specially those spawned by <code class=Fn>atf_utils_fork</code>().</div><p class=Pp><var class=Ft>void</var><code class=Fn>atf_utils_wait</code>(<var class=Fa>const pid_t pid</var>, <var class=Fa>const int expected_exit_status</var>, <var class=Fa>const char *expected_stdout</var>, <var class=Fa>const char *expected_stderr</var>);</p><div class="Bd Pp Bd-indent">Waits and validates the result of a subprocess spawned with <code class=Fn>atf_utils_fork</code>(). The validation involves checking that the subprocess exited cleanly and returned the code specified in <var class=Fa>expected_exit_status</var> and that its standard output and standard error match the strings given in <var class=Fa>expected_stdout</var> and <var class=Fa>expected_stderr</var>. <p class=Pp>If any of the <var class=Fa>expected_stdout</var> or <var class=Fa>expected_stderr</var> strings are prefixed with ‘save:’, then they specify the name of the file into which to store the stdout or stderr of the subprocess, and no comparison is performed.</p></div></section></section><section class=Sh><h2 class=Sh id=ENVIRONMENT><a class=permalink href=#ENVIRONMENT>ENVIRONMENT</a></h2> The following variables are recognized by <code class=Nm>atf-c</code> but should not be overridden other than for testing purposes: <p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><var class=Va>ATF_BUILD_CC</var></dt><dd>Path to the C compiler.</dd><dt><var class=Va>ATF_BUILD_CFLAGS</var></dt><dd>C compiler flags.</dd><dt><var class=Va>ATF_BUILD_CPP</var></dt><dd>Path to the C/C++ preprocessor.</dd><dt><var class=Va>ATF_BUILD_CPPFLAGS</var></dt><dd>C/C++ preprocessor flags.</dd><dt><var class=Va>ATF_BUILD_CXX</var></dt><dd>Path to the C++ compiler.</dd><dt><var class=Va>ATF_BUILD_CXXFLAGS</var></dt><dd>C++ compiler flags.</dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> The following shows a complete test program with a single test case that validates the addition operator: <div class="Bd Pp Bd-indent"><pre>
#include &lt;atf-c.h&gt;

ATF_TC(addition);
ATF_TC_HEAD(addition, tc)
{
    atf_tc_set_md_var(tc, "descr",
                      "Sample tests for the addition operator");
}
ATF_TC_BODY(addition, tc)
{
    ATF_CHECK_EQ(0, 0 + 0);
    ATF_CHECK_EQ(1, 0 + 1);
    ATF_CHECK_EQ(1, 1 + 0);

    ATF_CHECK_EQ(2, 1 + 1);

    ATF_CHECK_EQ(300, 100 + 200);
}

ATF_TC(string_formatting);
ATF_TC_HEAD(string_formatting, tc)
{
    atf_tc_set_md_var(tc, "descr",
                      "Sample tests for the snprintf");
}
ATF_TC_BODY(string_formatting, tc)
{
    char buf[1024];
    snprintf(buf, sizeof(buf), "a %s", "string");
    ATF_CHECK_STREQ_MSG("a string", buf, "%s is not working");
}

ATF_TC(open_failure);
ATF_TC_HEAD(open_failure, tc)
{
    atf_tc_set_md_var(tc, "descr",
                      "Sample tests for the open function");
}
ATF_TC_BODY(open_failure, tc)
{
    ATF_CHECK_ERRNO(ENOENT, open("non-existent", O_RDONLY) == -1);
}

ATF_TC(known_bug);
ATF_TC_HEAD(known_bug, tc)
{
    atf_tc_set_md_var(tc, "descr",
                      "Reproduces a known bug");
}
ATF_TC_BODY(known_bug, tc)
{
    atf_tc_expect_fail("See bug number foo/bar");
    ATF_CHECK_EQ(3, 1 + 1);
    atf_tc_expect_pass();
    ATF_CHECK_EQ(3, 1 + 2);
}

ATF_TP_ADD_TCS(tp)
{
    ATF_TP_ADD_TC(tp, addition);
    ATF_TP_ADD_TC(tp, string_formatting);
    ATF_TP_ADD_TC(tp, open_failure);
    ATF_TP_ADD_TC(tp, known_bug);

    return atf_no_error();
}
</pre></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=atf-test-program.1.html>atf-test-program(1)</a>, <a class=Xr href=atf-test-case.4.html>atf-test-case(4)</a></section></div><table class=foot><tr><td class=foot-date>April 5, 2017</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>