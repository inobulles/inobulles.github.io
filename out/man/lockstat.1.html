<!DOCTYPE html>
<html><head><meta charset=utf-8><title>lockstat(1)</title><keywords content=man,lockstat></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>lockstat(1)</h1><table class=head><tr><td class=head-ltitle>LOCKSTAT(1)</td><td class=head-vol>FreeBSD General Commands Manual</td><td class=head-rtitle>LOCKSTAT(1)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>lockstat</code> — <div class=Nd>report kernel lock and profiling statistics</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>lockstat</code></td><td>[<code class=Fl>-ACEHIV</code>] [<code class=Fl>-e</code><var class=Ar>event-list</var>] [<code class=Fl>-i</code><var class=Ar>rate</var>] [<code class=Fl>-b</code> | <code class=Fl>-t</code> | <code class=Fl>-h</code> | <code class=Fl>-s</code><var class=Ar>depth</var>] [<code class=Fl>-n</code><var class=Ar>num-records</var>] [<code class=Fl>-l</code><var class=Ar>lock</var> [,<var class=Ar>size</var>]] [<code class=Fl>-d</code><var class=Ar>duration</var>] [<code class=Fl>-f</code><var class=Ar>function</var> [,<var class=Ar>size</var>]] [<code class=Fl>-T</code>] [<code class=Fl>-kgwWRpP</code>] [<code class=Fl>-D</code><var class=Ar>count</var>] [<code class=Fl>-o</code><code class=Fl>-filename</code>] [<code class=Fl>-x</code><var class=Ar>opt</var> [=<var class=Ar>val</var>]] <var class=Ar>command</var> [[<var class=Ar>args</var>]]</td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>lockstat</code> utility gathers and displays kernel locking and profiling statistics. <code class=Nm>lockstat</code> allows you to specify which events to watch (for example, spin on adaptive mutex, block on read access to rwlock due to waiting writers, and so forth), how much data to gather for each event, and how to display the data. By default, <code class=Nm>lockstat</code> monitors all lock contention events, gathers frequency and timing data about those events, and displays the data in decreasing frequency order, so that the most common events appear first. <p class=Pp><code class=Nm>lockstat</code> gathers data until the specified command completes. For example, to gather statistics for a fixed-time interval, use <a class=Xr href=sleep.1.html>sleep(1)</a> as the command, as follows:</p><p class=Pp></p><div class="Bd Bd-indent"><code class=Li># lockstat sleep 5</code></div><p class=Pp>When the <code class=Fl>-I</code> option is specified, <code class=Nm>lockstat</code> establishes a per-processor high-level periodic interrupt source to gather profiling data. The interrupt handler simply generates a <code class=Nm>lockstat</code> event whose caller is the interrupted PC (program counter). The profiling event is just like any other <code class=Nm>lockstat</code> event, so all of the normal <code class=Nm>lockstat</code> options are applicable.</p><p class=Pp><code class=Nm>lockstat</code> relies on DTrace to modify the running kernel's text to intercept events of interest. This imposes a small but measurable overhead on all system activity, so access to <code class=Nm>lockstat</code> is restricted to super-user by default.</p></section><section class=Sh><h2 class=Sh id=OPTIONS><a class=permalink href=#OPTIONS>OPTIONS</a></h2> The following options are supported: <dl class=Bl-tag><dt><a class=permalink href=#V><code class=Fl id=V>-V</code></a></dt><dd>Print the D program used to gather the requested data.</dd></dl><section class=Ss><h2 class=Ss id=Event_Selection><a class=permalink href=#Event_Selection>Event Selection</a></h2> If no event selection options are specified, the default is <code class=Fl>-C</code>. <dl class=Bl-tag><dt><a class=permalink href=#A><code class=Fl id=A>-A</code></a></dt><dd>Watch all lock events. <code class=Fl>-A</code> is equivalent to <code class=Fl>-CH</code>.</dd><dt><a class=permalink href=#C><code class=Fl id=C>-C</code></a></dt><dd>Watch contention events.</dd><dt><a class=permalink href=#E><code class=Fl id=E>-E</code></a></dt><dd>Watch error events.</dd><dt><a class=permalink href=#e><code class=Fl id=e>-e</code></a><var class=Ar>event-list</var></dt><dd>Only watch the specified events. <var class=Ar>event-list</var> is a comma-separated list of events or ranges of events such as 1,4-7,35. Run <code class=Nm>lockstat</code> with no arguments to get a brief description of all events.</dd><dt><a class=permalink href=#H><code class=Fl id=H>-H</code></a></dt><dd>Watch hold events.</dd><dt><a class=permalink href=#I><code class=Fl id=I>-I</code></a></dt><dd>Watch profiling interrupt events.</dd><dt><a class=permalink href=#i><code class=Fl id=i>-i</code></a><var class=Ar>rate</var></dt><dd>Interrupt rate (per second) for <code class=Fl>-I</code>. The default is 97 Hz, so that profiling doesn't run in lockstep with the clock interrupt (which runs at 100 Hz).</dd></dl></section><section class=Ss><h2 class=Ss id=Data_Gathering><a class=permalink href=#Data_Gathering>Data Gathering</a></h2><dl class=Bl-tag><dt><a class=permalink href=#x><code class=Fl id=x>-x</code></a><var class=Ar>arg</var> [=<var class=Ar>val</var>]</dt><dd>Enable or modify a <a class=Xr href=dtrace.1.html>dtrace(1)</a> runtime option or D compiler option. Boolean options are enabled by specifying their name. Options with values are set by separating the option name and value with an equals sign.</dd></dl></section><section class=Ss><h2 class=Ss id=Data_Gathering_(Mutually_Exclusive)><a class=permalink href=#Data_Gathering_(Mutually_Exclusive)>Data Gathering (Mutually Exclusive)</a></h2><dl class=Bl-tag><dt><a class=permalink href=#b><code class=Fl id=b>-b</code></a></dt><dd>Basic statistics: lock, caller, number of events.</dd><dt><a class=permalink href=#h><code class=Fl id=h>-h</code></a></dt><dd>Histogram: timing plus time-distribution histograms.</dd><dt><a class=permalink href=#s><code class=Fl id=s>-s</code></a><var class=Ar>depth</var></dt><dd>Stack trace: histogram plus stack traces up to <var class=Ar>depth</var> frames deep.</dd><dt><a class=permalink href=#t><code class=Fl id=t>-t</code></a></dt><dd>Timing: Basic plus timing for all events (default).</dd></dl></section><section class=Ss><h2 class=Ss id=Data_Filtering><a class=permalink href=#Data_Filtering>Data Filtering</a></h2><dl class=Bl-tag><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a><var class=Ar>duration</var></dt><dd>Only watch events longer than <var class=Ar>duration</var>.</dd><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a><var class=Ar>func</var>[,<var class=Ar>size</var>]</dt><dd>Only watch events generated by <var class=Ar>func</var>, which can be specified as a symbolic name or hex address. <var class=Ar>size</var> defaults to the ELF symbol size if available, or 1 if not.</dd><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a><var class=Ar>lock</var>[,<var class=Ar>size</var>]</dt><dd>Only watch <var class=Ar>lock</var>, which can be specified as a symbolic name or hex address. <var class=Ar>size</var> defaults to the ELF symbol size or 1 if the symbol size is not available.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a><var class=Ar>num-records</var></dt><dd>Maximum number of data records.</dd><dt><a class=permalink href=#T><code class=Fl id=T>-T</code></a></dt><dd>Trace (rather than sample) events. This is off by default.</dd></dl></section><section class=Ss><h2 class=Ss id=Data_Reporting><a class=permalink href=#Data_Reporting>Data Reporting</a></h2><dl class=Bl-tag><dt><a class=permalink href=#D><code class=Fl id=D>-D</code></a><var class=Ar>count</var></dt><dd>Only display the top <var class=Ar>count</var> events of each type.</dd><dt><a class=permalink href=#g><code class=Fl id=g>-g</code></a></dt><dd>Show total events generated by function. For example, if <code class=Fn>foo</code>() calls <code class=Fn>bar</code>() in a loop, the work done by <code class=Fn>bar</code>() counts as work generated by <code class=Fn>foo</code>() (along with any work done by <code class=Fn>foo</code>() itself). The <code class=Fl>-g</code> option works by counting the total number of stack frames in which each function appears. This implies two things: (1) the data reported by <code class=Fl>-g</code> can be misleading if the stack traces are not deep enough, and (2) functions that are called recursively might show greater than 100% activity. In light of issue (1), the default data gathering mode when using <code class=Fl>-g</code> is <code class=Fl>-s</code><code class=Fl>-50</code>.</dd><dt><a class=permalink href=#k><code class=Fl id=k>-k</code></a></dt><dd>Coalesce PCs within functions.</dd><dt><a class=permalink href=#o><code class=Fl id=o>-o</code></a><var class=Ar>filename</var></dt><dd>Direct output to <var class=Ar>filename</var>.</dd><dt><a class=permalink href=#P><code class=Fl id=P>-P</code></a></dt><dd>Sort data by (<i>count * time</i>) product.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a></dt><dd>Parsable output format.</dd><dt><a class=permalink href=#R><code class=Fl id=R>-R</code></a></dt><dd>Display rates (events per second) rather than counts.</dd><dt><a class=permalink href=#W><code class=Fl id=W>-W</code></a></dt><dd>Whichever: distinguish events only by caller, not by lock.</dd><dt><a class=permalink href=#w><code class=Fl id=w>-w</code></a></dt><dd>Wherever: distinguish events only by lock, not by caller.</dd></dl></section></section><section class=Sh><h2 class=Sh id=DISPLAY_FORMATS><a class=permalink href=#DISPLAY_FORMATS>DISPLAY FORMATS</a></h2> The following headers appear over various columns of data. <dl class=Bl-tag><dt>Count or ops/s</dt><dd>Number of times this event occurred, or the rate (times per second) if <code class=Fl>-R</code> was specified.</dd><dt>indv</dt><dd>Percentage of all events represented by this individual event.</dd><dt>genr</dt><dd>Percentage of all events generated by this function.</dd><dt>cuml</dt><dd>Cumulative percentage; a running total of the individuals.</dd><dt>rcnt</dt><dd>Average reference count. This will always be 1 for exclusive locks (mutexes, spin locks, rwlocks held as writer) but can be greater than 1 for shared locks (rwlocks held as reader).</dd><dt>nsec</dt><dd>Average duration of the events in nanoseconds, as appropriate for the event. For the profiling event, duration means interrupt latency.</dd><dt>Lock</dt><dd>Address of the lock; displayed symbolically if possible.</dd><dt>CPU+Pri_Class</dt><dd>CPU plus the priority class of the interrupted thread. For example, if CPU 4 is interrupted while running a timeshare thread, this will be reported as ‘<code class=Li>cpu[4]+TShar</code>’.</dd><dt>Caller</dt><dd>Address of the caller; displayed symbolically if possible.</dd></dl></section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2><dl class=Bl-tag><dt>Example 1 Measuring Kernel Lock Contention</dt><dd><p class=Pp><code class=Li># lockstat sleep 5</code></p><div class="Bd Pp"><pre>
Adaptive mutex spin: 41411 events in 5.011 seconds (8263 events/sec)

Count indv cuml rcnt     nsec Lock                   Caller
-------------------------------------------------------------------------------
13750  33%  33% 0.00       72 vm_page_queue_free_mtx vm_page_free_toq+0x12e
13648  33%  66% 0.00       66 vm_page_queue_free_mtx vm_page_alloc+0x138
 4023  10%  76% 0.00       51 vm_dom+0x80            vm_page_dequeue+0x68
 2672   6%  82% 0.00      186 vm_dom+0x80            vm_page_enqueue+0x63
  618   1%  84% 0.00       31 0xfffff8000cd83a88     qsyncvp+0x37
  506   1%  85% 0.00      164 0xfffff8000cb3f098     vputx+0x5a
  477   1%  86% 0.00       69 0xfffff8000c7eb180     uma_dbg_getslab+0x5b
  288   1%  87% 0.00       77 0xfffff8000cd8b000     vn_finished_write+0x29
  263   1%  88% 0.00      103 0xfffff8000cbad448     vinactive+0xdc
  259   1%  88% 0.00       53 0xfffff8000cd8b000     vfs_ref+0x24
  237   1%  89% 0.00       20 0xfffff8000cbad448     vfs_hash_get+0xcc
  233   1%  89% 0.00       22 0xfffff8000bfd9480     uma_dbg_getslab+0x5b
  223   1%  90% 0.00       20 0xfffff8000cb3f098     cache_lookup+0x561
  193   0%  90% 0.00       16 0xfffff8000cb40ba8     vref+0x27
  175   0%  91% 0.00       34 0xfffff8000cbad448     vputx+0x5a
  169   0%  91% 0.00       51 0xfffff8000cd8b000     vfs_unbusy+0x27
  164   0%  92% 0.00       31 0xfffff8000cb40ba8     vputx+0x5a
[...]

Adaptive mutex block: 10 events in 5.011 seconds (2 events/sec)

Count indv cuml rcnt     nsec Lock                   Caller
-------------------------------------------------------------------------------
    3  30%  30% 0.00    17592 vm_page_queue_free_mtx vm_page_alloc+0x138
    2  20%  50% 0.00    20528 vm_dom+0x80            vm_page_enqueue+0x63
    2  20%  70% 0.00    55502 0xfffff8000cb40ba8     vputx+0x5a
    1  10%  80% 0.00    12007 vm_page_queue_free_mtx vm_page_free_toq+0x12e
    1  10%  90% 0.00     9125 0xfffff8000cbad448     vfs_hash_get+0xcc
    1  10% 100% 0.00     7864 0xfffff8000cd83a88     qsyncvp+0x37
-------------------------------------------------------------------------------
[...]
    </pre></div></dd><dt>Example 2 Measuring Hold Times</dt><dd><p class=Pp><code class=Li># lockstat -H -D 10 sleep 1</code></p><div class="Bd Pp"><pre>
Adaptive mutex hold: 109589 events in 1.039 seconds (105526 events/sec)

Count indv cuml rcnt     nsec Lock                   Caller
-------------------------------------------------------------------------------
 8998   8%   8% 0.00      617 0xfffff8000c7eb180     uma_dbg_getslab+0xd4
 5901   5%  14% 0.00      917 vm_page_queue_free_mtx vm_object_terminate+0x16a
 5040   5%  18% 0.00      902 vm_dom+0x80            vm_page_free_toq+0x88
 4884   4%  23% 0.00     1056 vm_page_queue_free_mtx vm_page_alloc+0x44e
 4664   4%  27% 0.00      759 vm_dom+0x80            vm_fault_hold+0x1a13
 4011   4%  31% 0.00      888 vm_dom                 vm_page_advise+0x11b
 4010   4%  34% 0.00      957 vm_dom+0x80            _vm_page_deactivate+0x5c
 3743   3%  38% 0.00      582 0xfffff8000cf04838     pmap_is_prefaultable+0x158
 2254   2%  40% 0.00      952 vm_dom                 vm_page_free_toq+0x88
 1639   1%  41% 0.00      591 0xfffff800d60065b8     trap_pfault+0x1f7
-------------------------------------------------------------------------------
[...]

R/W writer hold: 64314 events in 1.039 seconds (61929 events/sec)

Count indv cuml rcnt     nsec Lock                   Caller
-------------------------------------------------------------------------------
 7421  12%  12% 0.00     2994 pvh_global_lock        pmap_page_is_mapped+0xb6
 4668   7%  19% 0.00     3313 pvh_global_lock        pmap_enter+0x9ae
 1639   3%  21% 0.00      733 0xfffff80168d10200     vm_object_deallocate+0x683
 1639   3%  24% 0.00     3061 0xfffff80168d10200     unlock_and_deallocate+0x2b
 1639   3%  26% 0.00     2966 0xfffff80168d10200     vm_fault_hold+0x16ee
 1567   2%  29% 0.00      733 0xfffff80168d10200     vm_fault_hold+0x19bc
  821   1%  30% 0.00      786 0xfffff801eb0cc000     vm_object_madvise+0x32d
  649   1%  31% 0.00     4918 0xfffff80191105300     vm_fault_hold+0x16ee
  648   1%  32% 0.00     8112 0xfffff80191105300     unlock_and_deallocate+0x2b
  647   1%  33% 0.00     1261 0xfffff80191105300     vm_object_deallocate+0x683
-------------------------------------------------------------------------------
    </pre></div></dd><dt>Example 3 Measuring Hold Times for Stack Traces Containing a Specific Function</dt><dd><p class=Pp><code class=Li># lockstat -H -f tcp_input -s 50 -D 10 sleep 1</code></p><div class="Bd Pp"><pre>
Adaptive mutex hold: 68 events in 1.026 seconds (66 events/sec)

-------------------------------------------------------------------------------
Count indv cuml rcnt     nsec Lock                   Caller
   32  47%  47% 0.00     1631 0xfffff800686f50d8     tcp_do_segment+0x284b

      nsec ------ Time Distribution ------ count     Stack
      1024 |@@@@@@@@@@                     11        tcp_input+0xf54
      2048 |@@@@@@@@@@@@@                  14        ip_input+0xc8
      4096 |@@@@@                          6         swi_net+0x192
      8192 |                               1         intr_event_execute_handlers+0x93
                                                     ithread_loop+0xa6
                                                     fork_exit+0x84
                                                     0xffffffff808cf9ee
-------------------------------------------------------------------------------
Count indv cuml rcnt     nsec Lock                   Caller
   29  43%  90% 0.00     4851 0xfffff800686f50d8     sowakeup+0xf8

      nsec ------ Time Distribution ------ count     Stack
      4096 |@@@@@@@@@@@@@@@                15        tcp_do_segment+0x2423
      8192 |@@@@@@@@@@@@                   12        tcp_input+0xf54
     16384 |@@                             2         ip_input+0xc8
                                                     swi_net+0x192
                                                     intr_event_execute_handlers+0x93
                                                     ithread_loop+0xa6
                                                     fork_exit+0x84
                                                     0xffffffff808cf9ee
-------------------------------------------------------------------------------
[...]
    </pre></div></dd></dl></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=dtrace.1.html>dtrace(1)</a>, <a class=Xr href=ksyms.4.html>ksyms(4)</a>, <a class=Xr href=locking.9.html>locking(9)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>lockstat</code> utility first appeared in <span class=Ux>FreeBSD 7.1</span>. </section><section class=Sh><h2 class=Sh id=NOTES><a class=permalink href=#NOTES>NOTES</a></h2> Tail-call elimination can affect call sites. For example, if <code class=Fn>foo</code>()+0x50 calls <code class=Fn>bar</code>() and the last thing <code class=Fn>bar</code>() does is call <code class=Fn>mtx_unlock</code>(), the compiler can arrange for <code class=Fn>bar</code>() to branch to <code class=Fn>mtx_unlock</code>() with a return address of <code class=Fn>foo</code>()+0x58. Thus, the <code class=Fn>mtx_unlock</code>() in <code class=Fn>bar</code>() will appear as though it occurred at <code class=Fn>foo</code>()+0x58. <p class=Pp>The PC in the stack frame in which an interrupt occurs can be bogus because, between function calls, the compiler is free to use the return address register for local storage.</p><p class=Pp>When using the <code class=Fl>-I</code> and <code class=Fl>-s</code> options together, the interrupted PC will usually not appear anywhere in the stack since the interrupt handler is entered asynchronously, not by a function call from that PC.</p></section></div><table class=foot><tr><td class=foot-date>February 25, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>