<!DOCTYPE html>
<html><head><meta charset=utf-8><title>sodupsockaddr(9)</title><keywords content=man,sodupsockaddr></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>sodupsockaddr(9)</h1><table class=head><tr><td class=head-ltitle>SOCKET(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>SOCKET(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>socket</code> — <div class=Nd>kernel socket interface</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/socket.h.html>sys/socket.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/sys/socketvar.h.html>sys/socketvar.h</a>&gt;</code><p class=Pp><var class=Ft>void</var><br><code class=Fn>soabort</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soaccept</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockaddr **nam</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>socheckuid</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">uid_t uid</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sobind</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockaddr *nam</var>, <var class=Fa style="white-space: nowrap;">struct thread *td</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>soclose</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soconnect</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockaddr *nam</var>, <var class=Fa style="white-space: nowrap;">struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>socreate</code>(<var class=Fa>int dom</var>, <var class=Fa>struct socket **aso</var>, <var class=Fa>int type</var>, <var class=Fa>int proto</var>, <var class=Fa>struct ucred *cred</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sodisconnect</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sodtor_set</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>void (*func)(struct socket *)</var>);</p><p class=Pp><var class=Ft>struct sockaddr *</var><br><code class=Fn>sodupsockaddr</code>(<var class=Fa style="white-space: nowrap;">const struct sockaddr *sa</var>, <var class=Fa style="white-space: nowrap;">int mflags</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sofree</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sohasoutofband</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>solisten</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">int backlog</var>, <var class=Fa style="white-space: nowrap;">struct thread *td</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>solisten_proto</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">int backlog</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>solisten_proto_check</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>struct socket *</var><br><code class=Fn>sonewconn</code>(<var class=Fa style="white-space: nowrap;">struct socket *head</var>, <var class=Fa style="white-space: nowrap;">int connstatus</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sopoll</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>int events</var>, <var class=Fa>struct ucred *active_cred</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sopoll_generic</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>int events</var>, <var class=Fa>struct ucred *active_cred</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soreceive</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr **psa</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf **mp0</var>, <var class=Fa>struct mbuf **controlp</var>, <var class=Fa>int *flagsp</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soreceive_stream</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr **paddr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf **mp0</var>, <var class=Fa>struct mbuf **controlp</var>, <var class=Fa>int *flagsp</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soreceive_dgram</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr **paddr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf **mp0</var>, <var class=Fa>struct mbuf **controlp</var>, <var class=Fa>int *flagsp</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soreceive_generic</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr **paddr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf **mp0</var>, <var class=Fa>struct mbuf **controlp</var>, <var class=Fa>int *flagsp</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soreserve</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">u_long sndcc</var>, <var class=Fa style="white-space: nowrap;">u_long rcvcc</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sorflush</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sosend</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr *addr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf *top</var>, <var class=Fa>struct mbuf *control</var>, <var class=Fa>int flags</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sosend_dgram</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr *addr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf *top</var>, <var class=Fa>struct mbuf *control</var>, <var class=Fa>int flags</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sosend_generic</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>struct sockaddr *addr</var>, <var class=Fa>struct uio *uio</var>, <var class=Fa>struct mbuf *top</var>, <var class=Fa>struct mbuf *control</var>, <var class=Fa>int flags</var>, <var class=Fa>struct thread *td</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>soshutdown</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">int how</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sotoxsocket</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct xsocket *xso</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>soupcall_clear</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">int which</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>soupcall_set</code>(<var class=Fa>struct socket *so</var>, <var class=Fa>int which</var>, <var class=Fa>int (*func)(struct socket *, void *, int)</var>, <var class=Fa>void *arg</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>sowakeup</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockbuf *sb</var>);</p><p class=Pp><code class=In>#include &lt;<a class=In href=../src/sys/sockopt.h.html>sys/sockopt.h</a>&gt;</code></p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sosetopt</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockopt *sopt</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sogetopt</code>(<var class=Fa style="white-space: nowrap;">struct socket *so</var>, <var class=Fa style="white-space: nowrap;">struct sockopt *sopt</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sooptcopyin</code>(<var class=Fa style="white-space: nowrap;">struct sockopt *sopt</var>, <var class=Fa style="white-space: nowrap;">void *buf</var>, <var class=Fa style="white-space: nowrap;">size_t len</var>, <var class=Fa style="white-space: nowrap;">size_t minlen</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>sooptcopyout</code>(<var class=Fa style="white-space: nowrap;">struct sockopt *sopt</var>, <var class=Fa style="white-space: nowrap;">const void *buf</var>, <var class=Fa style="white-space: nowrap;">size_t len</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The kernel <code class=Nm>socket</code> programming interface permits in-kernel consumers to interact with local and network socket objects in a manner similar to that permitted using the <a class=Xr href=socket.2.html>socket(2)</a> user API. These interfaces are appropriate for use by distributed file systems and other network-aware kernel services. While the user API operates on file descriptors, the kernel interfaces operate directly on <var class=Vt>struct socket</var> pointers. Some portions of the kernel API exist only to implement the user API, and are not expected to be used by kernel code. The portions of the socket API used by socket consumers and implementations of network protocols will differ; some routines are only useful for protocol implementors. <p class=Pp>Except where otherwise indicated, <code class=Nm>socket</code> functions may sleep, and are not appropriate for use in an <a class=Xr href=ithread.9.html>ithread(9)</a> context or while holding non-sleepable kernel locks.</p><section class=Ss><h2 class=Ss id=Creating_and_Destroying_Sockets><a class=permalink href=#Creating_and_Destroying_Sockets>Creating and Destroying Sockets</a></h2> A new socket may be created using <code class=Fn>socreate</code>(). As with <a class=Xr href=socket.2.html>socket(2)</a>, arguments specify the requested domain, type, and protocol via <var class=Fa>dom</var>, <var class=Fa>type</var>, and <var class=Fa>proto</var>. The socket is returned via <var class=Fa>aso</var> on success. In addition, the credential used to authorize operations associated with the socket will be passed via <var class=Fa>cred</var> (and will be cached for the lifetime of the socket), and the thread performing the operation via <var class=Fa>td</var>. <i class=Em>Warning</i>: authorization of the socket creation operation will be performed using the thread credential for some protocols (such as raw sockets). <p class=Pp>Sockets may be closed and freed using <code class=Fn>soclose</code>(), which has similar semantics to <a class=Xr href=close.2.html>close(2)</a>.</p><p class=Pp>In certain circumstances, it is appropriate to destroy a socket without waiting for it to disconnect, for which <code class=Fn>soabort</code>() is used. This is only appropriate for incoming connections which are in a partially connected state. It must be called on an unreferenced socket, by the thread which removed the socket from its listen queue, to prevent races. It will call into protocol code, so no socket locks may be held over the call. The caller of <code class=Fn>soabort</code>() is responsible for setting the VNET context. The normal path to freeing a socket is <code class=Fn>sofree</code>(), which handles reference counting on the socket. It should be called whenever a reference is released, and also whenever reference flags are cleared in socket or protocol code. Calls to <code class=Fn>sofree</code>() should not be made from outside the socket layer; outside callers should use <code class=Fn>soclose</code>() instead.</p></section><section class=Ss><h2 class=Ss id=Connections_and_Addresses><a class=permalink href=#Connections_and_Addresses>Connections and Addresses</a></h2> The <code class=Fn>sobind</code>() function is equivalent to the <a class=Xr href=bind.2.html>bind(2)</a> system call, and binds the socket <var class=Fa>so</var> to the address <var class=Fa>nam</var>. The operation would be authorized using the credential on thread <var class=Fa>td</var>. <p class=Pp>The <code class=Fn>soconnect</code>() function is equivalent to the <a class=Xr href=connect.2.html>connect(2)</a> system call, and initiates a connection on the socket <var class=Fa>so</var> to the address <var class=Fa>nam</var>. The operation will be authorized using the credential on thread <var class=Fa>td</var>. Unlike the user system call, <code class=Fn>soconnect</code>() returns immediately; the caller may <a class=Xr href=msleep.9.html>msleep(9)</a> on <var class=Fa>so-&gt;so_timeo</var> while holding the socket mutex and waiting for the <code class=Dv>SS_ISCONNECTING</code> flag to clear or <var class=Fa>so-&gt;so_error</var> to become non-zero. If <code class=Fn>soconnect</code>() fails, the caller must manually clear the <code class=Dv>SS_ISCONNECTING</code> flag.</p><p class=Pp>A call to <code class=Fn>sodisconnect</code>() disconnects the socket without closing it.</p><p class=Pp>The <code class=Fn>soshutdown</code>() function is equivalent to the <a class=Xr href=shutdown.2.html>shutdown(2)</a> system call, and causes part or all of a connection on a socket to be closed down.</p><p class=Pp>Sockets are transitioned from non-listening status to listening with <code class=Fn>solisten</code>().</p></section><section class=Ss><h2 class=Ss id=Socket_Options><a class=permalink href=#Socket_Options>Socket Options</a></h2> The <code class=Fn>sogetopt</code>() function is equivalent to the <a class=Xr href=getsockopt.2.html>getsockopt(2)</a> system call, and retrieves a socket option on socket <var class=Fa>so</var>. The <code class=Fn>sosetopt</code>() function is equivalent to the <a class=Xr href=setsockopt.2.html>setsockopt(2)</a> system call, and sets a socket option on socket <var class=Fa>so</var>. <p class=Pp>The second argument in both <code class=Fn>sogetopt</code>() and <code class=Fn>sosetopt</code>() is the <var class=Fa>sopt</var> pointer to a <var class=Vt>struct sopt</var> describing the socket option operation. The caller-allocated structure must be zeroed, and then have its fields initialized to specify socket option operation arguments:</p><dl class=Bl-tag><dt><var class=Va>sopt_dir</var></dt><dd>Set to <code class=Dv>SOPT_SET</code> or <code class=Dv>SOPT_GET</code> depending on whether this is a get or set operation.</dd><dt><var class=Va>sopt_level</var></dt><dd>Specify the level in the network stack the operation is targeted at; for example, <code class=Dv>SOL_SOCKET</code>.</dd><dt><var class=Va>sopt_name</var></dt><dd>Specify the name of the socket option to set.</dd><dt><var class=Va>sopt_val</var></dt><dd>Kernel space pointer to the argument value for the socket option.</dd><dt><var class=Va>sopt_valsize</var></dt><dd>Size of the argument value in bytes.</dd></dl></section><section class=Ss><h2 class=Ss id=Socket_Upcalls><a class=permalink href=#Socket_Upcalls>Socket Upcalls</a></h2> In order for the owner of a socket to be notified when the socket is ready to send or receive data, an upcall may be registered on the socket. The upcall is a function that will be called by the socket framework when a socket buffer associated with the given socket is ready for reading or writing. <code class=Fn>soupcall_set</code>() is used to register a socket upcall. The function <var class=Va>func</var> is registered, and the pointer <var class=Va>arg</var> will be passed as its second argument when it is called by the framework. The possible values for <var class=Va>which</var> are <code class=Dv>SO_RCV</code> and <code class=Dv>SO_SND</code>, which register upcalls for receive and send events, respectively. The upcall function <code class=Fn>func</code>() must return either <code class=Dv>SU_OK</code> or <code class=Dv>SU_ISCONNECTED</code>, depending on whether or not a call to <a class=Xr href=soisconnected.1.html>soisconnected</a> should be made by the socket framework after the upcall returns. The upcall <var class=Va>func</var> cannot call <a class=Xr href=soisconnected.1.html>soisconnected</a> itself due to lock ordering with the socket buffer lock. Only <code class=Dv>SO_RCV</code> upcalls should return <code class=Dv>SU_ISCONNECTED</code>. When a <code class=Dv>SO_RCV</code> upcall returns <code class=Dv>SU_ISCONNECTED</code>, the upcall will be removed from the socket. <p class=Pp>Upcalls are removed from their socket by <code class=Fn>soupcall_clear</code>(). The <var class=Va>which</var> argument again specifies whether the sending or receiving upcall is to be cleared, with <code class=Dv>SO_RCV</code> or <code class=Dv>SO_SND</code>.</p></section><section class=Ss><h2 class=Ss id=Socket_Destructor_Callback><a class=permalink href=#Socket_Destructor_Callback>Socket Destructor Callback</a></h2> A kernel system can use the <code class=Fn>sodtor_set</code>() function to set a destructor for a socket. The destructor is called when the socket is is about to be freed. The destructor is called before the protocol detach routine. The destructor can serve as a callback to initiate additional cleanup actions. </section><section class=Ss><h2 class=Ss id=Socket_I/O><a class=permalink href=#Socket_I/O>Socket I/O</a></h2> The <code class=Fn>soreceive</code>() function is equivalent to the <a class=Xr href=recvmsg.2.html>recvmsg(2)</a> system call, and attempts to receive bytes of data from the socket <var class=Fa>so</var>, optionally blocking awaiting for data if none is ready to read. Data may be retrieved directly to kernel or user memory via the <var class=Fa>uio</var> argument, or as an mbuf chain returned to the caller via <var class=Fa>mp0</var>, avoiding a data copy. The <var class=Fa>uio</var> must always be non-<code class=Dv>NULL</code>. If <var class=Fa>mp0</var> is non-<code class=Dv>NULL</code>, only the <var class=Fa>uio_resid</var> of <var class=Fa>uio</var> is used. The caller may optionally retrieve a socket address on a protocol with the <code class=Dv>PR_ADDR</code> capability by providing storage via non-<code class=Dv>NULL</code><var class=Fa>psa</var> argument. The caller may optionally retrieve control data mbufs via a non-<code class=Dv>NULL</code><var class=Fa>controlp</var> argument. Optional flags may be passed to <code class=Fn>soreceive</code>() via a non-<code class=Dv>NULL</code><var class=Fa>flagsp</var> argument, and use the same flag name space as the <a class=Xr href=recvmsg.2.html>recvmsg(2)</a> system call. <p class=Pp>The <code class=Fn>sosend</code>() function is equivalent to the <a class=Xr href=sendmsg.2.html>sendmsg(2)</a> system call, and attempts to send bytes of data via the socket <var class=Fa>so</var>, optionally blocking if data cannot be immediately sent. Data may be sent directly from kernel or user memory via the <var class=Fa>uio</var> argument, or as an mbuf chain via <var class=Fa>top</var>, avoiding a data copy. Only one of the <var class=Fa>uio</var> or <var class=Fa>top</var> pointers may be non-<code class=Dv>NULL</code>. An optional destination address may be specified via a non-<code class=Dv>NULL</code><var class=Fa>addr</var> argument, which may result in an implicit connect if supported by the protocol. The caller may optionally send control data mbufs via a non-<code class=Dv>NULL</code><var class=Fa>control</var> argument. Flags may be passed to <code class=Fn>sosend</code>() using the <var class=Fa>flags</var> argument, and use the same flag name space as the <a class=Xr href=sendmsg.2.html>sendmsg(2)</a> system call.</p><p class=Pp>Kernel callers running in <a class=Xr href=ithread.9.html>ithread(9)</a> context, or with a mutex held, will wish to use non-blocking sockets and pass the <code class=Dv>MSG_DONTWAIT</code> flag in order to prevent these functions from sleeping.</p><p class=Pp>A socket can be queried for readability, writability, out-of-band data, or end-of-file using <code class=Fn>sopoll</code>(). The possible values for <var class=Va>events</var> are as for <a class=Xr href=poll.2.html>poll(2)</a>, with symbolic values <code class=Dv>POLLIN</code>, <code class=Dv>POLLPRI</code>, <code class=Dv>POLLOUT</code>, <code class=Dv>POLLRDNORM</code>, <code class=Dv>POLLWRNORM</code>, <code class=Dv>POLLRDBAND</code>, and <code class=Dv>POLLINGEOF</code> taken from <code class=In>&lt;<a class=In href=../src/sys/poll.h.html>sys/poll.h</a>&gt;</code>.</p><p class=Pp>Calls to <code class=Fn>soaccept</code>() pass through to the protocol's accept routine to accept an incoming connection.</p></section><section class=Ss><h2 class=Ss id=Socket_Utility_Functions><a class=permalink href=#Socket_Utility_Functions>Socket Utility Functions</a></h2> The uid of a socket's credential may be compared against a <var class=Va>uid</var> with <code class=Fn>socheckuid</code>(). <p class=Pp>A copy of an existing <var class=Vt>struct sockaddr</var> may be made using <code class=Fn>sodupsockaddr</code>().</p><p class=Pp>Protocol implementations notify the socket layer of the arrival of out-of-band data using <code class=Fn>sohasoutofband</code>(), so that the socket layer can notify socket consumers of the available data.</p><p class=Pp>An “external-format” version of a <var class=Vt>struct socket</var> can be created using <code class=Fn>sotoxsocket</code>(), suitable for isolating user code from changes in the kernel structure.</p></section><section class=Ss><h2 class=Ss id=Protocol_Implementations><a class=permalink href=#Protocol_Implementations>Protocol Implementations</a></h2> Protocols must supply an implementation for <code class=Fn>solisten</code>(); such protocol implementations can call back into the socket layer using <code class=Fn>solisten_proto_check</code>() and <code class=Fn>solisten_proto</code>() to check and set the socket-layer listen state. These callbacks are provided so that the protocol implementation can order the socket layer and protocol locks as necessary. Protocols must supply an implementation of <code class=Fn>soreceive</code>(); the functions <code class=Fn>soreceive_stream</code>(), <code class=Fn>soreceive_dgram</code>(), and <code class=Fn>soreceive_generic</code>() are supplied for use by such implementations. <p class=Pp>Protocol implementations can use <code class=Fn>sonewconn</code>() to create a socket and attach protocol state to that socket. This can be used to create new sockets available for <code class=Fn>soaccept</code>() on a listen socket. The returned socket has a reference count of zero.</p><p class=Pp>Protocols must supply an implementation for <code class=Fn>sopoll</code>(); <code class=Fn>sopoll_generic</code>() is provided for the use by protocol implementations.</p><p class=Pp>The functions <code class=Fn>sosend_dgram</code>() and <code class=Fn>sosend_generic</code>() are supplied to assist in protocol implementations of <code class=Fn>sosend</code>().</p><p class=Pp>When a protocol creates a new socket structure, it is necessary to reserve socket buffer space for that socket, by calling <code class=Fn>soreserve</code>(). The rough inverse of this reservation is performed by <code class=Fn>sorflush</code>(), which is called automatically by the socket framework.</p><p class=Pp>When a protocol needs to wake up threads waiting for the socket to become ready to read or write, variants of <code class=Fn>sowakeup</code>() are used. The <code class=Fn>sowakeup</code>() function should not be called directly by protocol code, instead use the wrappers <code class=Fn>sorwakeup</code>(), <code class=Fn>sorwakeup_locked</code>(), <code class=Fn>sowwakeup</code>(), and <code class=Fn>sowwakeup_locked</code>() for readers and writers, with the corresponding socket buffer lock not already locked, or already held, respectively.</p><p class=Pp>The functions <code class=Fn>sooptcopyin</code>() and <code class=Fn>sooptcopyout</code>() are useful for transferring <var class=Vt>struct sockopt</var> data between user and kernel code.</p></section></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=bind.2.html>bind(2)</a>, <a class=Xr href=close.2.html>close(2)</a>, <a class=Xr href=connect.2.html>connect(2)</a>, <a class=Xr href=getsockopt.2.html>getsockopt(2)</a>, <a class=Xr href=recv.2.html>recv(2)</a>, <a class=Xr href=send.2.html>send(2)</a>, <a class=Xr href=setsockopt.2.html>setsockopt(2)</a>, <a class=Xr href=shutdown.2.html>shutdown(2)</a>, <a class=Xr href=socket.2.html>socket(2)</a>, <a class=Xr href=ng_ksocket.4.html>ng_ksocket(4)</a>, <a class=Xr href=ithread.9.html>ithread(9)</a>, <a class=Xr href=msleep.9.html>msleep(9)</a>, <a class=Xr href=ucred.9.html>ucred(9)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <a class=Xr href=socket.2.html>socket(2)</a> system call appeared in <span class=Ux>4.2BSD</span>. This manual page was introduced in <span class=Ux>FreeBSD 7.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> This manual page was written by <span class=An>Robert Watson</span> and <br><span class=An>Benjamin Kaduk</span>. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> The use of explicitly passed credentials, credentials hung from explicitly passed threads, the credential on <code class=Dv>curthread</code>, and the cached credential from socket creation time is inconsistent, and may lead to unexpected behaviour. It is possible that several of the <var class=Fa>td</var> arguments should be <var class=Fa>cred</var> arguments, or simply not be present at all. <p class=Pp>The caller may need to manually clear <code class=Dv>SS_ISCONNECTING</code> if <code class=Fn>soconnect</code>() returns an error.</p><p class=Pp>The <code class=Dv>MSG_DONTWAIT</code> flag is not implemented for <code class=Fn>sosend</code>(), and may not always work with <code class=Fn>soreceive</code>() when zero copy sockets are enabled.</p><p class=Pp>This manual page does not describe how to register socket upcalls or monitor a socket for readability/writability without using blocking I/O.</p><p class=Pp>The <code class=Fn>soref</code>() and <code class=Fn>sorele</code>() functions are not described, and in most cases should not be used, due to confusing and potentially incorrect interactions when <code class=Fn>sorele</code>() is last called after <code class=Fn>soclose</code>().</p></section></div><table class=foot><tr><td class=foot-date>October 18, 2018</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>