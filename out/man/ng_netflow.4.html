<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ng_netflow(4)</title><keywords content=man,ng_netflow></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ng_netflow(4)</h1><table class=head><tr><td class=head-ltitle>NG_NETFLOW(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>NG_NETFLOW(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ng_netflow</code> — <div class=Nd>Cisco's NetFlow implementation</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netinet/in.h.html>netinet/in.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netgraph/netflow/ng_netflow.h.html>netgraph/netflow/ng_netflow.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>ng_netflow</code> node implements Cisco's NetFlow export protocol on a router running <span class=Ux>FreeBSD</span>. The <code class=Nm>ng_netflow</code> node listens for incoming traffic and identifies unique flows in it. Flows are distinguished by endpoint IP addresses, TCP/UDP port numbers, ToS and input interface. Expired flows are exported out of the node in NetFlow version 5/9 UDP datagrams. Expiration reason can be one of the following: <ul class=Bl-dash><li>RST or FIN TCP segment.</li><li>Active timeout. Flows cannot live more than the specified period of time. The default is 1800 seconds (30 minutes).</li><li>Inactive timeout. A flow was inactive for the specified period of time. The default is 15 seconds.</li></ul><p class=Pp>Node supports IPv6 accounting (NetFlow v9 only) and is aware of multiple fibs. Different fibs are mapped to different domain_id in NetFlow V9 and different engine_id in NetFlow V5.</p></section><section class=Sh><h2 class=Sh id=HOOKS><a class=permalink href=#HOOKS>HOOKS</a></h2> This node type supports up to <code class=Dv>NG_NETFLOW_MAXIFACES</code> (default 65536) hooks named <var class=Va>iface0</var>, <var class=Va>iface1</var>, etc., and the same number of hooks named <var class=Va>out0</var>, <var class=Va>out1</var>, etc., plus two export hooks: <var class=Va>export</var> (for NetFlow version 5) and <var class=Va>export9</var> (for NetFlow version 9). Export can be done simultaneously for all supported export hooks. By default (ingress NetFlow enabled) node does NetFlow accounting of data received on <var class=Va>iface*</var> hooks. If corresponding <var class=Va>out</var> hook is connected, unmodified data is bypassed to it, otherwise data is freed. If data is received on <var class=Va>out</var> hook, it is bypassed to corresponding <var class=Va>iface</var> hook without any processing (egress NetFlow disabled by default). When full export datagram for an export protocol is built it is sent to the <var class=Va>export</var> or <var class=Va>export9</var> hook. In normal operation, one (or more) export hook is connected to the <var class=Va>inet/dgram/udp</var> hook of the <a class=Xr href=ng_ksocket.4.html>ng_ksocket(4)</a> node. </section><section class=Sh><h2 class=Sh id=CONTROL_MESSAGES><a class=permalink href=#CONTROL_MESSAGES>CONTROL MESSAGES</a></h2> This node type supports the generic control messages, plus the following: <dl class=Bl-tag><dt><a class=permalink href=#NGM_NETFLOW_INFO><code class=Dv id=NGM_NETFLOW_INFO>NGM_NETFLOW_INFO</code></a> (<code class=Ic>info</code>)</dt><dd>Returns some node statistics and the current timeout values in a <var class=Vt>struct ng_netflow_info</var>.</dd><dt><a class=permalink href=#NGM_NETFLOW_IFINFO><code class=Dv id=NGM_NETFLOW_IFINFO>NGM_NETFLOW_IFINFO</code></a> (<code class=Ic>ifinfo</code>)</dt><dd>Returns information about the <var class=Va>iface</var><var class=Ar>N</var> hook. The hook number is passed as an argument.</dd><dt><a class=permalink href=#NGM_NETFLOW_SETDLT><code class=Dv id=NGM_NETFLOW_SETDLT>NGM_NETFLOW_SETDLT</code></a> (<code class=Ic>setdlt</code>)</dt><dd>Sets data link type on the <var class=Va>iface</var><var class=Ar>N</var> hook. Currently, supported types are <code class=Cm>DLT_RAW</code> (raw IP datagrams) and <code class=Cm>DLT_EN10MB</code> (Ethernet). DLT_ definitions can be found in <code class=In>&lt;<a class=In href=../src/net/bpf.h.html>net/bpf.h</a>&gt;</code> header. Currently used values are 1 for <code class=Cm>DLT_EN10MB</code> and 12 for <code class=Cm>DLT_RAW</code>. This message type uses <var class=Vt>struct ng_netflow_setdlt</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_setdlt {
	uint16_t iface;		/* which iface dlt change */
	uint8_t  dlt;		/* DLT_XXX from bpf.h */
};
    </pre></div><p class=Pp>The requested <var class=Va>iface</var><var class=Ar>N</var> hook must already be connected, otherwise message send operation will return an error.</p></dd><dt><a class=permalink href=#NGM_NETFLOW_SETIFINDEX><code class=Dv id=NGM_NETFLOW_SETIFINDEX>NGM_NETFLOW_SETIFINDEX</code></a> (<code class=Ic>setifindex</code>)</dt><dd>In some cases, <code class=Nm>ng_netflow</code> may be unable to determine the input interface index of a packet. This can happen if traffic enters the <code class=Nm>ng_netflow</code> node before it comes to the system interface's input queue. An example of such a setup is capturing a traffic <i class=Em>between</i> synchronous data line and <a class=Xr href=ng_iface.4.html>ng_iface(4)</a>. In this case, the input index should be associated with a given hook. The interface's index can be determined via <a class=Xr href=if_nametoindex.3.html>if_nametoindex(3)</a> from userland. This message requires <var class=Vt>struct ng_netflow_setifindex</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_setifindex {
	uint16_t iface;		/* which iface index change */
	uint16_t index;		/* new index */
};
    </pre></div><p class=Pp>The requested <var class=Va>iface</var><var class=Ar>N</var> hook must already be connected, otherwise the message send operation will return an error.</p></dd><dt><a class=permalink href=#NGM_NETFLOW_SETTIMEOUTS><code class=Dv id=NGM_NETFLOW_SETTIMEOUTS>NGM_NETFLOW_SETTIMEOUTS</code></a> (<code class=Ic>settimeouts</code>)</dt><dd>Sets values in seconds for NetFlow active/inactive timeouts. This message requires <var class=Vt>struct ng_netflow_settimeouts</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_settimeouts {
	uint32_t inactive_timeout;	/* flow inactive timeout */
	uint32_t active_timeout;	/* flow active timeout */
};
    </pre></div></dd><dt><a class=permalink href=#NGM_NETFLOW_SETCONFIG><code class=Dv id=NGM_NETFLOW_SETCONFIG>NGM_NETFLOW_SETCONFIG</code></a> (<code class=Ic>setconfig</code>)</dt><dd>Sets configuration for the specified interface. This message requires <var class=Vt>struct ng_netflow_setconfig</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_setconfig {
	uint16_t iface;		/* which iface config change */
	uint32_t conf;		/* new config */
#define NG_NETFLOW_CONF_INGRESS		1
#define NG_NETFLOW_CONF_EGRESS		2
#define NG_NETFLOW_CONF_ONCE		4
#define NG_NETFLOW_CONF_THISONCE	8
#define NG_NETFLOW_CONF_NOSRCLOOKUP	16
#define NG_NETFLOW_CONF_NODSTLOOKUP	32
};
    </pre></div><p class=Pp>Configuration is a bitmask of several options. Option NG_NETFLOW_CONF_INGRESS enabled by default enables ingress NetFlow generation (for data coming from ifaceX hook). Option <var class=Va>NG_NETFLOW_CONF_EGRESS</var> enables egress NetFlow (for data coming from outX hook). Option <var class=Va>NG_NETFLOW_CONF_ONCE</var> defines that packet should be accounted only once if it several times passes via netflow node. Option <var class=Va>NG_NETFLOW_CONF_THISONCE</var> defines that packet should be accounted only once if it several times passes via exactly this netflow node. These two options are important to avoid duplicate accounting when both ingress and egress NetFlow are enabled. Option <var class=Va>NG_NETFLOW_CONF_NOSRCLOOKUP</var> skips radix lookup on flow source address used to fill in network mask. Option <var class=Va>NG_NETFLOW_CONF_NODSTLOOKUP</var> skips radix lookup on destination (which fills egress interface id, destination mask and gateway). If one doesn't need data provided by lookups, he/she can disable them, to reduce load on routers.</p></dd><dt><a class=permalink href=#NGM_NETFLOW_SETTEMPLATE><code class=Dv id=NGM_NETFLOW_SETTEMPLATE>NGM_NETFLOW_SETTEMPLATE</code></a> (<code class=Ic>settemplate</code>)</dt><dd>Sets various timeouts to announce data flow templates (NetFlow v9-specific). This message requires <var class=Vt>struct ng_netflow_settemplate</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_settemplate {
	uint16_t time;		/* max time between announce */
	uint16_t packets;	/* max packets between announce */
};
    </pre></div><p class=Pp>Value of time field represents time in seconds to re-announce data templates. Value of packets field represents maximum packets count between re-announcing data templates.</p></dd><dt><a class=permalink href=#NGM_NETFLOW_SETMTU><code class=Dv id=NGM_NETFLOW_SETMTU>NGM_NETFLOW_SETMTU</code></a> (<code class=Ic>setmtu</code>)</dt><dd>Sets export interface MTU to build packets of specified size (NetFlow v9-specific). This message requires <var class=Vt>struct ng_netflow_setmtu</var> as an argument: <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_setemtu {
	uint16_t mtu;		/* MTU for packet */
};
    </pre></div><p class=Pp>Default is 1500 bytes.</p></dd><dt><a class=permalink href=#NGM_NETFLOW_SHOW><code class=Dv id=NGM_NETFLOW_SHOW>NGM_NETFLOW_SHOW</code></a></dt><dd>This control message asks a node to dump the entire contents of the flow cache. It is called from <a class=Xr href=flowctl.8.html>flowctl(8)</a>, not directly from <a class=Xr href=ngctl.8.html>ngctl(8)</a>.</dd><dt><a class=permalink href=#NGM_NETFLOW_V9INFO><code class=Dv id=NGM_NETFLOW_V9INFO>NGM_NETFLOW_V9INFO</code></a> (<code class=Ic>v9info</code>)</dt><dd>Returns some NetFlow v9 related values in a <div class="Bd Pp Bd-indent"><pre>
struct ng_netflow_v9info {
    uint16_t        templ_packets;  /* v9 template packets */
    uint16_t        templ_time;     /* v9 template time */
    uint16_t        mtu;            /* v9 MTU */
};
    </pre></div></dd></dl></section><section class=Sh><h2 class=Sh id=SHUTDOWN><a class=permalink href=#SHUTDOWN>SHUTDOWN</a></h2> This node shuts down upon receipt of a <code class=Dv>NGM_SHUTDOWN</code> control message, or when all hooks have been disconnected. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> The simplest possible configuration is one Ethernet interface, where flow collecting is enabled. <div class="Bd Pp Bd-indent"><pre>
/usr/sbin/ngctl -f- &lt;&lt;-SEQ
	mkpeer fxp0: netflow lower iface0
	name fxp0:lower netflow
	connect fxp0: netflow: upper out0
	mkpeer netflow: ksocket export inet/dgram/udp
	msg netflow:export connect inet/10.0.0.1:4444
SEQ
</pre></div><p class=Pp>This is a more complicated example of a router with 2 NetFlow-enabled interfaces <code class=Li>fxp0</code> and <code class=Li>ng0</code>. Note that the <var class=Va>ng0:</var> node in this example is connected to <a class=Xr href=ng_tee.4.html>ng_tee(4)</a>. The latter sends us a copy of IP packets, which we analyze and free. On <var class=Va>fxp0:</var> we do not use tee, but send packets back to either node.</p><div class="Bd Pp Bd-indent"><pre>
/usr/sbin/ngctl -f- &lt;&lt;-SEQ
	# connect ng0's tee to iface0 hook
	mkpeer ng0:inet netflow right2left iface0
	name ng0:inet.right2left netflow
	# set DLT to raw mode
	msg netflow: setdlt { iface=0 dlt=12 }
	# set interface index (5 in this example)
	msg netflow: setifindex { iface=0 index=5 }

	# Connect fxp0: to iface1 and out1 hook
	connect fxp0: netflow: lower iface1
	connect fxp0: netflow: upper out1

	# Create ksocket node on export hook, and configure it
	# to send exports to proper destination
	mkpeer netflow: ksocket export inet/dgram/udp
	msg netflow:export connect inet/10.0.0.1:4444
SEQ
</pre></div></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=setfib.2.html>setfib(2)</a>, <a class=Xr href=netgraph.4.html>netgraph(4)</a>, <a class=Xr href=ng_ether.4.html>ng_ether(4)</a>, <a class=Xr href=ng_iface.4.html>ng_iface(4)</a>, <a class=Xr href=ng_ksocket.4.html>ng_ksocket(4)</a>, <a class=Xr href=ng_tee.4.html>ng_tee(4)</a>, <a class=Xr href=flowctl.8.html>flowctl(8)</a>, <a class=Xr href=ngctl.8.html>ngctl(8)</a><p class=Pp><cite class=Rs><span class=RsA>B. Claise, Ed</span>, <span class=RsT>Cisco Systems NetFlow Services Export Version 9</span>, <span class=RsO>RFC 3954</span>.</cite></p><p class=Pp><span class=Pa>http://www.cisco.com/en/US/docs/ios/solutions_docs/netflow/nfwhite.html</span></p></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>ng_netflow</code> node type was written by <span class=An>Gleb Smirnoff</span> &lt;<a class=Mt href=mailto:glebius@FreeBSD.org>glebius@FreeBSD.org</a>&gt;, <span class=An>Alexander Motin</span> &lt;<a class=Mt href=mailto:mav@FreeBSD.org>mav@FreeBSD.org</a>&gt;, <span class=An>Alexander Chernikov</span> &lt;<a class=Mt href=mailto:melifaro@ipfw.ru>melifaro@ipfw.ru</a>&gt;. The initial code was based on <code class=Nm>ng_ipacct</code> written by <span class=An>Roman V. Palagin</span> &lt;<a class=Mt href=mailto:romanp@unshadow.net>romanp@unshadow.net</a>&gt;. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Cache snapshot obtained via <code class=Dv>NGM_NETFLOW_SHOW</code> command may lack some percentage of entries under severe load. <p class=Pp>The <code class=Nm>ng_netflow</code> node type does not fill in AS numbers. This is due to the lack of necessary information in the kernel routing table. However, this information can be injected into the kernel from a routing daemon such as GNU Zebra. This functionality may become available in future releases.</p></section></div><table class=foot><tr><td class=foot-date>December 10, 2012</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>