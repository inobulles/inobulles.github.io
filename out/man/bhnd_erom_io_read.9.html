<!DOCTYPE html>
<html><head><meta charset=utf-8><title>bhnd_erom_io_read(9)</title><keywords content=man,bhnd_erom_io_read></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>bhnd_erom_io_read(9)</h1><table class=head><tr><td class=head-ltitle>BHND_EROM(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>BHND_EROM(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>bhnd_erom</code>, <code class=Nm>bhnd_erom_alloc</code>, <code class=Nm>bhnd_erom_dump</code>, <code class=Nm>bhnd_erom_fini_static</code>, <code class=Nm>bhnd_erom_free</code>, <code class=Nm>bhnd_erom_free_core_table</code>, <code class=Nm>bhnd_erom_get_core_table</code>, <code class=Nm>bhnd_erom_init_static</code>, <code class=Nm>bhnd_erom_io</code>, <code class=Nm>bhnd_erom_io_fini</code>, <code class=Nm>bhnd_erom_io_map</code>, <code class=Nm>bhnd_erom_io_read</code>, <code class=Nm>bhnd_erom_iobus_init</code>, <code class=Nm>bhnd_erom_iores_new</code>, <code class=Nm>bhnd_erom_lookup_core</code>, <code class=Nm>bhnd_erom_lookup_core_addr</code>, <code class=Nm>bhnd_erom_probe</code>, <code class=Nm>bhnd_erom_probe_driver_classes</code> — <div class=Nd>BHND device enumeration table parsing</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/dev/bhnd/bhnd.h.html>dev/bhnd/bhnd.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/dev/bhnd/bhnd_erom.h.html>dev/bhnd/bhnd_erom.h</a>&gt;</code><p class=Pp><var class=Vt>typedef struct bhnd_erom bhnd_erom_t</var>; <br><var class=Vt>typedef struct kobj_class bhnd_erom_class_t</var>; <br><var class=Vt>typedef struct bhnd_erom_static bhnd_erom_static_t</var>;</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_probe</code>(<var class=Fa>bhnd_erom_class_t *cls</var>, <var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>const struct bhnd_chipid *hint</var>, <var class=Fa>struct bhnd_chipid *cid</var>);</p><p class=Pp><var class=Ft>bhnd_erom_class_t *</var><br><code class=Fn>bhnd_erom_probe_driver_classes</code>(<var class=Fa>devclass_t bus_devclass</var>, <var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>const struct bhnd_chipid *hint</var>, <var class=Fa>struct bhnd_chipid *cid</var>);</p><p class=Pp><var class=Ft>bhnd_erom_t *</var><br><code class=Fn>bhnd_erom_alloc</code>(<var class=Fa>bhnd_erom_class_t *cls</var>, <var class=Fa>const struct bhnd_chipid *cid</var>, <var class=Fa>struct bhnd_erom_io *eio</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>bhnd_erom_free</code>(<var class=Fa>bhnd_erom_t *erom</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_init_static</code>(<var class=Fa>bhnd_erom_class_t *cls</var>, <var class=Fa>bhnd_erom_t *erom</var>, <var class=Fa>size_t esize</var>, <var class=Fa>const struct bhnd_chipid *cid</var>, <var class=Fa>struct bhnd_erom_io *eio</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>bhnd_erom_fini_static</code>(<var class=Fa>bhnd_erom_t *erom</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_dump</code>(<var class=Fa>bhnd_erom_t *erom</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_get_core_table</code>(<var class=Fa>bhnd_erom_t *erom</var>, <var class=Fa>struct bhnd_core_info **cores</var>, <var class=Fa>u_int *num_cores</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>bhnd_erom_free_core_table</code>(<var class=Fa>bhnd_erom_t *erom</var>, <var class=Fa>struct bhnd_core_info *cores</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_lookup_core</code>(<var class=Fa>bhnd_erom_t *erom</var>, <var class=Fa>const struct bhnd_core_match *desc</var>, <var class=Fa>struct bhnd_core_info *core</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_lookup_core_addr</code>(<var class=Fa>bhnd_erom_t *erom</var>, <var class=Fa>const struct bhnd_core_match *desc</var>, <var class=Fa>bhnd_port_type type</var>, <var class=Fa>u_int port</var>, <var class=Fa>u_int region</var>, <var class=Fa>struct bhnd_core_info *core</var>, <var class=Fa>bhnd_addr_t *addr</var>, <var class=Fa>bhnd_size_t *size</var>);</p><section class=Ss><h2 class=Ss id=Bus_Space_I/O><a class=permalink href=#Bus_Space_I/O>Bus Space I/O</a></h2><var class=Ft>struct bhnd_erom_io *</var><br><code class=Fn>bhnd_erom_iores_new</code>(<var class=Fa>device_t dev</var>, <var class=Fa>int rid</var>); <p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_iobus_init</code>(<var class=Fa>struct bhnd_erom_iobus *iobus</var>, <var class=Fa>bhnd_addr_t addr</var>, <var class=Fa>bhnd_size_t size</var>, <var class=Fa>bus_space_tag_t bst</var>, <var class=Fa>bus_space_handle_t bsh</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>bhnd_erom_io_fini</code>(<var class=Fa>struct bhnd_erom_io *eio</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>bhnd_erom_io_map</code>(<var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>bhnd_addr_t addr</var>, <var class=Fa>bhnd_size_t size</var>);</p><p class=Pp><var class=Ft>uint32_t</var><br><code class=Fn>bhnd_erom_io_read</code>(<var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>bhnd_size_t offset</var>, <var class=Fa>u_int width</var>);</p><p class=Pp><code class=In>#include &lt;<a class=In href=../src/dev/bhnd/bhnd_eromvar.h.html>dev/bhnd/bhnd_eromvar.h</a>&gt;</code></p><div class="Bd Pp"><pre>
struct bhnd_erom_io {
	bhnd_erom_io_map_t	*map;
	bhnd_erom_io_read_t	*read;
	bhnd_erom_io_fini_t	*fini;
};
</pre></div><br><var class=Ft>typedef int</var><br><code class=Fn>(bhnd_erom_io_map_t)</code>(<var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>bhnd_addr_t addr</var>, <var class=Fa>bhnd_size_t size</var>); <p class=Pp><var class=Ft>typedef uint32_t</var><br><code class=Fn>(bhnd_erom_io_read_t)</code>(<var class=Fa>struct bhnd_erom_io *eio</var>, <var class=Fa>bhnd_size_t offset</var>, <var class=Fa>u_int width</var>);</p><p class=Pp><var class=Ft>typedef void</var><br><code class=Fn>(bhnd_erom_io_fini_t)</code>(<var class=Fa>struct bhnd_erom_io *eio</var>);</p></section></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>bhnd_erom</code> framework provides a common parser interface to the BHND device enumeration table formats supported by <a class=Xr href=bhnd.4.html>bhnd(4)</a> bus drivers. <p class=Pp>The <code class=Fn>bhnd_erom_probe</code>() function is used to identify a <a class=Xr href=bhnd.4.html>bhnd(4)</a> bus device and determine whether the erom class <var class=Fa>cls</var> is capable of parsing its device enumeration table. If successful, the probed chip identification is written to the location pointed to by <var class=Fa>cid</var>.</p><p class=Pp>A pointer to a bus I/O instance mapping the device registers of the first hardware core must be provided using the <var class=Fa>eio</var> argument. The registers can be mapped using <a class=Xr href=bhnd_erom_io_map.9.html>bhnd_erom_io_map(9)</a>.</p><p class=Pp>On devices that do not provide standard <a class=Xr href=bhnd_chipc.4.html>bhnd_chipc(4)</a> chip identification registers via the first hardware core, a pointer to chip information for the device must be specified using the <var class=Fa>hint</var> argument. Otherwise, the <var class=Fa>hint</var> argument should be <code class=Dv>NULL</code>.</p><p class=Pp>The <code class=Fn>bhnd_erom_probe_driver_classes</code>() function is a convenience wrapper for <code class=Fn>bhnd_erom_probe</code>(). This function will iterate over all drivers instances in the device class <var class=Fa>bus_devclass</var>, using <a class=Xr href=bhnd_driver_get_erom_class.9.html>bhnd_driver_get_erom_class(9)</a> to fetch each driver's erom class and probe the hardware core mapped by <var class=Fa>eio</var>. A pointer to the erom class with the highest probe priority is returned on success. If there are no successful probe results from the erom classes, <code class=Dv>NULL</code> is returned.</p><p class=Pp>The <code class=Fn>bhnd_erom_alloc</code>() function allocates and returns a new parser instance of the device enumeration class <var class=Fa>cls</var> for the chip identified by <var class=Fa>cid</var>, using the bus I/O instance <var class=Fa>eio</var> to map and read the device table. On success, the returned <var class=Vt>bhnd_erom_t</var> assumes ownership of <var class=Fa>eio</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_free</code>() function releases all resources held by an erom parser successfully allocated using <code class=Fn>bhnd_erom_alloc</code>().</p><p class=Pp>Clients can manage the allocation of memory themselves with <code class=Fn>bhnd_erom_init_static</code>(). This is useful in cases like performing device enumeration before <a class=Xr href=malloc.9.html>malloc(9)</a> initialization. <code class=Fn>bhnd_erom_init_static</code>() is called with <var class=Fa>erom</var> set to a pointer to the memory for the instance, and the total available bytes in <var class=Fa>esize</var>.</p><p class=Pp>The <var class=Vt>bhnd_erom_static</var> structure is large enough to statically allocate any supported parser class instance state. Pointers to a <var class=Vt>bhnd_erom_static</var> structure can be cast to <var class=Vt>bhnd_erom_t</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_fini_static</code>() function releases all resources held by an erom parser successfully initialized using <code class=Fn>bhnd_erom_init_static</code>().</p><p class=Pp>The <code class=Fn>bhnd_erom_dump</code>() function enumerates and prints all device table entries in <var class=Fa>erom</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_get_core_table</code>() function enumerates all device table entries in <var class=Fa>erom</var>, returning a table of core information structures in <var class=Fa>cores</var> and the count in <var class=Fa>num_cores</var>. The memory allocated for the table must be freed using <code class=Fn>bhnd_erom_free_core_table</code>().</p><p class=Pp>The <code class=Fn>bhnd_erom_free_core_table</code>() function frees any memory allocated in a previous call to <code class=Fn>bhnd_erom_get_core_table</code>().</p><p class=Pp>The <code class=Fn>bhnd_erom_lookup_core</code>() function locates the first device table entry in <var class=Fa>erom</var> that matches core match descriptor <var class=Fa>desc</var>, writing the core information of the matching entry to <var class=Fa>core</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_lookup_core_addr</code>() function locates the first device table entry in <var class=Fa>erom</var> that matches core match descriptor <var class=Fa>desc</var>, fetching the base address and size of the memory region <var class=Fa>region</var> mapped to the port <var class=Fa>port</var> of type <var class=Fa>type</var>. On success, the core information of the matching entry is written to <var class=Fa>core</var>, the base address of the port region is written to <var class=Fa>addr</var>, and the total size of the port region is written to <var class=Fa>size</var>. If the core information is not desired, set <var class=Fa>core</var> to <code class=Dv>NULL</code>.</p><section class=Ss><h2 class=Ss id=Bus_Space_I/O_2><a class=permalink href=#Bus_Space_I/O_2>Bus Space I/O</a></h2> The <var class=Vt>bhnd_erom_io</var> structure provides a set of I/O callbacks used by <code class=Nm>bhnd_erom</code> to map and read the device enumeration table. Clients may either use the existing <code class=Fn>bhnd_erom_iores_new</code>() or <code class=Fn>bhnd_erom_iobus_init</code>() functions to allocate a bus I/O instance, or implement the <var class=Vt>bhnd_erom_io</var> callbacks directly. <p class=Pp>The <var class=Vt>bhnd_erom_io</var> structure contains these required fields:</p><div class=Bd-indent><dl class=Bl-tag><dt><var class=Fa>map</var></dt><dd>A function implementing <code class=Fn>bhnd_erom_io_map</code>().</dd><dt><var class=Fa>read</var></dt><dd>A function implementing <code class=Fn>bhnd_erom_io_read</code>().</dd><dt><var class=Fa>fini</var></dt><dd>A function implementing <code class=Fn>bhnd_erom_io_fini</code>().</dd></dl></div><p class=Pp>The <code class=Fn>bhnd_erom_iores_new</code>() function allocates and returns a new bus I/O instance that will perform mapping by using <a class=Xr href=bhnd_alloc_resource.9.html>bhnd_alloc_resource(9)</a> to allocate <code class=Dv>SYS_RES_MEMORY</code> bus resources on demand from the device <var class=Fa>dev</var> using a resource ID of <var class=Fa>rid</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_iobus_init</code>() function initializes a caller-allocated bus I/O instance <var class=Fa>iobus</var> that will perform bus I/O using the bus space tag <var class=Fa>bst</var> and handle <var class=Fa>bsh</var>. The base address and total size mapped by <var class=Fa>bsh</var> should be specified using the <var class=Fa>addr</var> and <var class=Fa>size</var> arguments.</p><p class=Pp>The <code class=Fn>bhnd_erom_io_fini</code>() function frees all resources held by the bus I/O instance <var class=Fa>eio</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_io_map</code>() function is used to request that the bus I/O instance <var class=Fa>eio</var> map <a class=Xr href=bhnd.4.html>bhnd(4)</a> bus space at bus address <var class=Fa>addr</var> with a mapping of size <var class=Fa>size</var>.</p><p class=Pp>The <code class=Fn>bhnd_erom_io_read</code>() function is used to read a data item of <var class=Fa>width</var> bytes from the bus I/O instance <var class=Fa>eio</var> at <var class=Fa>offset</var>, relative to the bus address previously mapped using <code class=Fn>bhnd_erom_io_map</code>().</p><p class=Pp>The <var class=Fa>width</var> must be one of 1, 2, or 4 bytes.</p></section></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2> The <code class=Fn>bhnd_erom_probe</code>() function returns a standard <a class=Xr href=DEVICE_PROBE.9.html>DEVICE_PROBE(9)</a> result. <p class=Pp>A return value equal to or less than zero indicates success. Values greater than zero indicates an error, and will be an appropriate error code. For values less than or equal to zero, the erom class returning the highest value should be used to parse the erom table. <code class=Er>ENXIO</code> is returned if the device is not supported by the parser.</p><p class=Pp>The <code class=Fn>bhnd_erom_probe_driver_classes</code>() function returns a pointer to the probed <var class=Vt>bhnd_erom_class_t</var> instance on success, a null pointer otherwise.</p><p class=Pp>The <code class=Fn>bhnd_erom_alloc</code>() function returns a pointer to <var class=Vt>bhnd_erom_t</var> on success, or <code class=Dv>NULL</code> if an error occurred allocating or initializing the EROM parser.</p><p class=Pp>The <code class=Fn>bhnd_erom_init_static</code>() function returns 0 on success, <code class=Er>ENOMEM</code> if the allocation size is smaller than required by the erom class, or an appropriate error code if initialization otherwise fails.</p><p class=Pp>The <code class=Fn>bhnd_erom_lookup_core</code>() function returns 0 on success, <code class=Er>ENOENT</code> if no matching core is found, or an appropriate error code if parsing the device table otherwise fails.</p><p class=Pp>The <code class=Fn>bhnd_erom_dump</code>(), <code class=Fn>bhnd_erom_get_core_table</code>(), <code class=Fn>bhnd_erom_iobus_init</code>(), <code class=Fn>bhnd_erom_io_map</code>(), functions return 0 on success, otherwise an appropriate error code is returned.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=bhnd.4.html>bhnd(4)</a>, <a class=Xr href=bhnd.9.html>bhnd(9)</a>, <a class=Xr href=bhnd_alloc_resource.9.html>bhnd_alloc_resource(9)</a><a class=Xr href=bhnd_driver_get_erom_class.9.html>bhnd_driver_get_erom_class(9)</a><a class=Xr href=bus_space.9.html>bus_space(9)</a></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>bhnd_erom</code> framework and this manual page were written by <span class=An>Landon Fuller</span> &lt;<a class=Mt href=mailto:landonf@FreeBSD.org>landonf@FreeBSD.org</a>&gt;. </section></div><table class=foot><tr><td class=foot-date>November 9, 2017</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>