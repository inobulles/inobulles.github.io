<!DOCTYPE html>
<html><head><meta charset=utf-8><title>nfsv4(4)</title><keywords content=man,nfsv4></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>nfsv4(4)</h1><table class=head><tr><td class=head-ltitle>NFSV4(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>NFSV4(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>NFSv4</code> — <div class=Nd>NFS Version 4 Protocol</div></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The NFS client and server provides support for the NFSv4 specification; see <span class=RsT>Network File System (NFS) Version 4 Protocol RFC 7530,</span><span class=RsT>Network File System (NFS) Version 4 Minor Version 1 Protocol RFC 5661,</span><span class=RsT>Network File System (NFS) Version 4 Minor Version 2 Protocol RFC 7862,</span><span class=RsT>File System Extended Attributes in NFSv4 RFC 8276 and</span><span class=RsT>Parallel NFS (pNFS) Flexible File Layout RFC 8435.</span> The protocol is somewhat similar to NFS Version 3, but differs in significant ways. It uses a single compound RPC that concatenates operations to-gether. Each of these operations are similar to the RPCs of NFS Version 3. The operations in the compound are performed in order, until one of them fails (returns an error) and then the RPC terminates at that point. <p class=Pp>It has integrated locking support, which implies that the server is no longer stateless. As such, the <code class=Nm>NFSv4</code> server remains in recovery mode for a grace period (always greater than the lease duration the server uses) after a reboot. During this grace period, clients may recover state but not perform other open/lock state changing operations. To provide for correct recovery semantics, a small file described by <a class=Xr href=stablerestart.5.html>stablerestart(5)</a> is used by the server during the recovery phase. If this file is missing or empty, there is a backup copy maintained by <a class=Xr href=nfsd.8.html>nfsd(8)</a> that will be used. If either file is missing, they will be created by the <a class=Xr href=nfsd.8.html>nfsd(8)</a>. If both the file and the backup copy are empty, it will result in the server starting without providing a grace period for recovery. Note that recovery only occurs when the server machine is rebooted, not when the <a class=Xr href=nfsd.8.html>nfsd(8)</a> are just restarted.</p><p class=Pp>It provides several optional features not present in NFS Version 3:</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
- NFS Version 4 ACLs
- Referrals, which redirect subtrees to other servers
  (not yet implemented)
- Delegations, which allow a client to operate on a file locally
- pNFS, where I/O operations are separated from Metadata operations
And for NFSv4.2 only
- User namespace extended attributes
- lseek(SEEK_DATA/SEEK_HOLE)
- File copying done locally on the server for copy_file_range(2)
- posix_fallocate(2)
- posix_fadvise(POSIX_FADV_WILLNEED/POSIX_FADV_DONTNEED)
</pre></div><p class=Pp>The <code class=Nm>NFSv4</code> protocol does not use a separate mount protocol and assumes that the server provides a single file system tree structure, rooted at the point in the local file system tree specified by one or more</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
V4: &lt;rootdir&gt; [-sec=secflavors] [host(s) or net]
</pre></div><p class=Pp>line(s) in the <a class=Xr href=exports.5.html>exports(5)</a> file. (See <a class=Xr href=exports.5.html>exports(5)</a> for details.) The <a class=Xr href=nfsd.8.html>nfsd(8)</a> allows a limited subset of operations to be performed on non-exported subtrees of the local file system, so that traversal of the tree to the exported subtrees is possible. As such, the ``&lt;rootdir&gt;'' can be in a non-exported file system. The exception is ZFS, which checks exports and, as such, all ZFS file systems below the ``&lt;rootdir&gt;'' must be exported. However, the entire tree that is rooted at that point must be in local file systems that are of types that can be NFS exported. Since the <code class=Nm>NFSv4</code> file system is rooted at ``&lt;rootdir&gt;'', setting this to anything other than ``/'' will result in clients being required to use different mount paths for <code class=Nm>NFSv4</code> than for NFS Version 2 or 3. Unlike NFS Version 2 and 3, Version 4 allows a client mount to span across multiple server file systems, although not all clients are capable of doing this.</p><p class=Pp><code class=Nm>NFSv4</code> uses strings for users and groups instead of numbers. On the wire, these strings can either have the numbers in the string or take the form:</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
&lt;user&gt;@&lt;dns.domain&gt;
</pre></div><p class=Pp>where ``&lt;dns.domain&gt;'' is not the same as the DNS domain used for host name lookups, but is usually set to the same string. Most systems set this ``&lt;dns.domain&gt;'' to the domain name part of the machine's <a class=Xr href=hostname.1.html>hostname(1)</a> by default. However, this can normally be overridden by a command line option or configuration file for the daemon used to do the name&lt;-&gt;number mapping. Under <span class=Ux>FreeBSD</span>, the mapping daemon is called <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a> and has a command line option that overrides the domain component of the machine's hostname. For use of this form of string on <code class=Nm>NFSv4</code>, either client or server, this daemon must be running.</p><p class=Pp>The form where the numbers are in the strings can only be used for AUTH_SYS. To configure your systems this way, the <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a> daemon does not need to be running on the server, but the following sysctls need to be set to 1 on the server.</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
vfs.nfs.enable_uidtostring
vfs.nfsd.enable_stringtouid
</pre></div><p class=Pp>On the client, the sysctl</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
vfs.nfs.enable_uidtostring
</pre></div><p class=Pp>must be set to 1 and the <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a> daemon does not need to be running.</p><p class=Pp>If these strings are not configured correctly, ``ls -l'' will typically report a lot of ``nobody'' and ``nogroup'' ownerships.</p><p class=Pp>Although uid/gid numbers are no longer used in the <code class=Nm>NFSv4</code> protocol except optionally in the above strings, they will still be in the RPC authentication fields when using AUTH_SYS (sec=sys), which is the default. As such, in this case both the user/group name and number spaces must be consistent between the client and server.</p><p class=Pp>However, if you run <code class=Nm>NFSv4</code> with RPCSEC_GSS (sec=krb5, krb5i, krb5p), only names and KerberosV tickets will go on the wire.</p></section><section class=Sh><h2 class=Sh id=SERVER_SETUP><a class=permalink href=#SERVER_SETUP>SERVER SETUP</a></h2> To set up the NFS server that supports <code class=Nm>NFSv4</code>, you will need to set the variables in <a class=Xr href=rc.conf.5.html>rc.conf(5)</a> as follows: <p class=Pp></p><div class="Bd Bd-indent"><pre>
nfs_server_enable="YES"
nfsv4_server_enable="YES"
</pre></div><p class=Pp>plus</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
nfsuserd_enable="YES"
</pre></div><p class=Pp>if the server is using the ``&lt;user&gt;@&lt;domain&gt;'' form of user/group strings or is using the ``-manage-gids'' option for <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a>.</p><p class=Pp>You will also need to add at least one ``V4:'' line to the <a class=Xr href=exports.5.html>exports(5)</a> file for <code class=Nm>NFSv4</code> to work.</p><p class=Pp>If the file systems you are exporting are only being accessed via <code class=Nm>NFSv4</code> there are a couple of <a class=Xr href=sysctl.8.html>sysctl(8)</a> variables that you can change, which might improve performance.</p><dl class=Bl-tag><dt><a class=permalink href=#vfs.nfsd.issue_delegations><code class=Cm id=vfs.nfsd.issue_delegations>vfs.nfsd.issue_delegations</code></a></dt><dd>when set non-zero, allows the server to issue Open Delegations to clients. These delegations permit the client to manipulate the file locally on the client. Unfortunately, at this time, client use of delegations is limited, so performance gains may not be observed. This can only be enabled when the file systems being exported to <code class=Nm>NFSv4</code> clients are not being accessed locally on the server and, if being accessed via NFS Version 2 or 3 clients, these clients cannot be using the NLM.</dd><dt><a class=permalink href=#vfs.nfsd.enable_locallocks><code class=Cm id=vfs.nfsd.enable_locallocks>vfs.nfsd.enable_locallocks</code></a></dt><dd>can be set to 0 to disable acquisition of local byte range locks. Disabling local locking can only be done if neither local accesses to the exported file systems nor the NLM is operating on them.</dd></dl><p class=Pp>Note that Samba server access would be considered ``local access'' for the above discussion.</p><p class=Pp>To build a kernel with the NFS server that supports <code class=Nm>NFSv4</code> linked into it, the</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
options	NFSD
</pre></div><p class=Pp>must be specified in the kernel's <a class=Xr href=config.5.html>config(5)</a> file.</p></section><section class=Sh><h2 class=Sh id=CLIENT_MOUNTS><a class=permalink href=#CLIENT_MOUNTS>CLIENT MOUNTS</a></h2> To do an <code class=Nm>NFSv4</code> mount, specify the ``nfsv4'' option on the <a class=Xr href=mount_nfs.8.html>mount_nfs(8)</a> command line. This will force use of the client that supports <code class=Nm>NFSv4</code> plus set ``tcp'' and <code class=Nm>NFSv4</code>. <p class=Pp>The <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a> must be running if name&lt;-&gt;uid/gid mapping is being used, as above. Also, since an <code class=Nm>NFSv4</code> mount uses the host uuid to identify the client uniquely to the server, you cannot safely do an <code class=Nm>NFSv4</code> mount when</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
hostid_enable="NO"
</pre></div><p class=Pp>is set in <a class=Xr href=rc.conf.5.html>rc.conf(5)</a>.</p><p class=Pp>If the <code class=Nm>NFSv4</code> server that is being mounted on supports delegations, you can start the <a class=Xr href=nfscbd.8.html>nfscbd(8)</a> daemon to handle client side callbacks. This will occur if</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
nfsuserd_enable="YES"	&lt;-- If name&lt;-&gt;uid/gid mapping is being used.
nfscbd_enable="YES"
</pre></div><p class=Pp>are set in <a class=Xr href=rc.conf.5.html>rc.conf(5)</a>.</p><p class=Pp>Without a functioning callback path, a server will never issue Delegations to a client.</p><p class=Pp>For NFSv4.0, by default, the callback address will be set to the IP address acquired via <code class=Fn>rtalloc</code>() in the kernel and port# 7745. To override the default port#, a command line option for <a class=Xr href=nfscbd.8.html>nfscbd(8)</a> can be used.</p><p class=Pp>To get callbacks to work when behind a NAT gateway, a port for the callback service will need to be set up on the NAT gateway and then the address of the NAT gateway (host IP plus port#) will need to be set by assigning the <a class=Xr href=sysctl.8.html>sysctl(8)</a> variable vfs.nfs.callback_addr to a string of the form:</p><p class=Pp>N.N.N.N.N.N</p><p class=Pp>where the first 4 Ns are the host IP address and the last two are the port# in network byte order (all decimal #s in the range 0-255).</p><p class=Pp>For NFSv4.1 and NFSv4.2, the callback path (called a backchannel) uses the same TCP connection as the mount, so none of the above applies and should work through gateways without any issues.</p><p class=Pp>To build a kernel with the client that supports <code class=Nm>NFSv4</code> linked into it, the option</p><p class=Pp></p><div class="Bd Bd-indent"><pre>
options	NFSCL
</pre></div><p class=Pp>must be specified in the kernel's <a class=Xr href=config.5.html>config(5)</a> file.</p><p class=Pp>Options can be specified for the <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a> and <a class=Xr href=nfscbd.8.html>nfscbd(8)</a> daemons at boot time via the ``nfsuserd_flags'' and ``nfscbd_flags'' <a class=Xr href=rc.conf.5.html>rc.conf(5)</a> variables.</p><p class=Pp>NFSv4 mount(s) against exported volume(s) on the same host are not recommended, since this can result in a hung NFS server. It occurs when an nfsd thread tries to do an NFSv4 <code class=Fn>VOP_RECLAIM</code>() / Close RPC as part of acquiring a new vnode. If all other nfsd threads are blocked waiting for lock(s) held by this nfsd thread, then there isn't an nfsd thread to service the Close RPC.</p></section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class="Bl-tag Bl-compact"><dt><span class=Pa>/var/db/nfs-stablerestart</span></dt><dd>NFS V4 stable restart file</dd><dt><span class=Pa>/var/db/nfs-stablerestart.bak</span></dt><dd>backup copy of the file</dd></dl></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=stablerestart.5.html>stablerestart(5)</a>, <a class=Xr href=mountd.8.html>mountd(8)</a>, <a class=Xr href=nfscbd.8.html>nfscbd(8)</a>, <a class=Xr href=nfsd.8.html>nfsd(8)</a>, <a class=Xr href=nfsdumpstate.8.html>nfsdumpstate(8)</a>, <a class=Xr href=nfsrevoke.8.html>nfsrevoke(8)</a>, <a class=Xr href=nfsuserd.8.html>nfsuserd(8)</a></section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> At this time, there is no recall of delegations for local file system operations. As such, delegations should only be enabled for file systems that are being used solely as NFS export volumes and are not being accessed via local system calls nor services such as Samba. </section></div><table class=foot><tr><td class=foot-date>December 20, 2019</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>