<!DOCTYPE html>
<html><head><meta charset=utf-8><title>archive_write_disk_new(3)</title><keywords content=man,archive_write_disk_new></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>archive_write_disk_new(3)</h1><table class=head><tr><td class=head-ltitle>ARCHIVE_WRITE_DISK(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>ARCHIVE_WRITE_DISK(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>archive_write_disk_new</code>, <code class=Nm>archive_write_disk_set_options</code>, <code class=Nm>archive_write_disk_set_skip_file</code>, <code class=Nm>archive_write_disk_set_group_lookup</code>, <code class=Nm>archive_write_disk_set_standard_lookup</code>, <code class=Nm>archive_write_disk_set_user_lookup</code> — <div class=Nd>functions for creating objects on disk</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2> Streaming Archive Library (libarchive, -larchive) </section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/archive.h.html>archive.h</a>&gt;</code><p class=Pp><var class=Ft>struct archive *</var><br><code class=Fn>archive_write_disk_new</code>(<var class=Fa style="white-space: nowrap;">void</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>archive_write_disk_set_options</code>(<var class=Fa style="white-space: nowrap;">struct archive *</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>archive_write_disk_set_skip_file</code>(<var class=Fa style="white-space: nowrap;">struct archive *</var>, <var class=Fa style="white-space: nowrap;">dev_t</var>, <var class=Fa style="white-space: nowrap;">ino_t</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>archive_write_disk_set_group_lookup</code>(<var class=Fa>struct archive *</var>, <var class=Fa>void *</var>, <var class=Fa>gid_t (*)(void *, const char *gname, gid_t gid)</var>, <var class=Fa>void (*cleanup)(void *)</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>archive_write_disk_set_standard_lookup</code>(<var class=Fa style="white-space: nowrap;">struct archive *</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>archive_write_disk_set_user_lookup</code>(<var class=Fa>struct archive *</var>, <var class=Fa>void *</var>, <var class=Fa>uid_t (*)(void *, const char *uname, uid_t uid)</var>, <var class=Fa>void (*cleanup)(void *)</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> These functions provide a complete API for creating objects on disk from struct archive_entry descriptions. They are most naturally used when extracting objects from an archive using the <code class=Fn>archive_read</code>() interface. The general process is to read struct archive_entry objects from an archive, then write those objects to a struct archive object created using the <code class=Fn>archive_write_disk</code>() family functions. This interface is deliberately very similar to the <code class=Fn>archive_write</code>() interface used to write objects to a streaming archive. <dl class=Bl-tag><dt><code class=Fn>archive_write_disk_new</code>()</dt><dd>Allocates and initializes a struct archive object suitable for writing objects to disk.</dd><dt><code class=Fn>archive_write_disk_set_skip_file</code>()</dt><dd>Records the device and inode numbers of a file that should not be overwritten. This is typically used to ensure that an extraction process does not overwrite the archive from which objects are being read. This capability is technically unnecessary but can be a significant performance optimization in practice.</dd><dt><code class=Fn>archive_write_disk_set_options</code>()</dt><dd>The options field consists of a bitwise OR of one or more of the following values: <dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#ARCHIVE_EXTRACT_ACL><code class=Cm id=ARCHIVE_EXTRACT_ACL>ARCHIVE_EXTRACT_ACL</code></a></dt><dd>Attempt to restore Access Control Lists. By default, extended ACLs are ignored.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_CLEAR_NOCHANGE_FFLAGS><code class=Cm id=ARCHIVE_EXTRACT_CLEAR_NOCHANGE_FFLAGS>ARCHIVE_EXTRACT_CLEAR_NOCHANGE_FFLAGS</code></a></dt><dd>Before removing a file system object prior to replacing it, clear platform-specific file flags which might prevent its removal.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_FFLAGS><code class=Cm id=ARCHIVE_EXTRACT_FFLAGS>ARCHIVE_EXTRACT_FFLAGS</code></a></dt><dd>Attempt to restore file attributes (file flags). By default, file attributes are ignored. See <a class=Xr href=chattr.1.html>chattr(1)</a> (Linux) or <a class=Xr href=chflags.1.html>chflags(1)</a> (FreeBSD, Mac OS X) for more information on file attributes.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_MAC_METADATA><code class=Cm id=ARCHIVE_EXTRACT_MAC_METADATA>ARCHIVE_EXTRACT_MAC_METADATA</code></a></dt><dd>Mac OS X specific. Restore metadata using <a class=Xr href=copyfile.3.html>copyfile(3)</a>. By default, <a class=Xr href=copyfile.3.html>copyfile(3)</a> metadata is ignored.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_NO_OVERWRITE><code class=Cm id=ARCHIVE_EXTRACT_NO_OVERWRITE>ARCHIVE_EXTRACT_NO_OVERWRITE</code></a></dt><dd>Existing files on disk will not be overwritten. By default, existing regular files are truncated and overwritten; existing directories will have their permissions updated; other pre-existing objects are unlinked and recreated from scratch.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_OWNER><code class=Cm id=ARCHIVE_EXTRACT_OWNER>ARCHIVE_EXTRACT_OWNER</code></a></dt><dd>The user and group IDs should be set on the restored file. By default, the user and group IDs are not restored.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_PERM><code class=Cm id=ARCHIVE_EXTRACT_PERM>ARCHIVE_EXTRACT_PERM</code></a></dt><dd>Full permissions (including SGID, SUID, and sticky bits) should be restored exactly as specified, without obeying the current umask. Note that SUID and SGID bits can only be restored if the user and group ID of the object on disk are correct. If <code class=Cm>ARCHIVE_EXTRACT_OWNER</code> is not specified, then SUID and SGID bits will only be restored if the default user and group IDs of newly-created objects on disk happen to match those specified in the archive entry. By default, only basic permissions are restored, and umask is obeyed.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_SAFE_WRITES><code class=Cm id=ARCHIVE_EXTRACT_SAFE_WRITES>ARCHIVE_EXTRACT_SAFE_WRITES</code></a></dt><dd>Extract files atomically, by first creating a unique temporary file and then renaming it to its required destination name. This avoids a race where an application might see a partial file (or no file) during extraction.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_SECURE_NOABSOLUTEPATHS><code class=Cm id=ARCHIVE_EXTRACT_SECURE_NOABSOLUTEPATHS>ARCHIVE_EXTRACT_SECURE_NOABSOLUTEPATHS</code></a></dt><dd>Refuse to extract an absolute path. The default is to not refuse such paths.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_SECURE_NODOTDOT><code class=Cm id=ARCHIVE_EXTRACT_SECURE_NODOTDOT>ARCHIVE_EXTRACT_SECURE_NODOTDOT</code></a></dt><dd>Refuse to extract a path that contains a <span class=Pa>..</span> element anywhere within it. The default is to not refuse such paths. Note that paths ending in <span class=Pa>..</span> always cause an error, regardless of this flag.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_SECURE_SYMLINKS><code class=Cm id=ARCHIVE_EXTRACT_SECURE_SYMLINKS>ARCHIVE_EXTRACT_SECURE_SYMLINKS</code></a></dt><dd>Refuse to extract any object whose final location would be altered by a symlink on disk. This is intended to help guard against a variety of mischief caused by archives that (deliberately or otherwise) extract files outside of the current directory. The default is not to perform this check. If</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_SPARSE><code class=Cm id=ARCHIVE_EXTRACT_SPARSE>ARCHIVE_EXTRACT_SPARSE</code></a></dt><dd>Scan data for blocks of NUL bytes and try to recreate them with holes. This results in sparse files, independent of whether the archive format supports or uses them. <code class=Cm>ARCHIVE_EXTRACT_UNLINK</code> is specified together with this option, the library will remove any intermediate symlinks it finds and return an error only if such symlink could not be removed.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_TIME><code class=Cm id=ARCHIVE_EXTRACT_TIME>ARCHIVE_EXTRACT_TIME</code></a></dt><dd>The timestamps (mtime, ctime, and atime) should be restored. By default, they are ignored. Note that restoring of atime is not currently supported.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_UNLINK><code class=Cm id=ARCHIVE_EXTRACT_UNLINK>ARCHIVE_EXTRACT_UNLINK</code></a></dt><dd>Existing files on disk will be unlinked before any attempt to create them. In some cases, this can prove to be a significant performance improvement. By default, existing files are truncated and rewritten, but the file is not recreated. In particular, the default behavior does not break existing hard links.</dd><dt><a class=permalink href=#ARCHIVE_EXTRACT_XATTR><code class=Cm id=ARCHIVE_EXTRACT_XATTR>ARCHIVE_EXTRACT_XATTR</code></a></dt><dd>Attempt to restore extended file attributes. By default, they are ignored. See <a class=Xr href=xattr.7.html>xattr(7)</a> (Linux), <a class=Xr href=xattr.2.html>xattr(2)</a> (Mac OS X), or <a class=Xr href=getextattr.8.html>getextattr(8)</a> (FreeBSD) for more information on extended file attributes.</dd></dl></dd><dt><code class=Fn>archive_write_disk_set_group_lookup</code>(), <code class=Fn>archive_write_disk_set_user_lookup</code>()</dt><dd>The struct archive_entry objects contain both names and ids that can be used to identify users and groups. These names and ids describe the ownership of the file itself and also appear in ACL lists. By default, the library uses the ids and ignores the names, but this can be overridden by registering user and group lookup functions. To register, you must provide a lookup function which accepts both a name and id and returns a suitable id. You may also provide a void * pointer to a private data structure and a cleanup function for that data. The cleanup function will be invoked when the struct archive object is destroyed.</dd><dt><code class=Fn>archive_write_disk_set_standard_lookup</code>()</dt><dd>This convenience function installs a standard set of user and group lookup functions. These functions use <a class=Xr href=getpwnam.3.html>getpwnam(3)</a> and <a class=Xr href=getgrnam.3.html>getgrnam(3)</a> to convert names to ids, defaulting to the ids if the names cannot be looked up. These functions also implement a simple memory cache to reduce the number of calls to <a class=Xr href=getpwnam.3.html>getpwnam(3)</a> and <a class=Xr href=getgrnam.3.html>getgrnam(3)</a>.</dd></dl> More information about the <var class=Va>struct archive</var> object and the overall design of the library can be found in the <a class=Xr href=libarchive.3.html>libarchive(3)</a> overview. Many of these functions are also documented under <a class=Xr href=archive_write.3.html>archive_write(3)</a>. </section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2> Most functions return <code class=Cm>ARCHIVE_OK</code> (zero) on success, or one of several non-zero error codes for errors. Specific error codes include: <code class=Cm>ARCHIVE_RETRY</code> for operations that might succeed if retried, <code class=Cm>ARCHIVE_WARN</code> for unusual conditions that do not prevent further operations, and <code class=Cm>ARCHIVE_FATAL</code> for serious errors that make remaining operations impossible. <p class=Pp><code class=Fn>archive_write_disk_new</code>() returns a pointer to a newly-allocated struct archive object.</p><p class=Pp><code class=Fn>archive_write_data</code>() returns a count of the number of bytes actually written, or <code class=Li>-1</code> on error.</p></section><section class=Sh><h2 class=Sh id=ERRORS><a class=permalink href=#ERRORS>ERRORS</a></h2> Detailed error codes and textual descriptions are available from the <code class=Fn>archive_errno</code>() and <code class=Fn>archive_error_string</code>() functions. </section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=tar.1.html>tar(1)</a>, <a class=Xr href=archive_read.3.html>archive_read(3)</a>, <a class=Xr href=archive_write.3.html>archive_write(3)</a>, <a class=Xr href=libarchive.3.html>libarchive(3)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>libarchive</code> library first appeared in <span class=Ux>FreeBSD 5.3</span>. The <code class=Nm>archive_write_disk</code> interface was added to <code class=Nm>libarchive 2.0</code> and first appeared in <span class=Ux>FreeBSD 6.3</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>libarchive</code> library was written by <span class=An>Tim Kientzle</span> ⟨kientzle@acm.org⟩. </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Directories are actually extracted in two distinct phases. Directories are created during <code class=Fn>archive_write_header</code>(), but final permissions are not set until <code class=Fn>archive_write_close</code>(). This separation is necessary to correctly handle borderline cases such as a non-writable directory containing files, but can cause unexpected results. In particular, directory permissions are not fully restored until the archive is closed. If you use <a class=Xr href=chdir.2.html>chdir(2)</a> to change the current directory between calls to <code class=Fn>archive_read_extract</code>() or before calling <code class=Fn>archive_read_close</code>(), you may confuse the permission-setting logic with the result that directory permissions are restored incorrectly. <p class=Pp>The library attempts to create objects with filenames longer than <code class=Cm>PATH_MAX</code> by creating prefixes of the full path and changing the current directory. Currently, this logic is limited in scope; the fixup pass does not work correctly for such objects and the symlink security check option disables the support for very long pathnames.</p><p class=Pp>Restoring the path <span class=Pa>aa/../bb</span> does create each intermediate directory. In particular, the directory <span class=Pa>aa</span> is created as well as the final object <span class=Pa>bb</span>. In theory, this can be exploited to create an entire directory hierarchy with a single request. Of course, this does not work if the <code class=Cm>ARCHIVE_EXTRACT_NODOTDOT</code> option is specified.</p><p class=Pp>Implicit directories are always created obeying the current umask. Explicit objects are created obeying the current umask unless <code class=Cm>ARCHIVE_EXTRACT_PERM</code> is specified, in which case they current umask is ignored.</p><p class=Pp>SGID and SUID bits are restored only if the correct user and group could be set. If <code class=Cm>ARCHIVE_EXTRACT_OWNER</code> is not specified, then no attempt is made to set the ownership. In this case, SGID and SUID bits are restored only if the user and group of the final object happen to match those specified in the entry.</p><p class=Pp>The “standard” user-id and group-id lookup functions are not the defaults because <a class=Xr href=getgrnam.3.html>getgrnam(3)</a> and <a class=Xr href=getpwnam.3.html>getpwnam(3)</a> are sometimes too large for particular applications. The current design allows the application author to use a more compact implementation when appropriate.</p><p class=Pp>There should be a corresponding <code class=Nm>archive_read_disk</code> interface that walks a directory hierarchy and returns archive entry objects.</p></section></div><table class=foot><tr><td class=foot-date>January 19, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>