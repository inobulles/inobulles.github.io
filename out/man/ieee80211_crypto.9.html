<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ieee80211_crypto(9)</title><keywords content=man,ieee80211_crypto></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ieee80211_crypto(9)</h1><table class=head><tr><td class=head-ltitle>IEEE80211_CRYPTO(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>IEEE80211_CRYPTO(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ieee80211_crypto</code> — <div class=Nd>802.11 cryptographic support</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/net80211/ieee80211_var.h.html>net80211/ieee80211_var.h</a>&gt;</code><p class=Pp><br><var class=Ft>void</var><br><code class=Fn>ieee80211_crypto_register</code>(<var class=Fa style="white-space: nowrap;">const struct ieee80211_cipher *</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_crypto_unregister</code>(<var class=Fa style="white-space: nowrap;">const struct ieee80211_cipher *</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_available</code>(<var class=Fa style="white-space: nowrap;">int cipher</var>);</p><p class=Pp><br><var class=Ft>void</var><br><code class=Fn>ieee80211_notify_replay_failure</code>(<var class=Fa>struct ieee80211vap *</var>, <var class=Fa>const struct ieee80211_frame *</var>, <var class=Fa>const struct ieee80211_key *</var>, <var class=Fa>uint64_t rsc</var>, <var class=Fa>int tid</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_notify_michael_failure</code>(<var class=Fa>struct ieee80211vap *</var>, <var class=Fa>const struct ieee80211_frame *</var>, <var class=Fa>u_int keyix</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_newkey</code>(<var class=Fa>struct ieee80211vap *</var>, <var class=Fa>int cipher</var>, <var class=Fa>int flags</var>, <var class=Fa>struct ieee80211_key *</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_setkey</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211vap *</var>, <var class=Fa style="white-space: nowrap;">struct ieee80211_key *</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_delkey</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211vap *</var>, <var class=Fa style="white-space: nowrap;">struct ieee80211_key *</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_key_update_begin</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211vap *</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_key_update_end</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211vap *</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_crypto_delglobalkeys</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211vap *</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>ieee80211_crypto_reload_keys</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211com *</var>);</p><p class=Pp><br><var class=Ft>struct ieee80211_key *</var><br><code class=Fn>ieee80211_crypto_encap</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211_node *</var>, <var class=Fa style="white-space: nowrap;">struct mbuf *</var>);</p><p class=Pp><var class=Ft>struct ieee80211_key *</var><br><code class=Fn>ieee80211_crypto_decap</code>(<var class=Fa style="white-space: nowrap;">struct ieee80211_node *</var>, <var class=Fa style="white-space: nowrap;">struct mbuf *</var>, <var class=Fa style="white-space: nowrap;">int flags</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_demic</code>(<var class=Fa>struct ieee80211vap *</var>, <var class=Fa>struct ieee80211_key *</var>, <var class=Fa>struct mbuf *</var>, <var class=Fa>int force</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>ieee80211_crypto_enmic</code>(<var class=Fa>struct ieee80211vap *</var>, <var class=Fa>struct ieee80211_key *</var>, <var class=Fa>struct mbuf *</var>, <var class=Fa>int force</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>net80211</code> layer includes comprehensive cryptographic support for 802.11 protocols. Software implementations of ciphers required by WPA and 802.11i are provided as well as encap/decap processing of 802.11 frames. Software ciphers are written as kernel modules and register with the core crypto support. The cryptographic framework supports hardware acceleration of ciphers by drivers with automatic fall-back to software implementations when a driver is unable to provide necessary hardware services. </section><section class=Sh><h2 class=Sh id=CRYPTO_CIPHER_MODULES><a class=permalink href=#CRYPTO_CIPHER_MODULES>CRYPTO CIPHER MODULES</a></h2><code class=Nm>net80211</code> cipher modules register their services using <code class=Fn>ieee80211_crypto_register</code>() and supply a template that describes their operation. This <var class=Vt>ieee80211_cipher</var> structure defines protocol-related state such as the number of bytes of space in the 802.11 header to reserve/remove during encap/decap and entry points for setting up keys and doing cryptographic operations. <p class=Pp>Cipher modules can associate private state to each key through the <var class=Vt>wk_private</var> structure member. If state is setup by the module it will be called before a key is destroyed so it can reclaim resources.</p><p class=Pp>Crypto modules can notify the system of two events. When a packet replay event is recognized <code class=Fn>ieee80211_notify_replay_failure</code>() can be used to signal the event. When a <code class=Dv>TKIP</code> Michael failure is detected <code class=Fn>ieee80211_notify_michael_failure</code>() can be invoked. Drivers may also use these routines to signal events detected by the hardware.</p></section><section class=Sh><h2 class=Sh id=CRYPTO_KEY_MANAGEMENT><a class=permalink href=#CRYPTO_KEY_MANAGEMENT>CRYPTO KEY MANAGEMENT</a></h2> The <code class=Nm>net80211</code> layer implements a per-vap 4-element “global key table” and a per-station “unicast key” for protocols such as WPA, 802.1x, and 802.11i. The global key table is designed to support legacy WEP operation and Multicast/Group keys, though some applications also use it to implement WPA in station mode. Keys in the global table are identified by a key index in the range 0-3. Per-station keys are identified by the MAC address of the station and are typically used for unicast PTK bindings. <p class=Pp><code class=Nm>net80211</code> provides <a class=Xr href=ioctl.2.html>ioctl(2)</a> operations for managing both global and per-station keys. Drivers typically do not participate in software key management; they are involved only when providing hardware acceleration of cryptographic operations.</p><p class=Pp><code class=Fn>ieee80211_crypto_newkey</code>() is used to allocate a new <code class=Nm>net80211</code> key or reconfigure an existing key. The cipher must be specified along with any fixed key index. The <code class=Nm>net80211</code> layer will handle allocating cipher and driver resources to support the key.</p><p class=Pp>Once a key is allocated it's contents can be set using <code class=Fn>ieee80211_crypto_setkey</code>() and deleted with <code class=Fn>ieee80211_crypto_delkey</code>() (with any cipher and driver resources reclaimed).</p><p class=Pp><code class=Fn>ieee80211_crypto_delglobalkeys</code>() is used to reclaim all keys in the global key table for a vap; it typically is used only within the <code class=Nm>net80211</code> layer.</p><p class=Pp><code class=Fn>ieee80211_crypto_reload_keys</code>() handles hardware key state reloading from software key state, such as required after a suspend/resume cycle.</p></section><section class=Sh><h2 class=Sh id=DRIVER_CRYPTO_SUPPORT><a class=permalink href=#DRIVER_CRYPTO_SUPPORT>DRIVER CRYPTO SUPPORT</a></h2> Drivers identify ciphers they have hardware support for through the <var class=Vt>ic_cryptocaps</var> field of the <var class=Vt>ieee80211com</var> structure. If hardware support is available then a driver should also fill in the <code class=Dv>iv_key_alloc</code>, <code class=Dv>iv_key_set</code>, and <code class=Dv>iv_key_delete</code> methods of each <var class=Vt>ieee80211vap</var> created for use with the device. In addition the methods <code class=Dv>iv_key_update_begin</code> and <code class=Dv>iv_key_update_end</code> can be setup to handle synchronization requirements for updating hardware key state. <p class=Pp>When <code class=Nm>net80211</code> allocates a software key and the driver can accelerate the cipher operations the <code class=Dv>iv_key_alloc</code> method will be invoked. Drivers may return a token that is associated with outbound traffic (for use in encrypting frames). Otherwise, e.g. if hardware resources are not available, the driver will not return a token and <code class=Nm>net80211</code> will arrange to do the work in software and pass frames to the driver that are already prepared for transmission.</p><p class=Pp>For receive, drivers mark frames with the <code class=Dv>M_WEP</code> mbuf flag to indicate the hardware has decrypted the payload. If frames have the <code class=Dv>IEEE80211_FC1_PROTECTED</code> bit marked in their 802.11 header and are not tagged with <code class=Dv>M_WEP</code> then decryption is done in software. For more complicated scenarios the software key state is consulted; e.g. to decide if Michael verification needs to be done in software after the hardware has handled TKIP decryption.</p><p class=Pp>Drivers that manage complicated key data structures, e.g. faulting software keys into a hardware key cache, can safely manipulate software key state by bracketing their work with calls to <code class=Fn>ieee80211_key_update_begin</code>() and <code class=Fn>ieee80211_key_update_end</code>(). These calls also synchronize hardware key state update when receive traffic is active.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=ioctl.2.html>ioctl(2)</a>, <a class=Xr href=wlan_ccmp.4.html>wlan_ccmp(4)</a>, <a class=Xr href=wlan_tkip.4.html>wlan_tkip(4)</a>, <a class=Xr href=wlan_wep.4.html>wlan_wep(4)</a>, <a class=Xr href=ieee80211.9.html>ieee80211(9)</a></section></div><table class=foot><tr><td class=foot-date>March 29, 2010</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>