<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ng_hci(4)</title><keywords content=man,ng_hci></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ng_hci(4)</h1><table class=head><tr><td class=head-ltitle>NG_HCI(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>NG_HCI(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ng_hci</code> — <div class=Nd>Netgraph node type that is also a Bluetooth Host Controller Interface (HCI) layer</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netgraph/bluetooth/include/ng_hci.h.html>netgraph/bluetooth/include/ng_hci.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>hci</code> node type is a Netgraph node type that implements Bluetooth Host Controller Interface (HCI) layer as per chapter H1 of the Bluetooth Specification Book v1.1. </section><section class=Sh><h2 class=Sh id=INTRODUCTION_TO_BLUETOOTH><a class=permalink href=#INTRODUCTION_TO_BLUETOOTH>INTRODUCTION TO BLUETOOTH</a></h2> Bluetooth is a short-range radio link intended to replace the cable(s) connecting portable and/or fixed electronic devices. Bluetooth operates in the unlicensed ISM band at 2.4 GHz. The Bluetooth protocol uses a combination of circuit and packet switching. Bluetooth can support an asynchronous data channel, up to three simultaneous synchronous voice channels, or a channel which simultaneously supports asynchronous data and synchronous voice. Each voice channel supports a 64 kb/s synchronous (voice) channel in each direction. The asynchronous channel can support maximal 723.2 kb/s asymmetric (and still up to 57.6 kb/s in the return direction), or 433.9 kb/s symmetric. <p class=Pp>The Bluetooth system provides a point-to-point connection (only two Bluetooth units involved), or a point-to-multipoint connection. In the point-to-multipoint connection, the channel is shared among several Bluetooth units. Two or more units sharing the same channel form a “piconet”. One Bluetooth unit acts as the master of the piconet, whereas the other unit(s) acts as slave(s). Up to seven slaves can be active in the piconet. In addition, many more slaves can remain locked to the master in a so-called parked state. These parked slaves cannot be active on the channel, but remain synchronized to the master. Both for active and parked slaves, the channel access is controlled by the master.</p><p class=Pp>Multiple piconets with overlapping coverage areas form a “scatternet”. Each piconet can only have a single master. However, slaves can participate in different piconets on a time-division multiplex basis. In addition, a master in one piconet can be a slave in another piconet. The piconets shall not be frequency-synchronized. Each piconet has its own hopping channel.</p><section class=Ss><h2 class=Ss id=Time_Slots><a class=permalink href=#Time_Slots>Time Slots</a></h2> The channel is divided into time slots, each 625 usec in length. The time slots are numbered according to the Bluetooth clock of the piconet master. The slot numbering ranges from 0 to 2^27 -1 and is cyclic with a cycle length of 2^27. In the time slots, master and slave can transmit packets. </section><section class=Ss><h2 class=Ss id=SCO_Link><a class=permalink href=#SCO_Link>SCO Link</a></h2> The SCO link is a symmetric, point-to-point link between the master and a specific slave. The SCO link reserves slots and can therefore be considered as a circuit-switched connection between the master and the slave. The SCO link typically supports time-bounded information like voice. The master can support up to three SCO links to the same slave or to different slaves. A slave can support up to three SCO links from the same master, or two SCO links if the links originate from different masters. SCO packets are never retransmitted. </section><section class=Ss><h2 class=Ss id=ACL_Link><a class=permalink href=#ACL_Link>ACL Link</a></h2> In the slots not reserved for SCO links, the master can exchange packets with any slave on a per-slot basis. The ACL link provides a packet-switched connection between the master and all active slaves participating in the piconet. Both asynchronous and isochronous services are supported. Between a master and a slave only a single ACL link can exist. For most ACL packets, packet retransmission is applied to assure data integrity. </section></section><section class=Sh><h2 class=Sh id=HOST_CONTROLLER_INTERFACE_(HCI)><a class=permalink href=#HOST_CONTROLLER_INTERFACE_(HCI)>HOST CONTROLLER INTERFACE (HCI)</a></h2> The HCI provides a command interface to the baseband controller and link manager, and access to hardware status and control registers. This interface provides a uniform method of accessing the Bluetooth baseband capabilities. <p class=Pp>The HCI layer on the Host exchanges data and commands with the HCI firmware on the Bluetooth hardware. The Host Controller Transport Layer (i.e., physical bus) driver provides both HCI layers with the ability to exchange information with each other.</p><p class=Pp>The Host will receive asynchronous notifications of HCI events independent of which Host Controller Transport Layer is used. HCI events are used for notifying the Host when something occurs. When the Host discovers that an event has occurred it will then parse the received event packet to determine which event occurred. The next sections specify the HCI packet formats.</p><section class=Ss><h2 class=Ss id=HCI_Command_Packet><a class=permalink href=#HCI_Command_Packet>HCI Command Packet</a></h2><div class="Bd Bd-indent"><pre>
#define NG_HCI_CMD_PKT 0x01
typedef struct {
        uint8_t  type;   /* MUST be 0x1 */
        uint16_t opcode; /* OpCode */
        uint8_t  length; /* parameter(s) length in bytes */
} __attribute__ ((packed)) ng_hci_cmd_pkt_t;
</pre></div><p class=Pp>The HCI command packet is used to send commands to the Host Controller from the Host. When the Host Controller completes most of the commands, a Command Complete event is sent to the Host. Some commands do not receive a Command Complete event when they have been completed. Instead, when the Host Controller receives one of these commands the Host Controller sends a Command Status event back to the Host when it has begun to execute the command. Later on, when the actions associated with the command have finished, an event that is associated with the sent command will be sent by the Host Controller to the Host.</p></section><section class=Ss><h2 class=Ss id=HCI_Event_Packet><a class=permalink href=#HCI_Event_Packet>HCI Event Packet</a></h2><div class="Bd Bd-indent"><pre>
#define NG_HCI_EVENT_PKT 0x04
typedef struct {
        uint8_t type;   /* MUST be 0x4 */
        uint8_t event;  /* event */
        uint8_t length; /* parameter(s) length in bytes */
} __attribute__ ((packed)) ng_hci_event_pkt_t;
</pre></div><p class=Pp>The HCI event packet is used by the Host Controller to notify the Host when events occur.</p></section><section class=Ss><h2 class=Ss id=HCI_ACL_Data_Packet><a class=permalink href=#HCI_ACL_Data_Packet>HCI ACL Data Packet</a></h2><div class="Bd Bd-indent"><pre>
#define NG_HCI_ACL_DATA_PKT 0x02
typedef struct {
        uint8_t  type;       /* MUST be 0x2 */
        uint16_t con_handle; /* connection handle + PB + BC flags */
        uint16_t length;     /* payload length in bytes */
} __attribute__ ((packed)) ng_hci_acldata_pkt_t;
</pre></div><p class=Pp>HCI ACL data packets are used to exchange ACL data between the Host and Host Controller.</p></section><section class=Ss><h2 class=Ss id=HCI_SCO_Data_Packet><a class=permalink href=#HCI_SCO_Data_Packet>HCI SCO Data Packet</a></h2><div class="Bd Bd-indent"><pre>
#define NG_HCI_SCO_DATA_PKT 0x03
typedef struct {
        uint8_t  type;       /* MUST be 0x3 */
        uint16_t con_handle; /* connection handle + reserved bits */
        uint8_t  length;     /* payload length in bytes */
} __attribute__ ((packed)) ng_hci_scodata_pkt_t;
</pre></div><p class=Pp>HCI SCO data packets are used to exchange SCO data between the Host and Host Controller.</p></section></section><section class=Sh><h2 class=Sh id=HCI_INITIALIZATION><a class=permalink href=#HCI_INITIALIZATION>HCI INITIALIZATION</a></h2> On initialization, HCI control application must issue the following HCI commands (in any order). <dl class=Bl-tag><dt><a class=permalink href=#Read_BD_ADDR><code class=Dv id=Read_BD_ADDR>Read_BD_ADDR</code></a></dt><dd>To obtain BD_ADDR of the Bluetooth unit.</dd><dt><a class=permalink href=#Read_Local_Supported_Features><code class=Dv id=Read_Local_Supported_Features>Read_Local_Supported_Features</code></a></dt><dd>To obtain the list of features supported by Bluetooth unit.</dd><dt><a class=permalink href=#Read_Buffer_Size><code class=Dv id=Read_Buffer_Size>Read_Buffer_Size</code></a></dt><dd>To determine the maximum size of HCI ACL and SCO HCI data packets (excluding header) that can be sent from the Host to the Host Controller. There are also two additional return parameters that specify the total number of HCI ACL and SCO data packets that the Host Controller can have waiting for transmission in its buffers.</dd></dl><p class=Pp>As soon as HCI initialization has been successfully performed, HCI control application must turn on “inited” bit for the node. Once HCI node has been initialized all upstream hooks will receive a <code class=Dv>NGM_HCI_NODE_UP</code> Netgraph message defined as follows.</p><div class="Bd Pp Bd-indent"><pre>
#define NGM_HCI_NODE_UP 112 /* HCI -&gt; Upper */
typedef struct {
        uint16_t  pkt_size; /* max. ACL/SCO packet size (w/o hdr) */
        uint16_t  num_pkts; /* ACL/SCO packet queue size */
        uint16_t  reserved; /* place holder */
        bdaddr_t  bdaddr;   /* bdaddr */
} ng_hci_node_up_ep;
</pre></div></section><section class=Sh><h2 class=Sh id=HCI_FLOW_CONTROL><a class=permalink href=#HCI_FLOW_CONTROL>HCI FLOW CONTROL</a></h2> HCI layer performs flow control on baseband connection basis (i.e., ACL and SCO link). Each baseband connection has “connection handle” and queue of outgoing data packets. Upper layers protocols are allowed to send up to (<code class=Dv>num_pkts</code> - <code class=Dv>pending</code>) packets at one time. HCI layer will send <code class=Dv>NGM_HCI_SYNC_CON_QUEUE</code> Netgraph messages to inform upper layers about current queue state for each connection handle. The <code class=Dv>NGM_HCI_SYNC_CON_QUEUE</code> Netgraph message is defined as follows. <div class="Bd Pp Bd-indent"><pre>
#define NGM_HCI_SYNC_CON_QUEUE 113 /* HCI -&gt; Upper */
typedef struct {
        uint16_t con_handle; /* connection handle */
        uint16_t completed;  /* number of completed packets */
} ng_hci_sync_con_queue_ep;
</pre></div></section><section class=Sh><h2 class=Sh id=HOOKS><a class=permalink href=#HOOKS>HOOKS</a></h2> This node type supports the following hooks: <dl class=Bl-tag><dt><var class=Va>drv</var></dt><dd>Bluetooth Host Controller Transport Layer hook. Single HCI packet contained in single <var class=Vt>mbuf</var> structure.</dd><dt><var class=Va>acl</var></dt><dd>Upper layer protocol/node is connected to the hook. Single HCI ACL data packet contained in single <var class=Vt>mbuf</var> structure.</dd><dt><var class=Va>sco</var></dt><dd>Upper layer protocol/node is connected to the hook. Single HCI SCO data packet contained in single <var class=Vt>mbuf</var> structure.</dd><dt><var class=Va>raw</var></dt><dd>Raw hook. Every HCI frame (including HCI command frame) that goes in or out will be delivered to the hook. Usually the Bluetooth raw HCI socket layer is connected to the hook. Single HCI frame contained in single <var class=Vt>mbuf</var> structure.</dd></dl></section><section class=Sh><h2 class=Sh id=BLUETOOTH_UPPER_LAYER_PROTOCOLS_INTERFACE_(LP_CONTROL_MESSAGES)><a class=permalink href=#BLUETOOTH_UPPER_LAYER_PROTOCOLS_INTERFACE_(LP_CONTROL_MESSAGES)>BLUETOOTH UPPER LAYER PROTOCOLS INTERFACE (LP CONTROL MESSAGES)</a></h2><dl class=Bl-tag><dt><a class=permalink href=#NGM_HCI_LP_CON_REQ><code class=Dv id=NGM_HCI_LP_CON_REQ>NGM_HCI_LP_CON_REQ</code></a></dt><dd>Requests the lower protocol to create a connection. If a physical link to the remote device does not exist, this message must be sent to the lower protocol (baseband) to establish the physical connection.</dd><dt><a class=permalink href=#NGM_HCI_LP_DISCON_REQ><code class=Dv id=NGM_HCI_LP_DISCON_REQ>NGM_HCI_LP_DISCON_REQ</code></a></dt><dd>Requests the lower protocol (baseband) to terminate a connection.</dd><dt><a class=permalink href=#NGM_HCI_LP_CON_CFM><code class=Dv id=NGM_HCI_LP_CON_CFM>NGM_HCI_LP_CON_CFM</code></a></dt><dd>Confirms success or failure of the <code class=Dv>NGM_HCI_LP_CON_REQ</code> request to establish a lower layer (baseband) connection. This includes passing the authentication challenge if authentication is required to establish the physical link.</dd><dt><a class=permalink href=#NGM_HCI_LP_CON_IND><code class=Dv id=NGM_HCI_LP_CON_IND>NGM_HCI_LP_CON_IND</code></a></dt><dd>Indicates the lower protocol (baseband) has successfully established incoming connection.</dd><dt><a class=permalink href=#NGM_HCI_LP_CON_RSP><code class=Dv id=NGM_HCI_LP_CON_RSP>NGM_HCI_LP_CON_RSP</code></a></dt><dd>A response accepting or rejecting the previous connection indication request.</dd><dt><a class=permalink href=#NGM_HCI_LP_DISCON_IND><code class=Dv id=NGM_HCI_LP_DISCON_IND>NGM_HCI_LP_DISCON_IND</code></a></dt><dd>Indicates the lower protocol (baseband) has terminated connection. This could be a response to <code class=Dv>NGM_HCI_LP_DISCON_REQ</code> or a timeout event.</dd><dt><a class=permalink href=#NGM_HCI_LP_QOS_REQ><code class=Dv id=NGM_HCI_LP_QOS_REQ>NGM_HCI_LP_QOS_REQ</code></a></dt><dd>Requests the lower protocol (baseband) to accommodate a particular QoS parameter set.</dd><dt><a class=permalink href=#NGM_HCI_LP_QOS_CFM><code class=Dv id=NGM_HCI_LP_QOS_CFM>NGM_HCI_LP_QOS_CFM</code></a></dt><dd>Confirms success or failure of the request for a given quality of service.</dd><dt><a class=permalink href=#NGM_HCI_LP_QOS_IND><code class=Dv id=NGM_HCI_LP_QOS_IND>NGM_HCI_LP_QOS_IND</code></a></dt><dd>Indicates the lower protocol (baseband) has detected a violation of the QoS agreement.</dd></dl></section><section class=Sh><h2 class=Sh id=NETGRAPH_CONTROL_MESSAGES><a class=permalink href=#NETGRAPH_CONTROL_MESSAGES>NETGRAPH CONTROL MESSAGES</a></h2> This node type supports the generic control messages, plus the following: <dl class=Bl-tag><dt><a class=permalink href=#NGM_HCI_NODE_GET_STATE><code class=Dv id=NGM_HCI_NODE_GET_STATE>NGM_HCI_NODE_GET_STATE</code></a></dt><dd>Returns current state for the node.</dd><dt><a class=permalink href=#NGM_HCI_NODE_INIT><code class=Dv id=NGM_HCI_NODE_INIT>NGM_HCI_NODE_INIT</code></a></dt><dd>Turn on “inited” bit for the node.</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_DEBUG><code class=Dv id=NGM_HCI_NODE_GET_DEBUG>NGM_HCI_NODE_GET_DEBUG</code></a></dt><dd>Returns an integer containing the current debug level for the node.</dd><dt><a class=permalink href=#NGM_HCI_NODE_SET_DEBUG><code class=Dv id=NGM_HCI_NODE_SET_DEBUG>NGM_HCI_NODE_SET_DEBUG</code></a></dt><dd>This command takes an integer argument and sets current debug level for the node.</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_BUFFER><code class=Dv id=NGM_HCI_NODE_GET_BUFFER>NGM_HCI_NODE_GET_BUFFER</code></a></dt><dd>Returns current state of data buffers.</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_BDADDR><code class=Dv id=NGM_HCI_NODE_GET_BDADDR>NGM_HCI_NODE_GET_BDADDR</code></a></dt><dd>Returns BD_ADDR as cached in the node.</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_FEATURES><code class=Dv id=NGM_HCI_NODE_GET_FEATURES>NGM_HCI_NODE_GET_FEATURES</code></a></dt><dd>Returns the list of features supported by hardware (as cached by the node).</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_NEIGHBOR_CACHE><code class=Dv id=NGM_HCI_NODE_GET_NEIGHBOR_CACHE>NGM_HCI_NODE_GET_NEIGHBOR_CACHE</code></a></dt><dd>Returns content of the neighbor cache.</dd><dt><a class=permalink href=#NGM_HCI_NODE_FLUSH_NEIGHBOR_CACHE><code class=Dv id=NGM_HCI_NODE_FLUSH_NEIGHBOR_CACHE>NGM_HCI_NODE_FLUSH_NEIGHBOR_CACHE</code></a></dt><dd>Remove all neighbor cache entries.</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_CON_LIST><code class=Dv id=NGM_HCI_NODE_GET_CON_LIST>NGM_HCI_NODE_GET_CON_LIST</code></a></dt><dd>Returns list of active baseband connections (i.e., ACL and SCO links).</dd><dt><a class=permalink href=#NGM_HCI_NODE_GET_STAT><code class=Dv id=NGM_HCI_NODE_GET_STAT>NGM_HCI_NODE_GET_STAT</code></a></dt><dd>Returns various statistic counters.</dd><dt><a class=permalink href=#NGM_HCI_NODE_RESET_STAT><code class=Dv id=NGM_HCI_NODE_RESET_STAT>NGM_HCI_NODE_RESET_STAT</code></a></dt><dd>Resets all statistic counters to zero.</dd><dt>NGM_HCI_NODE_SET_LINK_POLICY_SETTINGS_MASK</dt><dd>Sets current link policy settings mask. After the new ACL connection is created the HCI node will try set link policy for the ACL connection. By default, every supported Link Manager (LM) mode will be enabled. User can override this by setting link policy settings mask which specifies LM modes to be enabled.</dd><dt>NGM_HCI_NODE_GET_LINK_POLICY_SETTINGS_MASK</dt><dd>Returns current link policy settings mask.</dd><dt>NGM_HCI_NODE_SET_PACKET_MASK</dt><dd>Sets current packet mask. When new baseband (ACL or SCO) connection is created the HCI node will specify every packet type supported by the device. User can override this by setting packet mask which specifies packet types to be used for new baseband connections.</dd><dt>NGM_HCI_NODE_GET_PACKET_MASK</dt><dd>Returns current packet mask.</dd><dt>NGM_HCI_NODE_SET_ROLE_SWITCH</dt><dd>Sets the value of the role switch. Role switch is enabled when this value is not zero. This is the default state. Note that actual role switch at Bluetooth link level will only be performed if hardware supports role switch and it was enabled.</dd><dt>NGM_HCI_NODE_GET_ROLE_SWITCH</dt><dd>Returns the value of the role switch for the node.</dd></dl></section><section class=Sh><h2 class=Sh id=SHUTDOWN><a class=permalink href=#SHUTDOWN>SHUTDOWN</a></h2> This node shuts down upon receipt of a <code class=Dv>NGM_SHUTDOWN</code> control message, or when all hooks have been disconnected. </section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=netgraph.4.html>netgraph(4)</a>, <a class=Xr href=hccontrol.8.html>hccontrol(8)</a>, <a class=Xr href=ngctl.8.html>ngctl(8)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>hci</code> node type was implemented in <span class=Ux>FreeBSD 5.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Maksim Yevmenkin</span> &lt;<a class=Mt href=mailto:m_evmenkin@yahoo.com>m_evmenkin@yahoo.com</a>&gt; </section><section class=Sh><h2 class=Sh id=BUGS><a class=permalink href=#BUGS>BUGS</a></h2> Most likely. Please report if found. </section></div><table class=foot><tr><td class=foot-date>June 25, 2002</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>