<!DOCTYPE html>
<html><head><meta charset=utf-8><title>ctm_dequeue(1)</title><keywords content=man,ctm_dequeue></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>ctm_dequeue(1)</h1><table class=head><tr><td class=head-ltitle>CTM_MAIL(1)</td><td class=head-vol>FreeBSD General Commands Manual</td><td class=head-rtitle>CTM_MAIL(1)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>ctm_smail</code>, <code class=Nm>ctm_dequeue</code>, <code class=Nm>ctm_rmail</code> — <div class=Nd>send and receive <a class=Xr href=ctm.1.html>ctm(1)</a> deltas via mail</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><table class=Nm><tr><td><code class=Nm>ctm_smail</code></td><td>[<code class=Fl>-l</code><var class=Ar>log</var>] [<code class=Fl>-m</code><var class=Ar>maxmsgsize</var>] [<code class=Fl>-c</code><var class=Ar>maxctmsize</var>] [<code class=Fl>-q</code><var class=Ar>queue-dir</var>] <var class=Ar>ctm-delta</var><var class=Ar>mail-alias</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>ctm_dequeue</code></td><td>[<code class=Fl>-l</code><var class=Ar>log</var>] [<code class=Fl>-n</code><var class=Ar>numchunks</var>] <var class=Ar>queue-dir</var></td></tr></table><br><table class=Nm><tr><td><code class=Nm>ctm_rmail</code></td><td>[<code class=Fl>-Dfuv</code>] [<code class=Fl>-l</code><var class=Ar>log</var>] [<code class=Fl>-p</code><var class=Ar>piecedir</var>] [<code class=Fl>-d</code><var class=Ar>deltadir</var>] [<code class=Fl>-b</code><var class=Ar>basedir</var>] [<var class=Ar>file ...</var>]</td></tr></table></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> In conjunction with the <a class=Xr href=ctm.1.html>ctm(1)</a> command, <code class=Nm>ctm_smail</code>, <code class=Nm>ctm_dequeue</code> and <code class=Nm>ctm_rmail</code> are used to distribute changes to a source tree via email. The <code class=Nm>ctm_smail</code> utility is given a compressed <a class=Xr href=ctm.1.html>ctm</a> delta, and a mailing list to send it to. It splits the delta into manageable pieces, encodes them as mail messages and sends them to the mailing list (optionally queued to spread the mail load). Each recipient uses <code class=Nm>ctm_rmail</code> (either manually or automatically) to decode and reassemble the delta, and optionally call <a class=Xr href=ctm.1.html>ctm</a> to apply it to the source tree. At the moment, several source trees are distributed, and by several sites. These include the <span class=Ux>FreeBSD</span>-current source and CVS trees, distributed by <code class=Li>freefall.FreeBSD.org</code>. <p class=Pp>Command line arguments for <code class=Nm>ctm_smail</code>:</p><dl class=Bl-tag><dt><a class=permalink href=#l><code class=Fl id=l>-l</code></a><var class=Ar>log</var></dt><dd>Instead of appearing on <i class=Em>stderr</i>, error diagnostics and informational messages (other than command line errors) are time stamped and written to the file <i class=Em>log</i>.</dd><dt><a class=permalink href=#m><code class=Fl id=m>-m</code></a><var class=Ar>maxmsgsize</var></dt><dd>Limit the maximum size mail message that <code class=Nm>ctm_smail</code> is allowed to send. It is approximate since mail headers and other niceties are not counted in this limit. If not specified, it will default to 64000 bytes, leaving room for 1535 bytes of headers before the rumoured 64k mail limit.</dd><dt><a class=permalink href=#c><code class=Fl id=c>-c</code></a><var class=Ar>maxctmsize</var></dt><dd>Limit the maximum size delta that will be sent. Deltas bigger that this limit will cause an apology mail message to be sent to the mailing list. This is to prevent massive changes overwhelming users' mail boxes. Note that this is the size before encoding. Encoding causes a 4/3 size increase before mail headers are added. If not specified, there is no limit.</dd><dt><a class=permalink href=#q><code class=Fl id=q>-q</code></a><var class=Ar>queue-dir</var></dt><dd>Instead of mailing the delta pieces now, store them in the given directory to be mailed later using <code class=Nm>ctm_dequeue</code>. This feature allows the mailing of large deltas to be spread out over hours or even days to limit the impact on recipients with limited network bandwidth or small mail spool areas.</dd></dl><p class=Pp><var class=Ar>ctm-delta</var> is the delta to be sent, and <var class=Ar>mail-alias</var> is the mailing list to send the delta to. The mail messages are sent using <a class=Xr href=sendmail.8.html>sendmail(8)</a>.</p><p class=Pp>Command line arguments for <code class=Nm>ctm_dequeue</code>:</p><dl class=Bl-tag><dt><a class=permalink href=#l_2><code class=Fl id=l_2>-l</code></a><var class=Ar>log</var></dt><dd>Instead of appearing on <i class=Em>stderr</i>, error diagnostics and informational messages (other than command line errors) are time stamped and written to the file <i class=Em>log</i>.</dd><dt><a class=permalink href=#n><code class=Fl id=n>-n</code></a><var class=Ar>numchunks</var></dt><dd>Limit the number of mail messages that <code class=Nm>ctm_dequeue</code> will send per run. By default, <code class=Nm>ctm_dequeue</code> will send one mail message per run.</dd></dl><p class=Pp><var class=Ar>queuedir</var> is the directory containing the mail messages stored by <code class=Nm>ctm_smail</code>. Up to <var class=Ar>numchunks</var> mail messages will be sent in each run. The recipient mailing list is already encoded in the queued files.</p><p class=Pp>It is safe to run <code class=Nm>ctm_dequeue</code> while <code class=Nm>ctm_smail</code> is adding entries to the queue, or even to run <code class=Nm>ctm_smail</code> multiple times concurrently, but a separate queue directory should be used for each tree being distributed. This is because entries are served in alphabetical order, and one tree will be unfairly serviced before any others, based on the delta names, not delta creation times.</p><p class=Pp>Command line arguments for <code class=Nm>ctm_rmail</code>:</p><dl class=Bl-tag><dt><a class=permalink href=#l_3><code class=Fl id=l_3>-l</code></a><var class=Ar>log</var></dt><dd>Instead of appearing on <i class=Em>stderr</i>, error diagnostics and informational messages (other than command line errors) are time stamped and written to the file <i class=Em>log</i>.</dd><dt><a class=permalink href=#p><code class=Fl id=p>-p</code></a><var class=Ar>piecedir</var></dt><dd>Collect pieces of deltas in this directory. Each piece corresponds to a single mail message. Pieces are removed when complete deltas are built. If this flag is not given, no input files will be read, but completed deltas may still be applied with <a class=Xr href=ctm.1.html>ctm</a> if the <code class=Fl>-b</code> flag is given.</dd><dt><a class=permalink href=#d><code class=Fl id=d>-d</code></a><var class=Ar>deltadir</var></dt><dd>Collect completed deltas in this directory. Deltas are built from one or more pieces when all pieces are present.</dd><dt><a class=permalink href=#b><code class=Fl id=b>-b</code></a><var class=Ar>basedir</var></dt><dd>Apply any completed deltas to this source tree. If this flag is not given, deltas will be stored, but not applied. The user may then apply the deltas manually, or by using <code class=Nm>ctm_rmail</code> without the <code class=Fl>-p</code> flag. Deltas will not be applied if they do not match the <code class=Li>.ctm_status</code> file in <var class=Ar>basedir</var> (or if <code class=Li>.ctm_status</code> does not exist).</dd><dt><a class=permalink href=#D><code class=Fl id=D>-D</code></a></dt><dd>Delete deltas after successful application by <a class=Xr href=ctm.1.html>ctm</a>. It is probably a good idea to avoid this flag (and keep all the deltas) as <a class=Xr href=ctm.1.html>ctm</a> has the ability to recover small groups of files from a full set of deltas.</dd><dt><a class=permalink href=#f><code class=Fl id=f>-f</code></a></dt><dd>Fork and execute in the background while applying deltas with <a class=Xr href=ctm.1.html>ctm</a>. This is useful when automatically invoking <code class=Nm>ctm_rmail</code> from <a class=Xr href=sendmail.1.html>sendmail</a> because <a class=Xr href=ctm.1.html>ctm</a> can take a very long time to complete, causing other people's mail to be delayed, and can in theory cause spurious mail retransmission due to the remote <a class=Xr href=sendmail.1.html>sendmail</a> timing out, or even termination of <code class=Nm>ctm_rmail</code> by mail filters such as <a class=Xr href="MH's.1.html">MH's</a><a class=Xr href=slocal.1.html>slocal</a>. Do not worry about zillions of background <a class=Xr href=ctm.1.html>ctm</a> processes loading your machine, since locking is used to prevent more than one <a class=Xr href=ctm.1.html>ctm</a> invocation at a time.</dd><dt><a class=permalink href=#u><code class=Fl id=u>-u</code></a></dt><dd>Pass the <code class=Fl>-u</code> flag to the <a class=Xr href=ctm.1.html>ctm</a> command when applying the complete deltas, causing it to set the modification time of created and modified files to the CTM delta creation time.</dd><dt><a class=permalink href=#v><code class=Fl id=v>-v</code></a></dt><dd>Pass the <code class=Fl>-v</code> flag to the <a class=Xr href=ctm.1.html>ctm</a> command when applying the complete deltas, causing a more informative output. All <a class=Xr href=ctm.1.html>ctm</a> output appears in the <code class=Nm>ctm_rmail</code> log file.</dd></dl><p class=Pp>The file arguments (or <i class=Em>stdin</i>, if there are none) are scanned for delta pieces. Multiple delta pieces can be read from a single file, so an entire maildrop can be scanned and processed with a single command.</p><p class=Pp>It is safe to invoke <code class=Nm>ctm_rmail</code> multiple times concurrently (with different input files), as might happen when <a class=Xr href=sendmail.1.html>sendmail</a> is delivering mail asynchronously. This is because locking is used to keep things orderly.</p></section><section class=Sh><h2 class=Sh id=FILE_FORMAT><a class=permalink href=#FILE_FORMAT>FILE FORMAT</a></h2> Following are the important parts of an actual (very small) delta piece: <div class="Bd Pp"><pre>
From: owner-src-cur
To: src-cur
Subject: ctm-mail src-cur.0003.gz 1/4

CTM_MAIL BEGIN src-cur.0003.gz 1 4
H4sIAAAAAAACA3VU72/bNhD9bP0VByQoEiyRSZEUSQP9kKTeYCR2gDTdsGFAwB/HRogtG5K8NCj6
v4+UZSdtUQh6Rz0eee/xaF/dzx8up3/MFlDkBNrGnbttAwyo1pxoRgoiBNX/QJ5d3c9/X8DcPGGo
lggkPiXngE4W1gUjKPJCYyk5MZRbIqmNW/ASglIFcdwIzTUxaAqhnCPcBqloKEkJVNDMF0Azk+Bo
dDzzk0Ods/+A5gXv9YyJHjMCtJwQNeESNma7hOmXDRxn
CTM_MAIL END 61065
</pre></div><p class=Pp>The subject of the message always begins with “ctm-mail” followed by the name of the delta, which piece this is, and how many total pieces there are. The data are bracketed by “CTM_MAIL BEGIN” and “CTM_MAIL END” lines, duplicating the information in the subject line, plus a simple checksum.</p><p class=Pp>If the delta exceeds <var class=Ar>maxctmsize</var>, then a message like this will be received instead:</p><div class="Bd Pp"><pre>
From: owner-src-cur
To: src-cur
Subject: ctm-notice src-cur.0999.gz

src-cur.0999.gz is 792843 bytes.  The limit is 300000 bytes.

You can retrieve this delta via ftp.
</pre></div><p class=Pp>You are then on your own!</p></section><section class=Sh><h2 class=Sh id=ENVIRONMENT><a class=permalink href=#ENVIRONMENT>ENVIRONMENT</a></h2> If deltas are to be applied then <a class=Xr href=ctm.1.html>ctm(1)</a> and <a class=Xr href=gunzip.1.html>gunzip(1)</a> must be in your <code class=Ev>PATH</code>. </section><section class=Sh><h2 class=Sh id=FILES><a class=permalink href=#FILES>FILES</a></h2><dl class=Bl-tag><dt><span class=Pa>QUEUEDIR/*</span></dt><dd>Pieces of deltas encoded as mail messages waiting to be sent to the mailing list.</dd><dt><span class=Pa>PIECEDIR/*</span></dt><dd>Pieces of deltas waiting for the rest to arrive.</dd><dt><span class=Pa>DELTADIR/*</span></dt><dd>Completed deltas.</dd><dt><span class=Pa>BASEDIR/.ctm_status</span></dt><dd>File containing the name and number of the next delta to be applied to this source tree.</dd></dl></section><section class=Sh><h2 class=Sh id=EXIT_STATUS><a class=permalink href=#EXIT_STATUS>EXIT STATUS</a></h2> The <code class=Nm>ctm_smail</code>, <code class=Nm>ctm_dequeue</code> and <code class=Nm>ctm_rmail</code> utilities return exit status 0 for success, and 1 for various failures. The <code class=Nm>ctm_rmail</code> utility is expected to be called from a mail transfer program, and thus signals failure only when the input mail message should be bounced (preferably into your regular maildrop, not back to the sender). In short, failure to apply a completed delta with <a class=Xr href=ctm.1.html>ctm</a> is not considered an error important enough to bounce the mail, and <code class=Nm>ctm_rmail</code> returns an exit status of 0. </section><section class=Sh><h2 class=Sh id=EXAMPLES><a class=permalink href=#EXAMPLES>EXAMPLES</a></h2> To send delta 32 of <i class=Em>src-cur</i> to a group of wonderful code hackers known to <a class=Xr href=sendmail.1.html>sendmail</a> as <i class=Em>src-guys</i>, limiting the mail size to roughly 60000 bytes, you could use: <div class="Bd Pp Bd-indent"><pre>
ctm_smail -m 60000 /wherever/it/is/src-cur.0032.gz src-guys
</pre></div><p class=Pp>To decode every <code class=Nm>ctm-mail</code> message in your mailbox, assemble them into complete deltas, then apply any deltas built or lying around, you could use:</p><div class="Bd Pp Bd-indent"><pre>
ctm_rmail -p ~/pieces -d ~/deltas -b /usr/ctm-src-cur $MAIL
</pre></div><p class=Pp>(Note that no messages are deleted by <code class=Nm>ctm_rmail</code>. Any mail reader could be used for that purpose.)</p><p class=Pp>To create a mail alias called <i class=Em>receiver-dude</i> that will automatically decode and assemble deltas, but not apply them, you could put the following lines in your <span class=Pa>/etc/mail/aliases</span> file (assuming the <span class=Pa>/ctm/tmp</span> and <span class=Pa>/ctm/deltas</span> directories and <span class=Pa>/ctm/log</span> file are writable by user <i class=Em>daemon</i> or group <i class=Em>wheel</i>):</p><div class="Bd Pp Bd-indent"><pre>
receiver-dude: "|ctm_rmail -p /ctm/tmp -d /ctm/deltas -l /ctm/log"
owner-receiver-dude: real_dude@wherever.you.like
</pre></div><p class=Pp>The second line will catch failures and drop them into your regular mailbox, or wherever else you like.</p><p class=Pp>To apply all the deltas collected, and delete those applied, you could use:</p><div class="Bd Pp Bd-indent"><pre>
ctm_rmail -D -d /ctm/deltas -b /ctm/src-cur -l /ctm/apply.log
</pre></div><p class=Pp>For maximum flexibility, consider this excerpt from a <a class=Xr href=procmail.1.html>procmail</a> script:</p><div class="Bd Pp Bd-indent"><pre>
PATH=$HOME/bin:$PATH

:0 w
* ^Subject: ctm-mail cvs-cur
| ctm_incoming
</pre></div><p class=Pp>together with the shell script <span class=Pa>~/bin/ctm_incoming</span>:</p><div class="Bd Pp Bd-indent"><pre>
#! /bin/sh
PATH="$HOME/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin"
export PATH

cd $HOME/ctm &amp;&amp; ctm_rmail -f -p pieces -d deltas -l log -b /ctm
</pre></div><p class=Pp>which will deposit all <a class=Xr href=ctm.1.html>ctm</a> deltas in <span class=Pa>~/ctm/deltas</span>, apply them to the tree in <span class=Pa>/ctm</span>, and drop any failures into your regular mail box. Note the <code class=Ev>PATH</code> manipulation in <span class=Pa>ctm_incoming</span> which allows <code class=Nm>ctm_rmail</code> to execute <a class=Xr href=ctm.1.html>ctm(1)</a> on the (non-<span class=Ux>FreeBSD</span>) machine that this example was taken from.</p></section><section class=Sh><h2 class=Sh id=SECURITY><a class=permalink href=#SECURITY>SECURITY</a></h2> On its own, CTM is an insecure protocol - there is no authentication performed that the changes applied to the source code were sent by a trusted party, and so care should be taken if the CTM deltas are obtained via an unauthenticated medium such as regular email. It is a relatively simple matter for an attacker to forge a CTM delta to replace or precede the legitimate one and insert malicious code into your source tree. If the legitimate delta is somehow prevented from arriving, this will go unnoticed until a later delta attempts to touch the same file, at which point the MD5 checksum will fail. <p class=Pp>To remedy this insecurity, CTM delta pieces generated by FreeBSD.org are cryptographically signed in a format compatible with the GNU Privacy Guard utility, available in /usr/ports/security/gpg, and the Pretty Good Privacy v5 utility, /usr/ports/security/pgp5. The relevant public key can be obtained by fingering ctm@FreeBSD.org.</p><p class=Pp>CTM deltas which are thus signed cannot be undetectably altered by an attacker. Therefore it is recommended that you make use of GPG or PGP5 to verify the signatures if you receive your CTM deltas via email.</p></section><section class=Sh><h2 class=Sh id=DIAGNOSTICS><a class=permalink href=#DIAGNOSTICS>DIAGNOSTICS</a></h2> In normal operation, <code class=Nm>ctm_smail</code> will report messages like: <div class="Bd Pp Bd-indent"><pre>
ctm_smail: src-cur.0250.gz 1/2 sent to src-guys
</pre></div><p class=Pp>or, if queueing,</p><div class="Bd Pp Bd-indent"><pre>
ctm_smail: src-cur.0250.gz 1/2 queued for src-guys
</pre></div><p class=Pp>The <code class=Nm>ctm_dequeue</code> utility will report messages like:</p><div class="Bd Pp Bd-indent"><pre>
ctm_dequeue: src-cur.0250.gz 1/2 sent
</pre></div><p class=Pp>The <code class=Nm>ctm_rmail</code> utility will report messages like:</p><div class="Bd Pp Bd-indent"><pre>
ctm_rmail: src-cur.0250.gz 1/2 stored
ctm_rmail: src-cur.0250.gz 2/2 stored
ctm_rmail: src-cur.0250.gz complete
</pre></div><p class=Pp>If any of the input files do not contain a valid delta piece, <code class=Nm>ctm_rmail</code> will report:</p><div class="Bd Pp Bd-indent"><pre>
ctm_rmail: message contains no delta
</pre></div><p class=Pp>and return an exit status of 1. You can use this to redirect wayward messages back into your real mailbox if your mail filter goes wonky.</p><p class=Pp>These messages go to <i class=Em>stderr</i> or to the log file. Messages from <a class=Xr href=ctm.1.html>ctm(1)</a> turn up here too. Error messages should be self explanatory.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=ctm.1.html>ctm(1)</a>, <a class=Xr href=ctm.5.html>ctm(5)</a></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2><span class=An>Stephen McKay</span> &lt;<a class=Mt href=mailto:mckay@FreeBSD.org>mckay@FreeBSD.org</a>&gt; </section></div><table class=foot><tr><td class=foot-date>January 24, 1995</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>