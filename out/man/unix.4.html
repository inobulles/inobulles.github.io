<!DOCTYPE html>
<html><head><meta charset=utf-8><title>unix(4)</title><keywords content=man,unix></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>unix(4)</h1><table class=head><tr><td class=head-ltitle>UNIX(4)</td><td class=head-vol>FreeBSD Kernel Interfaces Manual</td><td class=head-rtitle>UNIX(4)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>unix</code> — <div class=Nd>UNIX-domain protocol family</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/sys/un.h.html>sys/un.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <span class=Ux>UNIX</span>-domain protocol family is a collection of protocols that provides local (on-machine) interprocess communication through the normal <a class=Xr href=socket.2.html>socket(2)</a> mechanisms. The <span class=Ux>UNIX</span>-domain family supports the <code class=Dv>SOCK_STREAM</code>, <code class=Dv>SOCK_SEQPACKET</code>, and <code class=Dv>SOCK_DGRAM</code> socket types and uses file system pathnames for addressing. </section><section class=Sh><h2 class=Sh id=ADDRESSING><a class=permalink href=#ADDRESSING>ADDRESSING</a></h2><span class=Ux>UNIX</span>-domain addresses are variable-length file system pathnames of at most 104 characters. The include file <code class=In>&lt;<a class=In href=../src/sys/un.h.html>sys/un.h</a>&gt;</code> defines this address: <div class="Bd Pp Bd-indent"><pre>
struct sockaddr_un {
	u_char	sun_len;
	u_char	sun_family;
	char	sun_path[104];
};
</pre></div><p class=Pp>Binding a name to a <span class=Ux>UNIX</span>-domain socket with <a class=Xr href=bind.2.html>bind(2)</a> causes a socket file to be created in the file system. This file is <i class=Em>not</i> removed when the socket is closed — <a class=Xr href=unlink.2.html>unlink(2)</a> must be used to remove the file.</p><p class=Pp>The length of <span class=Ux>UNIX</span>-domain address, required by <a class=Xr href=bind.2.html>bind(2)</a> and <a class=Xr href=connect.2.html>connect(2)</a>, can be calculated by the macro <code class=Fn>SUN_LEN</code>() defined in <code class=In>&lt;<a class=In href=../src/sys/un.h.html>sys/un.h</a>&gt;</code>. The <var class=Va>sun_path</var> field must be terminated by a <code class=Dv>NUL</code> character to be used with <code class=Fn>SUN_LEN</code>(), but the terminating <code class=Dv>NUL</code> is <i class=Em>not</i> part of the address.</p><p class=Pp>The <span class=Ux>UNIX</span>-domain protocol family does not support broadcast addressing or any form of “wildcard” matching on incoming messages. All addresses are absolute- or relative-pathnames of other <span class=Ux>UNIX</span>-domain sockets. Normal file system access-control mechanisms are also applied when referencing pathnames; e.g., the destination of a <a class=Xr href=connect.2.html>connect(2)</a> or <a class=Xr href=sendto.2.html>sendto(2)</a> must be writable.</p></section><section class=Sh><h2 class=Sh id=CONTROL_MESSAGES><a class=permalink href=#CONTROL_MESSAGES>CONTROL MESSAGES</a></h2> The <span class=Ux>UNIX</span>-domain sockets support the communication of <span class=Ux>UNIX</span> file descriptors and process credentials through the use of the <var class=Va>msg_control</var> field in the <var class=Fa>msg</var> argument to <a class=Xr href=sendmsg.2.html>sendmsg(2)</a> and <a class=Xr href=recvmsg.2.html>recvmsg(2)</a>. The items to be passed are described using a <var class=Vt>struct cmsghdr</var> that is defined in the include file <code class=In>&lt;<a class=In href=../src/sys/socket.h.html>sys/socket.h</a>&gt;</code>. <p class=Pp>To send file descriptors, the type of the message is <code class=Dv>SCM_RIGHTS</code>, and the data portion of the messages is an array of integers representing the file descriptors to be passed. The number of descriptors being passed is defined by the length field of the message; the length field is the sum of the size of the header plus the size of the array of file descriptors.</p><p class=Pp>The received descriptor is a <i class=Em>duplicate</i> of the sender's descriptor, as if it were created via <code class=Li>dup(fd)</code> or <code class=Li>fcntl(fd, F_DUPFD_CLOEXEC, 0)</code> depending on whether <code class=Dv>MSG_CMSG_CLOEXEC</code> is passed in the <a class=Xr href=recvmsg.2.html>recvmsg(2)</a> call. Descriptors that are awaiting delivery, or that are purposely not received, are automatically closed by the system when the destination socket is closed.</p><p class=Pp>Credentials of the sending process can be transmitted explicitly using a control message of type <code class=Dv>SCM_CREDS</code> with a data portion of type <var class=Vt>struct cmsgcred</var>, defined in <code class=In>&lt;<a class=In href=../src/sys/socket.h.html>sys/socket.h</a>&gt;</code> as follows:</p><div class="Bd Pp"><pre>
struct cmsgcred {
  pid_t	cmcred_pid;		/* PID of sending process */
  uid_t	cmcred_uid;		/* real UID of sending process */
  uid_t	cmcred_euid;		/* effective UID of sending process */
  gid_t	cmcred_gid;		/* real GID of sending process */
  short	cmcred_ngroups;		/* number of groups */
  gid_t	cmcred_groups[CMGROUP_MAX];	/* groups */
};
</pre></div><p class=Pp>The sender should pass a zeroed buffer which will be filled in by the system.</p><p class=Pp>The group list is truncated to at most <code class=Dv>CMGROUP_MAX</code> GIDs.</p><p class=Pp>The process ID <var class=Fa>cmcred_pid</var> should not be looked up (such as via the <code class=Dv>KERN_PROC_PID</code> sysctl) for making security decisions. The sending process could have exited and its process ID already been reused for a new process.</p></section><section class=Sh><h2 class=Sh id=SOCKET_OPTIONS><a class=permalink href=#SOCKET_OPTIONS>SOCKET OPTIONS</a></h2> UNIX domain sockets support a number of socket options for the options level <code class=Dv>SOL_LOCAL</code>, which can be set with <a class=Xr href=setsockopt.2.html>setsockopt(2)</a> and tested with <a class=Xr href=getsockopt.2.html>getsockopt(2)</a>: <dl class=Bl-tag><dt><a class=permalink href=#LOCAL_CREDS><code class=Dv id=LOCAL_CREDS>LOCAL_CREDS</code></a></dt><dd>This option may be enabled on <code class=Dv>SOCK_DGRAM</code>, <code class=Dv>SOCK_SEQPACKET</code>, or a <code class=Dv>SOCK_STREAM</code> socket. This option provides a mechanism for the receiver to receive the credentials of the process calling <a class=Xr href=write.2.html>write(2)</a>, <a class=Xr href=send.2.html>send(2)</a>, <a class=Xr href=sendto.2.html>sendto(2)</a> or <a class=Xr href=sendmsg.2.html>sendmsg(2)</a> as a <a class=Xr href=recvmsg.2.html>recvmsg(2)</a> control message. The <var class=Va>msg_control</var> field in the <var class=Vt>msghdr</var> structure points to a buffer that contains a <var class=Vt>cmsghdr</var> structure followed by a variable length <var class=Vt>sockcred</var> structure, defined in <code class=In>&lt;<a class=In href=../src/sys/socket.h.html>sys/socket.h</a>&gt;</code> as follows: <div class="Bd Pp"><pre>
struct sockcred {
  uid_t	sc_uid;		/* real user id */
  uid_t	sc_euid;	/* effective user id */
  gid_t	sc_gid;		/* real group id */
  gid_t	sc_egid;	/* effective group id */
  int	sc_ngroups;	/* number of supplemental groups */
  gid_t	sc_groups[1];	/* variable length */
};
    </pre></div><p class=Pp>The current implementation truncates the group list to at most <code class=Dv>CMGROUP_MAX</code> groups.</p><p class=Pp>The <code class=Fn>SOCKCREDSIZE</code>() macro computes the size of the <var class=Vt>sockcred</var> structure for a specified number of groups. The <var class=Vt>cmsghdr</var> fields have the following values:</p><div class="Bd Pp"><pre>
cmsg_len = CMSG_LEN(SOCKCREDSIZE(ngroups))
cmsg_level = SOL_SOCKET
cmsg_type = SCM_CREDS
    </pre></div><p class=Pp>On <code class=Dv>SOCK_STREAM</code> and <code class=Dv>SOCK_SEQPACKET</code> sockets credentials are passed only on the first read from a socket, then the system clears the option on the socket.</p><p class=Pp>This option and the above explicit <var class=Vt>struct cmsgcred</var> both use the same value <code class=Dv>SCM_CREDS</code> but incompatible control messages. If this option is enabled and the sender attached a <code class=Dv>SCM_CREDS</code> control message with a <var class=Vt>struct cmsgcred</var>, it will be discarded and a <var class=Vt>struct sockcred</var> will be included.</p><p class=Pp>Many setuid programs will <a class=Xr href=write.2.html>write(2)</a> data at least partially controlled by the invoker, such as error messages. Therefore, a message accompanied by a particular <var class=Fa>sc_euid</var> value should not be trusted as being from that user.</p></dd><dt><a class=permalink href=#LOCAL_CREDS_PERSISTENT><code class=Dv id=LOCAL_CREDS_PERSISTENT>LOCAL_CREDS_PERSISTENT</code></a></dt><dd>This option is similar to <code class=Dv>LOCAL_CREDS</code>, except that socket credentials are passed on every read from a <code class=Dv>SOCK_STREAM</code> or <code class=Dv>SOCK_SEQPACKET</code> socket, instead of just the first read. Additionally, the <var class=Va>msg_control</var> field in the <var class=Vt>msghdr</var> structure points to a buffer that contains a <var class=Vt>cmsghdr</var> structure followed by a variable length <var class=Vt>sockcred2</var> structure, defined in <code class=In>&lt;<a class=In href=../src/sys/socket.h.html>sys/socket.h</a>&gt;</code> as follows: <div class="Bd Pp"><pre>
struct sockcred2 {
  int	sc_version;	/* version of this structure */
  pid_t	sc_pid;		/* PID of sending process */
  uid_t	sc_uid;		/* real user id */
  uid_t	sc_euid;	/* effective user id */
  gid_t	sc_gid;		/* real group id */
  gid_t	sc_egid;	/* effective group id */
  int	sc_ngroups;	/* number of supplemental groups */
  gid_t	sc_groups[1];	/* variable length */
};
    </pre></div><p class=Pp>The current version is zero.</p><p class=Pp>The <var class=Vt>cmsghdr</var> fields have the following values:</p><div class="Bd Pp"><pre>
cmsg_len = CMSG_LEN(SOCKCRED2SIZE(ngroups))
cmsg_level = SOL_SOCKET
cmsg_type = SCM_CREDS2
    </pre></div><p class=Pp>The <code class=Dv>LOCAL_CREDS</code> and <code class=Dv>LOCAL_CREDS_PERSISTENT</code> options are mutually exclusive.</p></dd><dt><a class=permalink href=#LOCAL_CONNWAIT><code class=Dv id=LOCAL_CONNWAIT>LOCAL_CONNWAIT</code></a></dt><dd>Used with <code class=Dv>SOCK_STREAM</code> sockets, this option causes the <a class=Xr href=connect.2.html>connect(2)</a> function to block until <a class=Xr href=accept.2.html>accept(2)</a> has been called on the listening socket.</dd><dt><a class=permalink href=#LOCAL_PEERCRED><code class=Dv id=LOCAL_PEERCRED>LOCAL_PEERCRED</code></a></dt><dd>Requested via <a class=Xr href=getsockopt.2.html>getsockopt(2)</a> on a <code class=Dv>SOCK_STREAM</code> or <code class=Dv>SOCK_SEQPACKET</code> socket returns credentials of the remote side. These will arrive in the form of a filled in <var class=Vt>xucred</var> structure, defined in <code class=In>&lt;<a class=In href=../src/sys/ucred.h.html>sys/ucred.h</a>&gt;</code> as follows: <div class="Bd Pp"><pre>
struct xucred {
  u_int	cr_version;		/* structure layout version */
  uid_t	cr_uid;			/* effective user id */
  short	cr_ngroups;		/* number of groups */
  gid_t	cr_groups[XU_NGROUPS];	/* groups */
  pid_t	cr_pid;			/* process id of the sending process */
};
    </pre></div> The <var class=Vt>cr_version</var> fields should be checked against <code class=Dv>XUCRED_VERSION</code> define. <p class=Pp>The credentials presented to the server (the <a class=Xr href=listen.2.html>listen(2)</a> caller) are those of the client when it called <a class=Xr href=connect.2.html>connect(2)</a>; the credentials presented to the client (the <a class=Xr href=connect.2.html>connect(2)</a> caller) are those of the server when it called <a class=Xr href=listen.2.html>listen(2)</a>. This mechanism is reliable; there is no way for either party to influence the credentials presented to its peer except by calling the appropriate system call (e.g., <a class=Xr href=connect.2.html>connect(2)</a> or <a class=Xr href=listen.2.html>listen(2)</a>) under different effective credentials.</p><p class=Pp>To reliably obtain peer credentials on a <code class=Dv>SOCK_DGRAM</code> socket refer to the <code class=Dv>LOCAL_CREDS</code> socket option.</p></dd></dl></section><section class=Sh><h2 class=Sh id=BUFFERING><a class=permalink href=#BUFFERING>BUFFERING</a></h2> Due to the local nature of the <span class=Ux>UNIX</span>-domain sockets, they do not implement send buffers. The <a class=Xr href=send.2.html>send(2)</a> and <a class=Xr href=write.2.html>write(2)</a> families of system calls attempt to write data to the receive buffer of the destination socket. <p class=Pp>The default buffer sizes for <code class=Dv>SOCK_STREAM</code> and <code class=Dv>SOCK_SEQPACKET</code><span class=Ux>UNIX</span>-domain sockets can be configured with <var class=Va>net.local.stream</var> and <var class=Va>net.local.seqpacket</var> branches of <a class=Xr href=sysctl.3.html>sysctl(3)</a> MIB respectively. Note that setting the send buffer size (sendspace) affects only the maximum write size.</p><p class=Pp>The <span class=Ux>UNIX</span>-domain sockets of type <code class=Dv>SOCK_DGRAM</code> are unreliable and always non-blocking for write operations. The default receive buffer can be configured with <var class=Va>net.local.dgram.recvspace</var>. The maximum allowed datagram size is limited by <var class=Va>net.local.dgram.maxdgram</var>. A <code class=Dv>SOCK_DGRAM</code> socket that has been bound with <a class=Xr href=bind.2.html>bind(2)</a> can have multiple peers connected at the same time. The modern <span class=Ux>FreeBSD</span> implementation will allocate <var class=Va>net.local.dgram.recvspace</var> sized private buffers in the receive buffer of the bound socket for every connected socket, preventing a situation when a single writer can exhaust all of buffer space. Messages coming from unconnected sends using <a class=Xr href=sendto.2.html>sendto(2)</a> land on the shared buffer of the receiving socket, which has the same size limit. A side effect of the implementation is that it doesn't guarantee that writes from different senders will arrive at the receiver in the same chronological order they were sent. The order is preserved for writes coming through a particular connection.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=connect.2.html>connect(2)</a>, <a class=Xr href=dup.2.html>dup(2)</a>, <a class=Xr href=fcntl.2.html>fcntl(2)</a>, <a class=Xr href=getsockopt.2.html>getsockopt(2)</a>, <a class=Xr href=listen.2.html>listen(2)</a>, <a class=Xr href=recvmsg.2.html>recvmsg(2)</a>, <a class=Xr href=sendto.2.html>sendto(2)</a>, <a class=Xr href=setsockopt.2.html>setsockopt(2)</a>, <a class=Xr href=socket.2.html>socket(2)</a>, <a class=Xr href=CMSG_DATA.3.html>CMSG_DATA(3)</a>, <a class=Xr href=intro.4.html>intro(4)</a>, <a class=Xr href=sysctl.8.html>sysctl(8)</a><p class=Pp><cite class=Rs><span class=RsT>An Introductory 4.3 BSD Interprocess Communication Tutorial</span>, <i class=RsB>PS1</i>, <span class=RsN>7</span>.</cite></p><p class=Pp><cite class=Rs><span class=RsT>An Advanced 4.3 BSD Interprocess Communication Tutorial</span>, <i class=RsB>PS1</i>, <span class=RsN>8</span>.</cite></p></section></div><table class=foot><tr><td class=foot-date>June 24, 2022</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>