<!DOCTYPE html>
<html><head><meta charset=utf-8><title>link(5)</title><keywords content=man,link></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>link(5)</h1><table class=head><tr><td class=head-ltitle>LINK(5)</td><td class=head-vol>FreeBSD File Formats Manual</td><td class=head-rtitle>LINK(5)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>link</code> — <div class=Nd>dynamic loader and link editor interface</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/types.h.html>sys/types.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/nlist.h.html>nlist.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/link.h.html>link.h</a>&gt;</code></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The include file <code class=In>&lt;<a class=In href=../src/link.h.html>link.h</a>&gt;</code> declares several structures that are present in dynamically linked programs and libraries. The structures define the interface between several components of the link-editor and loader mechanism. The layout of a number of these structures within the binaries resembles the a.out format in many places as it serves such similar functions as symbol definitions (including the accompanying string table) and relocation records needed to resolve references to external entities. It also records a number of data structures unique to the dynamic loading and linking process. These include references to other objects that are required to complete the link-editing process and indirection tables to facilitate <i class=Em>Position Independent Code</i> (PIC for short) to improve sharing of code pages among different processes. The collection of data structures described here will be referred to as the <i class=Em>Run-time Relocation Section (RRS)</i> and is embedded in the standard text and data segments of the dynamically linked program or shared object image as the existing <a class=Xr href=a.out.5.html>a.out(5)</a> format offers no room for it elsewhere. <p class=Pp>Several utilities cooperate to ensure that the task of getting a program ready to run can complete successfully in a way that optimizes the use of system resources. The compiler emits PIC code from which shared libraries can be built by <a class=Xr href=ld.1.html>ld(1)</a>. The compiler also includes size information of any initialized data items through the .size assembler directive. PIC code differs from conventional code in that it accesses data variables through an indirection table, the Global Offset Table, by convention accessible by the reserved name <code class=Dv>_GLOBAL_OFFSET_TABLE_</code>. The exact mechanism used for this is machine dependent, usually a machine register is reserved for the purpose. The rational behind this construct is to generate code that is independent of the actual load address. Only the values contained in the Global Offset Table may need updating at run-time depending on the load addresses of the various shared objects in the address space.</p><p class=Pp>Likewise, procedure calls to globally defined functions are redirected through the Procedure Linkage Table (PLT) residing in the data segment of the core image. Again, this is done to avoid run-time modifications to the text segment.</p><p class=Pp>The linker-editor allocates the Global Offset Table and Procedure Linkage Table when combining PIC object files into an image suitable for mapping into the process address space. It also collects all symbols that may be needed by the run-time link-editor and stores these along with the image's text and data bits. Another reserved symbol, <i class=Em>_DYNAMIC</i> is used to indicate the presence of the run-time linker structures. Whenever _DYNAMIC is relocated to 0, there is no need to invoke the run-time link-editor. If this symbol is non-zero, it points at a data structure from which the location of the necessary relocation- and symbol information can be derived. This is most notably used by the start-up module, <i class=Em>crt0</i>. The _DYNAMIC structure is conventionally located at the start of the data segment of the image to which it pertains.</p></section><section class=Sh><h2 class=Sh id=DATA_STRUCTURES><a class=permalink href=#DATA_STRUCTURES>DATA STRUCTURES</a></h2> The data structures supporting dynamic linking and run-time relocation reside both in the text and data segments of the image they apply to. The text segments contain read-only data such as symbols descriptions and names, while the data segments contain the tables that need to be modified by during the relocation process. <p class=Pp>The _DYNAMIC symbol references a <var class=Fa>_dynamic</var> structure:</p><div class="Bd Pp Bd-indent"><pre>
struct	_dynamic {
	int	d_version;
	struct 	so_debug *d_debug;
	union {
		struct section_dispatch_table *d_sdt;
	} d_un;
	struct  ld_entry *d_entry;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>d_version</var></dt><dd>This field provides for different versions of the dynamic linking implementation. The current version numbers understood by <a class=Xr href=ld.1.html>ld(1)</a> and <a class=Xr href=ld.so.1.html>ld.so(1)</a> are <i class=Em>LD_VERSION_SUN (3)</i>, which is used by the SunOS 4.x releases, and <i class=Em>LD_VERSION_BSD (8)</i>, which has been in use since <span class=Ux>FreeBSD 1.1</span>.</dd><dt><var class=Fa>d_un</var></dt><dd>Refers to a <i class=Em>d_version</i> dependent data structure.</dd><dt><var class=Fa>so_debug</var></dt><dd>this field provides debuggers with a hook to access symbol tables of shared objects loaded as a result of the actions of the run-time link-editor.</dd></dl><p class=Pp>The <var class=Fa>section_dispatch_table</var> structure is the main “dispatcher” table, containing offsets into the image's segments where various symbol and relocation information is located.</p><div class="Bd Pp Bd-indent"><pre>
struct section_dispatch_table {
	struct	so_map *sdt_loaded;
	long	sdt_sods;
	long	sdt_filler1;
	long	sdt_got;
	long	sdt_plt;
	long	sdt_rel;
	long	sdt_hash;
	long	sdt_nzlist;
	long	sdt_filler2;
	long	sdt_buckets;
	long	sdt_strings;
	long	sdt_str_sz;
	long	sdt_text_sz;
	long	sdt_plt_sz;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>sdt_loaded</var></dt><dd>A pointer to the first link map loaded (see below). This field is set by <code class=Nm>ld.so</code></dd><dt><var class=Fa>sdt_sods</var></dt><dd>The start of a (linked) list of shared object descriptors needed by <i class=Em>this</i> object.</dd><dt><var class=Fa>sdt_filler1</var></dt><dd>Deprecated (used by SunOS to specify library search rules).</dd><dt><var class=Fa>sdt_got</var></dt><dd>The location of the Global Offset Table within this image.</dd><dt><var class=Fa>sdt_plt</var></dt><dd>The location of the Procedure Linkage Table within this image.</dd><dt><var class=Fa>sdt_rel</var></dt><dd>The location of an array of <var class=Fa>relocation_info</var> structures (see <a class=Xr href=a.out.5.html>a.out(5)</a>) specifying run-time relocations.</dd><dt><var class=Fa>sdt_hash</var></dt><dd>The location of the hash table for fast symbol lookup in this object's symbol table.</dd><dt><var class=Fa>sdt_nzlist</var></dt><dd>The location of the symbol table.</dd><dt><var class=Fa>sdt_filler2</var></dt><dd>Currently unused.</dd><dt><var class=Fa>sdt_buckets</var></dt><dd>The number of buckets in <var class=Fa>sdt_hash</var></dd><dt><var class=Fa>sdt_strings</var></dt><dd>The location of the symbol string table that goes with <var class=Fa>sdt_nzlist</var>.</dd><dt><var class=Fa>sdt_str_sz</var></dt><dd>The size of the string table.</dd><dt><var class=Fa>sdt_text_sz</var></dt><dd>The size of the object's text segment.</dd><dt><var class=Fa>sdt_plt_sz</var></dt><dd>The size of the Procedure Linkage Table.</dd></dl><p class=Pp>A <var class=Fa>sod</var> structure describes a shared object that is needed to complete the link edit process of the object containing it. A list of such objects (chained through <var class=Fa>sod_next</var>) is pointed at by the <var class=Fa>sdt_sods</var> in the section_dispatch_table structure.</p><div class="Bd Pp Bd-indent"><pre>
struct sod {
	long	sod_name;
	u_int	sod_library : 1,
		sod_reserved : 31;
	short	sod_major;
	short	sod_minor;
	long	sod_next;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>sod_name</var></dt><dd>The offset in the text segment of a string describing this link object.</dd><dt><var class=Fa>sod_library</var></dt><dd>If set, <var class=Fa>sod_name</var> specifies a library that is to be searched for by <code class=Nm>ld.so</code>. The path name is obtained by searching a set of directories (see also <a class=Xr href=ldconfig.8.html>ldconfig(8)</a>) for a shared object matching <i class=Em>lib&lt;sod_name&gt;.so.n.m</i>. If not set, <var class=Fa>sod_name</var> should point at a full path name for the desired shared object.</dd><dt><var class=Fa>sod_major</var></dt><dd>Specifies the major version number of the shared object to load.</dd><dt><var class=Fa>sod_minor</var></dt><dd>Specifies the preferred minor version number of the shared object to load.</dd></dl><p class=Pp>The run-time link-editor maintains a list of structures called <i class=Em>link maps</i> to keep track of all shared objects loaded into a process' address space. These structures are only used at run-time and do not occur within the text or data segment of an executable or shared library.</p><div class="Bd Pp Bd-indent"><pre>
struct so_map {
	caddr_t	som_addr;
	char 	*som_path;
	struct	so_map *som_next;
	struct	sod *som_sod;
	caddr_t som_sodbase;
	u_int	som_write : 1;
	struct	_dynamic *som_dynamic;
	caddr_t	som_spd;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>som_addr</var></dt><dd>The address at which the shared object associated with this link map has been loaded.</dd><dt><var class=Fa>som_path</var></dt><dd>The full path name of the loaded object.</dd><dt><var class=Fa>som_next</var></dt><dd>Pointer to the next link map.</dd><dt><var class=Fa>som_sod</var></dt><dd>The <var class=Fa>sod</var> structure that was responsible for loading this shared object.</dd><dt><var class=Fa>som_sodbase</var></dt><dd>Tossed out in later versions of the run-time linker.</dd><dt><var class=Fa>som_write</var></dt><dd>Set if (some portion of) this object's text segment is currently writable.</dd><dt><var class=Fa>som_dynamic</var></dt><dd>Pointer to this object's <var class=Fa>_dynamic</var> structure.</dd><dt><var class=Fa>som_spd</var></dt><dd>Hook for attaching private data maintained by the run-time link-editor.</dd></dl><p class=Pp>Symbol description with size. This is simply an <var class=Fa>nlist</var> structure with one field (<var class=Fa>nz_size</var>) added. Used to convey size information on items in the data segment of shared objects. An array of these lives in the shared object's text segment and is addressed by the <var class=Fa>sdt_nzlist</var> field of <var class=Fa>section_dispatch_table</var>.</p><div class="Bd Pp Bd-indent"><pre>
struct nzlist {
	struct nlist	nlist;
	u_long		nz_size;
#define nz_un		nlist.n_un
#define nz_strx		nlist.n_un.n_strx
#define nz_name		nlist.n_un.n_name
#define nz_type		nlist.n_type
#define nz_value	nlist.n_value
#define nz_desc		nlist.n_desc
#define nz_other	nlist.n_other
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>nlist</var></dt><dd>(see <a class=Xr href=nlist.3.html>nlist(3)</a>).</dd><dt><var class=Fa>nz_size</var></dt><dd>The size of the data represented by this symbol.</dd></dl><p class=Pp>A hash table is included within the text segment of shared object to facilitate quick lookup of symbols during run-time link-editing. The <var class=Fa>sdt_hash</var> field of the <var class=Fa>section_dispatch_table</var> structure points at an array of <var class=Fa>rrs_hash</var> structures:</p><div class="Bd Pp Bd-indent"><pre>
struct rrs_hash {
	int	rh_symbolnum;		/* symbol number */
	int	rh_next;		/* next hash entry */
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>rh_symbolnum</var></dt><dd>The index of the symbol in the shared object's symbol table (as given by the <var class=Fa>ld_symbols</var> field).</dd><dt><var class=Fa>rh_next</var></dt><dd>In case of collisions, this field is the offset of the next entry in this hash table bucket. It is zero for the last bucket element.</dd></dl> The <var class=Fa>rt_symbol</var> structure is used to keep track of run-time allocated commons and data items copied from shared objects. These items are kept on linked list and is exported through the <var class=Fa>dd_cc</var> field in the <var class=Fa>so_debug</var> structure (see below) for use by debuggers. <div class="Bd Pp Bd-indent"><pre>
struct rt_symbol {
	struct nzlist		*rt_sp;
	struct rt_symbol	*rt_next;
	struct rt_symbol	*rt_link;
	caddr_t			rt_srcaddr;
	struct so_map		*rt_smp;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>rt_sp</var></dt><dd>The symbol description.</dd><dt><var class=Fa>rt_next</var></dt><dd>Virtual address of next rt_symbol.</dd><dt><var class=Fa>rt_link</var></dt><dd>Next in hash bucket. Used internally by <code class=Nm>ld.so</code>.</dd><dt><var class=Fa>rt_srcaddr</var></dt><dd>Location of the source of initialized data within a shared object.</dd><dt><var class=Fa>rt_smp</var></dt><dd>The shared object which is the original source of the data that this run-time symbol describes.</dd></dl><p class=Pp>The <var class=Fa>so_debug</var> structure is used by debuggers to gain knowledge of any shared objects that have been loaded in the process's address space as a result of run-time link-editing. Since the run-time link-editor runs as a part of process initialization, a debugger that wishes to access symbols from shared objects can only do so after the link-editor has been called from crt0. A dynamically linked binary contains a <var class=Fa>so_debug</var> structure which can be located by means of the <var class=Fa>d_debug</var> field in <var class=Fa>_dynamic</var>.</p><div class="Bd Pp Bd-indent"><pre>
struct 	so_debug {
	int	dd_version;
	int	dd_in_debugger;
	int	dd_sym_loaded;
	char    *dd_bpt_addr;
	int	dd_bpt_shadow;
	struct rt_symbol *dd_cc;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>dd_version</var></dt><dd>Version number of this interface.</dd><dt><var class=Fa>dd_in_debugger</var></dt><dd>Set by the debugger to indicate to the run-time linker that the program is run under control of a debugger.</dd><dt><var class=Fa>dd_sym_loaded</var></dt><dd>Set by the run-time linker whenever it adds symbols by loading shared objects.</dd><dt><var class=Fa>dd_bpt_addr</var></dt><dd>The address where a breakpoint will be set by the run-time linker to divert control to the debugger. This address is determined by the start-up module, <span class=Pa>crt0.o</span>, to be some convenient place before the call to _main.</dd><dt><var class=Fa>dd_bpt_shadow</var></dt><dd>Contains the original instruction that was at <var class=Fa>dd_bpt_addr</var>. The debugger is expected to put this instruction back before continuing the program.</dd><dt><var class=Fa>dd_cc</var></dt><dd>A pointer to the linked list of run-time allocated symbols that the debugger may be interested in.</dd></dl><p class=Pp>The <i class=Em>ld_entry</i> structure defines a set of service routines within <code class=Nm>ld.so</code>.</p><div class="Bd Pp Bd-indent"><pre>
struct ld_entry {
	void	*(*dlopen)(char *, int);
	int	(*dlclose)(void *);
	void	*(*dlsym)(void *, char *);
	char	*(*dlerror)(void);
};
</pre></div><p class=Pp>The <var class=Fa>crt_ldso</var> structure defines the interface between the start-up code in crt0 and <code class=Nm>ld.so</code>.</p><div class="Bd Pp Bd-indent"><pre>
struct crt_ldso {
	int		crt_ba;
	int		crt_dzfd;
	int		crt_ldfd;
	struct _dynamic	*crt_dp;
	char		**crt_ep;
	caddr_t		crt_bp;
	char		*crt_prog;
	char		*crt_ldso;
	struct ld_entry	*crt_ldentry;
};
#define CRT_VERSION_SUN		1
#define CRT_VERSION_BSD_2	2
#define CRT_VERSION_BSD_3	3
#define	CRT_VERSION_BSD_4	4
</pre></div><dl class=Bl-tag><dt><var class=Fa>crt_ba</var></dt><dd>The virtual address at which <code class=Nm>ld.so</code> was loaded by crt0.</dd><dt><var class=Fa>crt_dzfd</var></dt><dd>On SunOS systems, this field contains an open file descriptor to “<span class=Pa>/dev/zero</span>” used to get demand paged zeroed pages. On <span class=Ux>FreeBSD</span> systems it contains -1.</dd><dt><var class=Fa>crt_ldfd</var></dt><dd>Contains an open file descriptor that was used by crt0 to load <code class=Nm>ld.so</code>.</dd><dt><var class=Fa>crt_dp</var></dt><dd>A pointer to main's <var class=Fa>_dynamic</var> structure.</dd><dt><var class=Fa>crt_ep</var></dt><dd>A pointer to the environment strings.</dd><dt><var class=Fa>crt_bp</var></dt><dd>The address at which a breakpoint will be placed by the run-time linker if the main program is run by a debugger. See <var class=Fa>so_debug</var></dd><dt><var class=Fa>crt_prog</var></dt><dd>The name of the main program as determined by crt0 (CRT_VERSION_BSD3 only).</dd><dt><var class=Fa>crt_ldso</var></dt><dd>The path of the run-time linker as mapped by crt0 (CRT_VERSION_BSD4 only).</dd></dl><p class=Pp>The <var class=Fa>hints_header</var> and <var class=Fa>hints_bucket</var> structures define the layout of the library hints, normally found in “<span class=Pa>/var/run/ld.so.hints</span>”, which is used by <code class=Nm>ld.so</code> to quickly locate the shared object images in the file system. The organization of the hints file is not unlike that of an “a.out” object file, in that it contains a header determining the offset and size of a table of fixed sized hash buckets and a common string pool.</p><div class="Bd Pp Bd-indent"><pre>
struct hints_header {
	long		hh_magic;
#define HH_MAGIC	011421044151
	long		hh_version;
#define LD_HINTS_VERSION_1	1
	long		hh_hashtab;
	long		hh_nbucket;
	long		hh_strtab;
	long		hh_strtab_sz;
	long		hh_ehints;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>hh_magic</var></dt><dd>Hints file magic number.</dd><dt><var class=Fa>hh_version</var></dt><dd>Interface version number.</dd><dt><var class=Fa>hh_hashtab</var></dt><dd>Offset of hash table.</dd><dt><var class=Fa>hh_strtab</var></dt><dd>Offset of string table.</dd><dt><var class=Fa>hh_strtab_sz</var></dt><dd>Size of strings.</dd><dt><var class=Fa>hh_ehints</var></dt><dd>Maximum usable offset in hints file.</dd></dl><div class="Bd Pp Bd-indent"><pre>
/*
 * Hash table element in hints file.
 */
struct hints_bucket {
	int		hi_namex;
	int		hi_pathx;
	int		hi_dewey[MAXDEWEY];
	int		hi_ndewey;
#define hi_major hi_dewey[0]
#define hi_minor hi_dewey[1]
	int		hi_next;
};
</pre></div><dl class=Bl-tag><dt><var class=Fa>hi_namex</var></dt><dd>Index of the string identifying the library.</dd><dt><var class=Fa>hi_pathx</var></dt><dd>Index of the string representing the full path name of the library.</dd><dt><var class=Fa>hi_dewey</var></dt><dd>The version numbers of the shared library.</dd><dt><var class=Fa>hi_ndewey</var></dt><dd>The number of valid entries in <var class=Fa>hi_dewey</var>.</dd><dt><var class=Fa>hi_next</var></dt><dd>Next bucket in case of hashing collisions.</dd></dl></section><section class=Sh><h2 class=Sh id=CAVEATS><a class=permalink href=#CAVEATS>CAVEATS</a></h2> Only the (GNU) C compiler currently supports the creation of shared libraries. Other programming languages cannot be used. </section></div><table class=foot><tr><td class=foot-date>October 23, 1993</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>