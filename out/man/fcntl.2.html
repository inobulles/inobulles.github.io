<!DOCTYPE html>
<html><head><meta charset=utf-8><title>fcntl(2)</title><keywords content=man,fcntl></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>fcntl(2)</h1><table class=head><tr><td class=head-ltitle>FCNTL(2)</td><td class=head-vol>FreeBSD System Calls Manual</td><td class=head-rtitle>FCNTL(2)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>fcntl</code> — <div class=Nd>file control</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>Standard C Library (libc, -lc)</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/fcntl.h.html>fcntl.h</a>&gt;</code><p class=Pp><var class=Ft>int</var><br><code class=Fn>fcntl</code>(<var class=Fa style="white-space: nowrap;">int fd</var>, <var class=Fa style="white-space: nowrap;">int cmd</var>, <var class=Fa style="white-space: nowrap;">...</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Fn>fcntl</code>() system call provides for control over descriptors. The argument <var class=Fa>fd</var> is a descriptor to be operated on by <var class=Fa>cmd</var> as described below. Depending on the value of <var class=Fa>cmd</var>, <code class=Fn>fcntl</code>() can take an additional third argument <var class=Fa>arg</var>. Unless otherwise noted below for a specific operation, <var class=Fa>arg</var> has type <var class=Vt>int</var>. <dl class=Bl-tag><dt><a class=permalink href=#F_DUPFD><code class=Dv id=F_DUPFD>F_DUPFD</code></a></dt><dd>Return a new descriptor as follows: <p class=Pp></p><ul class="Bl-bullet Bd-indent Bl-compact"><li>Lowest numbered available descriptor greater than or equal to <var class=Fa>arg</var>.</li><li>Same object references as the original descriptor.</li><li>New descriptor shares the same file offset if the object was a file.</li><li>Same access mode (read, write or read/write).</li><li>Same file status flags (i.e., both file descriptors share the same file status flags).</li><li>The close-on-exec flag <code class=Dv>FD_CLOEXEC</code> associated with the new file descriptor is cleared, so the file descriptor is to remain open across <a class=Xr href=execve.2.html>execve(2)</a> system calls.</li></ul></dd><dt><a class=permalink href=#F_DUPFD_CLOEXEC><code class=Dv id=F_DUPFD_CLOEXEC>F_DUPFD_CLOEXEC</code></a></dt><dd>Like <code class=Dv>F_DUPFD</code>, but the <code class=Dv>FD_CLOEXEC</code> flag associated with the new file descriptor is set, so the file descriptor is closed when <a class=Xr href=execve.2.html>execve(2)</a> system call executes.</dd><dt><a class=permalink href=#F_DUP2FD><code class=Dv id=F_DUP2FD>F_DUP2FD</code></a></dt><dd>It is functionally equivalent to <div class="Bd Pp Bd-indent"><pre>
dup2(fd, arg)
    </pre></div></dd><dt><a class=permalink href=#F_DUP2FD_CLOEXEC><code class=Dv id=F_DUP2FD_CLOEXEC>F_DUP2FD_CLOEXEC</code></a></dt><dd>Like <code class=Dv>F_DUP2FD</code>, but the <code class=Dv>FD_CLOEXEC</code> flag associated with the new file descriptor is set. <p class=Pp>The <code class=Dv>F_DUP2FD</code> and <code class=Dv>F_DUP2FD_CLOEXEC</code> constants are not portable, so they should not be used if portability is needed. Use <code class=Fn>dup2</code>() instead of <code class=Dv>F_DUP2FD</code>.</p></dd><dt><a class=permalink href=#F_GETFD><code class=Dv id=F_GETFD>F_GETFD</code></a></dt><dd>Get the close-on-exec flag associated with the file descriptor <var class=Fa>fd</var> as <code class=Dv>FD_CLOEXEC</code>. If the returned value ANDed with <code class=Dv>FD_CLOEXEC</code> is 0, the file will remain open across <code class=Fn>exec</code>(), otherwise the file will be closed upon execution of <code class=Fn>exec</code>() (<var class=Fa>arg</var> is ignored).</dd><dt><a class=permalink href=#F_SETFD><code class=Dv id=F_SETFD>F_SETFD</code></a></dt><dd>Set the close-on-exec flag associated with <var class=Fa>fd</var> to <var class=Fa>arg</var>, where <var class=Fa>arg</var> is either 0 or <code class=Dv>FD_CLOEXEC</code>, as described above.</dd><dt><a class=permalink href=#F_GETFL><code class=Dv id=F_GETFL>F_GETFL</code></a></dt><dd>Get descriptor status flags, as described below (<var class=Fa>arg</var> is ignored).</dd><dt><a class=permalink href=#F_SETFL><code class=Dv id=F_SETFL>F_SETFL</code></a></dt><dd>Set descriptor status flags to <var class=Fa>arg</var>.</dd><dt><a class=permalink href=#F_GETOWN><code class=Dv id=F_GETOWN>F_GETOWN</code></a></dt><dd>Get the process ID or process group currently receiving <code class=Dv>SIGIO</code> and <code class=Dv>SIGURG</code> signals; process groups are returned as negative values (<var class=Fa>arg</var> is ignored).</dd><dt><a class=permalink href=#F_SETOWN><code class=Dv id=F_SETOWN>F_SETOWN</code></a></dt><dd>Set the process or process group to receive <code class=Dv>SIGIO</code> and <code class=Dv>SIGURG</code> signals; process groups are specified by supplying <var class=Fa>arg</var> as negative, otherwise <var class=Fa>arg</var> is interpreted as a process ID.</dd><dt><a class=permalink href=#F_READAHEAD><code class=Dv id=F_READAHEAD>F_READAHEAD</code></a></dt><dd>Set or clear the read ahead amount for sequential access to the third argument, <var class=Fa>arg</var>, which is rounded up to the nearest block size. A zero value in <var class=Fa>arg</var> turns off read ahead, a negative value restores the system default.</dd><dt><a class=permalink href=#F_RDAHEAD><code class=Dv id=F_RDAHEAD>F_RDAHEAD</code></a></dt><dd>Equivalent to Darwin counterpart which sets read ahead amount of 128KB when the third argument, <var class=Fa>arg</var> is non-zero. A zero value in <var class=Fa>arg</var> turns off read ahead.</dd><dt><a class=permalink href=#F_ADD_SEALS><code class=Dv id=F_ADD_SEALS>F_ADD_SEALS</code></a></dt><dd>Add seals to the file as described below, if the underlying filesystem supports seals.</dd><dt><a class=permalink href=#F_GET_SEALS><code class=Dv id=F_GET_SEALS>F_GET_SEALS</code></a></dt><dd>Get seals associated with the file, if the underlying filesystem supports seals.</dd><dt><a class=permalink href=#F_ISUNIONSTACK><code class=Dv id=F_ISUNIONSTACK>F_ISUNIONSTACK</code></a></dt><dd>Check if the vnode is part of a union stack (either the "union" flag from <a class=Xr href=mount.2.html>mount(2)</a> or unionfs). This is a hack not intended to be used outside of libc.</dd><dt><a class=permalink href=#F_KINFO><code class=Dv id=F_KINFO>F_KINFO</code></a></dt><dd>Fills a <var class=Vt>struct kinfo_file</var> for the file referenced by the specified file descriptor. The <var class=Fa>arg</var> argument should point to the storage for <var class=Vt>struct kinfo_file</var>. The <var class=Va>kf_structsize</var> member of the passed structure must be initialized with the sizeof of <var class=Vt>struct kinfo_file</var>, to allow for the interface versioning and evolution.</dd></dl><p class=Pp>The flags for the <code class=Dv>F_GETFL</code> and <code class=Dv>F_SETFL</code> commands are as follows:</p><dl class=Bl-tag><dt><a class=permalink href=#O_NONBLOCK><code class=Dv id=O_NONBLOCK>O_NONBLOCK</code></a></dt><dd>Non-blocking I/O; if no data is available to a <a class=Xr href=read.2.html>read(2)</a> system call, or if a <a class=Xr href=write.2.html>write(2)</a> operation would block, the read or write call returns -1 with the error <code class=Er>EAGAIN</code>.</dd><dt><a class=permalink href=#O_APPEND><code class=Dv id=O_APPEND>O_APPEND</code></a></dt><dd>Force each write to append at the end of file; corresponds to the <code class=Dv>O_APPEND</code> flag of <a class=Xr href=open.2.html>open(2)</a>.</dd><dt><a class=permalink href=#O_DIRECT><code class=Dv id=O_DIRECT>O_DIRECT</code></a></dt><dd>Minimize or eliminate the cache effects of reading and writing. The system will attempt to avoid caching the data you read or write. If it cannot avoid caching the data, it will minimize the impact the data has on the cache. Use of this flag can drastically reduce performance if not used with care.</dd><dt><a class=permalink href=#O_ASYNC><code class=Dv id=O_ASYNC>O_ASYNC</code></a></dt><dd>Enable the <code class=Dv>SIGIO</code> signal to be sent to the process group when I/O is possible, e.g., upon availability of data to be read.</dd><dt><a class=permalink href=#O_SYNC><code class=Dv id=O_SYNC>O_SYNC</code></a></dt><dd>Enable synchronous writes. Corresponds to the <code class=Dv>O_SYNC</code> flag of <a class=Xr href=open.2.html>open(2)</a>. <code class=Dv>O_FSYNC</code> is an historical synonym for <code class=Dv>O_SYNC</code>.</dd><dt><a class=permalink href=#O_DSYNC><code class=Dv id=O_DSYNC>O_DSYNC</code></a></dt><dd>Enable synchronous data writes. Corresponds to the <code class=Dv>O_DSYNC</code> flag of <a class=Xr href=open.2.html>open(2)</a>.</dd></dl><p class=Pp>The seals that may be applied with <code class=Dv>F_ADD_SEALS</code> are as follows:</p><dl class=Bl-tag><dt><a class=permalink href=#F_SEAL_SEAL><code class=Dv id=F_SEAL_SEAL>F_SEAL_SEAL</code></a></dt><dd>Prevent any further seals from being applied to the file.</dd><dt><a class=permalink href=#F_SEAL_SHRINK><code class=Dv id=F_SEAL_SHRINK>F_SEAL_SHRINK</code></a></dt><dd>Prevent the file from being shrunk with <a class=Xr href=ftruncate.2.html>ftruncate(2)</a>.</dd><dt><a class=permalink href=#F_SEAL_GROW><code class=Dv id=F_SEAL_GROW>F_SEAL_GROW</code></a></dt><dd>Prevent the file from being enlarged with <a class=Xr href=ftruncate.2.html>ftruncate(2)</a>.</dd><dt><a class=permalink href=#F_SEAL_WRITE><code class=Dv id=F_SEAL_WRITE>F_SEAL_WRITE</code></a></dt><dd>Prevent any further <a class=Xr href=write.2.html>write(2)</a> calls to the file. Any writes in progress will finish before <code class=Fn>fcntl</code>() returns. If any writeable mappings exist, F_ADD_SEALS will fail and return <code class=Dv>EBUSY</code>.</dd></dl><p class=Pp>Seals are on a per-inode basis and require support by the underlying filesystem. If the underlying filesystem does not support seals, <code class=Dv>F_ADD_SEALS</code> and <code class=Dv>F_GET_SEALS</code> will fail and return <code class=Dv>EINVAL</code>.</p><p class=Pp>Several operations are available for doing advisory file locking; they all operate on the following structure:</p><div class="Bd Pp"><pre>
struct flock {
	off_t	l_start;	/* starting offset */
	off_t	l_len;		/* len = 0 means until end of file */
	pid_t	l_pid;		/* lock owner */
	short	l_type;		/* lock type: read/write, etc. */
	short	l_whence;	/* type of l_start */
	int	l_sysid;	/* remote system id or zero for local */
};
</pre></div> These advisory file locking operations take a pointer to <var class=Vt>struct flock</var> as the third argument <var class=Fa>arg</var>. The commands available for advisory record locking are as follows: <dl class=Bl-tag><dt><a class=permalink href=#F_GETLK><code class=Dv id=F_GETLK>F_GETLK</code></a></dt><dd>Get the first lock that blocks the lock description pointed to by the third argument, <var class=Fa>arg</var>, taken as a pointer to a <var class=Fa>struct flock</var> (see above). The information retrieved overwrites the information passed to <code class=Fn>fcntl</code>() in the <var class=Fa>flock</var> structure. If no lock is found that would prevent this lock from being created, the structure is left unchanged by this system call except for the lock type which is set to <code class=Dv>F_UNLCK</code>.</dd><dt><a class=permalink href=#F_SETLK><code class=Dv id=F_SETLK>F_SETLK</code></a></dt><dd>Set or clear a file segment lock according to the lock description pointed to by the third argument, <var class=Fa>arg</var>, taken as a pointer to a <var class=Fa>struct flock</var> (see above). <code class=Dv>F_SETLK</code> is used to establish shared (or read) locks (<code class=Dv>F_RDLCK</code>) or exclusive (or write) locks, (<code class=Dv>F_WRLCK</code>), as well as remove either type of lock (<code class=Dv>F_UNLCK</code>). If a shared or exclusive lock cannot be set, <code class=Fn>fcntl</code>() returns immediately with <code class=Er>EAGAIN</code>.</dd><dt><a class=permalink href=#F_SETLKW><code class=Dv id=F_SETLKW>F_SETLKW</code></a></dt><dd>This command is the same as <code class=Dv>F_SETLK</code> except that if a shared or exclusive lock is blocked by other locks, the process waits until the request can be satisfied. If a signal that is to be caught is received while <code class=Fn>fcntl</code>() is waiting for a region, the <code class=Fn>fcntl</code>() will be interrupted if the signal handler has not specified the <code class=Dv>SA_RESTART</code> (see <a class=Xr href=sigaction.2.html>sigaction(2)</a>).</dd></dl><p class=Pp>When a shared lock has been set on a segment of a file, other processes can set shared locks on that segment or a portion of it. A shared lock prevents any other process from setting an exclusive lock on any portion of the protected area. A request for a shared lock fails if the file descriptor was not opened with read access.</p><p class=Pp>An exclusive lock prevents any other process from setting a shared lock or an exclusive lock on any portion of the protected area. A request for an exclusive lock fails if the file was not opened with write access.</p><p class=Pp>The value of <var class=Fa>l_whence</var> is <code class=Dv>SEEK_SET</code>, <code class=Dv>SEEK_CUR</code>, or <code class=Dv>SEEK_END</code> to indicate that the relative offset, <var class=Fa>l_start</var> bytes, will be measured from the start of the file, current position, or end of the file, respectively. The value of <var class=Fa>l_len</var> is the number of consecutive bytes to be locked. If <var class=Fa>l_len</var> is negative, <var class=Fa>l_start</var> means end edge of the region. The <var class=Fa>l_pid</var> and <var class=Fa>l_sysid</var> fields are only used with <code class=Dv>F_GETLK</code> to return the process ID of the process holding a blocking lock and the system ID of the system that owns that process. Locks created by the local system will have a system ID of zero. After a successful <code class=Dv>F_GETLK</code> request, the value of <var class=Fa>l_whence</var> is <code class=Dv>SEEK_SET</code>.</p><p class=Pp>Locks may start and extend beyond the current end of a file, but may not start or extend before the beginning of the file. A lock is set to extend to the largest possible value of the file offset for that file if <var class=Fa>l_len</var> is set to zero. If <var class=Fa>l_whence</var> and <var class=Fa>l_start</var> point to the beginning of the file, and <var class=Fa>l_len</var> is zero, the entire file is locked. If an application wishes only to do entire file locking, the <a class=Xr href=flock.2.html>flock(2)</a> system call is much more efficient.</p><p class=Pp>There is at most one type of lock set for each byte in the file. Before a successful return from an <code class=Dv>F_SETLK</code> or an <code class=Dv>F_SETLKW</code> request when the calling process has previously existing locks on bytes in the region specified by the request, the previous lock type for each byte in the specified region is replaced by the new lock type. As specified above under the descriptions of shared locks and exclusive locks, an <code class=Dv>F_SETLK</code> or an <code class=Dv>F_SETLKW</code> request fails or blocks respectively when another process has existing locks on bytes in the specified region and the type of any of those locks conflicts with the type specified in the request.</p><p class=Pp>The queuing for <code class=Dv>F_SETLKW</code> requests on local files is fair; that is, while the thread is blocked, subsequent requests conflicting with its requests will not be granted, even if these requests do not conflict with existing locks.</p><p class=Pp>This interface follows the completely stupid semantics of System V and <span class=St>IEEE Std 1003.1-1988 (“POSIX.1”)</span> that require that all locks associated with a file for a given process are removed when <i class=Em>any</i> file descriptor for that file is closed by that process. This semantic means that applications must be aware of any files that a subroutine library may access. For example if an application for updating the password file locks the password file database while making the update, and then calls <a class=Xr href=getpwnam.3.html>getpwnam(3)</a> to retrieve a record, the lock will be lost because <a class=Xr href=getpwnam.3.html>getpwnam(3)</a> opens, reads, and closes the password database. The database close will release all locks that the process has associated with the database, even if the library routine never requested a lock on the database. Another minor semantic problem with this interface is that locks are not inherited by a child process created using the <a class=Xr href=fork.2.html>fork(2)</a> system call. The <a class=Xr href=flock.2.html>flock(2)</a> interface has much more rational last close semantics and allows locks to be inherited by child processes. The <a class=Xr href=flock.2.html>flock(2)</a> system call is recommended for applications that want to ensure the integrity of their locks when using library routines or wish to pass locks to their children.</p><p class=Pp>The <code class=Fn>fcntl</code>(), <a class=Xr href=flock.2.html>flock(2)</a>, and <a class=Xr href=lockf.3.html>lockf(3)</a> locks are compatible. Processes using different locking interfaces can cooperate over the same file safely. However, only one of such interfaces should be used within the same process. If a file is locked by a process through <a class=Xr href=flock.2.html>flock(2)</a>, any record within the file will be seen as locked from the viewpoint of another process using <code class=Fn>fcntl</code>() or <a class=Xr href=lockf.3.html>lockf(3)</a>, and vice versa. Note that <code class=Fn>fcntl</code>(<var class=Fa>F_GETLK</var>) returns -1 in <var class=Fa>l_pid</var> if the process holding a blocking lock previously locked the file descriptor by <a class=Xr href=flock.2.html>flock(2)</a>.</p><p class=Pp>All locks associated with a file for a given process are removed when the process terminates.</p><p class=Pp>All locks obtained before a call to <a class=Xr href=execve.2.html>execve(2)</a> remain in effect until the new program releases them. If the new program does not know about the locks, they will not be released until the program exits.</p><p class=Pp>A potential for deadlock occurs if a process controlling a locked region is put to sleep by attempting to lock the locked region of another process. This implementation detects that sleeping until a locked region is unlocked would cause a deadlock and fails with an <code class=Er>EDEADLK</code> error.</p></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2> Upon successful completion, the value returned depends on <var class=Fa>cmd</var> as follows: <div class=Bd-indent><dl class=Bl-tag><dt><a class=permalink href=#F_DUPFD_2><code class=Dv id=F_DUPFD_2>F_DUPFD</code></a></dt><dd>A new file descriptor.</dd><dt><a class=permalink href=#F_DUP2FD_2><code class=Dv id=F_DUP2FD_2>F_DUP2FD</code></a></dt><dd>A file descriptor equal to <var class=Fa>arg</var>.</dd><dt><a class=permalink href=#F_GETFD_2><code class=Dv id=F_GETFD_2>F_GETFD</code></a></dt><dd>Value of flag (only the low-order bit is defined).</dd><dt><a class=permalink href=#F_GETFL_2><code class=Dv id=F_GETFL_2>F_GETFL</code></a></dt><dd>Value of flags.</dd><dt><a class=permalink href=#F_GETOWN_2><code class=Dv id=F_GETOWN_2>F_GETOWN</code></a></dt><dd>Value of file descriptor owner.</dd><dt>other</dt><dd>Value other than -1.</dd></dl></div><p class=Pp>Otherwise, a value of -1 is returned and <var class=Va>errno</var> is set to indicate the error.</p></section><section class=Sh><h2 class=Sh id=ERRORS><a class=permalink href=#ERRORS>ERRORS</a></h2> The <code class=Fn>fcntl</code>() system call will fail if: <dl class=Bl-tag><dt>[<a class=permalink href=#EAGAIN><code class=Er id=EAGAIN>EAGAIN</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLK</code>, the type of lock (<var class=Fa>l_type</var>) is a shared lock (<code class=Dv>F_RDLCK</code>) or exclusive lock (<code class=Dv>F_WRLCK</code>), and the segment of a file to be locked is already exclusive-locked by another process; or the type is an exclusive lock and some portion of the segment of a file to be locked is already shared-locked or exclusive-locked by another process.</dd><dt>[<a class=permalink href=#EBADF><code class=Er id=EBADF>EBADF</code></a>]</dt><dd>The <var class=Fa>fd</var> argument is not a valid open file descriptor. <p class=Pp>The argument <var class=Fa>cmd</var> is <code class=Dv>F_DUP2FD</code>, and <var class=Fa>arg</var> is not a valid file descriptor.</p><p class=Pp>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code>, the type of lock (<var class=Fa>l_type</var>) is a shared lock (<code class=Dv>F_RDLCK</code>), and <var class=Fa>fd</var> is not a valid file descriptor open for reading.</p><p class=Pp>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code>, the type of lock (<var class=Fa>l_type</var>) is an exclusive lock (<code class=Dv>F_WRLCK</code>), and <var class=Fa>fd</var> is not a valid file descriptor open for writing.</p></dd><dt>[<a class=permalink href=#EBUSY><code class=Er id=EBUSY>EBUSY</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_ADD_SEALS</code>, attempting to set <code class=Dv>F_SEAL_WRITE</code>, and writeable mappings of the file exist.</dd><dt>[<a class=permalink href=#EDEADLK><code class=Er id=EDEADLK>EDEADLK</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLKW</code>, and a deadlock condition was detected.</dd><dt>[<a class=permalink href=#EINTR><code class=Er id=EINTR>EINTR</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLKW</code>, and the system call was interrupted by a signal.</dd><dt>[<a class=permalink href=#EINVAL><code class=Er id=EINVAL>EINVAL</code></a>]</dt><dd>The <var class=Fa>cmd</var> argument is <code class=Dv>F_DUPFD</code> and <var class=Fa>arg</var> is negative or greater than the maximum allowable number (see <a class=Xr href=getdtablesize.2.html>getdtablesize(2)</a>). <p class=Pp>The argument <var class=Fa>cmd</var> is <code class=Dv>F_GETLK</code>, <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code> and the data to which <var class=Fa>arg</var> points is not valid.</p><p class=Pp>The argument <var class=Fa>cmd</var> is <code class=Dv>F_ADD_SEALS</code> or <code class=Dv>F_GET_SEALS</code>, and the underlying filesystem does not support sealing.</p><p class=Pp>The argument <var class=Fa>cmd</var> is invalid.</p></dd><dt>[<a class=permalink href=#EMFILE><code class=Er id=EMFILE>EMFILE</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_DUPFD</code> and the maximum number of file descriptors permitted for the process are already in use, or no file descriptors greater than or equal to <var class=Fa>arg</var> are available.</dd><dt>[<a class=permalink href=#ENOTTY><code class=Er id=ENOTTY>ENOTTY</code></a>]</dt><dd>The <var class=Fa>fd</var> argument is not a valid file descriptor for the requested operation. This may be the case if <var class=Fa>fd</var> is a device node, or a descriptor returned by <a class=Xr href=kqueue.2.html>kqueue(2)</a>.</dd><dt>[<a class=permalink href=#ENOLCK><code class=Er id=ENOLCK>ENOLCK</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code>, and satisfying the lock or unlock request would result in the number of locked regions in the system exceeding a system-imposed limit.</dd><dt>[<a class=permalink href=#EOPNOTSUPP><code class=Er id=EOPNOTSUPP>EOPNOTSUPP</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_GETLK</code>, <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code> and <var class=Fa>fd</var> refers to a file for which locking is not supported.</dd><dt>[<a class=permalink href=#EOVERFLOW><code class=Er id=EOVERFLOW>EOVERFLOW</code></a>]</dt><dd>The argument <var class=Fa>cmd</var> is <code class=Dv>F_GETLK</code>, <code class=Dv>F_SETLK</code> or <code class=Dv>F_SETLKW</code> and an <var class=Fa>off_t</var> calculation overflowed.</dd><dt>[<a class=permalink href=#EPERM><code class=Er id=EPERM>EPERM</code></a>]</dt><dd>The <var class=Fa>cmd</var> argument is <code class=Dv>F_SETOWN</code> and the process ID or process group given as an argument is in a different session than the caller. <p class=Pp>The <var class=Fa>cmd</var> argument is <code class=Dv>F_ADD_SEALS</code> and the <code class=Dv>F_SEAL_SEAL</code> seal has already been set.</p></dd><dt>[<a class=permalink href=#ESRCH><code class=Er id=ESRCH>ESRCH</code></a>]</dt><dd>The <var class=Fa>cmd</var> argument is <code class=Dv>F_SETOWN</code> and the process ID given as argument is not in use.</dd></dl><p class=Pp>In addition, if <var class=Fa>fd</var> refers to a descriptor open on a terminal device (as opposed to a descriptor open on a socket), a <var class=Fa>cmd</var> of <code class=Dv>F_SETOWN</code> can fail for the same reasons as in <a class=Xr href=tcsetpgrp.3.html>tcsetpgrp(3)</a>, and a <var class=Fa>cmd</var> of <code class=Dv>F_GETOWN</code> for the reasons as stated in <a class=Xr href=tcgetpgrp.3.html>tcgetpgrp(3)</a>.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=close.2.html>close(2)</a>, <a class=Xr href=dup2.2.html>dup2(2)</a>, <a class=Xr href=execve.2.html>execve(2)</a>, <a class=Xr href=flock.2.html>flock(2)</a>, <a class=Xr href=getdtablesize.2.html>getdtablesize(2)</a>, <a class=Xr href=open.2.html>open(2)</a>, <a class=Xr href=sigaction.2.html>sigaction(2)</a>, <a class=Xr href=lockf.3.html>lockf(3)</a>, <a class=Xr href=tcgetpgrp.3.html>tcgetpgrp(3)</a>, <a class=Xr href=tcsetpgrp.3.html>tcsetpgrp(3)</a></section><section class=Sh><h2 class=Sh id=STANDARDS><a class=permalink href=#STANDARDS>STANDARDS</a></h2> The <code class=Dv>F_DUP2FD</code> constant is non portable. It is provided for compatibility with AIX and Solaris. <p class=Pp>Per <span class=St>Version 4 of the Single UNIX Specification (“SUSv4”)</span>, a call with <code class=Dv>F_SETLKW</code> should fail with [<code class=Er>EINTR</code>] after any caught signal and should continue waiting during thread suspension such as a stop signal. However, in this implementation a call with <code class=Dv>F_SETLKW</code> is restarted after catching a signal with a <code class=Dv>SA_RESTART</code> handler or a thread suspension such as a stop signal.</p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Fn>fcntl</code>() system call appeared in <span class=Ux>4.2BSD</span>. <p class=Pp>The <code class=Dv>F_DUP2FD</code> constant first appeared in <span class=Ux>FreeBSD 7.1</span>.</p></section></div><table class=foot><tr><td class=foot-date>December 7, 2021</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>