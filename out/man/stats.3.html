<!DOCTYPE html>
<html><head><meta charset=utf-8><title>stats(3)</title><keywords content=man,stats></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>stats(3)</h1><table class=head><tr><td class=head-ltitle>STATS(3)</td><td class=head-vol>FreeBSD Library Functions Manual</td><td class=head-rtitle>STATS(3)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>stats</code> — <div class=Nd>statistics gathering</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>library “libstats”</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/arb.h.html>sys/arb.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/sys/qmath.h.html>sys/qmath.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/sys/stats.h.html>sys/stats.h</a>&gt;</code><section class=Ss><h2 class=Ss id=Stats_Blob_Template_Management_Functions><a class=permalink href=#Stats_Blob_Template_Management_Functions>Stats Blob Template Management Functions</a></h2><var class=Ft>int</var><br><code class=Fn>stats_tpl_alloc</code>(<var class=Fa>const char *name</var>, <var class=Fa>uint32_t flags</var>); <p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_fetch_allocid</code>(<var class=Fa>const char *name</var>, <var class=Fa>uint32_t hash</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_fetch</code>(<var class=Fa>int tpl_id</var>, <var class=Fa>struct statsblob_tpl **tpl</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_id2name</code>(<var class=Fa>uint32_t tpl_id</var>, <var class=Fa>char *buf</var>, <var class=Fa>size_t len</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_sample_rates</code>(<var class=Fa>SYSCTL_HANDLER_ARGS</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_sample_rollthedice</code>(<var class=Fa>struct stats_tpl_sample_rate *rates</var>, <var class=Fa>int nrates</var>, <var class=Fa>void *seed_bytes</var>, <var class=Fa>size_t seed_len</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_SUM</code>();</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_MAX</code>();</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_MIN</code>();</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_CRHIST&lt;32|64&gt;_LIN</code>(<var class=Fa>lb</var>, <var class=Fa>ub</var>, <var class=Fa>stepinc</var>, <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_CRHIST&lt;32|64&gt;_EXP</code>(<var class=Fa>lb</var>, <var class=Fa>ub</var>, <var class=Fa>stepbase</var>, <var class=Fa>stepexp</var>, <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_CRHIST&lt;32|64&gt;_LINEXP</code>(<var class=Fa>lb</var>, <var class=Fa>ub</var>, <var class=Fa>nlinsteps</var>, <var class=Fa>stepbase</var>, <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_CRHIST&lt;32|64&gt;_USR</code>(<b class=Sy>HBKTS</b>(<b class=Sy>CRBKT</b>(<i class=Em>lb</i>), <i class=Em>...</i>), <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_DRHIST&lt;32|64&gt;_USR</code>(<b class=Sy>HBKTS</b>(<b class=Sy>DRBKT</b>(<i class=Em>lb</i>, <i class=Em>ub</i>), <i class=Em>...</i>), <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_DVHIST&lt;32|64&gt;_USR</code>(<b class=Sy>HBKTS</b>(<b class=Sy>DVBKT</b>(<i class=Em>val</i>), <i class=Em>...</i>), <var class=Fa>vsdflags</var>);</p><p class=Pp><var class=Ft>struct voistatspec</var><br><code class=Fn>STATS_VSS_TDGSTCLUST&lt;32|64&gt;</code>(<var class=Fa>nctroids</var>, <var class=Fa>prec</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_tpl_add_voistats</code>(<var class=Fa>uint32_t tpl_id</var>, <var class=Fa>int32_t voi_id</var>, <var class=Fa>const char *voi_name</var>, <var class=Fa>enum vsd_dtype voi_dtype</var>, <var class=Fa>uint32_t nvss</var>, <var class=Fa>struct voistatspec *vss</var>, <var class=Fa>uint32_t flags</var>);</p></section><section class=Ss><h2 class=Ss id=Stats_Blob_Data_Gathering_Functions><a class=permalink href=#Stats_Blob_Data_Gathering_Functions>Stats Blob Data Gathering Functions</a></h2><var class=Ft>int</var><br><code class=Fn>stats_voi_update_&lt;abs|rel&gt;_&lt;dtype&gt;</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>int32_t voi_id</var>, <var class=Fa>&lt;dtype&gt; voival</var>); </section><section class=Ss><h2 class=Ss id=Stats_Blob_Utility_Functions><a class=permalink href=#Stats_Blob_Utility_Functions>Stats Blob Utility Functions</a></h2><var class=Ft>struct statsblob *</var><br><code class=Fn>stats_blob_alloc</code>(<var class=Fa>uint32_t tpl_id</var>, <var class=Fa>uint32_t flags</var>); <p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_blob_init</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>uint32_t tpl_id</var>, <var class=Fa>uint32_t flags</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_blob_clone</code>(<var class=Fa>struct statsblob **dst</var>, <var class=Fa>size_t dstmaxsz</var>, <var class=Fa>struct statsblob *src</var>, <var class=Fa>uint32_t flags</var>);</p><p class=Pp><var class=Ft>void</var><br><code class=Fn>stats_blob_destroy</code>(<var class=Fa>struct statsblob *sb</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_voistat_fetch_dptr</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>int32_t voi_id</var>, <var class=Fa>enum voi_stype stype</var>, <var class=Fa>enum vsd_dtype *retdtype</var>, <var class=Fa>struct voistatdata **retvsd</var>, <var class=Fa>size_t *retvsdsz</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_voistat_fetch_&lt;dtype&gt;</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>int32_t voi_id</var>, <var class=Fa>enum voi_stype stype</var>, <var class=Fa>&lt;dtype&gt; *ret</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_blob_snapshot</code>(<var class=Fa>struct statsblob **dst</var>, <var class=Fa>size_t dstmaxsz</var>, <var class=Fa>struct statsblob *src</var>, <var class=Fa>uint32_t flags</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_blob_tostr</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>struct sbuf *buf</var>, <var class=Fa>enum sb_str_fmt fmt</var>, <var class=Fa>uint32_t flags</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_voistatdata_tostr</code>(<var class=Fa>const struct voistatdata *vsd</var>, <var class=Fa>enum vsd_dtype dtype</var>, <var class=Fa>enum sb_str_fmt fmt</var>, <var class=Fa>struct sbuf *buf</var>, <var class=Fa>int objdump</var>);</p><p class=Pp><var class=Ft>typedef int</var><br><code class=Fn>(*stats_blob_visitcb_t)</code>(<var class=Fa style="white-space: nowrap;">struct sb_visit *sbv</var>, <var class=Fa style="white-space: nowrap;">void *usrctx</var>);</p><p class=Pp><var class=Ft>int</var><br><code class=Fn>stats_blob_visit</code>(<var class=Fa>struct statsblob *sb</var>, <var class=Fa>stats_blob_visitcb_t func</var>, <var class=Fa>void *usrctx</var>);</p></section></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>stats</code> framework facilitates real-time kernel and user space statistics gathering. The framework is built around the “statsblob”, an object embedded within a contiguous memory allocation that is mostly opaque to consumers and stores all required state. A “statsblob” object can itself be embedded within other objects either directly or indirectly using a pointer. <p class=Pp>Objects or subsystems for which statistics are to be gathered are initialized from a template “statsblob”, which acts as the blueprint for an arbitrary set of Variables Of Interest (VOIs) and their associated statistics. Each template defines a schema plus associated metadata, which are kept separate to minimize the memory footprint of blobs.</p><p class=Pp>Data gathering hook functions added at appropriate locations within the code base of interest feed VOI data into the framework for processing.</p><p class=Pp>Each “statsblob”, consists of a <var class=Vt>struct statsblob</var> header and opaque internal blob structure per the following diagram:</p><div class="Bd Pp Bd-indent"><pre>
---------------------------------------------------------
|   struct  |		       uint8_t			|
| statsblob |		      opaque[]			|
---------------------------------------------------------
</pre></div><p class=Pp>The publicly visible 8-byte header is defined as:</p><div class="Bd Pp Bd-indent"><pre>
struct statsblob {
	uint8_t		abi;
	uint8_t		endian;
	uint16_t	flags;
	uint16_t	maxsz;
	uint16_t	cursz;
	uint8_t		opaque[];
};
</pre></div><p class=Pp><var class=Va>abi</var> specifies which API version the blob's <var class=Va>opaque</var> internals conform to (<code class=Dv>STATS_ABI_V1 is the only version currently defined</code>). <var class=Va>endian</var> specifies the endianness of the blob's fields (<code class=Dv>SB_LE</code> for little endian, <code class=Dv>SB_BE</code> for big endian, or <code class=Dv>SB_UE</code> for unknown endianness). <var class=Va>cursz</var> specifies the size of the blob, while <var class=Va>maxsz</var> specifies the size of the underlying memory allocation in which the blob is embedded. Both <var class=Va>cursz</var> and <var class=Va>maxsz</var> default to units of bytes, unless a flag is set in <var class=Va>flags</var> that dictates otherwise.</p><p class=Pp>Templates are constructed by associating arbitrary VOI IDs with a set of statistics, where each statistic is specified using a <var class=Vt>struct voistatspec</var> per the definition below:</p><div class="Bd Pp Bd-indent"><pre>
struct voistatspec {
	vss_hlpr_fn		hlpr;
	struct vss_hlpr_info	*hlprinfo;
	struct voistatdata	*iv;
	size_t			vsdsz;
	uint32_t		flags;
	enum vsd_dtype		vs_dtype : 8;
	enum voi_stype		stype : 8;
};
</pre></div><p class=Pp>It is generally expected that consumers will not work with <var class=Vt>struct voistatspec</var> directly, and instead use the <code class=Fn>STATS_VSS_*</code>() helper macros.</p><p class=Pp>The <code class=Nm>stats</code> framework offers the following statistics for association with VOIs:</p><dl class=Bl-tag><dt><a class=permalink href=#VS_STYPE_SUM><code class=Dv id=VS_STYPE_SUM>VS_STYPE_SUM</code></a></dt><dd>The sum of VOI values.</dd><dt><a class=permalink href=#VS_STYPE_MAX><code class=Dv id=VS_STYPE_MAX>VS_STYPE_MAX</code></a></dt><dd>The maximum VOI value.</dd><dt><a class=permalink href=#VS_STYPE_MIN><code class=Dv id=VS_STYPE_MIN>VS_STYPE_MIN</code></a></dt><dd>The minimum VOI value.</dd><dt><a class=permalink href=#VS_STYPE_HIST><code class=Dv id=VS_STYPE_HIST>VS_STYPE_HIST</code></a></dt><dd>A static bucket histogram of VOI values, including a count of “out-of-band/bucket” values which did not match any bucket. Histograms can be specified as “<i class=Em>C</i>ontinuous <i class=Em>R</i>ange” (CRHIST), “<i class=Em>D</i>iscrete <i class=Em>R</i>ange” (DRHIST) or “<i class=Em>D</i>iscrete <i class=Em>V</i>alue” (DVHIST), with 32 or 64 bit bucket counters, depending on the VOI semantics.</dd><dt><a class=permalink href=#VS_STYPE_TDGST><code class=Dv id=VS_STYPE_TDGST>VS_STYPE_TDGST</code></a></dt><dd>A dynamic bucket histogram of VOI values based on the t-digest method (refer to the t-digest paper in the <a class=Sx href=#SEE_ALSO>SEE ALSO</a> section below).</dd></dl><p class=Pp>A “visitor software design pattern”-like scheme is employed to facilitate iterating over a blob's data without concern for the blob's structure. The data provided to visitor callback functions is encapsulated in <var class=Vt>struct sb_visit</var> per the definition below:</p><div class="Bd Pp Bd-indent"><pre>
struct sb_visit {
	struct voistatdata	*vs_data;
	uint32_t		tplhash;
	uint32_t		flags;
	int16_t			voi_id;
	int16_t			vs_dsz;
	enum vsd_dtype		voi_dtype : 8;
	enum vsd_dtype		vs_dtype : 8;
	int8_t			vs_stype;
	uint16_t		vs_errs;
};
</pre></div><p class=Pp>The <code class=Fn>stats_tpl_sample_rates</code>() and <code class=Fn>stats_tpl_sample_rollthedice</code>() functions utilize <var class=Vt>struct stats_tpl_sample_rate</var> to encapsulate per-template sample rate information per the definition below:</p><div class="Bd Pp Bd-indent"><pre>
struct stats_tpl_sample_rate {
	int32_t		tpl_slot_id;
	uint32_t	tpl_sample_pct;
};
</pre></div><p class=Pp>The <var class=Va>tpl_slot_id</var> member holds the template's slot ID obtained from <code class=Fn>stats_tpl_alloc</code>() or <code class=Fn>stats_tpl_fetch_allocid</code>(). The <var class=Va>tpl_sample_pct</var> member holds the template's sample rate as an integer percentage in the range [0,100].</p><p class=Pp>The <var class=Vt>stats_tpl_sr_cb_t</var> conformant function pointer that is required as the <var class=Fa>arg1</var> of <code class=Fn>stats_tpl_sample_rates</code>() is defined as:</p><div class="Bd Pp Bd-indent"><pre>
enum stats_tpl_sr_cb_action {
	TPL_SR_UNLOCKED_GET,
	TPL_SR_RLOCKED_GET,
	TPL_SR_RUNLOCK,
	TPL_SR_PUT
};
typedef int (*stats_tpl_sr_cb_t)(enum stats_tpl_sr_cb_action action,
    struct stats_tpl_sample_rate **rates, int *nrates, void *ctx);
</pre></div><p class=Pp>It is required that a conformant function:</p><ul class=Bl-dash><li>Return an appropriate <a class=Xr href=errno.2.html>errno(2)</a> on error, otherwise 0.</li><li>When called with “action == TPL_SR_*_GET”, return the subsystem's rates list ptr and count, locked or unlocked as requested.</li><li>When called with “action == TPL_SR_RUNLOCK”, unlock the subsystem's rates list ptr and count. Pair with a prior “action == TPL_SR_RLOCKED_GET” call.</li><li>When called with “action == TPL_SR_PUT”, update the subsystem's rates list ptr and count to the sysctl processed values and return the inactive list details in <var class=Fa>rates</var> and <var class=Fa>nrates</var> for garbage collection by <code class=Fn>stats_tpl_sample_rates</code>().</li></ul><p class=Pp>Where templates need to be referenced via textual means, for example via a MIB variable, the following string based template spec formats can be used:</p><ol class=Bl-enum><li>“&lt;tplname&gt;”:&lt;tplhash&gt;, for example “TCP_DEFAULT”:1731235399</li><li>“&lt;tplname&gt;”, for example “TCP_DEFAULT”</li><li>:&lt;tplhash&gt;, for example :1731235399</li></ol><p class=Pp>The first form is the normative spec format generated by the framework, while the second and third forms are convenience formats primarily for user input. The use of inverted commas around the template name is optional.</p><section class=Ss><h2 class=Ss id=MIB_Variables><a class=permalink href=#MIB_Variables>MIB Variables</a></h2> The in-kernel <code class=Nm>stats</code> framework exposes the following framework-specific variables in the <var class=Va>kern.stats</var> branch of the <a class=Xr href=sysctl.3.html>sysctl(3)</a> MIB. <dl class=Bl-tag><dt>templates</dt><dd>Read-only CSV list of registered templates in normative template spec form.</dd></dl></section><section class=Ss><h2 class=Ss id=Template_Management_Functions><a class=permalink href=#Template_Management_Functions>Template Management Functions</a></h2> The <code class=Fn>stats_tpl_alloc</code>() function allocates a new template with the specified unique name and returns its runtime-stable template slot ID for use with other API functions. The <var class=Fa>flags</var> argument is currently unused. <p class=Pp>The <code class=Fn>stats_tpl_fetch_allocid</code>() function returns the runtime-stable template slot ID of any registered template matching the specified name and hash.</p><p class=Pp>The <code class=Fn>stats_tpl_fetch</code>() function returns the pointer to the registered template object at the specified template slot ID.</p><p class=Pp>The <code class=Fn>stats_tpl_id2name</code>() function returns the name of the registered template object at the specified template slot ID.</p><p class=Pp>The <code class=Fn>stats_tpl_sample_rates</code>() function provides a generic handler for template sample rates management and reporting via <a class=Xr href=sysctl.3.html>sysctl(3)</a> MIB variables. Subsystems can use this function to create a subsystem-specific <a class=Xr href=SYSCTL_PROC.9.html>SYSCTL_PROC(9)</a> MIB variable that manages and reports subsystem-specific template sampling rates. Subsystems must supply a <var class=Vt>stats_tpl_sr_cb_t</var> conformant function pointer as the sysctl's <var class=Fa>arg1</var>, which is a callback used to interact with the subsystem's stats template sample rates list. Subsystems can optionally specify the sysctl's <var class=Fa>arg2</var> as non-zero, which causes a zero-initialized allocation of arg2-sized contextual memory to be heap-allocated and passed in to all subsystem callbacks made during the operation of <code class=Fn>stats_tpl_sample_rates</code>().</p><p class=Pp>The <code class=Fn>stats_tpl_sample_rollthedice</code>() function makes a weighted random template selection from the supplied array of template sampling rates. The cumulative percentage of all sampling rates should not exceed 100. If no seed is supplied, a PRNG is used to generate a true random number so that every selection is independent. If a seed is supplied, selection will be made randomly across different seeds, but deterministically given the same seed.</p><p class=Pp>The <code class=Fn>stats_tpl_add_voistats</code>() function is used to add a VOI and associated set of statistics to the registered template object at the specified template slot ID. The set of statistics is passed as an array of <var class=Vt>struct voistatspec</var> which can be initialized using the <code class=Fn>STATS_VSS_*</code>() helper macros or manually for non-standard use cases. For static <var class=Fa>vss</var> arrays, the <var class=Fa>nvss</var> count of array elements can be determined by passing <var class=Fa>vss</var> to the <code class=Fn>NVSS</code>() macro. The <code class=Dv>SB_VOI_RELUPDATE</code> flag can be passed to configure the VOI for use with <code class=Fn>stats_voi_update_rel_&lt;dtype&gt;</code>(), which entails maintaining an extra 8 bytes of state in the blob at each update.</p></section><section class=Ss><h2 class=Ss id=Data_Gathering_Functions><a class=permalink href=#Data_Gathering_Functions>Data Gathering Functions</a></h2> The <code class=Fn>stats_voi_update_abs_&lt;dtype&gt;</code>() and <code class=Fn>stats_voi_update_rel_&lt;dtype&gt;</code>() functions both update all the statistics associated with the VOI identified by <var class=Fa>voi_id</var>. The “abs” call uses <var class=Fa>voival</var> as an absolute value, whereas the “rel” call uses <var class=Fa>voival</var> as a value relative to that of the previous update function call, by adding it to the previous value and using the result for the update. Relative updates are only possible for VOIs that were added to the template with the <code class=Dv>SB_VOI_RELUPDATE</code> flag specified to <code class=Fn>stats_tpl_add_voistats</code>(). </section><section class=Ss><h2 class=Ss id=Utility_Functions><a class=permalink href=#Utility_Functions>Utility Functions</a></h2> The <code class=Fn>stats_blob_alloc</code>() function allocates and initializes a new blob based on the registered template object at the specified template slot ID. <p class=Pp>The <code class=Fn>stats_blob_init</code>() function initializes a new blob in an existing memory allocation based on the registered template object at the specified template slot ID.</p><p class=Pp>The <code class=Fn>stats_blob_clone</code>() function duplicates the <var class=Fa>src</var> blob into <var class=Fa>dst</var>, leaving only the <var class=Va>maxsz</var> field of <var class=Fa>dst</var> untouched. The <code class=Dv>SB_CLONE_ALLOCDST</code> flag can be passed to instruct the function to allocate a new blob of appropriate size into which to clone <var class=Fa>src</var>, storing the new pointer in <var class=Fa>*dst</var>. The <code class=Dv>SB_CLONE_USRDSTNOFAULT</code> or <code class=Dv>SB_CLONE_USRDST</code> flags can be set to respectively signal that <a class=Xr href=copyout_nofault.9.html>copyout_nofault(9)</a> or <a class=Xr href=copyout.9.html>copyout(9)</a> should be used because <var class=Fa>*dst</var> is a user space address.</p><p class=Pp>The <code class=Fn>stats_blob_snapshot</code>() function calls <code class=Fn>stats_blob_clone</code>() to obtain a copy of <var class=Fa>src</var> and then performs any additional functions required to produce a coherent blob snapshot. The flags interpreted by <code class=Fn>stats_blob_clone</code>() also apply to <code class=Fn>stats_blob_snapshot</code>(). Additionally, the <code class=Dv>SB_CLONE_RSTSRC</code> flag can be used to effect a reset of the <var class=Fa>src</var> blob's statistics after a snapshot is successfully taken.</p><p class=Pp>The <code class=Fn>stats_blob_destroy</code>() function destroys a blob previously created with <code class=Fn>stats_blob_alloc</code>(), <code class=Fn>stats_blob_clone</code>() or <code class=Fn>stats_blob_snapshot</code>().</p><p class=Pp>The <code class=Fn>stats_blob_visit</code>() function allows the caller to iterate over the contents of a blob. The callback function <var class=Fa>func</var> is called for every VOI and statistic in the blob, passing a <var class=Vt>struct sb_visit</var> and the user context argument <var class=Fa>usrctx</var> to the callback function. The <var class=Fa>sbv</var> passed to the callback function may have one or more of the following flags set in the <var class=Va>flags</var> struct member to provide useful metadata about the iteration: <code class=Dv>SB_IT_FIRST_CB</code>, <code class=Dv>SB_IT_LAST_CB</code>, <code class=Dv>SB_IT_FIRST_VOI</code>, <code class=Dv>SB_IT_LAST_VOI</code>, <code class=Dv>SB_IT_FIRST_VOISTAT</code>, <code class=Dv>SB_IT_LAST_VOISTAT</code>, <code class=Dv>SB_IT_NULLVOI</code> and <code class=Dv>SB_IT_NULLVOISTAT</code>. Returning a non-zero value from the callback function terminates the iteration.</p><p class=Pp>The <code class=Fn>stats_blob_tostr</code>() renders a string representation of a blob into the <a class=Xr href=sbuf.9.html>sbuf(9)</a><var class=Fa>buf</var>. Currently supported render formats are <code class=Dv>SB_STRFMT_FREEFORM</code> and <code class=Dv>SB_STRFMT_JSON</code>. The <code class=Dv>SB_TOSTR_OBJDUMP</code> flag can be passed to render version specific opaque implementation detail for debugging or string-to-binary blob reconstruction purposes. The <code class=Dv>SB_TOSTR_META</code> flag can be passed to render template metadata into the string representation, using the blob's template hash to lookup the corresponding template.</p><p class=Pp>The <code class=Fn>stats_voistatdata_tostr</code>() renders a string representation of an individual statistic's data into the <a class=Xr href=sbuf.9.html>sbuf(9)</a><var class=Fa>buf</var>. The same render formats supported by the <code class=Fn>stats_blob_tostr</code>() function can be specified, and the <var class=Fa>objdump</var> boolean has the same meaning as the <code class=Dv>SB_TOSTR_OBJDUMP</code> flag.</p><p class=Pp>The <code class=Fn>stats_voistat_fetch_dptr</code>() function returns an internal blob pointer to the specified <var class=Fa>stype</var> statistic data for the VOI <var class=Fa>voi_id</var>. The <code class=Fn>stats_voistat_fetch_&lt;dtype&gt;</code>() functions are convenience wrappers around <code class=Fn>stats_voistat_fetch_dptr</code>() to perform the extraction for simple data types.</p></section></section><section class=Sh><h2 class=Sh id=IMPLEMENTATION_NOTES><a class=permalink href=#IMPLEMENTATION_NOTES>IMPLEMENTATION NOTES</a></h2> The following notes apply to STATS_ABI_V1 format statsblobs. <section class=Ss><h2 class=Ss id=Space_Time_Complexity><a class=permalink href=#Space_Time_Complexity>Space-Time Complexity</a></h2> Blobs are laid out as three distinct memory regions following the header: <div class="Bd Pp Bd-indent"><pre>
------------------------------------------------------
|   struct    | struct |   struct   |     struct     |
| statsblobv1 | voi [] | voistat [] | voistatdata [] |
------------------------------------------------------
</pre></div><p class=Pp>Blobs store VOI and statistic blob state (8 bytes for <var class=Vt>struct voi</var> and 8 bytes for <var class=Vt>struct voistat</var> respectively) in sparse arrays, using the <var class=Fa>voi_id</var> and <var class=Vt>enum voi_stype</var> as array indices. This allows O(1) access to any voi/voistat pair in the blob, at the expense of 8 bytes of wasted memory per vacant slot for templates which do not specify contiguously numbered VOIs and/or statistic types. Data storage for statistics is only allocated for non-vacant slot pairs.</p><p class=Pp>To provide a concrete example, a blob with the following specification:</p><ul class=Bl-dash><li>Two VOIs; ID 0 and 2; added to the template in that order</li><li>VOI 0 is of data type <var class=Vt>int64_t</var>, is configured with <code class=Dv>SB_VOI_RELUPDATE</code> to enable support for relative updates using <code class=Fn>stats_voi_update_rel_&lt;dtype&gt;</code>(), and has a <code class=Dv>VS_STYPE_MIN</code> statistic associated with it.</li><li>VOI 2 is of data type <var class=Vt>uint32_t</var> with <code class=Dv>VS_STYPE_SUM</code> and <code class=Dv>VS_STYPE_MAX</code> statistics associated with it.</li></ul><p class=Pp>would have the following memory layout:</p><div class="Bd Pp"><pre>
--------------------------------------
| header			     | struct statsblobv1, 32 bytes
|------------------------------------|
| voi[0]			     | struct voi, 8 bytes
| voi[1] (vacant)		     | struct voi, 8 bytes
| voi[2]			     | struct voi, 8 bytes
|------------------------------------|
| voi[2]voistat[VOISTATE] (vacant)   | struct voistat, 8 bytes
| voi[2]voistat[SUM]		     | struct voistat, 8 bytes
| voi[2]voistat[MAX]		     | struct voistat, 8 bytes
| voi[0]voistat[VOISTATE]	     | struct voistat, 8 bytes
| voi[0]voistat[SUM] (vacant)	     | struct voistat, 8 bytes
| voi[0]voistat[MAX] (vacant)	     | struct voistat, 8 bytes
| voi[0]voistat[MIN]		     | struct voistat, 8 bytes
|------------------------------------|
| voi[2]voistat[SUM]voistatdata      | struct voistatdata_int32, 4 bytes
| voi[2]voistat[MAX]voistatdata      | struct voistatdata_int32, 4 bytes
| voi[0]voistat[VOISTATE]voistatdata | struct voistatdata_numeric, 8 bytes
| voi[0]voistat[MIN]voistatdata      | struct voistatdata_int64, 8 bytes
--------------------------------------
				       TOTAL 136 bytes
</pre></div><p class=Pp>When rendered to string format using <code class=Fn>stats_blob_tostr</code>(), the <code class=Dv>SB_STRFMT_FREEFORM</code><var class=Fa>fmt</var> and the <code class=Dv>SB_TOSTR_OBJDUMP</code> flag, the rendered output is:</p><div class="Bd Pp"><pre>
struct statsblobv1@0x8016250a0, abi=1, endian=1, maxsz=136, cursz=136, \
  created=6294158585626144, lastrst=6294158585626144, flags=0x0000, \
  stats_off=56, statsdata_off=112, tplhash=2994056564
    vois[0]: id=0, name="", flags=0x0001, dtype=INT_S64, voistatmaxid=3, \
      stats_off=80
        vois[0]stat[0]: stype=VOISTATE, flags=0x0000, dtype=VOISTATE, \
          dsz=8, data_off=120
            voistatdata: prev=0
        vois[0]stat[1]: stype=-1
        vois[0]stat[2]: stype=-1
        vois[0]stat[3]: stype=MIN, flags=0x0000, dtype=INT_S64, \
          dsz=8, data_off=128
            voistatdata: 9223372036854775807
    vois[1]: id=-1
    vois[2]: id=2, name="", flags=0x0000, dtype=INT_U32, voistatmaxid=2, \
      stats_off=56
        vois[2]stat[0]: stype=-1
        vois[2]stat[1]: stype=SUM, flags=0x0000, dtype=INT_U32, dsz=4, \
          data_off=112
            voistatdata: 0
        vois[2]stat[2]: stype=MAX, flags=0x0000, dtype=INT_U32, dsz=4, \
          data_off=116
            voistatdata: 0
</pre></div><p class=Pp>Note: The “\” present in the rendered output above indicates a manual line break inserted to keep the man page within 80 columns and is not part of the actual output.</p></section><section class=Ss><h2 class=Ss id=Locking><a class=permalink href=#Locking>Locking</a></h2> The <code class=Nm>stats</code> framework does not provide any concurrency protection at the individual blob level, instead requiring that consumers guarantee mutual exclusion when calling API functions that reference a non-template blob. <p class=Pp>The list of templates is protected with a <a class=Xr href=rwlock.9.html>rwlock(9)</a> in-kernel, and <a class=Xr href=pthread.3.html>pthread(3)</a> rw lock in user space to support concurrency between template management and blob initialization operations.</p></section></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2><code class=Fn>stats_tpl_alloc</code>() returns a runtime-stable template slot ID on success, or a negative errno on failure. -EINVAL is returned if any problems are detected with the arguments. -EEXIST is returned if an existing template is registered with the same name. -ENOMEM is returned if a required memory allocation fails. <p class=Pp><code class=Fn>stats_tpl_fetch_allocid</code>() returns a runtime-stable template slot ID, or negative errno on failure. -ESRCH is returned if no registered template matches the specified name and/or hash.</p><p class=Pp><code class=Fn>stats_tpl_fetch</code>() returns 0 on success, or ENOENT if an invalid <var class=Fa>tpl_id</var> is specified.</p><p class=Pp><code class=Fn>stats_tpl_id2name</code>() returns 0 on success, or an errno on failure. EOVERFLOW is returned if the length of <var class=Fa>buf</var> specified by <var class=Fa>len</var> is too short to hold the template's name. ENOENT is returned if an invalid <var class=Fa>tpl_id</var> is specified.</p><p class=Pp><code class=Fn>stats_tpl_sample_rollthedice</code>() returns a valid template slot id selected from <var class=Fa>rates</var> or -1 if a NULL selection was made, that is no stats collection this roll.</p><p class=Pp><code class=Fn>stats_tpl_add_voistats</code>() return 0 on success, or an errno on failure. EINVAL is returned if any problems are detected with the arguments. EFBIG is returned if the resulting blob would have exceeded the maximum size. EOPNOTSUPP is returned if an attempt is made to add more VOI stats to a previously configured VOI. ENOMEM is returned if a required memory allocation fails.</p><p class=Pp><code class=Fn>stats_voi_update_abs_&lt;dtype&gt;</code>() and <code class=Fn>stats_voi_update_rel_&lt;dtype&gt;</code>() return 0 on success, or EINVAL if any problems are detected with the arguments.</p><p class=Pp><code class=Fn>stats_blob_init</code>() returns 0 on success, or an errno on failure. EINVAL is returned if any problems are detected with the arguments. EOVERFLOW is returned if the template blob's <var class=Fa>cursz</var> is larger than the <var class=Fa>maxsz</var> of the blob being initialized.</p><p class=Pp><code class=Fn>stats_blob_alloc</code>() returns a pointer to a newly allocated and initialized blob based on the specified template with slot ID <var class=Fa>tpl_id</var>, or NULL if the memory allocation failed.</p><p class=Pp><code class=Fn>stats_blob_clone</code>() and <code class=Fn>stats_blob_snapshot</code>() return 0 on success, or an errno on failure. EINVAL is returned if any problems are detected with the arguments. ENOMEM is returned if the SB_CLONE_ALLOCDST flag was specified and the memory allocation for <var class=Fa>dst</var> fails. EOVERFLOW is returned if the src blob's <var class=Fa>cursz</var> is larger than the <var class=Fa>maxsz</var> of the <var class=Fa>dst</var> blob.</p><p class=Pp><code class=Fn>stats_blob_visit</code>() returns 0 on success, or EINVAL if any problems are detected with the arguments.</p><p class=Pp><code class=Fn>stats_blob_tostr</code>() and <code class=Fn>stats_voistatdata_tostr</code>() return 0 on success, or an errno on failure. EINVAL is returned if any problems are detected with the arguments, otherwise any error returned by <code class=Fn>sbuf_error</code>() for <var class=Fa>buf</var> is returned.</p><p class=Pp><code class=Fn>stats_voistat_fetch_dptr</code>() returns 0 on success, or EINVAL if any problems are detected with the arguments.</p><p class=Pp><code class=Fn>stats_voistat_fetch_&lt;dtype&gt;</code>() returns 0 on success, or an errno on failure. EINVAL is returned if any problems are detected with the arguments. EFTYPE is returned if the requested data type does not match the blob's data type for the specified <var class=Fa>voi_id</var> and <var class=Fa>stype</var>.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=errno.2.html>errno(2)</a>, <a class=Xr href=arb.3.html>arb(3)</a>, <a class=Xr href=qmath.3.html>qmath(3)</a>, <a class=Xr href=tcp.4.html>tcp(4)</a>, <a class=Xr href=sbuf.9.html>sbuf(9)</a><p class=Pp><cite class=Rs><span class=RsA>Ted Dunning</span> and <span class=RsA>Otmar Ertl</span>, <span class=RsT>Computing Extremely Accurate Quantiles Using t-digests</span>, <a class=RsU href=https://github.com/tdunning/t-digest/raw/master/docs/t-digest-paper/histo.pdf>https://github.com/tdunning/t-digest/raw/master/docs/t-digest-paper/histo.pdf</a>.</cite></p></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>stats</code> framework first appeared in <span class=Ux>FreeBSD 13.0</span>. </section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>stats</code> framework and this manual page were written by <span class=An>Lawrence Stewart</span> ⟨lstewart@FreeBSD.org⟩ and sponsored by Netflix, Inc. </section><section class=Sh><h2 class=Sh id=CAVEATS><a class=permalink href=#CAVEATS>CAVEATS</a></h2> Granularity of timing-dependent network statistics, in particular TCP_RTT, depends on the <code class=Dv>HZ</code> timer. To minimize the measurement error avoid using HZ lower than 1000. </section></div><table class=foot><tr><td class=foot-date>December 2, 2019</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>