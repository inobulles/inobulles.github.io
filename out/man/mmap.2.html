<!DOCTYPE html>
<html><head><meta charset=utf-8><title>mmap(2)</title><keywords content=man,mmap></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>mmap(2)</h1><table class=head><tr><td class=head-ltitle>MMAP(2)</td><td class=head-vol>FreeBSD System Calls Manual</td><td class=head-rtitle>MMAP(2)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>mmap</code> — <div class=Nd>allocate memory, or map files or devices into memory</div></section><section class=Sh><h2 class=Sh id=LIBRARY><a class=permalink href=#LIBRARY>LIBRARY</a></h2><span class=Lb>Standard C Library (libc, -lc)</span></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/sys/mman.h.html>sys/mman.h</a>&gt;</code><p class=Pp><var class=Ft>void *</var><br><code class=Fn>mmap</code>(<var class=Fa style="white-space: nowrap;">void *addr</var>, <var class=Fa style="white-space: nowrap;">size_t len</var>, <var class=Fa style="white-space: nowrap;">int prot</var>, <var class=Fa style="white-space: nowrap;">int flags</var>, <var class=Fa style="white-space: nowrap;">int fd</var>, <var class=Fa style="white-space: nowrap;">off_t offset</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Fn>mmap</code>() system call causes the pages starting at <var class=Fa>addr</var> and continuing for at most <var class=Fa>len</var> bytes to be mapped from the object described by <var class=Fa>fd</var>, starting at byte offset <var class=Fa>offset</var>. If <var class=Fa>len</var> is not a multiple of the page size, the mapped region may extend past the specified range. Any such extension beyond the end of the mapped object will be zero-filled. <p class=Pp>If <var class=Fa>fd</var> references a regular file or a shared memory object, the range of bytes starting at <var class=Fa>offset</var> and continuing for <var class=Fa>len</var> bytes must be legitimate for the possible (not necessarily current) offsets in the object. In particular, the <var class=Fa>offset</var> value cannot be negative. If the object is truncated and the process later accesses a page that is wholly within the truncated region, the access is aborted and a <code class=Dv>SIGBUS</code> signal is delivered to the process.</p><p class=Pp>If <var class=Fa>fd</var> references a device file, the interpretation of the <var class=Fa>offset</var> value is device specific and defined by the device driver. The virtual memory subsystem does not impose any restrictions on the <var class=Fa>offset</var> value in this case, passing it unchanged to the driver.</p><p class=Pp>If <var class=Fa>addr</var> is non-zero, it is used as a hint to the system. (As a convenience to the system, the actual address of the region may differ from the address supplied.) If <var class=Fa>addr</var> is zero, an address will be selected by the system. The actual starting address of the region is returned. A successful <var class=Fa>mmap</var> deletes any previous mapping in the allocated address range.</p><p class=Pp>The protections (region accessibility) are specified in the <var class=Fa>prot</var> argument by <i class=Em>or</i>'ing the following values:</p><p class=Pp></p><dl class="Bl-tag Bl-compact"><dt><a class=permalink href=#PROT_NONE><code class=Dv id=PROT_NONE>PROT_NONE</code></a></dt><dd>Pages may not be accessed.</dd><dt><a class=permalink href=#PROT_READ><code class=Dv id=PROT_READ>PROT_READ</code></a></dt><dd>Pages may be read.</dd><dt><a class=permalink href=#PROT_WRITE><code class=Dv id=PROT_WRITE>PROT_WRITE</code></a></dt><dd>Pages may be written.</dd><dt><a class=permalink href=#PROT_EXEC><code class=Dv id=PROT_EXEC>PROT_EXEC</code></a></dt><dd>Pages may be executed.</dd></dl><p class=Pp>In addition to these protection flags, <span class=Ux>FreeBSD</span> provides the ability to set the maximum protection of a region allocated by <code class=Nm>mmap</code> and later altered by <a class=Xr href=mprotect.2.html>mprotect(2)</a>. This is accomplished by <i class=Em>or</i>'ing one or more <code class=Dv>PROT_</code> values wrapped in the <code class=Dv>PROT_MAX()</code> macro into the <var class=Fa>prot</var> argument.</p><p class=Pp>The <var class=Fa>flags</var> argument specifies the type of the mapped object, mapping options and whether modifications made to the mapped copy of the page are private to the process or are to be shared with other references. Sharing, mapping type and options are specified in the <var class=Fa>flags</var> argument by <i class=Em>or</i>'ing the following values:</p><dl class=Bl-tag><dt><a class=permalink href=#MAP_32BIT><code class=Dv id=MAP_32BIT>MAP_32BIT</code></a></dt><dd>Request a region in the first 2GB of the current process's address space. If a suitable region cannot be found, <code class=Fn>mmap</code>() will fail. This flag is only available on 64-bit platforms.</dd><dt><a class=permalink href=#MAP_ALIGNED><code class=Dv id=MAP_ALIGNED>MAP_ALIGNED</code></a>(<var class=Fa>n</var>)</dt><dd>Align the region on a requested boundary. If a suitable region cannot be found, <code class=Fn>mmap</code>() will fail. The <var class=Fa>n</var> argument specifies the binary logarithm of the desired alignment.</dd><dt><a class=permalink href=#MAP_ALIGNED_SUPER><code class=Dv id=MAP_ALIGNED_SUPER>MAP_ALIGNED_SUPER</code></a></dt><dd>Align the region to maximize the potential use of large (“super”) pages. If a suitable region cannot be found, <code class=Fn>mmap</code>() will fail. The system will choose a suitable page size based on the size of mapping. The page size used as well as the alignment of the region may both be affected by properties of the file being mapped. In particular, the physical address of existing pages of a file may require a specific alignment. The region is not guaranteed to be aligned on any specific boundary.</dd><dt><a class=permalink href=#MAP_ANON><code class=Dv id=MAP_ANON>MAP_ANON</code></a></dt><dd>Map anonymous memory not associated with any specific file. The file descriptor used for creating <code class=Dv>MAP_ANON</code> must be -1. The <var class=Fa>offset</var> argument must be 0.</dd><dt><a class=permalink href=#MAP_ANONYMOUS><code class=Dv id=MAP_ANONYMOUS>MAP_ANONYMOUS</code></a></dt><dd>This flag is identical to <code class=Dv>MAP_ANON</code> and is provided for compatibility.</dd><dt><a class=permalink href=#MAP_EXCL><code class=Dv id=MAP_EXCL>MAP_EXCL</code></a></dt><dd>This flag can only be used in combination with <code class=Dv>MAP_FIXED</code>. Please see the definition of <code class=Dv>MAP_FIXED</code> for the description of its effect.</dd><dt><a class=permalink href=#MAP_FIXED><code class=Dv id=MAP_FIXED>MAP_FIXED</code></a></dt><dd>Do not permit the system to select a different address than the one specified. If the specified address cannot be used, <code class=Fn>mmap</code>() will fail. If <code class=Dv>MAP_FIXED</code> is specified, <var class=Fa>addr</var> must be a multiple of the page size. If <code class=Dv>MAP_EXCL</code> is not specified, a successful <code class=Dv>MAP_FIXED</code> request replaces any previous mappings for the process' pages in the range from <var class=Fa>addr</var> to <var class=Fa>addr</var> + <var class=Fa>len</var>. In contrast, if <code class=Dv>MAP_EXCL</code> is specified, the request will fail if a mapping already exists within the range.</dd><dt><a class=permalink href=#MAP_GUARD><code class=Dv id=MAP_GUARD>MAP_GUARD</code></a></dt><dd>Instead of a mapping, create a guard of the specified size. Guards allow a process to create reservations in its address space, which can later be replaced by actual mappings. <p class=Pp><var class=Fa>mmap</var> will not create mappings in the address range of a guard unless the request specifies <code class=Dv>MAP_FIXED</code>. Guards can be destroyed with <a class=Xr href=munmap.2.html>munmap(2)</a>. Any memory access by a thread to the guarded range results in the delivery of a <code class=Dv>SIGSEGV</code> signal to that thread.</p></dd><dt><a class=permalink href=#MAP_NOCORE><code class=Dv id=MAP_NOCORE>MAP_NOCORE</code></a></dt><dd>Region is not included in a core file.</dd><dt><a class=permalink href=#MAP_NOSYNC><code class=Dv id=MAP_NOSYNC>MAP_NOSYNC</code></a></dt><dd>Causes data dirtied via this VM map to be flushed to physical media only when necessary (usually by the pager) rather than gratuitously. Typically this prevents the update daemons from flushing pages dirtied through such maps and thus allows efficient sharing of memory across unassociated processes using a file-backed shared memory map. Without this option any VM pages you dirty may be flushed to disk every so often (every 30-60 seconds usually) which can create performance problems if you do not need that to occur (such as when you are using shared file-backed mmap regions for IPC purposes). Dirty data will be flushed automatically when all mappings of an object are removed and all descriptors referencing the object are closed. Note that VM/file system coherency is maintained whether you use <code class=Dv>MAP_NOSYNC</code> or not. This option is not portable across <span class=Ux>UNIX</span> platforms (yet), though some may implement the same behavior by default. <p class=Pp><i class=Em>WARNING</i>! Extending a file with <a class=Xr href=ftruncate.2.html>ftruncate(2)</a>, thus creating a big hole, and then filling the hole by modifying a shared <code class=Fn>mmap</code>() can lead to severe file fragmentation. In order to avoid such fragmentation you should always pre-allocate the file's backing store by <code class=Fn>write</code>()ing zero's into the newly extended area prior to modifying the area via your <code class=Fn>mmap</code>(). The fragmentation problem is especially sensitive to <code class=Dv>MAP_NOSYNC</code> pages, because pages may be flushed to disk in a totally random order.</p><p class=Pp>The same applies when using <code class=Dv>MAP_NOSYNC</code> to implement a file-based shared memory store. It is recommended that you create the backing store by <code class=Fn>write</code>()ing zero's to the backing file rather than <code class=Fn>ftruncate</code>()ing it. You can test file fragmentation by observing the KB/t (kilobytes per transfer) results from an “<code class=Li>iostat 1</code>” while reading a large file sequentially, e.g., using “<code class=Li>dd if=filename of=/dev/null bs=32k</code>”.</p><p class=Pp>The <a class=Xr href=fsync.2.html>fsync(2)</a> system call will flush all dirty data and metadata associated with a file, including dirty NOSYNC VM data, to physical media. The <a class=Xr href=sync.8.html>sync(8)</a> command and <a class=Xr href=sync.2.html>sync(2)</a> system call generally do not flush dirty NOSYNC VM data. The <a class=Xr href=msync.2.html>msync(2)</a> system call is usually not needed since <span class=Ux>BSD</span> implements a coherent file system buffer cache. However, it may be used to associate dirty VM pages with file system buffers and thus cause them to be flushed to physical media sooner rather than later.</p></dd><dt><a class=permalink href=#MAP_PREFAULT_READ><code class=Dv id=MAP_PREFAULT_READ>MAP_PREFAULT_READ</code></a></dt><dd>Immediately update the calling process's lowest-level virtual address translation structures, such as its page table, so that every memory resident page within the region is mapped for read access. Ordinarily these structures are updated lazily. The effect of this option is to eliminate any soft faults that would otherwise occur on the initial read accesses to the region. Although this option does not preclude <var class=Fa>prot</var> from including <code class=Dv>PROT_WRITE</code>, it does not eliminate soft faults on the initial write accesses to the region.</dd><dt><a class=permalink href=#MAP_PRIVATE><code class=Dv id=MAP_PRIVATE>MAP_PRIVATE</code></a></dt><dd>Modifications are private.</dd><dt><a class=permalink href=#MAP_SHARED><code class=Dv id=MAP_SHARED>MAP_SHARED</code></a></dt><dd>Modifications are shared.</dd><dt><a class=permalink href=#MAP_STACK><code class=Dv id=MAP_STACK>MAP_STACK</code></a></dt><dd>Creates both a mapped region that grows downward on demand and an adjoining guard that both reserves address space for the mapped region to grow into and limits the mapped region's growth. Together, the mapped region and the guard occupy <var class=Fa>len</var> bytes of the address space. The guard starts at the returned address, and the mapped region ends at the returned address plus <var class=Fa>len</var> bytes. Upon access to the guard, the mapped region automatically grows in size, and the guard shrinks by an equal amount. Essentially, the boundary between the guard and the mapped region moves downward so that the access falls within the enlarged mapped region. However, the guard will never shrink to less than the number of pages specified by the sysctl <code class=Dv>security.bsd.stack_guard_page</code>, thereby ensuring that a gap for detecting stack overflow always exists between the downward growing mapped region and the closest mapped region beneath it. <p class=Pp><code class=Dv>MAP_STACK</code> implies <code class=Dv>MAP_ANON</code> and <var class=Fa>offset</var> of 0. The <var class=Fa>fd</var> argument must be -1 and <var class=Fa>prot</var> must include at least <code class=Dv>PROT_READ</code> and <code class=Dv>PROT_WRITE</code>. The size of the guard, in pages, is specified by sysctl <code class=Dv>security.bsd.stack_guard_page</code>.</p></dd></dl><p class=Pp>The <a class=Xr href=close.2.html>close(2)</a> system call does not unmap pages, see <a class=Xr href=munmap.2.html>munmap(2)</a> for further information.</p></section><section class=Sh><h2 class=Sh id=NOTES><a class=permalink href=#NOTES>NOTES</a></h2> Although this implementation does not impose any alignment restrictions on the <var class=Fa>offset</var> argument, a portable program must only use page-aligned values. <p class=Pp>Large page mappings require that the pages backing an object be aligned in matching blocks in both the virtual address space and RAM. The system will automatically attempt to use large page mappings when mapping an object that is already backed by large pages in RAM by aligning the mapping request in the virtual address space to match the alignment of the large physical pages. The system may also use large page mappings when mapping portions of an object that are not yet backed by pages in RAM. The <code class=Dv>MAP_ALIGNED_SUPER</code> flag is an optimization that will align the mapping request to the size of a large page similar to <code class=Dv>MAP_ALIGNED</code>, except that the system will override this alignment if an object already uses large pages so that the mapping will be consistent with the existing large pages. This flag is mostly useful for maximizing the use of large pages on the first mapping of objects that do not yet have pages present in RAM.</p></section><section class=Sh><h2 class=Sh id=RETURN_VALUES><a class=permalink href=#RETURN_VALUES>RETURN VALUES</a></h2> Upon successful completion, <code class=Fn>mmap</code>() returns a pointer to the mapped region. Otherwise, a value of <code class=Dv>MAP_FAILED</code> is returned and <var class=Va>errno</var> is set to indicate the error. </section><section class=Sh><h2 class=Sh id=ERRORS><a class=permalink href=#ERRORS>ERRORS</a></h2> The <code class=Fn>mmap</code>() system call will fail if: <dl class=Bl-tag><dt>[<a class=permalink href=#EACCES><code class=Er id=EACCES>EACCES</code></a>]</dt><dd>The flag <code class=Dv>PROT_READ</code> was specified as part of the <var class=Fa>prot</var> argument and <var class=Fa>fd</var> was not open for reading. The flags <code class=Dv>MAP_SHARED</code> and <code class=Dv>PROT_WRITE</code> were specified as part of the <var class=Fa>flags</var> and <var class=Fa>prot</var> argument and <var class=Fa>fd</var> was not open for writing.</dd><dt>[<a class=permalink href=#EBADF><code class=Er id=EBADF>EBADF</code></a>]</dt><dd>The <var class=Fa>fd</var> argument is not a valid open file descriptor.</dd><dt>[<a class=permalink href=#EINVAL><code class=Er id=EINVAL>EINVAL</code></a>]</dt><dd>An invalid (negative) value was passed in the <var class=Fa>offset</var> argument, when <var class=Fa>fd</var> referenced a regular file or shared memory.</dd><dt>[<a class=permalink href=#EINVAL_2><code class=Er id=EINVAL_2>EINVAL</code></a>]</dt><dd>An invalid value was passed in the <var class=Fa>prot</var> argument.</dd><dt>[<a class=permalink href=#EINVAL_3><code class=Er id=EINVAL_3>EINVAL</code></a>]</dt><dd>An undefined option was set in the <var class=Fa>flags</var> argument.</dd><dt>[<a class=permalink href=#EINVAL_4><code class=Er id=EINVAL_4>EINVAL</code></a>]</dt><dd>Both <code class=Dv>MAP_PRIVATE</code> and <code class=Dv>MAP_SHARED</code> were specified.</dd><dt>[<a class=permalink href=#EINVAL_5><code class=Er id=EINVAL_5>EINVAL</code></a>]</dt><dd>None of <code class=Dv>MAP_ANON</code>, <code class=Dv>MAP_GUARD</code>, <code class=Dv>MAP_PRIVATE</code>, <code class=Dv>MAP_SHARED</code>, or <code class=Dv>MAP_STACK</code> was specified. At least one of these flags must be included.</dd><dt>[<a class=permalink href=#EINVAL_6><code class=Er id=EINVAL_6>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_STACK_2><code class=Dv id=MAP_STACK_2>MAP_STACK</code></a> was specified and <var class=Va>len</var> is less than or equal to the guard size.</dd><dt>[<a class=permalink href=#EINVAL_7><code class=Er id=EINVAL_7>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_FIXED_2><code class=Dv id=MAP_FIXED_2>MAP_FIXED</code></a> was specified and the <var class=Fa>addr</var> argument was not page aligned, or part of the desired address space resides out of the valid address space for a user process.</dd><dt>[<a class=permalink href=#EINVAL_8><code class=Er id=EINVAL_8>EINVAL</code></a>]</dt><dd>Both <code class=Dv>MAP_FIXED</code> and <code class=Dv>MAP_32BIT</code> were specified and part of the desired address space resides outside of the first 2GB of user address space.</dd><dt>[<a class=permalink href=#EINVAL_9><code class=Er id=EINVAL_9>EINVAL</code></a>]</dt><dd>The <var class=Fa>len</var> argument was equal to zero.</dd><dt>[<a class=permalink href=#EINVAL_10><code class=Er id=EINVAL_10>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_ALIGNED_2><code class=Dv id=MAP_ALIGNED_2>MAP_ALIGNED</code></a> was specified and the desired alignment was either larger than the virtual address size of the machine or smaller than a page.</dd><dt>[<a class=permalink href=#EINVAL_11><code class=Er id=EINVAL_11>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_ANON_2><code class=Dv id=MAP_ANON_2>MAP_ANON</code></a> was specified and the <var class=Fa>fd</var> argument was not -1.</dd><dt>[<a class=permalink href=#EINVAL_12><code class=Er id=EINVAL_12>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_ANON_3><code class=Dv id=MAP_ANON_3>MAP_ANON</code></a> was specified and the <var class=Fa>offset</var> argument was not 0.</dd><dt>[<a class=permalink href=#EINVAL_13><code class=Er id=EINVAL_13>EINVAL</code></a>]</dt><dd>Both <code class=Dv>MAP_FIXED</code> and <code class=Dv>MAP_EXCL</code> were specified, but the requested region is already used by a mapping.</dd><dt>[<a class=permalink href=#EINVAL_14><code class=Er id=EINVAL_14>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_EXCL_2><code class=Dv id=MAP_EXCL_2>MAP_EXCL</code></a> was specified, but <code class=Dv>MAP_FIXED</code> was not.</dd><dt>[<a class=permalink href=#EINVAL_15><code class=Er id=EINVAL_15>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_GUARD_2><code class=Dv id=MAP_GUARD_2>MAP_GUARD</code></a> was specified, but the <var class=Fa>offset</var> argument was not zero, the <var class=Fa>fd</var> argument was not -1, or the <var class=Fa>prot</var> argument was not <code class=Dv>PROT_NONE</code>.</dd><dt>[<a class=permalink href=#EINVAL_16><code class=Er id=EINVAL_16>EINVAL</code></a>]</dt><dd><a class=permalink href=#MAP_GUARD_3><code class=Dv id=MAP_GUARD_3>MAP_GUARD</code></a> was specified together with one of the flags <code class=Dv>MAP_ANON</code>, <code class=Dv>MAP_PREFAULT</code>, <code class=Dv>MAP_PREFAULT_READ</code>, <code class=Dv>MAP_PRIVATE</code>, <code class=Dv>MAP_SHARED</code>, <code class=Dv>MAP_STACK</code>.</dd><dt>[<a class=permalink href=#ENODEV><code class=Er id=ENODEV>ENODEV</code></a>]</dt><dd><a class=permalink href=#MAP_ANON_4><code class=Dv id=MAP_ANON_4>MAP_ANON</code></a> has not been specified and <var class=Fa>fd</var> did not reference a regular or character special file.</dd><dt>[<a class=permalink href=#ENOMEM><code class=Er id=ENOMEM>ENOMEM</code></a>]</dt><dd><a class=permalink href=#MAP_FIXED_3><code class=Dv id=MAP_FIXED_3>MAP_FIXED</code></a> was specified and the <var class=Fa>addr</var> argument was not available. <code class=Dv>MAP_ANON</code> was specified and insufficient memory was available.</dd><dt>[<a class=permalink href=#ENOTSUP><code class=Er id=ENOTSUP>ENOTSUP</code></a>]</dt><dd>The <var class=Fa>prot</var> argument contains protections which are not a subset of the specified maximum protections.</dd></dl></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=madvise.2.html>madvise(2)</a>, <a class=Xr href=mincore.2.html>mincore(2)</a>, <a class=Xr href=minherit.2.html>minherit(2)</a>, <a class=Xr href=mlock.2.html>mlock(2)</a>, <a class=Xr href=mprotect.2.html>mprotect(2)</a>, <a class=Xr href=msync.2.html>msync(2)</a>, <a class=Xr href=munlock.2.html>munlock(2)</a>, <a class=Xr href=munmap.2.html>munmap(2)</a>, <a class=Xr href=getpagesize.3.html>getpagesize(3)</a>, <a class=Xr href=getpagesizes.3.html>getpagesizes(3)</a></section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The <code class=Nm>mmap</code> system call was first documented in <span class=Ux>4.2BSD</span> and implemented in <span class=Ux>4.4BSD</span>. <p class=Pp>The <code class=Dv>PROT_MAX</code> functionality was introduced in <span class=Ux>FreeBSD 13</span>.</p></section></div><table class=foot><tr><td class=foot-date>December 24, 2020</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>