<!DOCTYPE html>
<html><head><meta charset=utf-8><title>mod_cc(9)</title><keywords content=man,mod_cc></keywords><style>:root { --monitor-bleed: rgba(183, 0, 255, 0.46); --gradient: -webkit-linear-gradient(50deg, rgb(126, 119, 255), rgb(255, 34, 137)); --background-colour: #fff; --title-colour: #000; --text-colour: #000; --article-colour: #fff; --accent-colour: #4385f5; --muted-colour: #555; --shadow-colour: rgba(183, 0, 255, 0.487); --border-radius: 12px; --blur-radius: 0px; --navbar-colour: #fffc; --navbar-shadow: rgba(183, 0, 255, 0.1) 0 8px 32px; --code-background: #ddd; } .dark { visibility: hidden; } @media (prefers-color-scheme: light) { } @media (prefers-color-scheme: dark) { :root { --monitor-bleed: rgba(183, 0, 255, 0.172); --gradient: -webkit-linear-gradient(50deg, rgb(255, 79, 79), rgb(255, 52, 221)); --background-colour: #000; --title-colour: #fff; --text-colour: #ddd; --article-colour: #00000033; --accent-colour: #98beff; --muted-colour: #999; --shadow-colour: #ff00cc29; --blur-radius: 96px; --navbar-colour: #000a; --navbar-shadow: rgba(183, 0, 255, 0.05) 0 8px 32px; --code-background: #111; } .dark { visibility: visible; } .light { visibility: hidden; } } html, body { overflow-x: hidden; } body { background-image: url(bg.svg); background-size: cover; margin: 0; background-color: var(--background-colour); color: var(--text-colour); font-size: 22px; font-display: optional; font-family: "Montserrat", sans-serif; overflow-y: hidden; } h1 { color: var(--title-colour); font-size: 70px; font-display: optional; font-family: "Montserrat", sans-serif; } h2 { color: var(--title-colour); font-size: 40px; font-display: optional; font-family: "Montserrat", sans-serif; } h3 { color: var(--title-colour); font-size: 24px; font-display: optional; font-family: "Roboto Slab", serif; } q, blockquote { font-style: italic; white-space: pre-wrap; padding-left: 42px; } pre { margin: 32px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word; } strong { background: var(--gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; } code { border-radius: 8px; background-color: var(--code-background); } pre { white-space: pre-wrap; } .info-container { max-width: 400px; margin: 32px; } .info-container p { margin-inline: 16px; margin-block: 32px; text-align: justify; font-size: 18px; } .labeled-img { max-width: 100%; position: relative; } .labeled-img div { position: absolute; bottom: 0; width: 100%; height: 70%; background: linear-gradient(to bottom, transparent, black); border-radius: var(--border-radius); } .labeled-img div h2 { color: white; position: absolute; bottom: 0; left: 32px; } .labeled-img img { width: 100%; border-radius: var(--border-radius); } a { background: var(--gradient); background-clip: none; color: var(--background-colour); font-weight: bold; text-decoration: none; border-radius: 3px; } a:hover { background: var(--text-colour); } .link, .link:hover { background: none; } button { background: var(--gradient); color: var(--background-colour); box-shadow: none; border: none; border-radius: 48px; padding: 8px; padding-left: 32px; padding-right: 32px; margin: 24px; font-size: 24px; font-display: optional; font-family: "Montserrat", sans-serif; font-weight: bold; cursor: pointer; transition: background .2s, color .2s, opacity .2s, box-shadow .2s, transform .2s; } button:hover { box-shadow: var(--shadow-colour) 0 8px 32px; transform: translateY(-4px); } button:active { transform: none; opacity: 50%; } .clickable { padding: 2px; transition: background-color 0.05s ease-out; border-radius: var(--border-radius); } .clickable:hover { background-color: var(--shadow-colour); } .docs-container { margin: auto; margin-top: 64px; max-width: 1200px; display: grid; justify-content: center; grid-template-columns: 1fr 3fr; } .docs { max-width: 900px; } .sidebar { min-width: 250px; position: fixed; padding: 16px; display: grid; justify-content: center; grid-auto-flow: row; grid-gap: 32px; padding-top: 64px; } .sidebar * { margin: auto; display: grid; justify-content: left; grid-auto-flow: column; grid-gap: 8px; } .sidebar p { font-size: 18px; } .sidebar-item { color: var(--text-colour); background: none; padding-inline: 8px; width: 100%; height: 100%; } .sidebar-item div svg { fill: var(--text-colour); } .navbar-container { width: 100vw; height: 48px; } .navbar { position: fixed; z-index: 100; width: 100vw; background-color: var(--navbar-colour); backdrop-filter: blur(20px); display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 32px; padding: 12px; } .navbar * { margin: auto; display: grid; justify-content: center; grid-auto-flow: column; grid-gap: 8px; } .navbar p { font-size: 18px; } .navbar-logo { height: 100%; max-height: 32px; stroke: var(--text-colour); } .navbar-icon { fill: var(--text-colour); } .navbar-item { color: var(--text-colour); background-color: transparent; padding-inline: 8px; width: 100%; height: 100%; border-radius: 8px; } @media only screen and (max-width: 800px) { .navbar-item { position: absolute; visibility: hidden; } } footer { text-align: center; padding: 64px; border-radius: 64px 64px 0 0; background: -webkit-linear-gradient(50deg, transparent, var(--monitor-bleed)); } footer p { margin: auto; } .permalink { color: var(--text-colour); background: none; } .permalink:hover { background: none; } </style></head><body><html><body><div class=navbar-container><div class=navbar><a class="navbar-item clickable link" href=https://inobulles.github.io><div><svg class=navbar-logo fill=none height=24px viewbox="0 0 144 144" width=24px xmlns=http://www.w3.org/2000/svg><path d=m22,115l50,-88l50,88l-100,0z stroke-width=20 transform="rotate(180 72 72)"></path></svg><p><strong>aquaBSD</strong></p></div></a><a class="navbar-item clickable link" href=https://inobulles.github.io/docs><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"></path></svg><p>Develop</p></div></a><a class="navbar-item clickable link" href=mailto:inobulles@gmail.com><div><svg class=navbar-icon fill=none height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1z"></path></svg><p>Contact</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M19.46,9.12l-2.78,1.15 c-0.51-1.36-1.58-2.44-2.95-2.94l1.15-2.78C16.98,5.35,18.65,7.02,19.46,9.12z M12,15c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3 S13.66,15,12,15z M9.13,4.54l1.17,2.78c-1.38,0.5-2.47,1.59-2.98,2.97L4.54,9.13C5.35,7.02,7.02,5.35,9.13,4.54z M4.54,14.87 l2.78-1.15c0.51,1.38,1.59,2.46,2.97,2.96l-1.17,2.78C7.02,18.65,5.35,16.98,4.54,14.87z M14.88,19.46l-1.15-2.78 c1.37-0.51,2.45-1.59,2.95-2.97l2.78,1.17C18.65,16.98,16.98,18.65,14.88,19.46z"></path></g></svg><p>Support</p></div></a><a class="navbar-item clickable link" href=#><div><svg class=navbar-icon fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 12 7.4l3.38 4.6L17 10.83 14.92 8H20v6z"></path></svg><p>Log in</p></div></a></div></div></body></html><div class=docs-container><html><body><div class=sidebar-container><div class=sidebar><a class="sidebar-item clickable" href=https://inobulles.github.io/docs><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M12.36 6l.4 2H18v6h-3.36l-.4-2H7V6h5.36M14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6L14 4z"></path></svg><p>Introduction</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/struct><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><rect fill=none height=24 width=24></rect><path d="M22,11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3H22z M7,9H4V5h3V9z M17,15h3v4h-3V15z M17,5h3v4h-3V5z"></path></svg><p>OS Components</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/dev-tools><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><rect height=8.48 transform="matrix(0.7071 -0.7071 0.7071 0.7071 -6.8717 17.6255)" width=3 x=16.34 y=12.87></rect><path d="M17.5,10c1.93,0,3.5-1.57,3.5-3.5c0-0.58-0.16-1.12-0.41-1.6l-2.7,2.7L16.4,6.11l2.7-2.7C18.62,3.16,18.08,3,17.5,3 C15.57,3,14,4.57,14,6.5c0,0.41,0.08,0.8,0.21,1.16l-1.85,1.85l-1.78-1.78l0.71-0.71L9.88,5.61L12,3.49 c-1.17-1.17-3.07-1.17-4.24,0L4.22,7.03l1.41,1.41H2.81L2.1,9.15l3.54,3.54l0.71-0.71V9.15l1.41,1.41l0.71-0.71l1.78,1.78 l-7.41,7.41l2.12,2.12L16.34,9.79C16.7,9.92,17.09,10,17.5,10z"></path></g></g></svg><p>Developer Tools</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/create-app><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24 x=0></rect></g><g><g><polygon points="19,9 20.25,6.25 23,5 20.25,3.75 19,1 17.75,3.75 15,5 17.75,6.25"></polygon><polygon points="19,15 17.75,17.75 15,19 17.75,20.25 19,23 20.25,20.25 23,19 20.25,17.75"></polygon><path d="M11.5,9.5L9,4L6.5,9.5L1,12l5.5,2.5L9,20l2.5-5.5L17,12L11.5,9.5z M9.99,12.99L9,15.17l-0.99-2.18L5.83,12l2.18-0.99 L9,8.83l0.99,2.18L12.17,12L9.99,12.99z"></path></g></g></svg><p>Creating an App</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/packaging><div><svg enable-background="new 0 0 24 24" fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><g><rect fill=none height=24 width=24></rect></g><g><g><path d="M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M19,20H5V9h14V20z M20,7H4V4h16V7z"></path><rect height=2 width=6 x=9 y=12></rect></g></g></svg><p>Packaging Apps</p></div></a><a class="sidebar-item clickable" href=https://inobulles.github.io/docs/publishing><div><svg fill=#000000 height=24px viewbox="0 0 24 24" width=24px xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none></path><path d="M13 3v1h-2V3h2m-1 7.11l5.38 1.77 2.39.78-1.12 3.97c-.54-.3-.94-.71-1.14-.94L16 13.96l-1.51 1.72c-.34.4-1.28 1.32-2.49 1.32s-2.15-.92-2.49-1.32L8 13.96l-1.51 1.72c-.2.23-.6.63-1.14.93l-1.13-3.96 2.4-.79L12 10.11M15 1H9v3H6c-1.1 0-2 .9-2 2v4.62l-1.29.42c-.26.08-.48.26-.6.5s-.15.52-.06.78L3.95 19H4c1.6 0 3.02-.88 4-2 .98 1.12 2.4 2 4 2s3.02-.88 4-2c.98 1.12 2.4 2 4 2h.05l1.89-6.68c.08-.26.06-.54-.06-.78s-.34-.42-.6-.5L20 10.62V6c0-1.1-.9-2-2-2h-3V1zM6 9.97V6h12v3.97L12 8 6 9.97zm10 9.71c-1.22.85-2.61 1.28-4 1.28s-2.78-.43-4-1.28C6.78 20.53 5.39 21 4 21H2v2h2c1.38 0 2.74-.35 4-.99 1.26.64 2.63.97 4 .97s2.74-.32 4-.97c1.26.65 2.62.99 4 .99h2v-2h-2c-1.39 0-2.78-.47-4-1.32z"></path></svg><p>Publishing Apps</p></div></a></div></div></body></html><div class=docs><h1>mod_cc(9)</h1><table class=head><tr><td class=head-ltitle>MOD_CC(9)</td><td class=head-vol>FreeBSD Kernel Developer's Manual</td><td class=head-rtitle>MOD_CC(9)</td></tr></table><div class=manual-text><section class=Sh><h2 class=Sh id=NAME><a class=permalink href=#NAME>NAME</a></h2><code class=Nm>mod_cc</code>, <code class=Nm>DECLARE_CC_MODULE</code>, <code class=Nm>CCV</code> — <div class=Nd>Modular Congestion Control</div></section><section class=Sh><h2 class=Sh id=SYNOPSIS><a class=permalink href=#SYNOPSIS>SYNOPSIS</a></h2><code class=In>#include &lt;<a class=In href=../src/netinet/tcp.h.html>netinet/tcp.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netinet/cc/cc.h.html>netinet/cc/cc.h</a>&gt;</code><br><code class=In>#include &lt;<a class=In href=../src/netinet/cc/cc_module.h.html>netinet/cc/cc_module.h</a>&gt;</code><p class=Pp><code class=Fn>DECLARE_CC_MODULE</code>(<var class=Fa style="white-space: nowrap;">ccname</var>, <var class=Fa style="white-space: nowrap;">ccalgo</var>);</p><p class=Pp><code class=Fn>CCV</code>(<var class=Fa style="white-space: nowrap;">ccv</var>, <var class=Fa style="white-space: nowrap;">what</var>);</p></section><section class=Sh><h2 class=Sh id=DESCRIPTION><a class=permalink href=#DESCRIPTION>DESCRIPTION</a></h2> The <code class=Nm>mod_cc</code> framework allows congestion control algorithms to be implemented as dynamically loadable kernel modules via the <a class=Xr href=kld.4.html>kld(4)</a> facility. Transport protocols can select from the list of available algorithms on a connection-by-connection basis, or use the system default (see <a class=Xr href=mod_cc.4.html>mod_cc(4)</a> for more details). <p class=Pp><code class=Nm>mod_cc</code> modules are identified by an <a class=Xr href=ascii.7.html>ascii(7)</a> name and set of hook functions encapsulated in a <var class=Vt>struct cc_algo</var>, which has the following members:</p><div class="Bd Pp Bd-indent"><pre>
struct cc_algo {
	char	name[TCP_CA_NAME_MAX];
	int	(*mod_init) (void);
	int	(*mod_destroy) (void);
	size_t  (*cc_data_sz)(void);
	int	(*cb_init) (struct cc_var *ccv, void *ptr);
	void	(*cb_destroy) (struct cc_var *ccv);
	void	(*conn_init) (struct cc_var *ccv);
	void	(*ack_received) (struct cc_var *ccv, uint16_t type);
	void	(*cong_signal) (struct cc_var *ccv, uint32_t type);
	void	(*post_recovery) (struct cc_var *ccv);
	void	(*after_idle) (struct cc_var *ccv);
	int	(*ctl_output)(struct cc_var *, struct sockopt *, void *);
	void    (*rttsample)(struct cc_var *, uint32_t, uint32_t, uint32_t);
	void    (*newround)(struct cc_var *, uint32_t);
};
</pre></div><p class=Pp>The <var class=Va>name</var> field identifies the unique name of the algorithm, and should be no longer than TCP_CA_NAME_MAX-1 characters in length (the TCP_CA_NAME_MAX define lives in <code class=In>&lt;<a class=In href=../src/netinet/tcp.h.html>netinet/tcp.h</a>&gt;</code> for compatibility reasons).</p><p class=Pp>The <var class=Va>mod_init</var> function is called when a new module is loaded into the system but before the registration process is complete. It should be implemented if a module needs to set up some global state prior to being available for use by new connections. Returning a non-zero value from <var class=Va>mod_init</var> will cause the loading of the module to fail.</p><p class=Pp>The <var class=Va>mod_destroy</var> function is called prior to unloading an existing module from the kernel. It should be implemented if a module needs to clean up any global state before being removed from the kernel. The return value is currently ignored.</p><p class=Pp>The <var class=Va>cc_data_sz</var> function is called by the socket option code to get the size of data that the <var class=Va>cb_init</var> function needs. The socket option code then preallocates the modules memory so that the <var class=Va>cb_init</var> function will not fail (the socket option code uses M_WAITOK with no locks held to do this).</p><p class=Pp>The <var class=Va>cb_init</var> function is called when a TCP control block <var class=Vt>struct tcpcb</var> is created. It should be implemented if a module needs to allocate memory for storing private per-connection state. Returning a non-zero value from <var class=Va>cb_init</var> will cause the connection set up to be aborted, terminating the connection as a result. Note that the ptr argument passed to the function should be checked to see if it is non-NULL, if so it is preallocated memory that the cb_init function must use instead of calling malloc itself.</p><p class=Pp>The <var class=Va>cb_destroy</var> function is called when a TCP control block <var class=Vt>struct tcpcb</var> is destroyed. It should be implemented if a module needs to free memory allocated in <var class=Va>cb_init</var>.</p><p class=Pp>The <var class=Va>conn_init</var> function is called when a new connection has been established and variables are being initialised. It should be implemented to initialise congestion control algorithm variables for the newly established connection.</p><p class=Pp>The <var class=Va>ack_received</var> function is called when a TCP acknowledgement (ACK) packet is received. Modules use the <var class=Fa>type</var> argument as an input to their congestion management algorithms. The ACK types currently reported by the stack are CC_ACK and CC_DUPACK. CC_ACK indicates the received ACK acknowledges previously unacknowledged data. CC_DUPACK indicates the received ACK acknowledges data we have already received an ACK for.</p><p class=Pp>The <var class=Va>cong_signal</var> function is called when a congestion event is detected by the TCP stack. Modules use the <var class=Fa>type</var> argument as an input to their congestion management algorithms. The congestion event types currently reported by the stack are CC_ECN, CC_RTO, CC_RTO_ERR and CC_NDUPACK. CC_ECN is reported when the TCP stack receives an explicit congestion notification (RFC3168). CC_RTO is reported when the retransmission time out timer fires. CC_RTO_ERR is reported if the retransmission time out timer fired in error. CC_NDUPACK is reported if N duplicate ACKs have been received back-to-back, where N is the fast retransmit duplicate ack threshold (N=3 currently as per RFC5681).</p><p class=Pp>The <var class=Va>post_recovery</var> function is called after the TCP connection has recovered from a congestion event. It should be implemented to adjust state as required.</p><p class=Pp>The <var class=Va>after_idle</var> function is called when data transfer resumes after an idle period. It should be implemented to adjust state as required.</p><p class=Pp>The <var class=Va>ctl_output</var> function is called when <a class=Xr href=getsockopt.2.html>getsockopt(2)</a> or <a class=Xr href=setsockopt.2.html>setsockopt(2)</a> is called on a <a class=Xr href=tcp.4.html>tcp(4)</a> socket with the <var class=Va>struct sockopt</var> pointer forwarded unmodified from the TCP control, and a <var class=Va>void *</var> pointer to algorithm specific argument.</p><p class=Pp>The <var class=Va>rttsample</var> function is called to pass round trip time information to the congestion controller. The additional arguments to the function include the microsecond RTT that is being noted, the number of times that the data being acknowledged was retransmitted as well as the flightsize at send. For transports that do not track flightsize at send, this variable will be the current cwnd at the time of the call.</p><p class=Pp>The <var class=Va>newround</var> function is called each time a new round trip time begins. The montonically increasing round number is also passed to the congestion controller as well. This can be used for various purposes by the congestion controller (e.g Hystart++).</p><p class=Pp>Note that currently not all TCP stacks call the <var class=Va>rttsample</var> and <var class=Va>newround</var> function so dependancy on these functions is also dependant upon which TCP stack is in use.</p><p class=Pp>The <code class=Fn>DECLARE_CC_MODULE</code>() macro provides a convenient wrapper around the <a class=Xr href=DECLARE_MODULE.9.html>DECLARE_MODULE(9)</a> macro, and is used to register a <code class=Nm>mod_cc</code> module with the <code class=Nm>mod_cc</code> framework. The <var class=Fa>ccname</var> argument specifies the module's name. The <var class=Fa>ccalgo</var> argument points to the module's <var class=Vt>struct cc_algo</var>.</p><p class=Pp><code class=Nm>mod_cc</code> modules must instantiate a <var class=Vt>struct cc_algo</var>, but are only required to set the name field, and optionally any of the function pointers. Note that if a module defines the <var class=Va>cb_init</var> function it also must define a <var class=Va>cc_data_sz</var> function. This is because when switching from one congestion control module to another the socket option code will preallocate memory for the <var class=Va>cb_init</var> function. If no memory is allocated by the modules <var class=Va>cb_init</var> then the <var class=Va>cc_data_sz</var> function should return 0.</p><p class=Pp>The stack will skip calling any function pointer which is NULL, so there is no requirement to implement any of the function pointers (with the exception of the cb_init &lt;-&gt; cc_data_sz dependancy noted above). Using the C99 designated initialiser feature to set fields is encouraged.</p><p class=Pp>Each function pointer which deals with congestion control state is passed a pointer to a <var class=Vt>struct cc_var</var>, which has the following members:</p><div class="Bd Pp Bd-indent"><pre>
struct cc_var {
	void		*cc_data;
	int		bytes_this_ack;
	tcp_seq		curack;
	uint32_t	flags;
	int		type;
	union ccv_container {
		struct tcpcb		*tcp;
		struct sctp_nets	*sctp;
	} ccvc;
	uint16_t	nsegs;
	uint8_t		labc;
};
</pre></div><p class=Pp><var class=Vt>struct cc_var</var> groups congestion control related variables into a single, embeddable structure and adds a layer of indirection to accessing transport protocol control blocks. The eventual goal is to allow a single set of <code class=Nm>mod_cc</code> modules to be shared between all congestion aware transport protocols, though currently only <a class=Xr href=tcp.4.html>tcp(4)</a> is supported.</p><p class=Pp>To aid the eventual transition towards this goal, direct use of variables from the transport protocol's data structures is strongly discouraged. However, it is inevitable at the current time to require access to some of these variables, and so the <code class=Fn>CCV</code>() macro exists as a convenience accessor. The <var class=Fa>ccv</var> argument points to the <var class=Vt>struct cc_var</var> passed into the function by the <code class=Nm>mod_cc</code> framework. The <var class=Fa>what</var> argument specifies the name of the variable to access.</p><p class=Pp>Apart from the <var class=Va>type</var> and <var class=Va>ccv_container</var> fields, the remaining fields in <var class=Vt>struct cc_var</var> are for use by <code class=Nm>mod_cc</code> modules.</p><p class=Pp>The <var class=Va>cc_data</var> field is available for algorithms requiring additional per-connection state to attach a dynamic memory pointer to. The memory should be allocated and attached in the module's <var class=Va>cb_init</var> hook function.</p><p class=Pp>The <var class=Va>bytes_this_ack</var> field specifies the number of new bytes acknowledged by the most recently received ACK packet. It is only valid in the <var class=Va>ack_received</var> hook function.</p><p class=Pp>The <var class=Va>curack</var> field specifies the sequence number of the most recently received ACK packet. It is only valid in the <var class=Va>ack_received</var>, <var class=Va>cong_signal</var> and <var class=Va>post_recovery</var> hook functions.</p><p class=Pp>The <var class=Va>flags</var> field is used to pass useful information from the stack to a <code class=Nm>mod_cc</code> module. The CCF_ABC_SENTAWND flag is relevant in <var class=Va>ack_received</var> and is set when appropriate byte counting (RFC3465) has counted a window's worth of bytes has been sent. It is the module's responsibility to clear the flag after it has processed the signal. The CCF_CWND_LIMITED flag is relevant in <var class=Va>ack_received</var> and is set when the connection's ability to send data is currently constrained by the value of the congestion window. Algorithms should use the absence of this flag being set to avoid accumulating a large difference between the congestion window and send window.</p><p class=Pp>The <var class=Va>nsegs</var> variable is used to pass in how much compression was done by the local LRO system. So for example if LRO pushed three in-order acknowledgements into one acknowledgement the variable would be set to three.</p><p class=Pp>The <var class=Va>labc</var> variable is used in conjunction with the CCF_USE_LOCAL_ABC flag to override what labc variable the congestion controller will use for this particular acknowledgement.</p></section><section class=Sh><h2 class=Sh id=SEE_ALSO><a class=permalink href=#SEE_ALSO>SEE ALSO</a></h2><a class=Xr href=cc_cdg.4.html>cc_cdg(4)</a>, <a class=Xr href=cc_chd.4.html>cc_chd(4)</a>, <a class=Xr href=cc_cubic.4.html>cc_cubic(4)</a>, <a class=Xr href=cc_dctcp.4.html>cc_dctcp(4)</a>, <a class=Xr href=cc_hd.4.html>cc_hd(4)</a>, <a class=Xr href=cc_htcp.4.html>cc_htcp(4)</a>, <a class=Xr href=cc_newreno.4.html>cc_newreno(4)</a>, <a class=Xr href=cc_vegas.4.html>cc_vegas(4)</a>, <a class=Xr href=mod_cc.4.html>mod_cc(4)</a>, <a class=Xr href=tcp.4.html>tcp(4)</a></section><section class=Sh><h2 class=Sh id=ACKNOWLEDGEMENTS><a class=permalink href=#ACKNOWLEDGEMENTS>ACKNOWLEDGEMENTS</a></h2> Development and testing of this software were made possible in part by grants from the FreeBSD Foundation and Cisco University Research Program Fund at Community Foundation Silicon Valley. </section><section class=Sh><h2 class=Sh id=FUTURE_WORK><a class=permalink href=#FUTURE_WORK>FUTURE WORK</a></h2> Integrate with <a class=Xr href=sctp.4.html>sctp(4)</a>. </section><section class=Sh><h2 class=Sh id=HISTORY><a class=permalink href=#HISTORY>HISTORY</a></h2> The modular Congestion Control (CC) framework first appeared in <span class=Ux>FreeBSD 9.0</span>. <p class=Pp>The framework was first released in 2007 by James Healy and Lawrence Stewart whilst working on the NewTCP research project at Swinburne University of Technology's Centre for Advanced Internet Architectures, Melbourne, Australia, which was made possible in part by a grant from the Cisco University Research Program Fund at Community Foundation Silicon Valley. More details are available at:</p><p class=Pp>http://caia.swin.edu.au/urp/newtcp/</p></section><section class=Sh><h2 class=Sh id=AUTHORS><a class=permalink href=#AUTHORS>AUTHORS</a></h2> The <code class=Nm>mod_cc</code> framework was written by <span class=An>Lawrence Stewart</span> &lt;<a class=Mt href=mailto:lstewart@FreeBSD.org>lstewart@FreeBSD.org</a>&gt;, <span class=An>James Healy</span> &lt;<a class=Mt href=mailto:jimmy@deefa.com>jimmy@deefa.com</a>&gt; and <span class=An>David Hayes</span> &lt;<a class=Mt href=mailto:david.hayes@ieee.org>david.hayes@ieee.org</a>&gt;. <p class=Pp>This manual page was written by <span class=An>David Hayes</span> &lt;<a class=Mt href=mailto:david.hayes@ieee.org>david.hayes@ieee.org</a>&gt; and <span class=An>Lawrence Stewart</span> &lt;<a class=Mt href=mailto:lstewart@FreeBSD.org>lstewart@FreeBSD.org</a>&gt;.</p></section></div><table class=foot><tr><td class=foot-date>May 13, 2021</td><td class=foot-os>FreeBSD 13.1-RELEASE-p2</td></tr></table></div></div><html><body><footer><p>©️ 2023 Inobulles</p></footer></body></html></body></html>